/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//! moment.js
//! version : 2.13.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com

/*
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined
 * in FIPS PUB 180-1
 * Version 2.1a Copyright Paul Johnston 2000 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for details.
 */

/*
 * A JavaScript implementation of the RSA Data Security, Inc. MD5 Message
 * Digest Algorithm, as defined in RFC 1321.
 * Version 2.1 Copyright (C) Paul Johnston 1999 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for more info.
 */

/*
    This program is distributed under the terms of the MIT license.
    Please see the LICENSE file for details.

    Copyright 2006-2008, OGG, LLC
*/

/*!
 * jQuery Browser Plugin 0.1.0
 * https://github.com/gabceb/jquery-browser-plugin
 *
 * Original jquery-browser code Copyright 2005, 2015 jQuery Foundation, Inc. and other contributors
 * http://jquery.org/license
 *
 * Modifications Copyright 2015 Gabriel Cebrian
 * https://github.com/gabceb
 *
 * Released under the MIT license
 *
 * Date: 05-07-2015
 */

/**
 * @license text 2.0.15 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/text/LICENSE
 */

// RequireJS UnderscoreJS template plugin
// http://github.com/jfparadis/requirejs-tpl
//
// An alternative to http://github.com/ZeeAgency/requirejs-tpl
//
// Using UnderscoreJS micro-templates at http://underscorejs.org/#template
// Using and RequireJS text.js at http://requirejs.org/docs/api.html#text
// @author JF Paradis
// @version 0.0.2
//
// Released under the MIT license
//
// Usage:
//   require(['backbone', 'tpl!mytemplate'], function (Backbone, mytemplate) {
//     return Backbone.View.extend({
//       initialize: function(){
//         this.render();
//       },
//       render: function(){
//         this.$el.html(mytemplate({message: 'hello'}));
//     });
//   });
//
// Configuration: (optional)
//   require.config({
//     tpl: {
//       extension: '.tpl' // default = '.html'
//     }
//   });

/*
  Copyright 2010, Fran√ßois de Metz <francois@2metz.fr>
*/

//     (c) 2010-2016 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/*!
 * Backbone.Overview 
 *
 * Copyright (c) 2014, JC Brand <jc@opkode.com>
 * Licensed under the Mozilla Public License (MPL) 
 */

// Converse.js (A browser based XMPP chat client)
// http://conversejs.org
//
// Copyright (c) 2012-2016, Jan-Carel Brand <jc@opkode.com>
// Licensed under the Mozilla Public License (MPLv2)
//

/*
jed.js
v0.5.0beta

https://github.com/SlexAxton/Jed
-----------
A gettext compatible i18n library for modern JavaScript Applications

by Alex Sexton - AlexSexton [at] gmail - @SlexAxton
WTFPL license for use
Dojo CLA for contributions

Jed offers the entire applicable GNU gettext spec'd set of
functions, but also offers some nicer wrappers around them.
The api for gettext was written for a language with no function
overloading, so Jed allows a little more of that.

Many thanks to Joshua I. Miller - unrtst@cpan.org - who wrote
gettext.js back in 2008. I was able to vet a lot of my ideas
against his. I also made sure Jed passed against his tests
in order to offer easy upgrades -- jsgettext.berlios.de
*/

// Underscore 1.3.0 was used to port and is licensed

/**
   sprintf() for JavaScript 0.7-beta1
   http://www.diveintojavascript.com/projects/javascript-sprintf

   Copyright (c) Alexandru Marasteanu <alexaholic [at) gmail (dot] com>
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are met:
       * Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.
       * Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in the
         documentation and/or other materials provided with the distribution.
       * Neither the name of sprintf() for JavaScript nor the
         names of its contributors may be used to endorse or promote products
         derived from this software without specific prior written permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
   WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
   DISCLAIMED. IN NO EVENT SHALL Alexandru Marasteanu BE LIABLE FOR ANY
   DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
   (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
   LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
   ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  */

/*
CryptoJS v3.1.2
code.google.com/p/crypto-js
(c) 2009-2013 by Jeff Mott. All rights reserved.
code.google.com/p/crypto-js/wiki/License
*/

/*!
 * EventEmitter v4.2.3 - git.io/ee
 * Oliver Caldwell
 * MIT license
 * @preserve
 */

/*!

  otr.js v0.2.12 - 2014-04-15
  (c) 2014 - Arlo Breault <arlolra@gmail.com>
  Freely distributed under the MPL v2.0 license.

  This file is concatenated for the browser.
  Please see: https://github.com/arlolra/otr

*/

/*
* Based on Ping Strophejs plugins (https://github.com/metajack/strophejs-plugins/tree/master/ping)
* This plugin is distributed under the terms of the MIT licence.
* Please see the LICENCE file for details.
*
* Copyright (c) Markus Kohlhase, 2010
* Refactored by Pavel Lang, 2011
* AMD Support added by Thierry
*/

/*!
 * typeahead.js 0.10.5
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT
 */

var requirejs,require,define;!function(t){function e(t,e){return v.call(t,e)}function n(t,e){var n,i,s,r,o,a,c,l,u,h,d,f,p=e&&e.split("/"),_=m.map,g=_&&_["*"]||{};if(t){for(t=t.split("/"),o=t.length-1,m.nodeIdCompat&&b.test(t[o])&&(t[o]=t[o].replace(b,"")),"."===t[0].charAt(0)&&p&&(f=p.slice(0,p.length-1),t=f.concat(t)),u=0;u<t.length;u++)if(d=t[u],"."===d)t.splice(u,1),u-=1;else if(".."===d){if(0===u||1===u&&".."===t[2]||".."===t[u-1])continue;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}if((p||g)&&_){for(n=t.split("/"),u=n.length;u>0;u-=1){if(i=n.slice(0,u).join("/"),p)for(h=p.length;h>0;h-=1)if(s=_[p.slice(0,h).join("/")],s&&(s=s[i])){r=s,a=u;break}if(r)break;!c&&g&&g[i]&&(c=g[i],l=u)}!r&&c&&(r=c,a=l),r&&(n.splice(0,a,r),t=n.join("/"))}return t}function i(e,n){return function(){var i=y.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),h.apply(t,i.concat([e,n]))}}function s(t){return function(e){return n(e,t)}}function r(t){return function(e){p[t]=e}}function o(n){if(e(_,n)){var i=_[n];delete _[n],g[n]=!0,u.apply(t,i)}if(!e(p,n)&&!e(g,n))throw new Error("No "+n);return p[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function c(t){return t?a(t):[]}function l(t){return function(){return m&&m.config&&m.config[t]||{}}}var u,h,d,f,p={},_={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice,b=/\.js$/;d=function(t,e){var i,r=a(t),c=r[0],l=e[1];return t=r[1],c&&(c=n(c,l),i=o(c)),c?t=i&&i.normalize?i.normalize(t,s(l)):n(t,l):(t=n(t,l),r=a(t),c=r[0],t=r[1],c&&(i=o(c))),{f:c?c+"!"+t:t,n:t,pr:c,p:i}},f={require:function(t){return i(t)},exports:function(t){var e=p[t];return"undefined"!=typeof e?e:p[t]={}},module:function(t){return{id:t,uri:"",exports:p[t],config:l(t)}}},u=function(n,s,a,l){var u,h,m,v,y,b,w,S=[],x=typeof a;if(l=l||n,b=c(l),"undefined"===x||"function"===x){for(s=!s.length&&a.length?["require","exports","module"]:s,y=0;y<s.length;y+=1)if(v=d(s[y],b),h=v.f,"require"===h)S[y]=f.require(n);else if("exports"===h)S[y]=f.exports(n),w=!0;else if("module"===h)u=S[y]=f.module(n);else if(e(p,h)||e(_,h)||e(g,h))S[y]=o(h);else{if(!v.p)throw new Error(n+" missing "+h);v.p.load(v.n,i(l,!0),r(h),{}),S[y]=p[h]}m=a?a.apply(p[n],S):void 0,n&&(u&&u.exports!==t&&u.exports!==p[n]?p[n]=u.exports:m===t&&w||(p[n]=m))}else n&&(p[n]=a)},requirejs=require=h=function(e,n,i,s,r){if("string"==typeof e)return f[e]?f[e](n):o(d(e,c(n)).f);if(!e.splice){if(m=e,m.deps&&h(m.deps,m.callback),!n)return;n.splice?(e=n,n=i,i=null):e=t}return n=n||function(){},"function"==typeof i&&(i=s,s=r),s?u(t,e,n,i):setTimeout(function(){u(t,e,n,i)},4),h},h.config=function(t){return h(t)},requirejs._defined=p,define=function(t,n,i){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");n.splice||(i=n,n=[]),e(p,t)||e(_,t)||(_[t]=[t,n,i])},define.amd={jQuery:!0}}(),define("almond",function(){}),function(){function t(t){function e(e,n,i,s,r,o){for(;r>=0&&r<o;r+=t){var a=s?s[r]:r;i=n(i,e[a],a,e)}return i}return function(n,i,s,r){i=y(i,r,4);var o=!C(n)&&v.keys(n),a=(o||n).length,c=t>0?0:a-1;return arguments.length<3&&(s=n[o?o[c]:c],c+=t),e(n,i,s,o,c,a)}}function e(t){return function(e,n,i){n=b(n,i);for(var s=k(e),r=t>0?0:s-1;r>=0&&r<s;r+=t)if(n(e[r],r,e))return r;return-1}}function n(t,e,n){return function(i,s,r){var o=0,a=k(i);if("number"==typeof r)t>0?o=r>=0?r:Math.max(r+a,o):a=r>=0?Math.min(r+1,a):r+a+1;else if(n&&r&&a)return r=n(i,s),i[r]===s?r:-1;if(s!==s)return r=e(u.call(i,o,a),v.isNaN),r>=0?r+o:-1;for(r=t>0?o:a-1;r>=0&&r<a;r+=t)if(i[r]===s)return r;return-1}}function i(t,e){var n=N.length,i=t.constructor,s=v.isFunction(i)&&i.prototype||a,r="constructor";for(v.has(t,r)&&!v.contains(e,r)&&e.push(r);n--;)r=N[n],r in t&&t[r]!==s[r]&&!v.contains(e,r)&&e.push(r)}var s=this,r=s._,o=Array.prototype,a=Object.prototype,c=Function.prototype,l=o.push,u=o.slice,h=a.toString,d=a.hasOwnProperty,f=Array.isArray,p=Object.keys,_=c.bind,m=Object.create,g=function(){},v=function(t){return t instanceof v?t:this instanceof v?void(this._wrapped=t):new v(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=v),exports._=v):s._=v,v.VERSION="1.8.3";var y=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,s){return t.call(e,n,i,s)};case 4:return function(n,i,s,r){return t.call(e,n,i,s,r)}}return function(){return t.apply(e,arguments)}},b=function(t,e,n){return null==t?v.identity:v.isFunction(t)?y(t,e,n):v.isObject(t)?v.matcher(t):v.property(t)};v.iteratee=function(t,e){return b(t,e,1/0)};var w=function(t,e){return function(n){var i=arguments.length;if(i<2||null==n)return n;for(var s=1;s<i;s++)for(var r=arguments[s],o=t(r),a=o.length,c=0;c<a;c++){var l=o[c];e&&void 0!==n[l]||(n[l]=r[l])}return n}},S=function(t){if(!v.isObject(t))return{};if(m)return m(t);g.prototype=t;var e=new g;return g.prototype=null,e},x=function(t){return function(e){return null==e?void 0:e[t]}},M=Math.pow(2,53)-1,k=x("length"),C=function(t){var e=k(t);return"number"==typeof e&&e>=0&&e<=M};v.each=v.forEach=function(t,e,n){e=y(e,n);var i,s;if(C(t))for(i=0,s=t.length;i<s;i++)e(t[i],i,t);else{var r=v.keys(t);for(i=0,s=r.length;i<s;i++)e(t[r[i]],r[i],t)}return t},v.map=v.collect=function(t,e,n){e=b(e,n);for(var i=!C(t)&&v.keys(t),s=(i||t).length,r=Array(s),o=0;o<s;o++){var a=i?i[o]:o;r[o]=e(t[a],a,t)}return r},v.reduce=v.foldl=v.inject=t(1),v.reduceRight=v.foldr=t(-1),v.find=v.detect=function(t,e,n){var i;if(i=C(t)?v.findIndex(t,e,n):v.findKey(t,e,n),void 0!==i&&i!==-1)return t[i]},v.filter=v.select=function(t,e,n){var i=[];return e=b(e,n),v.each(t,function(t,n,s){e(t,n,s)&&i.push(t)}),i},v.reject=function(t,e,n){return v.filter(t,v.negate(b(e)),n)},v.every=v.all=function(t,e,n){e=b(e,n);for(var i=!C(t)&&v.keys(t),s=(i||t).length,r=0;r<s;r++){var o=i?i[r]:r;if(!e(t[o],o,t))return!1}return!0},v.some=v.any=function(t,e,n){e=b(e,n);for(var i=!C(t)&&v.keys(t),s=(i||t).length,r=0;r<s;r++){var o=i?i[r]:r;if(e(t[o],o,t))return!0}return!1},v.contains=v.includes=v.include=function(t,e,n,i){return C(t)||(t=v.values(t)),("number"!=typeof n||i)&&(n=0),v.indexOf(t,e,n)>=0},v.invoke=function(t,e){var n=u.call(arguments,2),i=v.isFunction(e);return v.map(t,function(t){var s=i?e:t[e];return null==s?s:s.apply(t,n)})},v.pluck=function(t,e){return v.map(t,v.property(e))},v.where=function(t,e){return v.filter(t,v.matcher(e))},v.findWhere=function(t,e){return v.find(t,v.matcher(e))},v.max=function(t,e,n){var i,s,r=-(1/0),o=-(1/0);if(null==e&&null!=t){t=C(t)?t:v.values(t);for(var a=0,c=t.length;a<c;a++)i=t[a],i>r&&(r=i)}else e=b(e,n),v.each(t,function(t,n,i){s=e(t,n,i),(s>o||s===-(1/0)&&r===-(1/0))&&(r=t,o=s)});return r},v.min=function(t,e,n){var i,s,r=1/0,o=1/0;if(null==e&&null!=t){t=C(t)?t:v.values(t);for(var a=0,c=t.length;a<c;a++)i=t[a],i<r&&(r=i)}else e=b(e,n),v.each(t,function(t,n,i){s=e(t,n,i),(s<o||s===1/0&&r===1/0)&&(r=t,o=s)});return r},v.shuffle=function(t){for(var e,n=C(t)?t:v.values(t),i=n.length,s=Array(i),r=0;r<i;r++)e=v.random(0,r),e!==r&&(s[r]=s[e]),s[e]=n[r];return s},v.sample=function(t,e,n){return null==e||n?(C(t)||(t=v.values(t)),t[v.random(t.length-1)]):v.shuffle(t).slice(0,Math.max(0,e))},v.sortBy=function(t,e,n){return e=b(e,n),v.pluck(v.map(t,function(t,n,i){return{value:t,index:n,criteria:e(t,n,i)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index-e.index}),"value")};var T=function(t){return function(e,n,i){var s={};return n=b(n,i),v.each(e,function(i,r){var o=n(i,r,e);t(s,i,o)}),s}};v.groupBy=T(function(t,e,n){v.has(t,n)?t[n].push(e):t[n]=[e]}),v.indexBy=T(function(t,e,n){t[n]=e}),v.countBy=T(function(t,e,n){v.has(t,n)?t[n]++:t[n]=1}),v.toArray=function(t){return t?v.isArray(t)?u.call(t):C(t)?v.map(t,v.identity):v.values(t):[]},v.size=function(t){return null==t?0:C(t)?t.length:v.keys(t).length},v.partition=function(t,e,n){e=b(e,n);var i=[],s=[];return v.each(t,function(t,n,r){(e(t,n,r)?i:s).push(t)}),[i,s]},v.first=v.head=v.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:v.initial(t,t.length-e)},v.initial=function(t,e,n){return u.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},v.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:v.rest(t,Math.max(0,t.length-e))},v.rest=v.tail=v.drop=function(t,e,n){return u.call(t,null==e||n?1:e)},v.compact=function(t){return v.filter(t,v.identity)};var A=function(t,e,n,i){for(var s=[],r=0,o=i||0,a=k(t);o<a;o++){var c=t[o];if(C(c)&&(v.isArray(c)||v.isArguments(c))){e||(c=A(c,e,n));var l=0,u=c.length;for(s.length+=u;l<u;)s[r++]=c[l++]}else n||(s[r++]=c)}return s};v.flatten=function(t,e){return A(t,e,!1)},v.without=function(t){return v.difference(t,u.call(arguments,1))},v.uniq=v.unique=function(t,e,n,i){v.isBoolean(e)||(i=n,n=e,e=!1),null!=n&&(n=b(n,i));for(var s=[],r=[],o=0,a=k(t);o<a;o++){var c=t[o],l=n?n(c,o,t):c;e?(o&&r===l||s.push(c),r=l):n?v.contains(r,l)||(r.push(l),s.push(c)):v.contains(s,c)||s.push(c)}return s},v.union=function(){return v.uniq(A(arguments,!0,!0))},v.intersection=function(t){for(var e=[],n=arguments.length,i=0,s=k(t);i<s;i++){var r=t[i];if(!v.contains(e,r)){for(var o=1;o<n&&v.contains(arguments[o],r);o++);o===n&&e.push(r)}}return e},v.difference=function(t){var e=A(arguments,!0,!0,1);return v.filter(t,function(t){return!v.contains(e,t)})},v.zip=function(){return v.unzip(arguments)},v.unzip=function(t){for(var e=t&&v.max(t,k).length||0,n=Array(e),i=0;i<e;i++)n[i]=v.pluck(t,i);return n},v.object=function(t,e){for(var n={},i=0,s=k(t);i<s;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},v.findIndex=e(1),v.findLastIndex=e(-1),v.sortedIndex=function(t,e,n,i){n=b(n,i,1);for(var s=n(e),r=0,o=k(t);r<o;){var a=Math.floor((r+o)/2);n(t[a])<s?r=a+1:o=a}return r},v.indexOf=n(1,v.findIndex,v.sortedIndex),v.lastIndexOf=n(-1,v.findLastIndex),v.range=function(t,e,n){null==e&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),s=Array(i),r=0;r<i;r++,t+=n)s[r]=t;return s};var E=function(t,e,n,i,s){if(!(i instanceof e))return t.apply(n,s);var r=S(t.prototype),o=t.apply(r,s);return v.isObject(o)?o:r};v.bind=function(t,e){if(_&&t.bind===_)return _.apply(t,u.call(arguments,1));if(!v.isFunction(t))throw new TypeError("Bind must be called on a function");var n=u.call(arguments,2),i=function(){return E(t,i,e,this,n.concat(u.call(arguments)))};return i},v.partial=function(t){var e=u.call(arguments,1),n=function(){for(var i=0,s=e.length,r=Array(s),o=0;o<s;o++)r[o]=e[o]===v?arguments[i++]:e[o];for(;i<arguments.length;)r.push(arguments[i++]);return E(t,n,this,this,r)};return n},v.bindAll=function(t){var e,n,i=arguments.length;if(i<=1)throw new Error("bindAll must be passed function names");for(e=1;e<i;e++)n=arguments[e],t[n]=v.bind(t[n],t);return t},v.memoize=function(t,e){var n=function(i){var s=n.cache,r=""+(e?e.apply(this,arguments):i);return v.has(s,r)||(s[r]=t.apply(this,arguments)),s[r]};return n.cache={},n},v.delay=function(t,e){var n=u.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},v.defer=v.partial(v.delay,v,1),v.throttle=function(t,e,n){var i,s,r,o=null,a=0;n||(n={});var c=function(){a=n.leading===!1?0:v.now(),o=null,r=t.apply(i,s),o||(i=s=null)};return function(){var l=v.now();a||n.leading!==!1||(a=l);var u=e-(l-a);return i=this,s=arguments,u<=0||u>e?(o&&(clearTimeout(o),o=null),a=l,r=t.apply(i,s),o||(i=s=null)):o||n.trailing===!1||(o=setTimeout(c,u)),r}},v.debounce=function(t,e,n){var i,s,r,o,a,c=function(){var l=v.now()-o;l<e&&l>=0?i=setTimeout(c,e-l):(i=null,n||(a=t.apply(r,s),i||(r=s=null)))};return function(){r=this,s=arguments,o=v.now();var l=n&&!i;return i||(i=setTimeout(c,e)),l&&(a=t.apply(r,s),r=s=null),a}},v.wrap=function(t,e){return v.partial(e,t)},v.negate=function(t){return function(){return!t.apply(this,arguments)}},v.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,i=t[e].apply(this,arguments);n--;)i=t[n].call(this,i);return i}},v.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},v.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},v.once=v.partial(v.before,2);var D=!{toString:null}.propertyIsEnumerable("toString"),N=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];v.keys=function(t){if(!v.isObject(t))return[];if(p)return p(t);var e=[];for(var n in t)v.has(t,n)&&e.push(n);return D&&i(t,e),e},v.allKeys=function(t){if(!v.isObject(t))return[];var e=[];for(var n in t)e.push(n);return D&&i(t,e),e},v.values=function(t){for(var e=v.keys(t),n=e.length,i=Array(n),s=0;s<n;s++)i[s]=t[e[s]];return i},v.mapObject=function(t,e,n){e=b(e,n);for(var i,s=v.keys(t),r=s.length,o={},a=0;a<r;a++)i=s[a],o[i]=e(t[i],i,t);return o},v.pairs=function(t){for(var e=v.keys(t),n=e.length,i=Array(n),s=0;s<n;s++)i[s]=[e[s],t[e[s]]];return i},v.invert=function(t){for(var e={},n=v.keys(t),i=0,s=n.length;i<s;i++)e[t[n[i]]]=n[i];return e},v.functions=v.methods=function(t){var e=[];for(var n in t)v.isFunction(t[n])&&e.push(n);return e.sort()},v.extend=w(v.allKeys),v.extendOwn=v.assign=w(v.keys),v.findKey=function(t,e,n){e=b(e,n);for(var i,s=v.keys(t),r=0,o=s.length;r<o;r++)if(i=s[r],e(t[i],i,t))return i},v.pick=function(t,e,n){var i,s,r={},o=t;if(null==o)return r;v.isFunction(e)?(s=v.allKeys(o),i=y(e,n)):(s=A(arguments,!1,!1,1),i=function(t,e,n){return e in n},o=Object(o));for(var a=0,c=s.length;a<c;a++){var l=s[a],u=o[l];i(u,l,o)&&(r[l]=u)}return r},v.omit=function(t,e,n){if(v.isFunction(e))e=v.negate(e);else{var i=v.map(A(arguments,!1,!1,1),String);e=function(t,e){return!v.contains(i,e)}}return v.pick(t,e,n)},v.defaults=w(v.allKeys,!0),v.create=function(t,e){var n=S(t);return e&&v.extendOwn(n,e),n},v.clone=function(t){return v.isObject(t)?v.isArray(t)?t.slice():v.extend({},t):t},v.tap=function(t,e){return e(t),t},v.isMatch=function(t,e){var n=v.keys(e),i=n.length;if(null==t)return!i;for(var s=Object(t),r=0;r<i;r++){var o=n[r];if(e[o]!==s[o]||!(o in s))return!1}return!0};var O=function(t,e,n,i){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof v&&(t=t._wrapped),e instanceof v&&(e=e._wrapped);var s=h.call(t);if(s!==h.call(e))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var r="[object Array]"===s;if(!r){if("object"!=typeof t||"object"!=typeof e)return!1;var o=t.constructor,a=e.constructor;if(o!==a&&!(v.isFunction(o)&&o instanceof o&&v.isFunction(a)&&a instanceof a)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],i=i||[];for(var c=n.length;c--;)if(n[c]===t)return i[c]===e;if(n.push(t),i.push(e),r){if(c=t.length,c!==e.length)return!1;for(;c--;)if(!O(t[c],e[c],n,i))return!1}else{var l,u=v.keys(t);if(c=u.length,v.keys(e).length!==c)return!1;for(;c--;)if(l=u[c],!v.has(e,l)||!O(t[l],e[l],n,i))return!1}return n.pop(),i.pop(),!0};v.isEqual=function(t,e){return O(t,e)},v.isEmpty=function(t){return null==t||(C(t)&&(v.isArray(t)||v.isString(t)||v.isArguments(t))?0===t.length:0===v.keys(t).length)},v.isElement=function(t){return!(!t||1!==t.nodeType)},v.isArray=f||function(t){return"[object Array]"===h.call(t)},v.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},v.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){v["is"+t]=function(e){return h.call(e)==="[object "+t+"]"}}),v.isArguments(arguments)||(v.isArguments=function(t){return v.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(v.isFunction=function(t){return"function"==typeof t||!1}),v.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},v.isNaN=function(t){return v.isNumber(t)&&t!==+t},v.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===h.call(t)},v.isNull=function(t){return null===t},v.isUndefined=function(t){return void 0===t},v.has=function(t,e){return null!=t&&d.call(t,e)},v.noConflict=function(){return s._=r,this},v.identity=function(t){return t},v.constant=function(t){return function(){return t}},v.noop=function(){},v.property=x,v.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},v.matcher=v.matches=function(t){return t=v.extendOwn({},t),function(e){return v.isMatch(e,t)}},v.times=function(t,e,n){var i=Array(Math.max(0,t));e=y(e,n,1);for(var s=0;s<t;s++)i[s]=e(s);return i},v.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},v.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=v.invert(j),R=function(t){var e=function(e){return t[e]},n="(?:"+v.keys(t).join("|")+")",i=RegExp(n),s=RegExp(n,"g");return function(t){return t=null==t?"":""+t,i.test(t)?t.replace(s,e):t}};v.escape=R(j),v.unescape=R(I),v.result=function(t,e,n){var i=null==t?void 0:t[e];return void 0===i&&(i=n),v.isFunction(i)?i.call(t):i};var L=0;v.uniqueId=function(t){var e=++L+"";return t?t+e:e},v.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Y=/\\|'|\r|\n|\u2028|\u2029/g,F=function(t){return"\\"+P[t]};v.template=function(t,e,n){!e&&n&&(e=n),e=v.defaults({},e,v.templateSettings);var i=RegExp([(e.escape||H).source,(e.interpolate||H).source,(e.evaluate||H).source].join("|")+"|$","g"),s=0,r="__p+='";t.replace(i,function(e,n,i,o,a){return r+=t.slice(s,a).replace(Y,F),s=a+e.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":o&&(r+="';\n"+o+"\n__p+='"),e}),r+="';\n",e.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{var o=new Function(e.variable||"obj","_",r)}catch(t){throw t.source=r,t}var a=function(t){return o.call(this,t,v)},c=e.variable||"obj";return a.source="function("+c+"){\n"+r+"}",a},v.chain=function(t){var e=v(t);return e._chain=!0,e};var B=function(t,e){return t._chain?v(e).chain():e};v.mixin=function(t){v.each(v.functions(t),function(e){var n=v[e]=t[e];v.prototype[e]=function(){var t=[this._wrapped];return l.apply(t,arguments),B(this,n.apply(v,t))}})},v.mixin(v),v.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=o[t];v.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],B(this,n)}}),v.each(["concat","join","slice"],function(t){var e=o[t];v.prototype[t]=function(){return B(this,e.apply(this._wrapped,arguments))}}),v.prototype.value=function(){return this._wrapped},v.prototype.valueOf=v.prototype.toJSON=v.prototype.value,v.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return v})}.call(this),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("moment",e):t.moment=e()}(this,function(){"use strict";function t(){return oi.apply(null,arguments)}function e(t){oi=t}function n(t){return t instanceof Array||"[object Array]"===Object.prototype.toString.call(t)}function i(t){return t instanceof Date||"[object Date]"===Object.prototype.toString.call(t)}function s(t,e){var n,i=[];for(n=0;n<t.length;++n)i.push(e(t[n],n));return i}function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function o(t,e){for(var n in e)r(e,n)&&(t[n]=e[n]);return r(e,"toString")&&(t.toString=e.toString),r(e,"valueOf")&&(t.valueOf=e.valueOf),t}function a(t,e,n,i){return Rt(t,e,n,i,!0).utc()}function c(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null}}function l(t){return null==t._pf&&(t._pf=c()),t._pf}function u(t){if(null==t._isValid){var e=l(t),n=ai.call(e.parsedDateParts,function(t){return null!=t});t._isValid=!isNaN(t._d.getTime())&&e.overflow<0&&!e.empty&&!e.invalidMonth&&!e.invalidWeekday&&!e.nullInput&&!e.invalidFormat&&!e.userInvalidated&&(!e.meridiem||e.meridiem&&n),t._strict&&(t._isValid=t._isValid&&0===e.charsLeftOver&&0===e.unusedTokens.length&&void 0===e.bigHour)}return t._isValid}function h(t){var e=a(NaN);return null!=t?o(l(e),t):l(e).userInvalidated=!0,e}function d(t){return void 0===t}function f(t,e){var n,i,s;if(d(e._isAMomentObject)||(t._isAMomentObject=e._isAMomentObject),d(e._i)||(t._i=e._i),d(e._f)||(t._f=e._f),d(e._l)||(t._l=e._l),d(e._strict)||(t._strict=e._strict),d(e._tzm)||(t._tzm=e._tzm),d(e._isUTC)||(t._isUTC=e._isUTC),d(e._offset)||(t._offset=e._offset),d(e._pf)||(t._pf=l(e)),d(e._locale)||(t._locale=e._locale),ci.length>0)for(n in ci)i=ci[n],s=e[i],d(s)||(t[i]=s);return t}function p(e){f(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),li===!1&&(li=!0,t.updateOffset(this),li=!1)}function _(t){return t instanceof p||null!=t&&null!=t._isAMomentObject}function m(t){return t<0?Math.ceil(t):Math.floor(t)}function g(t){var e=+t,n=0;return 0!==e&&isFinite(e)&&(n=m(e)),n}function v(t,e,n){var i,s=Math.min(t.length,e.length),r=Math.abs(t.length-e.length),o=0;for(i=0;i<s;i++)(n&&t[i]!==e[i]||!n&&g(t[i])!==g(e[i]))&&o++;return o+r}function y(e){t.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function b(e,n){var i=!0;return o(function(){return null!=t.deprecationHandler&&t.deprecationHandler(null,e),i&&(y(e+"\nArguments: "+Array.prototype.slice.call(arguments).join(", ")+"\n"+(new Error).stack),i=!1),n.apply(this,arguments)},n)}function w(e,n){null!=t.deprecationHandler&&t.deprecationHandler(e,n),ui[e]||(y(n),ui[e]=!0)}function S(t){return t instanceof Function||"[object Function]"===Object.prototype.toString.call(t)}function x(t){return"[object Object]"===Object.prototype.toString.call(t)}function M(t){var e,n;for(n in t)e=t[n],S(e)?this[n]=e:this["_"+n]=e;this._config=t,this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function k(t,e){var n,i=o({},t);for(n in e)r(e,n)&&(x(t[n])&&x(e[n])?(i[n]={},o(i[n],t[n]),o(i[n],e[n])):null!=e[n]?i[n]=e[n]:delete i[n]);return i}function C(t){null!=t&&this.set(t)}function T(t){return t?t.toLowerCase().replace("_","-"):t}function A(t){for(var e,n,i,s,r=0;r<t.length;){for(s=T(t[r]).split("-"),e=s.length,n=T(t[r+1]),n=n?n.split("-"):null;e>0;){if(i=E(s.slice(0,e).join("-")))return i;if(n&&n.length>=e&&v(s,n,!0)>=e-1)break;e--}r++}return null}function E(t){var e=null;if(!pi[t]&&"undefined"!=typeof module&&module&&module.exports)try{e=di._abbr,require("./locale/"+t),D(e)}catch(t){}return pi[t]}function D(t,e){var n;return t&&(n=d(e)?j(t):N(t,e),n&&(di=n)),di._abbr}function N(t,e){return null!==e?(e.abbr=t,null!=pi[t]?(w("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale"),e=k(pi[t]._config,e)):null!=e.parentLocale&&(null!=pi[e.parentLocale]?e=k(pi[e.parentLocale]._config,e):w("parentLocaleUndefined","specified parentLocale is not defined yet")),pi[t]=new C(e),D(t),pi[t]):(delete pi[t],null)}function O(t,e){if(null!=e){var n;null!=pi[t]&&(e=k(pi[t]._config,e)),n=new C(e),n.parentLocale=pi[t],pi[t]=n,D(t)}else null!=pi[t]&&(null!=pi[t].parentLocale?pi[t]=pi[t].parentLocale:null!=pi[t]&&delete pi[t]);return pi[t]}function j(t){var e;if(t&&t._locale&&t._locale._abbr&&(t=t._locale._abbr),!t)return di;if(!n(t)){if(e=E(t))return e;t=[t]}return A(t)}function I(){return hi(pi)}function R(t,e){var n=t.toLowerCase();_i[n]=_i[n+"s"]=_i[e]=t}function L(t){return"string"==typeof t?_i[t]||_i[t.toLowerCase()]:void 0}function H(t){var e,n,i={};for(n in t)r(t,n)&&(e=L(n),e&&(i[e]=t[n]));return i}function P(e,n){return function(i){return null!=i?(F(this,e,i),t.updateOffset(this,n),this):Y(this,e)}}function Y(t,e){return t.isValid()?t._d["get"+(t._isUTC?"UTC":"")+e]():NaN}function F(t,e,n){t.isValid()&&t._d["set"+(t._isUTC?"UTC":"")+e](n)}function B(t,e){var n;if("object"==typeof t)for(n in t)this.set(n,t[n]);else if(t=L(t),S(this[t]))return this[t](e);return this}function z(t,e,n){var i=""+Math.abs(t),s=e-i.length,r=t>=0;return(r?n?"+":"":"-")+Math.pow(10,Math.max(0,s)).toString().substr(1)+i}function $(t,e,n,i){var s=i;"string"==typeof i&&(s=function(){return this[i]()}),t&&(yi[t]=s),e&&(yi[e[0]]=function(){return z(s.apply(this,arguments),e[1],e[2])}),n&&(yi[n]=function(){return this.localeData().ordinal(s.apply(this,arguments),t)})}function q(t){return t.match(/\[[\s\S]/)?t.replace(/^\[|\]$/g,""):t.replace(/\\/g,"")}function U(t){var e,n,i=t.match(mi);for(e=0,n=i.length;e<n;e++)yi[i[e]]?i[e]=yi[i[e]]:i[e]=q(i[e]);return function(e){var s,r="";for(s=0;s<n;s++)r+=i[s]instanceof Function?i[s].call(e,t):i[s];return r}}function W(t,e){return t.isValid()?(e=G(e,t.localeData()),vi[e]=vi[e]||U(e),vi[e](t)):t.localeData().invalidDate()}function G(t,e){function n(t){return e.longDateFormat(t)||t}var i=5;for(gi.lastIndex=0;i>=0&&gi.test(t);)t=t.replace(gi,n),gi.lastIndex=0,i-=1;return t}function V(t,e,n){Hi[t]=S(e)?e:function(t,i){return t&&n?n:e}}function J(t,e){return r(Hi,t)?Hi[t](e._strict,e._locale):new RegExp(X(t))}function X(t){return K(t.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(t,e,n,i,s){return e||n||i||s}))}function K(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Q(t,e){var n,i=e;for("string"==typeof t&&(t=[t]),"number"==typeof e&&(i=function(t,n){n[e]=g(t)}),n=0;n<t.length;n++)Pi[t[n]]=i}function Z(t,e){Q(t,function(t,n,i,s){i._w=i._w||{},e(t,i._w,i,s)})}function tt(t,e,n){null!=e&&r(Pi,t)&&Pi[t](e,n._a,n,t)}function et(t,e){return new Date(Date.UTC(t,e+1,0)).getUTCDate()}function nt(t,e){return n(this._months)?this._months[t.month()]:this._months[Vi.test(e)?"format":"standalone"][t.month()]}function it(t,e){return n(this._monthsShort)?this._monthsShort[t.month()]:this._monthsShort[Vi.test(e)?"format":"standalone"][t.month()]}function st(t,e,n){var i,s,r,o=t.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)r=a([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===e?(s=fi.call(this._shortMonthsParse,o),s!==-1?s:null):(s=fi.call(this._longMonthsParse,o),s!==-1?s:null):"MMM"===e?(s=fi.call(this._shortMonthsParse,o),s!==-1?s:(s=fi.call(this._longMonthsParse,o),s!==-1?s:null)):(s=fi.call(this._longMonthsParse,o),s!==-1?s:(s=fi.call(this._shortMonthsParse,o),s!==-1?s:null))}function rt(t,e,n){var i,s,r;if(this._monthsParseExact)return st.call(this,t,e,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(s=a([2e3,i]),n&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(s,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(s,"").replace(".","")+"$","i")),n||this._monthsParse[i]||(r="^"+this.months(s,"")+"|^"+this.monthsShort(s,""),this._monthsParse[i]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===e&&this._longMonthsParse[i].test(t))return i;if(n&&"MMM"===e&&this._shortMonthsParse[i].test(t))return i;if(!n&&this._monthsParse[i].test(t))return i}}function ot(t,e){var n;if(!t.isValid())return t;if("string"==typeof e)if(/^\d+$/.test(e))e=g(e);else if(e=t.localeData().monthsParse(e),"number"!=typeof e)return t;return n=Math.min(t.date(),et(t.year(),e)),t._d["set"+(t._isUTC?"UTC":"")+"Month"](e,n),t}function at(e){return null!=e?(ot(this,e),t.updateOffset(this,!0),this):Y(this,"Month")}function ct(){return et(this.year(),this.month())}function lt(t){return this._monthsParseExact?(r(this,"_monthsRegex")||ht.call(this),t?this._monthsShortStrictRegex:this._monthsShortRegex):this._monthsShortStrictRegex&&t?this._monthsShortStrictRegex:this._monthsShortRegex}function ut(t){return this._monthsParseExact?(r(this,"_monthsRegex")||ht.call(this),t?this._monthsStrictRegex:this._monthsRegex):this._monthsStrictRegex&&t?this._monthsStrictRegex:this._monthsRegex}function ht(){function t(t,e){return e.length-t.length}var e,n,i=[],s=[],r=[];for(e=0;e<12;e++)n=a([2e3,e]),i.push(this.monthsShort(n,"")),s.push(this.months(n,"")),r.push(this.months(n,"")),r.push(this.monthsShort(n,""));for(i.sort(t),s.sort(t),r.sort(t),e=0;e<12;e++)i[e]=K(i[e]),s[e]=K(s[e]),r[e]=K(r[e]);this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+s.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+i.join("|")+")","i")}function dt(t){var e,n=t._a;return n&&l(t).overflow===-2&&(e=n[Fi]<0||n[Fi]>11?Fi:n[Bi]<1||n[Bi]>et(n[Yi],n[Fi])?Bi:n[zi]<0||n[zi]>24||24===n[zi]&&(0!==n[$i]||0!==n[qi]||0!==n[Ui])?zi:n[$i]<0||n[$i]>59?$i:n[qi]<0||n[qi]>59?qi:n[Ui]<0||n[Ui]>999?Ui:-1,l(t)._overflowDayOfYear&&(e<Yi||e>Bi)&&(e=Bi),l(t)._overflowWeeks&&e===-1&&(e=Wi),l(t)._overflowWeekday&&e===-1&&(e=Gi),l(t).overflow=e),t}function ft(t){var e,n,i,s,r,o,a=t._i,c=Zi.exec(a)||ts.exec(a);if(c){for(l(t).iso=!0,e=0,n=ns.length;e<n;e++)if(ns[e][1].exec(c[1])){s=ns[e][0],i=ns[e][2]!==!1;break}if(null==s)return void(t._isValid=!1);if(c[3]){for(e=0,n=is.length;e<n;e++)if(is[e][1].exec(c[3])){r=(c[2]||" ")+is[e][0];break}if(null==r)return void(t._isValid=!1)}if(!i&&null!=r)return void(t._isValid=!1);if(c[4]){if(!es.exec(c[4]))return void(t._isValid=!1);o="Z"}t._f=s+(r||"")+(o||""),At(t)}else t._isValid=!1}function pt(e){var n=ss.exec(e._i);return null!==n?void(e._d=new Date(+n[1])):(ft(e),void(e._isValid===!1&&(delete e._isValid,t.createFromInputFallback(e))))}function _t(t,e,n,i,s,r,o){var a=new Date(t,e,n,i,s,r,o);return t<100&&t>=0&&isFinite(a.getFullYear())&&a.setFullYear(t),a}function mt(t){var e=new Date(Date.UTC.apply(null,arguments));return t<100&&t>=0&&isFinite(e.getUTCFullYear())&&e.setUTCFullYear(t),e}function gt(t){return vt(t)?366:365}function vt(t){return t%4===0&&t%100!==0||t%400===0}function yt(){return vt(this.year())}function bt(t,e,n){var i=7+e-n,s=(7+mt(t,0,i).getUTCDay()-e)%7;return-s+i-1}function wt(t,e,n,i,s){var r,o,a=(7+n-i)%7,c=bt(t,i,s),l=1+7*(e-1)+a+c;return l<=0?(r=t-1,o=gt(r)+l):l>gt(t)?(r=t+1,o=l-gt(t)):(r=t,o=l),{year:r,dayOfYear:o}}function St(t,e,n){var i,s,r=bt(t.year(),e,n),o=Math.floor((t.dayOfYear()-r-1)/7)+1;return o<1?(s=t.year()-1,i=o+xt(s,e,n)):o>xt(t.year(),e,n)?(i=o-xt(t.year(),e,n),s=t.year()+1):(s=t.year(),i=o),{week:i,year:s}}function xt(t,e,n){var i=bt(t,e,n),s=bt(t+1,e,n);return(gt(t)-i+s)/7}function Mt(t,e,n){return null!=t?t:null!=e?e:n}function kt(e){var n=new Date(t.now());return e._useUTC?[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()]:[n.getFullYear(),n.getMonth(),n.getDate()]}function Ct(t){var e,n,i,s,r=[];if(!t._d){for(i=kt(t),t._w&&null==t._a[Bi]&&null==t._a[Fi]&&Tt(t),t._dayOfYear&&(s=Mt(t._a[Yi],i[Yi]),t._dayOfYear>gt(s)&&(l(t)._overflowDayOfYear=!0),n=mt(s,0,t._dayOfYear),t._a[Fi]=n.getUTCMonth(),t._a[Bi]=n.getUTCDate()),e=0;e<3&&null==t._a[e];++e)t._a[e]=r[e]=i[e];for(;e<7;e++)t._a[e]=r[e]=null==t._a[e]?2===e?1:0:t._a[e];24===t._a[zi]&&0===t._a[$i]&&0===t._a[qi]&&0===t._a[Ui]&&(t._nextDay=!0,t._a[zi]=0),t._d=(t._useUTC?mt:_t).apply(null,r),null!=t._tzm&&t._d.setUTCMinutes(t._d.getUTCMinutes()-t._tzm),t._nextDay&&(t._a[zi]=24)}}function Tt(t){var e,n,i,s,r,o,a,c;e=t._w,null!=e.GG||null!=e.W||null!=e.E?(r=1,o=4,n=Mt(e.GG,t._a[Yi],St(Lt(),1,4).year),i=Mt(e.W,1),s=Mt(e.E,1),(s<1||s>7)&&(c=!0)):(r=t._locale._week.dow,o=t._locale._week.doy,n=Mt(e.gg,t._a[Yi],St(Lt(),r,o).year),i=Mt(e.w,1),null!=e.d?(s=e.d,(s<0||s>6)&&(c=!0)):null!=e.e?(s=e.e+r,(e.e<0||e.e>6)&&(c=!0)):s=r),
i<1||i>xt(n,r,o)?l(t)._overflowWeeks=!0:null!=c?l(t)._overflowWeekday=!0:(a=wt(n,i,s,r,o),t._a[Yi]=a.year,t._dayOfYear=a.dayOfYear)}function At(e){if(e._f===t.ISO_8601)return void ft(e);e._a=[],l(e).empty=!0;var n,i,s,r,o,a=""+e._i,c=a.length,u=0;for(s=G(e._f,e._locale).match(mi)||[],n=0;n<s.length;n++)r=s[n],i=(a.match(J(r,e))||[])[0],i&&(o=a.substr(0,a.indexOf(i)),o.length>0&&l(e).unusedInput.push(o),a=a.slice(a.indexOf(i)+i.length),u+=i.length),yi[r]?(i?l(e).empty=!1:l(e).unusedTokens.push(r),tt(r,i,e)):e._strict&&!i&&l(e).unusedTokens.push(r);l(e).charsLeftOver=c-u,a.length>0&&l(e).unusedInput.push(a),l(e).bigHour===!0&&e._a[zi]<=12&&e._a[zi]>0&&(l(e).bigHour=void 0),l(e).parsedDateParts=e._a.slice(0),l(e).meridiem=e._meridiem,e._a[zi]=Et(e._locale,e._a[zi],e._meridiem),Ct(e),dt(e)}function Et(t,e,n){var i;return null==n?e:null!=t.meridiemHour?t.meridiemHour(e,n):null!=t.isPM?(i=t.isPM(n),i&&e<12&&(e+=12),i||12!==e||(e=0),e):e}function Dt(t){var e,n,i,s,r;if(0===t._f.length)return l(t).invalidFormat=!0,void(t._d=new Date(NaN));for(s=0;s<t._f.length;s++)r=0,e=f({},t),null!=t._useUTC&&(e._useUTC=t._useUTC),e._f=t._f[s],At(e),u(e)&&(r+=l(e).charsLeftOver,r+=10*l(e).unusedTokens.length,l(e).score=r,(null==i||r<i)&&(i=r,n=e));o(t,n||e)}function Nt(t){if(!t._d){var e=H(t._i);t._a=s([e.year,e.month,e.day||e.date,e.hour,e.minute,e.second,e.millisecond],function(t){return t&&parseInt(t,10)}),Ct(t)}}function Ot(t){var e=new p(dt(jt(t)));return e._nextDay&&(e.add(1,"d"),e._nextDay=void 0),e}function jt(t){var e=t._i,s=t._f;return t._locale=t._locale||j(t._l),null===e||void 0===s&&""===e?h({nullInput:!0}):("string"==typeof e&&(t._i=e=t._locale.preparse(e)),_(e)?new p(dt(e)):(n(s)?Dt(t):s?At(t):i(e)?t._d=e:It(t),u(t)||(t._d=null),t))}function It(e){var r=e._i;void 0===r?e._d=new Date(t.now()):i(r)?e._d=new Date(r.valueOf()):"string"==typeof r?pt(e):n(r)?(e._a=s(r.slice(0),function(t){return parseInt(t,10)}),Ct(e)):"object"==typeof r?Nt(e):"number"==typeof r?e._d=new Date(r):t.createFromInputFallback(e)}function Rt(t,e,n,i,s){var r={};return"boolean"==typeof n&&(i=n,n=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=s,r._l=n,r._i=t,r._f=e,r._strict=i,Ot(r)}function Lt(t,e,n,i){return Rt(t,e,n,i,!1)}function Ht(t,e){var i,s;if(1===e.length&&n(e[0])&&(e=e[0]),!e.length)return Lt();for(i=e[0],s=1;s<e.length;++s)e[s].isValid()&&!e[s][t](i)||(i=e[s]);return i}function Pt(){var t=[].slice.call(arguments,0);return Ht("isBefore",t)}function Yt(){var t=[].slice.call(arguments,0);return Ht("isAfter",t)}function Ft(t){var e=H(t),n=e.year||0,i=e.quarter||0,s=e.month||0,r=e.week||0,o=e.day||0,a=e.hour||0,c=e.minute||0,l=e.second||0,u=e.millisecond||0;this._milliseconds=+u+1e3*l+6e4*c+1e3*a*60*60,this._days=+o+7*r,this._months=+s+3*i+12*n,this._data={},this._locale=j(),this._bubble()}function Bt(t){return t instanceof Ft}function zt(t,e){$(t,0,0,function(){var t=this.utcOffset(),n="+";return t<0&&(t=-t,n="-"),n+z(~~(t/60),2)+e+z(~~t%60,2)})}function $t(t,e){var n=(e||"").match(t)||[],i=n[n.length-1]||[],s=(i+"").match(ls)||["-",0,0],r=+(60*s[1])+g(s[2]);return"+"===s[0]?r:-r}function qt(e,n){var s,r;return n._isUTC?(s=n.clone(),r=(_(e)||i(e)?e.valueOf():Lt(e).valueOf())-s.valueOf(),s._d.setTime(s._d.valueOf()+r),t.updateOffset(s,!1),s):Lt(e).local()}function Ut(t){return 15*-Math.round(t._d.getTimezoneOffset()/15)}function Wt(e,n){var i,s=this._offset||0;return this.isValid()?null!=e?("string"==typeof e?e=$t(Ii,e):Math.abs(e)<16&&(e=60*e),!this._isUTC&&n&&(i=Ut(this)),this._offset=e,this._isUTC=!0,null!=i&&this.add(i,"m"),s!==e&&(!n||this._changeInProgress?le(this,ie(e-s,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?s:Ut(this):null!=e?this:NaN}function Gt(t,e){return null!=t?("string"!=typeof t&&(t=-t),this.utcOffset(t,e),this):-this.utcOffset()}function Vt(t){return this.utcOffset(0,t)}function Jt(t){return this._isUTC&&(this.utcOffset(0,t),this._isUTC=!1,t&&this.subtract(Ut(this),"m")),this}function Xt(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset($t(ji,this._i)),this}function Kt(t){return!!this.isValid()&&(t=t?Lt(t).utcOffset():0,(this.utcOffset()-t)%60===0)}function Qt(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Zt(){if(!d(this._isDSTShifted))return this._isDSTShifted;var t={};if(f(t,this),t=jt(t),t._a){var e=t._isUTC?a(t._a):Lt(t._a);this._isDSTShifted=this.isValid()&&v(t._a,e.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function te(){return!!this.isValid()&&!this._isUTC}function ee(){return!!this.isValid()&&this._isUTC}function ne(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function ie(t,e){var n,i,s,o=t,a=null;return Bt(t)?o={ms:t._milliseconds,d:t._days,M:t._months}:"number"==typeof t?(o={},e?o[e]=t:o.milliseconds=t):(a=us.exec(t))?(n="-"===a[1]?-1:1,o={y:0,d:g(a[Bi])*n,h:g(a[zi])*n,m:g(a[$i])*n,s:g(a[qi])*n,ms:g(a[Ui])*n}):(a=hs.exec(t))?(n="-"===a[1]?-1:1,o={y:se(a[2],n),M:se(a[3],n),w:se(a[4],n),d:se(a[5],n),h:se(a[6],n),m:se(a[7],n),s:se(a[8],n)}):null==o?o={}:"object"==typeof o&&("from"in o||"to"in o)&&(s=oe(Lt(o.from),Lt(o.to)),o={},o.ms=s.milliseconds,o.M=s.months),i=new Ft(o),Bt(t)&&r(t,"_locale")&&(i._locale=t._locale),i}function se(t,e){var n=t&&parseFloat(t.replace(",","."));return(isNaN(n)?0:n)*e}function re(t,e){var n={milliseconds:0,months:0};return n.months=e.month()-t.month()+12*(e.year()-t.year()),t.clone().add(n.months,"M").isAfter(e)&&--n.months,n.milliseconds=+e-+t.clone().add(n.months,"M"),n}function oe(t,e){var n;return t.isValid()&&e.isValid()?(e=qt(e,t),t.isBefore(e)?n=re(t,e):(n=re(e,t),n.milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function ae(t){return t<0?Math.round(-1*t)*-1:Math.round(t)}function ce(t,e){return function(n,i){var s,r;return null===i||isNaN(+i)||(w(e,"moment()."+e+"(period, number) is deprecated. Please use moment()."+e+"(number, period)."),r=n,n=i,i=r),n="string"==typeof n?+n:n,s=ie(n,i),le(this,s,t),this}}function le(e,n,i,s){var r=n._milliseconds,o=ae(n._days),a=ae(n._months);e.isValid()&&(s=null==s||s,r&&e._d.setTime(e._d.valueOf()+r*i),o&&F(e,"Date",Y(e,"Date")+o*i),a&&ot(e,Y(e,"Month")+a*i),s&&t.updateOffset(e,o||a))}function ue(t,e){var n=t||Lt(),i=qt(n,this).startOf("day"),s=this.diff(i,"days",!0),r=s<-6?"sameElse":s<-1?"lastWeek":s<0?"lastDay":s<1?"sameDay":s<2?"nextDay":s<7?"nextWeek":"sameElse",o=e&&(S(e[r])?e[r]():e[r]);return this.format(o||this.localeData().calendar(r,this,Lt(n)))}function he(){return new p(this)}function de(t,e){var n=_(t)?t:Lt(t);return!(!this.isValid()||!n.isValid())&&(e=L(d(e)?"millisecond":e),"millisecond"===e?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(e).valueOf())}function fe(t,e){var n=_(t)?t:Lt(t);return!(!this.isValid()||!n.isValid())&&(e=L(d(e)?"millisecond":e),"millisecond"===e?this.valueOf()<n.valueOf():this.clone().endOf(e).valueOf()<n.valueOf())}function pe(t,e,n,i){return i=i||"()",("("===i[0]?this.isAfter(t,n):!this.isBefore(t,n))&&(")"===i[1]?this.isBefore(e,n):!this.isAfter(e,n))}function _e(t,e){var n,i=_(t)?t:Lt(t);return!(!this.isValid()||!i.isValid())&&(e=L(e||"millisecond"),"millisecond"===e?this.valueOf()===i.valueOf():(n=i.valueOf(),this.clone().startOf(e).valueOf()<=n&&n<=this.clone().endOf(e).valueOf()))}function me(t,e){return this.isSame(t,e)||this.isAfter(t,e)}function ge(t,e){return this.isSame(t,e)||this.isBefore(t,e)}function ve(t,e,n){var i,s,r,o;return this.isValid()?(i=qt(t,this),i.isValid()?(s=6e4*(i.utcOffset()-this.utcOffset()),e=L(e),"year"===e||"month"===e||"quarter"===e?(o=ye(this,i),"quarter"===e?o/=3:"year"===e&&(o/=12)):(r=this-i,o="second"===e?r/1e3:"minute"===e?r/6e4:"hour"===e?r/36e5:"day"===e?(r-s)/864e5:"week"===e?(r-s)/6048e5:r),n?o:m(o)):NaN):NaN}function ye(t,e){var n,i,s=12*(e.year()-t.year())+(e.month()-t.month()),r=t.clone().add(s,"months");return e-r<0?(n=t.clone().add(s-1,"months"),i=(e-r)/(r-n)):(n=t.clone().add(s+1,"months"),i=(e-r)/(n-r)),-(s+i)||0}function be(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function we(){var t=this.clone().utc();return 0<t.year()&&t.year()<=9999?S(Date.prototype.toISOString)?this.toDate().toISOString():W(t,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):W(t,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function Se(e){e||(e=this.isUtc()?t.defaultFormatUtc:t.defaultFormat);var n=W(this,e);return this.localeData().postformat(n)}function xe(t,e){return this.isValid()&&(_(t)&&t.isValid()||Lt(t).isValid())?ie({to:this,from:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function Me(t){return this.from(Lt(),t)}function ke(t,e){return this.isValid()&&(_(t)&&t.isValid()||Lt(t).isValid())?ie({from:this,to:t}).locale(this.locale()).humanize(!e):this.localeData().invalidDate()}function Ce(t){return this.to(Lt(),t)}function Te(t){var e;return void 0===t?this._locale._abbr:(e=j(t),null!=e&&(this._locale=e),this)}function Ae(){return this._locale}function Ee(t){switch(t=L(t)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===t&&this.weekday(0),"isoWeek"===t&&this.isoWeekday(1),"quarter"===t&&this.month(3*Math.floor(this.month()/3)),this}function De(t){return t=L(t),void 0===t||"millisecond"===t?this:("date"===t&&(t="day"),this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms"))}function Ne(){return this._d.valueOf()-6e4*(this._offset||0)}function Oe(){return Math.floor(this.valueOf()/1e3)}function je(){return this._offset?new Date(this.valueOf()):this._d}function Ie(){var t=this;return[t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()]}function Re(){var t=this;return{years:t.year(),months:t.month(),date:t.date(),hours:t.hours(),minutes:t.minutes(),seconds:t.seconds(),milliseconds:t.milliseconds()}}function Le(){return this.isValid()?this.toISOString():null}function He(){return u(this)}function Pe(){return o({},l(this))}function Ye(){return l(this).overflow}function Fe(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}function Be(t,e){$(0,[t,t.length],0,e)}function ze(t){return We.call(this,t,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function $e(t){return We.call(this,t,this.isoWeek(),this.isoWeekday(),1,4)}function qe(){return xt(this.year(),1,4)}function Ue(){var t=this.localeData()._week;return xt(this.year(),t.dow,t.doy)}function We(t,e,n,i,s){var r;return null==t?St(this,i,s).year:(r=xt(t,i,s),e>r&&(e=r),Ge.call(this,t,e,n,i,s))}function Ge(t,e,n,i,s){var r=wt(t,e,n,i,s),o=mt(r.year,0,r.dayOfYear);return this.year(o.getUTCFullYear()),this.month(o.getUTCMonth()),this.date(o.getUTCDate()),this}function Ve(t){return null==t?Math.ceil((this.month()+1)/3):this.month(3*(t-1)+this.month()%3)}function Je(t){return St(t,this._week.dow,this._week.doy).week}function Xe(){return this._week.dow}function Ke(){return this._week.doy}function Qe(t){var e=this.localeData().week(this);return null==t?e:this.add(7*(t-e),"d")}function Ze(t){var e=St(this,1,4).week;return null==t?e:this.add(7*(t-e),"d")}function tn(t,e){return"string"!=typeof t?t:isNaN(t)?(t=e.weekdaysParse(t),"number"==typeof t?t:null):parseInt(t,10)}function en(t,e){return n(this._weekdays)?this._weekdays[t.day()]:this._weekdays[this._weekdays.isFormat.test(e)?"format":"standalone"][t.day()]}function nn(t){return this._weekdaysShort[t.day()]}function sn(t){return this._weekdaysMin[t.day()]}function rn(t,e,n){var i,s,r,o=t.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)r=a([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===e?(s=fi.call(this._weekdaysParse,o),s!==-1?s:null):"ddd"===e?(s=fi.call(this._shortWeekdaysParse,o),s!==-1?s:null):(s=fi.call(this._minWeekdaysParse,o),s!==-1?s:null):"dddd"===e?(s=fi.call(this._weekdaysParse,o),s!==-1?s:(s=fi.call(this._shortWeekdaysParse,o),s!==-1?s:(s=fi.call(this._minWeekdaysParse,o),s!==-1?s:null))):"ddd"===e?(s=fi.call(this._shortWeekdaysParse,o),s!==-1?s:(s=fi.call(this._weekdaysParse,o),s!==-1?s:(s=fi.call(this._minWeekdaysParse,o),s!==-1?s:null))):(s=fi.call(this._minWeekdaysParse,o),s!==-1?s:(s=fi.call(this._weekdaysParse,o),s!==-1?s:(s=fi.call(this._shortWeekdaysParse,o),s!==-1?s:null)))}function on(t,e,n){var i,s,r;if(this._weekdaysParseExact)return rn.call(this,t,e,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(s=a([2e3,1]).day(i),n&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(s,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(s,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(s,"").replace(".",".?")+"$","i")),this._weekdaysParse[i]||(r="^"+this.weekdays(s,"")+"|^"+this.weekdaysShort(s,"")+"|^"+this.weekdaysMin(s,""),this._weekdaysParse[i]=new RegExp(r.replace(".",""),"i")),n&&"dddd"===e&&this._fullWeekdaysParse[i].test(t))return i;if(n&&"ddd"===e&&this._shortWeekdaysParse[i].test(t))return i;if(n&&"dd"===e&&this._minWeekdaysParse[i].test(t))return i;if(!n&&this._weekdaysParse[i].test(t))return i}}function an(t){if(!this.isValid())return null!=t?this:NaN;var e=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=t?(t=tn(t,this.localeData()),this.add(t-e,"d")):e}function cn(t){if(!this.isValid())return null!=t?this:NaN;var e=(this.day()+7-this.localeData()._week.dow)%7;return null==t?e:this.add(t-e,"d")}function ln(t){return this.isValid()?null==t?this.day()||7:this.day(this.day()%7?t:t-7):null!=t?this:NaN}function un(t){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||fn.call(this),t?this._weekdaysStrictRegex:this._weekdaysRegex):this._weekdaysStrictRegex&&t?this._weekdaysStrictRegex:this._weekdaysRegex}function hn(t){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||fn.call(this),t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):this._weekdaysShortStrictRegex&&t?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}function dn(t){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||fn.call(this),t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):this._weekdaysMinStrictRegex&&t?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}function fn(){function t(t,e){return e.length-t.length}var e,n,i,s,r,o=[],c=[],l=[],u=[];for(e=0;e<7;e++)n=a([2e3,1]).day(e),i=this.weekdaysMin(n,""),s=this.weekdaysShort(n,""),r=this.weekdays(n,""),o.push(i),c.push(s),l.push(r),u.push(i),u.push(s),u.push(r);for(o.sort(t),c.sort(t),l.sort(t),u.sort(t),e=0;e<7;e++)c[e]=K(c[e]),l[e]=K(l[e]),u[e]=K(u[e]);this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+o.join("|")+")","i")}function pn(t){var e=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==t?e:this.add(t-e,"d")}function _n(){return this.hours()%12||12}function mn(){return this.hours()||24}function gn(t,e){$(t,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),e)})}function vn(t,e){return e._meridiemParse}function yn(t){return"p"===(t+"").toLowerCase().charAt(0)}function bn(t,e,n){return t>11?n?"pm":"PM":n?"am":"AM"}function wn(t,e){e[Ui]=g(1e3*("0."+t))}function Sn(){return this._isUTC?"UTC":""}function xn(){return this._isUTC?"Coordinated Universal Time":""}function Mn(t){return Lt(1e3*t)}function kn(){return Lt.apply(null,arguments).parseZone()}function Cn(t,e,n){var i=this._calendar[t];return S(i)?i.call(e,n):i}function Tn(t){var e=this._longDateFormat[t],n=this._longDateFormat[t.toUpperCase()];return e||!n?e:(this._longDateFormat[t]=n.replace(/MMMM|MM|DD|dddd/g,function(t){return t.slice(1)}),this._longDateFormat[t])}function An(){return this._invalidDate}function En(t){return this._ordinal.replace("%d",t)}function Dn(t){return t}function Nn(t,e,n,i){var s=this._relativeTime[n];return S(s)?s(t,e,n,i):s.replace(/%d/i,t)}function On(t,e){var n=this._relativeTime[t>0?"future":"past"];return S(n)?n(e):n.replace(/%s/i,e)}function jn(t,e,n,i){var s=j(),r=a().set(i,e);return s[n](r,t)}function In(t,e,n){if("number"==typeof t&&(e=t,t=void 0),t=t||"",null!=e)return jn(t,e,n,"month");var i,s=[];for(i=0;i<12;i++)s[i]=jn(t,i,n,"month");return s}function Rn(t,e,n,i){"boolean"==typeof t?("number"==typeof e&&(n=e,e=void 0),e=e||""):(e=t,n=e,t=!1,"number"==typeof e&&(n=e,e=void 0),e=e||"");var s=j(),r=t?s._week.dow:0;if(null!=n)return jn(e,(n+r)%7,i,"day");var o,a=[];for(o=0;o<7;o++)a[o]=jn(e,(o+r)%7,i,"day");return a}function Ln(t,e){return In(t,e,"months")}function Hn(t,e){return In(t,e,"monthsShort")}function Pn(t,e,n){return Rn(t,e,n,"weekdays")}function Yn(t,e,n){return Rn(t,e,n,"weekdaysShort")}function Fn(t,e,n){return Rn(t,e,n,"weekdaysMin")}function Bn(){var t=this._data;return this._milliseconds=Ps(this._milliseconds),this._days=Ps(this._days),this._months=Ps(this._months),t.milliseconds=Ps(t.milliseconds),t.seconds=Ps(t.seconds),t.minutes=Ps(t.minutes),t.hours=Ps(t.hours),t.months=Ps(t.months),t.years=Ps(t.years),this}function zn(t,e,n,i){var s=ie(e,n);return t._milliseconds+=i*s._milliseconds,t._days+=i*s._days,t._months+=i*s._months,t._bubble()}function $n(t,e){return zn(this,t,e,1)}function qn(t,e){return zn(this,t,e,-1)}function Un(t){return t<0?Math.floor(t):Math.ceil(t)}function Wn(){var t,e,n,i,s,r=this._milliseconds,o=this._days,a=this._months,c=this._data;return r>=0&&o>=0&&a>=0||r<=0&&o<=0&&a<=0||(r+=864e5*Un(Vn(a)+o),o=0,a=0),c.milliseconds=r%1e3,t=m(r/1e3),c.seconds=t%60,e=m(t/60),c.minutes=e%60,n=m(e/60),c.hours=n%24,o+=m(n/24),s=m(Gn(o)),a+=s,o-=Un(Vn(s)),i=m(a/12),a%=12,c.days=o,c.months=a,c.years=i,this}function Gn(t){return 4800*t/146097}function Vn(t){return 146097*t/4800}function Jn(t){var e,n,i=this._milliseconds;if(t=L(t),"month"===t||"year"===t)return e=this._days+i/864e5,n=this._months+Gn(e),"month"===t?n:n/12;switch(e=this._days+Math.round(Vn(this._months)),t){case"week":return e/7+i/6048e5;case"day":return e+i/864e5;case"hour":return 24*e+i/36e5;case"minute":return 1440*e+i/6e4;case"second":return 86400*e+i/1e3;case"millisecond":return Math.floor(864e5*e)+i;default:throw new Error("Unknown unit "+t)}}function Xn(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*g(this._months/12)}function Kn(t){return function(){return this.as(t)}}function Qn(t){return t=L(t),this[t+"s"]()}function Zn(t){return function(){return this._data[t]}}function ti(){return m(this.days()/7)}function ei(t,e,n,i,s){return s.relativeTime(e||1,!!n,t,i)}function ni(t,e,n){var i=ie(t).abs(),s=tr(i.as("s")),r=tr(i.as("m")),o=tr(i.as("h")),a=tr(i.as("d")),c=tr(i.as("M")),l=tr(i.as("y")),u=s<er.s&&["s",s]||r<=1&&["m"]||r<er.m&&["mm",r]||o<=1&&["h"]||o<er.h&&["hh",o]||a<=1&&["d"]||a<er.d&&["dd",a]||c<=1&&["M"]||c<er.M&&["MM",c]||l<=1&&["y"]||["yy",l];return u[2]=e,u[3]=+t>0,u[4]=n,ei.apply(null,u)}function ii(t,e){return void 0!==er[t]&&(void 0===e?er[t]:(er[t]=e,!0))}function si(t){var e=this.localeData(),n=ni(this,!t,e);return t&&(n=e.pastFuture(+this,n)),e.postformat(n)}function ri(){var t,e,n,i=nr(this._milliseconds)/1e3,s=nr(this._days),r=nr(this._months);t=m(i/60),e=m(t/60),i%=60,t%=60,n=m(r/12),r%=12;var o=n,a=r,c=s,l=e,u=t,h=i,d=this.asSeconds();return d?(d<0?"-":"")+"P"+(o?o+"Y":"")+(a?a+"M":"")+(c?c+"D":"")+(l||u||h?"T":"")+(l?l+"H":"")+(u?u+"M":"")+(h?h+"S":""):"P0D"}var oi,ai;ai=Array.prototype.some?Array.prototype.some:function(t){for(var e=Object(this),n=e.length>>>0,i=0;i<n;i++)if(i in e&&t.call(this,e[i],i,e))return!0;return!1};var ci=t.momentProperties=[],li=!1,ui={};t.suppressDeprecationWarnings=!1,t.deprecationHandler=null;var hi;hi=Object.keys?Object.keys:function(t){var e,n=[];for(e in t)r(t,e)&&n.push(e);return n};var di,fi,pi={},_i={},mi=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,gi=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,vi={},yi={},bi=/\d/,wi=/\d\d/,Si=/\d{3}/,xi=/\d{4}/,Mi=/[+-]?\d{6}/,ki=/\d\d?/,Ci=/\d\d\d\d?/,Ti=/\d\d\d\d\d\d?/,Ai=/\d{1,3}/,Ei=/\d{1,4}/,Di=/[+-]?\d{1,6}/,Ni=/\d+/,Oi=/[+-]?\d+/,ji=/Z|[+-]\d\d:?\d\d/gi,Ii=/Z|[+-]\d\d(?::?\d\d)?/gi,Ri=/[+-]?\d+(\.\d{1,3})?/,Li=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Hi={},Pi={},Yi=0,Fi=1,Bi=2,zi=3,$i=4,qi=5,Ui=6,Wi=7,Gi=8;fi=Array.prototype.indexOf?Array.prototype.indexOf:function(t){var e;for(e=0;e<this.length;++e)if(this[e]===t)return e;return-1},$("M",["MM",2],"Mo",function(){return this.month()+1}),$("MMM",0,0,function(t){return this.localeData().monthsShort(this,t)}),$("MMMM",0,0,function(t){return this.localeData().months(this,t)}),R("month","M"),V("M",ki),V("MM",ki,wi),V("MMM",function(t,e){return e.monthsShortRegex(t)}),V("MMMM",function(t,e){return e.monthsRegex(t)}),Q(["M","MM"],function(t,e){e[Fi]=g(t)-1}),Q(["MMM","MMMM"],function(t,e,n,i){var s=n._locale.monthsParse(t,i,n._strict);null!=s?e[Fi]=s:l(n).invalidMonth=t});var Vi=/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/,Ji="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Xi="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Ki=Li,Qi=Li,Zi=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,ts=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?/,es=/Z|[+-]\d\d(?::?\d\d)?/,ns=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],is=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],ss=/^\/?Date\((\-?\d+)/i;t.createFromInputFallback=b("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(t){t._d=new Date(t._i+(t._useUTC?" UTC":""))}),$("Y",0,0,function(){var t=this.year();return t<=9999?""+t:"+"+t}),$(0,["YY",2],0,function(){return this.year()%100}),$(0,["YYYY",4],0,"year"),$(0,["YYYYY",5],0,"year"),$(0,["YYYYYY",6,!0],0,"year"),R("year","y"),V("Y",Oi),V("YY",ki,wi),V("YYYY",Ei,xi),V("YYYYY",Di,Mi),V("YYYYYY",Di,Mi),Q(["YYYYY","YYYYYY"],Yi),Q("YYYY",function(e,n){n[Yi]=2===e.length?t.parseTwoDigitYear(e):g(e)}),Q("YY",function(e,n){n[Yi]=t.parseTwoDigitYear(e)}),Q("Y",function(t,e){e[Yi]=parseInt(t,10)}),t.parseTwoDigitYear=function(t){return g(t)+(g(t)>68?1900:2e3)};var rs=P("FullYear",!0);t.ISO_8601=function(){};var os=b("moment().min is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var t=Lt.apply(null,arguments);return this.isValid()&&t.isValid()?t<this?this:t:h()}),as=b("moment().max is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var t=Lt.apply(null,arguments);return this.isValid()&&t.isValid()?t>this?this:t:h()}),cs=function(){return Date.now?Date.now():+new Date};zt("Z",":"),zt("ZZ",""),V("Z",Ii),V("ZZ",Ii),Q(["Z","ZZ"],function(t,e,n){n._useUTC=!0,n._tzm=$t(Ii,t)});var ls=/([\+\-]|\d\d)/gi;t.updateOffset=function(){};var us=/^(\-)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?\d*)?$/,hs=/^(-)?P(?:(-?[0-9,.]*)Y)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)W)?(?:(-?[0-9,.]*)D)?(?:T(?:(-?[0-9,.]*)H)?(?:(-?[0-9,.]*)M)?(?:(-?[0-9,.]*)S)?)?$/;ie.fn=Ft.prototype;var ds=ce(1,"add"),fs=ce(-1,"subtract");t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var ps=b("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return void 0===t?this.localeData():this.locale(t)});$(0,["gg",2],0,function(){return this.weekYear()%100}),$(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Be("gggg","weekYear"),Be("ggggg","weekYear"),Be("GGGG","isoWeekYear"),Be("GGGGG","isoWeekYear"),R("weekYear","gg"),R("isoWeekYear","GG"),V("G",Oi),V("g",Oi),V("GG",ki,wi),V("gg",ki,wi),V("GGGG",Ei,xi),V("gggg",Ei,xi),V("GGGGG",Di,Mi),V("ggggg",Di,Mi),Z(["gggg","ggggg","GGGG","GGGGG"],function(t,e,n,i){e[i.substr(0,2)]=g(t)}),Z(["gg","GG"],function(e,n,i,s){n[s]=t.parseTwoDigitYear(e)}),$("Q",0,"Qo","quarter"),R("quarter","Q"),V("Q",bi),Q("Q",function(t,e){e[Fi]=3*(g(t)-1)}),$("w",["ww",2],"wo","week"),$("W",["WW",2],"Wo","isoWeek"),R("week","w"),R("isoWeek","W"),V("w",ki),V("ww",ki,wi),V("W",ki),V("WW",ki,wi),Z(["w","ww","W","WW"],function(t,e,n,i){e[i.substr(0,1)]=g(t)});var _s={dow:0,doy:6};$("D",["DD",2],"Do","date"),R("date","D"),V("D",ki),V("DD",ki,wi),V("Do",function(t,e){return t?e._ordinalParse:e._ordinalParseLenient}),Q(["D","DD"],Bi),Q("Do",function(t,e){e[Bi]=g(t.match(ki)[0],10)});var ms=P("Date",!0);$("d",0,"do","day"),$("dd",0,0,function(t){return this.localeData().weekdaysMin(this,t)}),$("ddd",0,0,function(t){return this.localeData().weekdaysShort(this,t)}),$("dddd",0,0,function(t){return this.localeData().weekdays(this,t)}),$("e",0,0,"weekday"),$("E",0,0,"isoWeekday"),R("day","d"),R("weekday","e"),R("isoWeekday","E"),V("d",ki),V("e",ki),V("E",ki),V("dd",function(t,e){return e.weekdaysMinRegex(t)}),V("ddd",function(t,e){return e.weekdaysShortRegex(t)}),V("dddd",function(t,e){return e.weekdaysRegex(t)}),Z(["dd","ddd","dddd"],function(t,e,n,i){var s=n._locale.weekdaysParse(t,i,n._strict);null!=s?e.d=s:l(n).invalidWeekday=t}),Z(["d","e","E"],function(t,e,n,i){e[i]=g(t)});var gs="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),vs="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),ys="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),bs=Li,ws=Li,Ss=Li;$("DDD",["DDDD",3],"DDDo","dayOfYear"),R("dayOfYear","DDD"),V("DDD",Ai),V("DDDD",Si),Q(["DDD","DDDD"],function(t,e,n){n._dayOfYear=g(t)}),$("H",["HH",2],0,"hour"),$("h",["hh",2],0,_n),$("k",["kk",2],0,mn),$("hmm",0,0,function(){return""+_n.apply(this)+z(this.minutes(),2)}),$("hmmss",0,0,function(){return""+_n.apply(this)+z(this.minutes(),2)+z(this.seconds(),2)}),$("Hmm",0,0,function(){return""+this.hours()+z(this.minutes(),2)}),$("Hmmss",0,0,function(){return""+this.hours()+z(this.minutes(),2)+z(this.seconds(),2)}),gn("a",!0),gn("A",!1),R("hour","h"),V("a",vn),V("A",vn),V("H",ki),V("h",ki),V("HH",ki,wi),V("hh",ki,wi),V("hmm",Ci),V("hmmss",Ti),V("Hmm",Ci),V("Hmmss",Ti),Q(["H","HH"],zi),Q(["a","A"],function(t,e,n){n._isPm=n._locale.isPM(t),n._meridiem=t}),Q(["h","hh"],function(t,e,n){e[zi]=g(t),l(n).bigHour=!0}),Q("hmm",function(t,e,n){var i=t.length-2;e[zi]=g(t.substr(0,i)),e[$i]=g(t.substr(i)),l(n).bigHour=!0}),Q("hmmss",function(t,e,n){var i=t.length-4,s=t.length-2;e[zi]=g(t.substr(0,i)),e[$i]=g(t.substr(i,2)),e[qi]=g(t.substr(s)),l(n).bigHour=!0}),Q("Hmm",function(t,e,n){var i=t.length-2;e[zi]=g(t.substr(0,i)),e[$i]=g(t.substr(i))}),Q("Hmmss",function(t,e,n){var i=t.length-4,s=t.length-2;e[zi]=g(t.substr(0,i)),e[$i]=g(t.substr(i,2)),e[qi]=g(t.substr(s))});var xs=/[ap]\.?m?\.?/i,Ms=P("Hours",!0);$("m",["mm",2],0,"minute"),R("minute","m"),V("m",ki),V("mm",ki,wi),Q(["m","mm"],$i);var ks=P("Minutes",!1);$("s",["ss",2],0,"second"),R("second","s"),V("s",ki),V("ss",ki,wi),Q(["s","ss"],qi);var Cs=P("Seconds",!1);$("S",0,0,function(){return~~(this.millisecond()/100)}),$(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),$(0,["SSS",3],0,"millisecond"),$(0,["SSSS",4],0,function(){return 10*this.millisecond()}),$(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),$(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),$(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),$(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),$(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),R("millisecond","ms"),V("S",Ai,bi),V("SS",Ai,wi),V("SSS",Ai,Si);var Ts;for(Ts="SSSS";Ts.length<=9;Ts+="S")V(Ts,Ni);for(Ts="S";Ts.length<=9;Ts+="S")Q(Ts,wn);var As=P("Milliseconds",!1);$("z",0,0,"zoneAbbr"),$("zz",0,0,"zoneName");var Es=p.prototype;Es.add=ds,Es.calendar=ue,Es.clone=he,Es.diff=ve,Es.endOf=De,Es.format=Se,Es.from=xe,Es.fromNow=Me,Es.to=ke,Es.toNow=Ce,Es.get=B,Es.invalidAt=Ye,Es.isAfter=de,Es.isBefore=fe,Es.isBetween=pe,Es.isSame=_e,Es.isSameOrAfter=me,Es.isSameOrBefore=ge,Es.isValid=He,Es.lang=ps,Es.locale=Te,Es.localeData=Ae,Es.max=as,Es.min=os,Es.parsingFlags=Pe,Es.set=B,Es.startOf=Ee,Es.subtract=fs,Es.toArray=Ie,Es.toObject=Re,Es.toDate=je,Es.toISOString=we,Es.toJSON=Le,Es.toString=be,Es.unix=Oe,Es.valueOf=Ne,Es.creationData=Fe,Es.year=rs,Es.isLeapYear=yt,Es.weekYear=ze,Es.isoWeekYear=$e,Es.quarter=Es.quarters=Ve,Es.month=at,Es.daysInMonth=ct,Es.week=Es.weeks=Qe,Es.isoWeek=Es.isoWeeks=Ze,Es.weeksInYear=Ue,Es.isoWeeksInYear=qe,Es.date=ms,Es.day=Es.days=an,Es.weekday=cn,Es.isoWeekday=ln,Es.dayOfYear=pn,Es.hour=Es.hours=Ms,Es.minute=Es.minutes=ks,Es.second=Es.seconds=Cs,Es.millisecond=Es.milliseconds=As,Es.utcOffset=Wt,Es.utc=Vt,Es.local=Jt,Es.parseZone=Xt,Es.hasAlignedHourOffset=Kt,Es.isDST=Qt,Es.isDSTShifted=Zt,Es.isLocal=te,Es.isUtcOffset=ee,Es.isUtc=ne,Es.isUTC=ne,Es.zoneAbbr=Sn,Es.zoneName=xn,Es.dates=b("dates accessor is deprecated. Use date instead.",ms),Es.months=b("months accessor is deprecated. Use month instead",at),Es.years=b("years accessor is deprecated. Use year instead",rs),Es.zone=b("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Gt);var Ds=Es,Ns={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Os={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},js="Invalid date",Is="%d",Rs=/\d{1,2}/,Ls={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Hs=C.prototype;Hs._calendar=Ns,Hs.calendar=Cn,Hs._longDateFormat=Os,Hs.longDateFormat=Tn,Hs._invalidDate=js,Hs.invalidDate=An,Hs._ordinal=Is,Hs.ordinal=En,Hs._ordinalParse=Rs,Hs.preparse=Dn,Hs.postformat=Dn,Hs._relativeTime=Ls,Hs.relativeTime=Nn,Hs.pastFuture=On,Hs.set=M,Hs.months=nt,Hs._months=Ji,Hs.monthsShort=it,Hs._monthsShort=Xi,Hs.monthsParse=rt,Hs._monthsRegex=Qi,Hs.monthsRegex=ut,Hs._monthsShortRegex=Ki,Hs.monthsShortRegex=lt,Hs.week=Je,Hs._week=_s,Hs.firstDayOfYear=Ke,Hs.firstDayOfWeek=Xe,Hs.weekdays=en,Hs._weekdays=gs,Hs.weekdaysMin=sn,Hs._weekdaysMin=ys,Hs.weekdaysShort=nn,Hs._weekdaysShort=vs,Hs.weekdaysParse=on,Hs._weekdaysRegex=bs,Hs.weekdaysRegex=un,Hs._weekdaysShortRegex=ws,Hs.weekdaysShortRegex=hn,Hs._weekdaysMinRegex=Ss,Hs.weekdaysMinRegex=dn,Hs.isPM=yn,Hs._meridiemParse=xs,Hs.meridiem=bn,D("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(t){
var e=t%10,n=1===g(t%100/10)?"th":1===e?"st":2===e?"nd":3===e?"rd":"th";return t+n}}),t.lang=b("moment.lang is deprecated. Use moment.locale instead.",D),t.langData=b("moment.langData is deprecated. Use moment.localeData instead.",j);var Ps=Math.abs,Ys=Kn("ms"),Fs=Kn("s"),Bs=Kn("m"),zs=Kn("h"),$s=Kn("d"),qs=Kn("w"),Us=Kn("M"),Ws=Kn("y"),Gs=Zn("milliseconds"),Vs=Zn("seconds"),Js=Zn("minutes"),Xs=Zn("hours"),Ks=Zn("days"),Qs=Zn("months"),Zs=Zn("years"),tr=Math.round,er={s:45,m:45,h:22,d:26,M:11},nr=Math.abs,ir=Ft.prototype;ir.abs=Bn,ir.add=$n,ir.subtract=qn,ir.as=Jn,ir.asMilliseconds=Ys,ir.asSeconds=Fs,ir.asMinutes=Bs,ir.asHours=zs,ir.asDays=$s,ir.asWeeks=qs,ir.asMonths=Us,ir.asYears=Ws,ir.valueOf=Xn,ir._bubble=Wn,ir.get=Qn,ir.milliseconds=Gs,ir.seconds=Vs,ir.minutes=Js,ir.hours=Xs,ir.days=Ks,ir.weeks=ti,ir.months=Qs,ir.years=Zs,ir.humanize=si,ir.toISOString=ri,ir.toString=ri,ir.toJSON=ri,ir.locale=Te,ir.localeData=Ae,ir.toIsoString=b("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",ri),ir.lang=ps,$("X",0,0,"unix"),$("x",0,0,"valueOf"),V("x",Oi),V("X",Ri),Q("X",function(t,e,n){n._d=new Date(1e3*parseFloat(t,10))}),Q("x",function(t,e,n){n._d=new Date(g(t))}),t.version="2.13.0",e(Lt),t.fn=Ds,t.min=Pt,t.max=Yt,t.now=cs,t.utc=a,t.unix=Mn,t.months=Ln,t.isDate=i,t.locale=D,t.invalid=h,t.duration=ie,t.isMoment=_,t.weekdays=Pn,t.parseZone=kn,t.localeData=j,t.isDuration=Bt,t.monthsShort=Hn,t.weekdaysMin=Fn,t.defineLocale=N,t.updateLocale=O,t.locales=I,t.weekdaysShort=Yn,t.normalizeUnits=L,t.relativeTimeThreshold=ii,t.prototype=Ds;var sr=t;return sr}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_af",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("af",{months:"Januarie_Februarie_Maart_April_Mei_Junie_Julie_Augustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Aug_Sep_Okt_Nov_Des".split("_"),weekdays:"Sondag_Maandag_Dinsdag_Woensdag_Donderdag_Vrydag_Saterdag".split("_"),weekdaysShort:"Son_Maa_Din_Woe_Don_Vry_Sat".split("_"),weekdaysMin:"So_Ma_Di_Wo_Do_Vr_Sa".split("_"),meridiemParse:/vm|nm/i,isPM:function(t){return/^nm$/i.test(t)},meridiem:function(t,e,n){return t<12?n?"vm":"VM":n?"nm":"NM"},longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Vandag om] LT",nextDay:"[M√¥re om] LT",nextWeek:"dddd [om] LT",lastDay:"[Gister om] LT",lastWeek:"[Laas] dddd [om] LT",sameElse:"L"},relativeTime:{future:"oor %s",past:"%s gelede",s:"'n paar sekondes",m:"'n minuut",mm:"%d minute",h:"'n uur",hh:"%d ure",d:"'n dag",dd:"%d dae",M:"'n maand",MM:"%d maande",y:"'n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(t){return t+(1===t||8===t||t>=20?"ste":"de")},week:{dow:1,doy:4}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_de",["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e,n,i){var s={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[t+" Tage",t+" Tagen"],M:["ein Monat","einem Monat"],MM:[t+" Monate",t+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[t+" Jahre",t+" Jahren"]};return e?s[n][0]:s[n][1]}var n=t.defineLocale("de",{months:"Januar_Februar_M√§rz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:e,mm:"%d Minuten",h:e,hh:"%d Stunden",d:e,dd:e,M:e,MM:e,y:e,yy:e},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return n}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_es",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),n="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),i=t.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(t,i){return/-MMM-/.test(i)?n[t.month()]:e[t.month()]},monthsParseExact:!0,weekdays:"domingo_lunes_martes_mi√©rcoles_jueves_viernes_s√°bado".split("_"),weekdaysShort:"dom._lun._mar._mi√©._jue._vie._s√°b.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_s√°".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[ma√±ana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un d√≠a",dd:"%d d√≠as",M:"un mes",MM:"%d meses",y:"un a√±o",yy:"%d a√±os"},ordinalParse:/\d{1,2}¬∫/,ordinal:"%d¬∫",week:{dow:1,doy:4}});return i}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_fr",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("fr",{months:"janvier_f√©vrier_mars_avril_mai_juin_juillet_ao√ªt_septembre_octobre_novembre_d√©cembre".split("_"),monthsShort:"janv._f√©vr._mars_avr._mai_juin_juil._ao√ªt_sept._oct._nov._d√©c.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd'hui √†] LT",nextDay:"[Demain √†] LT",nextWeek:"dddd [√†] LT",lastDay:"[Hier √†] LT",lastWeek:"dddd [dernier √†] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(t){return t+(1===t?"er":"")},week:{dow:1,doy:4}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_he",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("he",{months:"◊ô◊†◊ï◊ê◊®_◊§◊ë◊®◊ï◊ê◊®_◊û◊®◊•_◊ê◊§◊®◊ô◊ú_◊û◊ê◊ô_◊ô◊ï◊†◊ô_◊ô◊ï◊ú◊ô_◊ê◊ï◊í◊ï◊°◊ò_◊°◊§◊ò◊û◊ë◊®_◊ê◊ï◊ß◊ò◊ï◊ë◊®_◊†◊ï◊ë◊û◊ë◊®_◊ì◊¶◊û◊ë◊®".split("_"),monthsShort:"◊ô◊†◊ï◊≥_◊§◊ë◊®◊≥_◊û◊®◊•_◊ê◊§◊®◊≥_◊û◊ê◊ô_◊ô◊ï◊†◊ô_◊ô◊ï◊ú◊ô_◊ê◊ï◊í◊≥_◊°◊§◊ò◊≥_◊ê◊ï◊ß◊≥_◊†◊ï◊ë◊≥_◊ì◊¶◊û◊≥".split("_"),weekdays:"◊®◊ê◊©◊ï◊ü_◊©◊†◊ô_◊©◊ú◊ô◊©◊ô_◊®◊ë◊ô◊¢◊ô_◊ó◊û◊ô◊©◊ô_◊©◊ô◊©◊ô_◊©◊ë◊™".split("_"),weekdaysShort:"◊ê◊≥_◊ë◊≥_◊í◊≥_◊ì◊≥_◊î◊≥_◊ï◊≥_◊©◊≥".split("_"),weekdaysMin:"◊ê_◊ë_◊í_◊ì_◊î_◊ï_◊©".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [◊ë]MMMM YYYY",LLL:"D [◊ë]MMMM YYYY HH:mm",LLLL:"dddd, D [◊ë]MMMM YYYY HH:mm",l:"D/M/YYYY",ll:"D MMM YYYY",lll:"D MMM YYYY HH:mm",llll:"ddd, D MMM YYYY HH:mm"},calendar:{sameDay:"[◊î◊ô◊ï◊ù ◊ë÷æ]LT",nextDay:"[◊û◊ó◊® ◊ë÷æ]LT",nextWeek:"dddd [◊ë◊©◊¢◊î] LT",lastDay:"[◊ê◊™◊û◊ï◊ú ◊ë÷æ]LT",lastWeek:"[◊ë◊ô◊ï◊ù] dddd [◊î◊ê◊ó◊®◊ï◊ü ◊ë◊©◊¢◊î] LT",sameElse:"L"},relativeTime:{future:"◊ë◊¢◊ï◊ì %s",past:"◊ú◊§◊†◊ô %s",s:"◊û◊°◊§◊® ◊©◊†◊ô◊ï◊™",m:"◊ì◊ß◊î",mm:"%d ◊ì◊ß◊ï◊™",h:"◊©◊¢◊î",hh:function(t){return 2===t?"◊©◊¢◊™◊ô◊ô◊ù":t+" ◊©◊¢◊ï◊™"},d:"◊ô◊ï◊ù",dd:function(t){return 2===t?"◊ô◊ï◊û◊ô◊ô◊ù":t+" ◊ô◊û◊ô◊ù"},M:"◊ó◊ï◊ì◊©",MM:function(t){return 2===t?"◊ó◊ï◊ì◊©◊ô◊ô◊ù":t+" ◊ó◊ï◊ì◊©◊ô◊ù"},y:"◊©◊†◊î",yy:function(t){return 2===t?"◊©◊†◊™◊ô◊ô◊ù":t%10===0&&10!==t?t+" ◊©◊†◊î":t+" ◊©◊†◊ô◊ù"}},meridiemParse:/◊ê◊ó◊î"◊¶|◊ú◊§◊†◊î"◊¶|◊ê◊ó◊®◊ô ◊î◊¶◊î◊®◊ô◊ô◊ù|◊ú◊§◊†◊ô ◊î◊¶◊î◊®◊ô◊ô◊ù|◊ú◊§◊†◊ï◊™ ◊ë◊ï◊ß◊®|◊ë◊ë◊ï◊ß◊®|◊ë◊¢◊®◊ë/i,isPM:function(t){return/^(◊ê◊ó◊î"◊¶|◊ê◊ó◊®◊ô ◊î◊¶◊î◊®◊ô◊ô◊ù|◊ë◊¢◊®◊ë)$/.test(t)},meridiem:function(t,e,n){return t<5?"◊ú◊§◊†◊ï◊™ ◊ë◊ï◊ß◊®":t<10?"◊ë◊ë◊ï◊ß◊®":t<12?n?'◊ú◊§◊†◊î"◊¶':"◊ú◊§◊†◊ô ◊î◊¶◊î◊®◊ô◊ô◊ù":t<18?n?'◊ê◊ó◊î"◊¶':"◊ê◊ó◊®◊ô ◊î◊¶◊î◊®◊ô◊ô◊ù":"◊ë◊¢◊®◊ë"}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_hu",["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e,n,i){var s=t;switch(n){case"s":return i||e?"n√©h√°ny m√°sodperc":"n√©h√°ny m√°sodperce";case"m":return"egy"+(i||e?" perc":" perce");case"mm":return s+(i||e?" perc":" perce");case"h":return"egy"+(i||e?" √≥ra":" √≥r√°ja");case"hh":return s+(i||e?" √≥ra":" √≥r√°ja");case"d":return"egy"+(i||e?" nap":" napja");case"dd":return s+(i||e?" nap":" napja");case"M":return"egy"+(i||e?" h√≥nap":" h√≥napja");case"MM":return s+(i||e?" h√≥nap":" h√≥napja");case"y":return"egy"+(i||e?" √©v":" √©ve");case"yy":return s+(i||e?" √©v":" √©ve")}return""}function n(t){return(t?"":"[m√∫lt] ")+"["+i[this.day()]+"] LT[-kor]"}var i="vas√°rnap h√©tf≈ën kedden szerd√°n cs√ºt√∂rt√∂k√∂n p√©nteken szombaton".split(" "),s=t.defineLocale("hu",{months:"janu√°r_febru√°r_m√°rcius_√°prilis_m√°jus_j√∫nius_j√∫lius_augusztus_szeptember_okt√≥ber_november_december".split("_"),monthsShort:"jan_feb_m√°rc_√°pr_m√°j_j√∫n_j√∫l_aug_szept_okt_nov_dec".split("_"),weekdays:"vas√°rnap_h√©tf≈ë_kedd_szerda_cs√ºt√∂rt√∂k_p√©ntek_szombat".split("_"),weekdaysShort:"vas_h√©t_kedd_sze_cs√ºt_p√©n_szo".split("_"),weekdaysMin:"v_h_k_sze_cs_p_szo".split("_"),longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"YYYY.MM.DD.",LL:"YYYY. MMMM D.",LLL:"YYYY. MMMM D. H:mm",LLLL:"YYYY. MMMM D., dddd H:mm"},meridiemParse:/de|du/i,isPM:function(t){return"u"===t.charAt(1).toLowerCase()},meridiem:function(t,e,n){return t<12?n===!0?"de":"DE":n===!0?"du":"DU"},calendar:{sameDay:"[ma] LT[-kor]",nextDay:"[holnap] LT[-kor]",nextWeek:function(){return n.call(this,!0)},lastDay:"[tegnap] LT[-kor]",lastWeek:function(){return n.call(this,!1)},sameElse:"L"},relativeTime:{future:"%s m√∫lva",past:"%s",s:e,m:e,mm:e,h:e,hh:e,d:e,dd:e,M:e,MM:e,y:e,yy:e},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:7}});return s}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_id",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("id",{months:"Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),monthsShort:"Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),weekdays:"Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),weekdaysShort:"Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),weekdaysMin:"Mg_Sn_Sl_Rb_Km_Jm_Sb".split("_"),longDateFormat:{LT:"HH.mm",LTS:"HH.mm.ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY [pukul] HH.mm",LLLL:"dddd, D MMMM YYYY [pukul] HH.mm"},meridiemParse:/pagi|siang|sore|malam/,meridiemHour:function(t,e){return 12===t&&(t=0),"pagi"===e?t:"siang"===e?t>=11?t:t+12:"sore"===e||"malam"===e?t+12:void 0},meridiem:function(t,e,n){return t<11?"pagi":t<15?"siang":t<19?"sore":"malam"},calendar:{sameDay:"[Hari ini pukul] LT",nextDay:"[Besok pukul] LT",nextWeek:"dddd [pukul] LT",lastDay:"[Kemarin pukul] LT",lastWeek:"dddd [lalu pukul] LT",sameElse:"L"},relativeTime:{future:"dalam %s",past:"%s yang lalu",s:"beberapa detik",m:"semenit",mm:"%d menit",h:"sejam",hh:"%d jam",d:"sehari",dd:"%d hari",M:"sebulan",MM:"%d bulan",y:"setahun",yy:"%d tahun"},week:{dow:1,doy:7}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_it",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("it",{months:"gennaio_febbraio_marzo_aprile_maggio_giugno_luglio_agosto_settembre_ottobre_novembre_dicembre".split("_"),monthsShort:"gen_feb_mar_apr_mag_giu_lug_ago_set_ott_nov_dic".split("_"),weekdays:"Domenica_Luned√¨_Marted√¨_Mercoled√¨_Gioved√¨_Venerd√¨_Sabato".split("_"),weekdaysShort:"Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),weekdaysMin:"Do_Lu_Ma_Me_Gi_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Oggi alle] LT",nextDay:"[Domani alle] LT",nextWeek:"dddd [alle] LT",lastDay:"[Ieri alle] LT",lastWeek:function(){switch(this.day()){case 0:return"[la scorsa] dddd [alle] LT";default:return"[lo scorso] dddd [alle] LT"}},sameElse:"L"},relativeTime:{future:function(t){return(/^[0-9].+$/.test(t)?"tra":"in")+" "+t},past:"%s fa",s:"alcuni secondi",m:"un minuto",mm:"%d minuti",h:"un'ora",hh:"%d ore",d:"un giorno",dd:"%d giorni",M:"un mese",MM:"%d mesi",y:"un anno",yy:"%d anni"},ordinalParse:/\d{1,2}¬∫/,ordinal:"%d¬∫",week:{dow:1,doy:4}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_ja",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("ja",{months:"1Êúà_2Êúà_3Êúà_4Êúà_5Êúà_6Êúà_7Êúà_8Êúà_9Êúà_10Êúà_11Êúà_12Êúà".split("_"),monthsShort:"1Êúà_2Êúà_3Êúà_4Êúà_5Êúà_6Êúà_7Êúà_8Êúà_9Êúà_10Êúà_11Êúà_12Êúà".split("_"),weekdays:"Êó•ÊõúÊó•_ÊúàÊõúÊó•_ÁÅ´ÊõúÊó•_Ê∞¥ÊõúÊó•_Êú®ÊõúÊó•_ÈáëÊõúÊó•_ÂúüÊõúÊó•".split("_"),weekdaysShort:"Êó•_Êúà_ÁÅ´_Ê∞¥_Êú®_Èáë_Âúü".split("_"),weekdaysMin:"Êó•_Êúà_ÁÅ´_Ê∞¥_Êú®_Èáë_Âúü".split("_"),longDateFormat:{LT:"AhÊôÇmÂàÜ",LTS:"AhÊôÇmÂàÜsÁßí",L:"YYYY/MM/DD",LL:"YYYYÂπ¥MÊúàDÊó•",LLL:"YYYYÂπ¥MÊúàDÊó•AhÊôÇmÂàÜ",LLLL:"YYYYÂπ¥MÊúàDÊó•AhÊôÇmÂàÜ dddd"},meridiemParse:/ÂçàÂâç|ÂçàÂæå/i,isPM:function(t){return"ÂçàÂæå"===t},meridiem:function(t,e,n){return t<12?"ÂçàÂâç":"ÂçàÂæå"},calendar:{sameDay:"[‰ªäÊó•] LT",nextDay:"[ÊòéÊó•] LT",nextWeek:"[Êù•ÈÄ±]dddd LT",lastDay:"[Êò®Êó•] LT",lastWeek:"[ÂâçÈÄ±]dddd LT",sameElse:"L"},ordinalParse:/\d{1,2}Êó•/,ordinal:function(t,e){switch(e){case"d":case"D":case"DDD":return t+"Êó•";default:return t}},relativeTime:{future:"%sÂæå",past:"%sÂâç",s:"Êï∞Áßí",m:"1ÂàÜ",mm:"%dÂàÜ",h:"1ÊôÇÈñì",hh:"%dÊôÇÈñì",d:"1Êó•",dd:"%dÊó•",M:"1„É∂Êúà",MM:"%d„É∂Êúà",y:"1Âπ¥",yy:"%dÂπ¥"}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_nb",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("nb",{months:"januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),monthsShort:"jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),monthsParseExact:!0,weekdays:"s√∏ndag_mandag_tirsdag_onsdag_torsdag_fredag_l√∏rdag".split("_"),weekdaysShort:"s√∏._ma._ti._on._to._fr._l√∏.".split("_"),weekdaysMin:"s√∏_ma_ti_on_to_fr_l√∏".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY [kl.] HH:mm",LLLL:"dddd D. MMMM YYYY [kl.] HH:mm"},calendar:{sameDay:"[i dag kl.] LT",nextDay:"[i morgen kl.] LT",nextWeek:"dddd [kl.] LT",lastDay:"[i g√•r kl.] LT",lastWeek:"[forrige] dddd [kl.] LT",sameElse:"L"},relativeTime:{future:"om %s",past:"%s siden",s:"noen sekunder",m:"ett minutt",mm:"%d minutter",h:"en time",hh:"%d timer",d:"en dag",dd:"%d dager",M:"en m√•ned",MM:"%d m√•neder",y:"ett √•r",yy:"%d √•r"},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_nl",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e="jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),n="jan_feb_mrt_apr_mei_jun_jul_aug_sep_okt_nov_dec".split("_"),i=t.defineLocale("nl",{months:"januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),monthsShort:function(t,i){return/-MMM-/.test(i)?n[t.month()]:e[t.month()]},monthsParseExact:!0,weekdays:"zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),weekdaysShort:"zo._ma._di._wo._do._vr._za.".split("_"),weekdaysMin:"Zo_Ma_Di_Wo_Do_Vr_Za".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD-MM-YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[vandaag om] LT",nextDay:"[morgen om] LT",nextWeek:"dddd [om] LT",lastDay:"[gisteren om] LT",lastWeek:"[afgelopen] dddd [om] LT",sameElse:"L"},relativeTime:{future:"over %s",past:"%s geleden",s:"een paar seconden",m:"√©√©n minuut",mm:"%d minuten",h:"√©√©n uur",hh:"%d uur",d:"√©√©n dag",dd:"%d dagen",M:"√©√©n maand",MM:"%d maanden",y:"√©√©n jaar",yy:"%d jaar"},ordinalParse:/\d{1,2}(ste|de)/,ordinal:function(t){return t+(1===t||8===t||t>=20?"ste":"de")},week:{dow:1,doy:4}});return i}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_pl",["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t){return t%10<5&&t%10>1&&~~(t/10)%10!==1}function n(t,n,i){var s=t+" ";switch(i){case"m":return n?"minuta":"minutƒô";case"mm":return s+(e(t)?"minuty":"minut");case"h":return n?"godzina":"godzinƒô";case"hh":return s+(e(t)?"godziny":"godzin");case"MM":return s+(e(t)?"miesiƒÖce":"miesiƒôcy");case"yy":return s+(e(t)?"lata":"lat")}}var i="stycze≈Ñ_luty_marzec_kwiecie≈Ñ_maj_czerwiec_lipiec_sierpie≈Ñ_wrzesie≈Ñ_pa≈∫dziernik_listopad_grudzie≈Ñ".split("_"),s="stycznia_lutego_marca_kwietnia_maja_czerwca_lipca_sierpnia_wrze≈õnia_pa≈∫dziernika_listopada_grudnia".split("_"),r=t.defineLocale("pl",{months:function(t,e){return""===e?"("+s[t.month()]+"|"+i[t.month()]+")":/D MMMM/.test(e)?s[t.month()]:i[t.month()]},monthsShort:"sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa≈∫_lis_gru".split("_"),weekdays:"niedziela_poniedzia≈Çek_wtorek_≈õroda_czwartek_piƒÖtek_sobota".split("_"),weekdaysShort:"nie_pon_wt_≈õr_czw_pt_sb".split("_"),weekdaysMin:"Nd_Pn_Wt_≈ör_Cz_Pt_So".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd, D MMMM YYYY HH:mm"},calendar:{sameDay:"[Dzi≈õ o] LT",nextDay:"[Jutro o] LT",nextWeek:"[W] dddd [o] LT",lastDay:"[Wczoraj o] LT",lastWeek:function(){switch(this.day()){case 0:return"[W zesz≈ÇƒÖ niedzielƒô o] LT";case 3:return"[W zesz≈ÇƒÖ ≈õrodƒô o] LT";case 6:return"[W zesz≈ÇƒÖ sobotƒô o] LT";default:return"[W zesz≈Çy] dddd [o] LT"}},sameElse:"L"},relativeTime:{future:"za %s",past:"%s temu",s:"kilka sekund",m:n,mm:n,h:n,hh:n,d:"1 dzie≈Ñ",dd:"%d dni",M:"miesiƒÖc",MM:n,y:"rok",yy:n},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});return r}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_pt-br",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("pt-br",{months:"Janeiro_Fevereiro_Mar√ßo_Abril_Maio_Junho_Julho_Agosto_Setembro_Outubro_Novembro_Dezembro".split("_"),monthsShort:"Jan_Fev_Mar_Abr_Mai_Jun_Jul_Ago_Set_Out_Nov_Dez".split("_"),weekdays:"Domingo_Segunda-feira_Ter√ßa-feira_Quarta-feira_Quinta-feira_Sexta-feira_S√°bado".split("_"),weekdaysShort:"Dom_Seg_Ter_Qua_Qui_Sex_S√°b".split("_"),weekdaysMin:"Dom_2¬™_3¬™_4¬™_5¬™_6¬™_S√°b".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [√†s] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [√†s] HH:mm"},calendar:{sameDay:"[Hoje √†s] LT",nextDay:"[Amanh√£ √†s] LT",nextWeek:"dddd [√†s] LT",lastDay:"[Ontem √†s] LT",lastWeek:function(){return 0===this.day()||6===this.day()?"[√öltimo] dddd [√†s] LT":"[√öltima] dddd [√†s] LT"},sameElse:"L"},relativeTime:{future:"em %s",past:"%s atr√°s",s:"poucos segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um m√™s",MM:"%d meses",y:"um ano",yy:"%d anos"},ordinalParse:/\d{1,2}¬∫/,ordinal:"%d¬∫"});return e}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_ru",["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e){var n=t.split("_");return e%10===1&&e%100!==11?n[0]:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?n[1]:n[2]}function n(t,n,i){var s={mm:n?"–º–∏–Ω—É—Ç–∞_–º–∏–Ω—É—Ç—ã_–º–∏–Ω—É—Ç":"–º–∏–Ω—É—Ç—É_–º–∏–Ω—É—Ç—ã_–º–∏–Ω—É—Ç",hh:"—á–∞—Å_—á–∞—Å–∞_—á–∞—Å–æ–≤",dd:"–¥–µ–Ω—å_–¥–Ω—è_–¥–Ω–µ–π",MM:"–º–µ—Å—è—Ü_–º–µ—Å—è—Ü–∞_–º–µ—Å—è—Ü–µ–≤",yy:"–≥–æ–¥_–≥–æ–¥–∞_–ª–µ—Ç"};return"m"===i?n?"–º–∏–Ω—É—Ç–∞":"–º–∏–Ω—É—Ç—É":t+" "+e(s[i],+t)}var i=[/^—è–Ω–≤/i,/^—Ñ–µ–≤/i,/^–º–∞—Ä/i,/^–∞–ø—Ä/i,/^–º–∞[–π—è]/i,/^–∏—é–Ω/i,/^–∏—é–ª/i,/^–∞–≤–≥/i,/^—Å–µ–Ω/i,/^–æ–∫—Ç/i,/^–Ω–æ—è/i,/^–¥–µ–∫/i],s=t.defineLocale("ru",{months:{format:"—è–Ω–≤–∞—Ä—è_—Ñ–µ–≤—Ä–∞–ª—è_–º–∞—Ä—Ç–∞_–∞–ø—Ä–µ–ª—è_–º–∞—è_–∏—é–Ω—è_–∏—é–ª—è_–∞–≤–≥—É—Å—Ç–∞_—Å–µ–Ω—Ç—è–±—Ä—è_–æ–∫—Ç—è–±—Ä—è_–Ω–æ—è–±—Ä—è_–¥–µ–∫–∞–±—Ä—è".split("_"),standalone:"—è–Ω–≤–∞—Ä—å_—Ñ–µ–≤—Ä–∞–ª—å_–º–∞—Ä—Ç_–∞–ø—Ä–µ–ª—å_–º–∞–π_–∏—é–Ω—å_–∏—é–ª—å_–∞–≤–≥—É—Å—Ç_—Å–µ–Ω—Ç—è–±—Ä—å_–æ–∫—Ç—è–±—Ä—å_–Ω–æ—è–±—Ä—å_–¥–µ–∫–∞–±—Ä—å".split("_")},monthsShort:{format:"—è–Ω–≤._—Ñ–µ–≤—Ä._–º–∞—Ä._–∞–ø—Ä._–º–∞—è_–∏—é–Ω—è_–∏—é–ª—è_–∞–≤–≥._—Å–µ–Ω—Ç._–æ–∫—Ç._–Ω–æ—è–±._–¥–µ–∫.".split("_"),standalone:"—è–Ω–≤._—Ñ–µ–≤—Ä._–º–∞—Ä—Ç_–∞–ø—Ä._–º–∞–π_–∏—é–Ω—å_–∏—é–ª—å_–∞–≤–≥._—Å–µ–Ω—Ç._–æ–∫—Ç._–Ω–æ—è–±._–¥–µ–∫.".split("_")},weekdays:{standalone:"–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ_–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫_–≤—Ç–æ—Ä–Ω–∏–∫_—Å—Ä–µ–¥–∞_—á–µ—Ç–≤–µ—Ä–≥_–ø—è—Ç–Ω–∏—Ü–∞_—Å—É–±–±–æ—Ç–∞".split("_"),format:"–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ_–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫_–≤—Ç–æ—Ä–Ω–∏–∫_—Å—Ä–µ–¥—É_—á–µ—Ç–≤–µ—Ä–≥_–ø—è—Ç–Ω–∏—Ü—É_—Å—É–±–±–æ—Ç—É".split("_"),isFormat:/\[ ?[–í–≤] ?(?:–ø—Ä–æ—à–ª—É—é|—Å–ª–µ–¥—É—é—â—É—é|—ç—Ç—É)? ?\] ?dddd/},weekdaysShort:"–≤—Å_–ø–Ω_–≤—Ç_—Å—Ä_—á—Ç_–ø—Ç_—Å–±".split("_"),weekdaysMin:"–≤—Å_–ø–Ω_–≤—Ç_—Å—Ä_—á—Ç_–ø—Ç_—Å–±".split("_"),monthsParse:i,longMonthsParse:i,shortMonthsParse:i,monthsRegex:/^(—Å–µ–Ω—Ç—è–±—Ä[—è—å]|–æ–∫—Ç—è–±—Ä[—è—å]|–¥–µ–∫–∞–±—Ä[—è—å]|—Ñ–µ–≤—Ä–∞–ª[—è—å]|—è–Ω–≤–∞—Ä[—è—å]|–∞–ø—Ä–µ–ª[—è—å]|–∞–≤–≥—É—Å—Ç–∞?|–Ω–æ—è–±—Ä[—è—å]|—Å–µ–Ω—Ç\.|—Ñ–µ–≤—Ä\.|–Ω–æ—è–±\.|–∏—é–Ω—å|—è–Ω–≤.|–∏—é–ª—å|–¥–µ–∫.|–∞–≤–≥.|–∞–ø—Ä.|–º–∞—Ä—Ç–∞|–º–∞—Ä[.—Ç]|–æ–∫—Ç.|–∏—é–Ω[—è—å]|–∏—é–ª[—è—å]|–º–∞[—è–π])/i,monthsShortRegex:/^(—Å–µ–Ω—Ç—è–±—Ä[—è—å]|–æ–∫—Ç—è–±—Ä[—è—å]|–¥–µ–∫–∞–±—Ä[—è—å]|—Ñ–µ–≤—Ä–∞–ª[—è—å]|—è–Ω–≤–∞—Ä[—è—å]|–∞–ø—Ä–µ–ª[—è—å]|–∞–≤–≥—É—Å—Ç–∞?|–Ω–æ—è–±—Ä[—è—å]|—Å–µ–Ω—Ç\.|—Ñ–µ–≤—Ä\.|–Ω–æ—è–±\.|–∏—é–Ω—å|—è–Ω–≤.|–∏—é–ª—å|–¥–µ–∫.|–∞–≤–≥.|–∞–ø—Ä.|–º–∞—Ä—Ç–∞|–º–∞—Ä[.—Ç]|–æ–∫—Ç.|–∏—é–Ω[—è—å]|–∏—é–ª[—è—å]|–º–∞[—è–π])/i,monthsStrictRegex:/^(—Å–µ–Ω—Ç—è–±—Ä[—è—å]|–æ–∫—Ç—è–±—Ä[—è—å]|–¥–µ–∫–∞–±—Ä[—è—å]|—Ñ–µ–≤—Ä–∞–ª[—è—å]|—è–Ω–≤–∞—Ä[—è—å]|–∞–ø—Ä–µ–ª[—è—å]|–∞–≤–≥—É—Å—Ç–∞?|–Ω–æ—è–±—Ä[—è—å]|–º–∞—Ä—Ç–∞?|–∏—é–Ω[—è—å]|–∏—é–ª[—è—å]|–º–∞[—è–π])/i,monthsShortStrictRegex:/^(–Ω–æ—è–±\.|—Ñ–µ–≤—Ä\.|—Å–µ–Ω—Ç\.|–∏—é–ª—å|—è–Ω–≤\.|–∏—é–Ω[—è—å]|–º–∞—Ä[.—Ç]|–∞–≤–≥\.|–∞–ø—Ä\.|–æ–∫—Ç\.|–¥–µ–∫\.|–º–∞[—è–π])/i,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY –≥.",LLL:"D MMMM YYYY –≥., HH:mm",LLLL:"dddd, D MMMM YYYY –≥., HH:mm"},calendar:{sameDay:"[–°–µ–≥–æ–¥–Ω—è –≤] LT",nextDay:"[–ó–∞–≤—Ç—Ä–∞ –≤] LT",lastDay:"[–í—á–µ—Ä–∞ –≤] LT",nextWeek:function(t){if(t.week()===this.week())return 2===this.day()?"[–í–æ] dddd [–≤] LT":"[–í] dddd [–≤] LT";switch(this.day()){case 0:return"[–í —Å–ª–µ–¥—É—é—â–µ–µ] dddd [–≤] LT";case 1:case 2:case 4:return"[–í —Å–ª–µ–¥—É—é—â–∏–π] dddd [–≤] LT";case 3:case 5:case 6:return"[–í —Å–ª–µ–¥—É—é—â—É—é] dddd [–≤] LT"}},lastWeek:function(t){if(t.week()===this.week())return 2===this.day()?"[–í–æ] dddd [–≤] LT":"[–í] dddd [–≤] LT";switch(this.day()){case 0:return"[–í –ø—Ä–æ—à–ª–æ–µ] dddd [–≤] LT";case 1:case 2:case 4:return"[–í –ø—Ä–æ—à–ª—ã–π] dddd [–≤] LT";case 3:case 5:case 6:return"[–í –ø—Ä–æ—à–ª—É—é] dddd [–≤] LT"}},sameElse:"L"},relativeTime:{future:"—á–µ—Ä–µ–∑ %s",past:"%s –Ω–∞–∑–∞–¥",s:"–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥",m:n,mm:n,h:"—á–∞—Å",hh:n,d:"–¥–µ–Ω—å",dd:n,M:"–º–µ—Å—è—Ü",MM:n,y:"–≥–æ–¥",yy:n},meridiemParse:/–Ω–æ—á–∏|—É—Ç—Ä–∞|–¥–Ω—è|–≤–µ—á–µ—Ä–∞/i,isPM:function(t){return/^(–¥–Ω—è|–≤–µ—á–µ—Ä–∞)$/.test(t)},meridiem:function(t,e,n){return t<4?"–Ω–æ—á–∏":t<12?"—É—Ç—Ä–∞":t<17?"–¥–Ω—è":"–≤–µ—á–µ—Ä–∞"},ordinalParse:/\d{1,2}-(–π|–≥–æ|—è)/,ordinal:function(t,e){switch(e){case"M":case"d":case"DDD":return t+"-–π";case"D":return t+"-–≥–æ";case"w":case"W":return t+"-—è";default:return t}},week:{dow:1,doy:7}});return s}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_uk",["moment"],e):e(t.moment)}(this,function(t){"use strict";function e(t,e){var n=t.split("_");return e%10===1&&e%100!==11?n[0]:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?n[1]:n[2]}function n(t,n,i){var s={mm:n?"—Ö–≤–∏–ª–∏–Ω–∞_—Ö–≤–∏–ª–∏–Ω–∏_—Ö–≤–∏–ª–∏–Ω":"—Ö–≤–∏–ª–∏–Ω—É_—Ö–≤–∏–ª–∏–Ω–∏_—Ö–≤–∏–ª–∏–Ω",hh:n?"–≥–æ–¥–∏–Ω–∞_–≥–æ–¥–∏–Ω–∏_–≥–æ–¥–∏–Ω":"–≥–æ–¥–∏–Ω—É_–≥–æ–¥–∏–Ω–∏_–≥–æ–¥–∏–Ω",dd:"–¥–µ–Ω—å_–¥–Ω—ñ_–¥–Ω—ñ–≤",MM:"–º—ñ—Å—è—Ü—å_–º—ñ—Å—è—Ü—ñ_–º—ñ—Å—è—Ü—ñ–≤",yy:"—Ä—ñ–∫_—Ä–æ–∫–∏_—Ä–æ–∫—ñ–≤"};return"m"===i?n?"—Ö–≤–∏–ª–∏–Ω–∞":"—Ö–≤–∏–ª–∏–Ω—É":"h"===i?n?"–≥–æ–¥–∏–Ω–∞":"–≥–æ–¥–∏–Ω—É":t+" "+e(s[i],+t)}function i(t,e){var n={nominative:"–Ω–µ–¥—ñ–ª—è_–ø–æ–Ω–µ–¥—ñ–ª–æ–∫_–≤—ñ–≤—Ç–æ—Ä–æ–∫_—Å–µ—Ä–µ–¥–∞_—á–µ—Ç–≤–µ—Ä_–ø‚Äô—è—Ç–Ω–∏—Ü—è_—Å—É–±–æ—Ç–∞".split("_"),accusative:"–Ω–µ–¥—ñ–ª—é_–ø–æ–Ω–µ–¥—ñ–ª–æ–∫_–≤—ñ–≤—Ç–æ—Ä–æ–∫_—Å–µ—Ä–µ–¥—É_—á–µ—Ç–≤–µ—Ä_–ø‚Äô—è—Ç–Ω–∏—Ü—é_—Å—É–±–æ—Ç—É".split("_"),genitive:"–Ω–µ–¥—ñ–ª—ñ_–ø–æ–Ω–µ–¥—ñ–ª–∫–∞_–≤—ñ–≤—Ç–æ—Ä–∫–∞_—Å–µ—Ä–µ–¥–∏_—á–µ—Ç–≤–µ—Ä–≥–∞_–ø‚Äô—è—Ç–Ω–∏—Ü—ñ_—Å—É–±–æ—Ç–∏".split("_")},i=/(\[[–í–≤–£—É]\]) ?dddd/.test(e)?"accusative":/\[?(?:–º–∏–Ω—É–ª–æ—ó|–Ω–∞—Å—Ç—É–ø–Ω–æ—ó)? ?\] ?dddd/.test(e)?"genitive":"nominative";return n[i][t.day()]}function s(t){return function(){return t+"–æ"+(11===this.hours()?"–±":"")+"] LT"}}var r=t.defineLocale("uk",{months:{format:"—Å—ñ—á–Ω—è_–ª—é—Ç–æ–≥–æ_–±–µ—Ä–µ–∑–Ω—è_–∫–≤—ñ—Ç–Ω—è_—Ç—Ä–∞–≤–Ω—è_—á–µ—Ä–≤–Ω—è_–ª–∏–ø–Ω—è_—Å–µ—Ä–ø–Ω—è_–≤–µ—Ä–µ—Å–Ω—è_–∂–æ–≤—Ç–Ω—è_–ª–∏—Å—Ç–æ–ø–∞–¥–∞_–≥—Ä—É–¥–Ω—è".split("_"),standalone:"—Å—ñ—á–µ–Ω—å_–ª—é—Ç–∏–π_–±–µ—Ä–µ–∑–µ–Ω—å_–∫–≤—ñ—Ç–µ–Ω—å_—Ç—Ä–∞–≤–µ–Ω—å_—á–µ—Ä–≤–µ–Ω—å_–ª–∏–ø–µ–Ω—å_—Å–µ—Ä–ø–µ–Ω—å_–≤–µ—Ä–µ—Å–µ–Ω—å_–∂–æ–≤—Ç–µ–Ω—å_–ª–∏—Å—Ç–æ–ø–∞–¥_–≥—Ä—É–¥–µ–Ω—å".split("_")},monthsShort:"—Å—ñ—á_–ª—é—Ç_–±–µ—Ä_–∫–≤—ñ—Ç_—Ç—Ä–∞–≤_—á–µ—Ä–≤_–ª–∏–ø_—Å–µ—Ä–ø_–≤–µ—Ä_–∂–æ–≤—Ç_–ª–∏—Å—Ç_–≥—Ä—É–¥".split("_"),weekdays:i,weekdaysShort:"–Ω–¥_–ø–Ω_–≤—Ç_—Å—Ä_—á—Ç_–ø—Ç_—Å–±".split("_"),weekdaysMin:"–Ω–¥_–ø–Ω_–≤—Ç_—Å—Ä_—á—Ç_–ø—Ç_—Å–±".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D MMMM YYYY —Ä.",LLL:"D MMMM YYYY —Ä., HH:mm",LLLL:"dddd, D MMMM YYYY —Ä., HH:mm"},calendar:{sameDay:s("[–°—å–æ–≥–æ–¥–Ω—ñ "),nextDay:s("[–ó–∞–≤—Ç—Ä–∞ "),lastDay:s("[–í—á–æ—Ä–∞ "),nextWeek:s("[–£] dddd ["),lastWeek:function(){switch(this.day()){case 0:case 3:case 5:case 6:return s("[–ú–∏–Ω—É–ª–æ—ó] dddd [").call(this);case 1:case 2:case 4:return s("[–ú–∏–Ω—É–ª–æ–≥–æ] dddd [").call(this)}},sameElse:"L"},relativeTime:{future:"–∑–∞ %s",past:"%s —Ç–æ–º—É",s:"–¥–µ–∫—ñ–ª—å–∫–∞ —Å–µ–∫—É–Ω–¥",m:n,mm:n,h:"–≥–æ–¥–∏–Ω—É",hh:n,d:"–¥–µ–Ω—å",dd:n,M:"–º—ñ—Å—è—Ü—å",MM:n,y:"—Ä—ñ–∫",yy:n},meridiemParse:/–Ω–æ—á—ñ|—Ä–∞–Ω–∫—É|–¥–Ω—è|–≤–µ—á–æ—Ä–∞/,isPM:function(t){return/^(–¥–Ω—è|–≤–µ—á–æ—Ä–∞)$/.test(t)},meridiem:function(t,e,n){return t<4?"–Ω–æ—á—ñ":t<12?"—Ä–∞–Ω–∫—É":t<17?"–¥–Ω—è":"–≤–µ—á–æ—Ä–∞"},ordinalParse:/\d{1,2}-(–π|–≥–æ)/,ordinal:function(t,e){switch(e){case"M":case"d":case"DDD":case"w":case"W":return t+"-–π";case"D":return t+"-–≥–æ";default:return t}},week:{dow:1,doy:7}});return r}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module&&"function"==typeof require?e(require("../moment")):"function"==typeof define&&define.amd?define("moment_zh",["moment"],e):e(t.moment)}(this,function(t){"use strict";var e=t.defineLocale("zh-cn",{months:"‰∏ÄÊúà_‰∫åÊúà_‰∏âÊúà_ÂõõÊúà_‰∫îÊúà_ÂÖ≠Êúà_‰∏ÉÊúà_ÂÖ´Êúà_‰πùÊúà_ÂçÅÊúà_ÂçÅ‰∏ÄÊúà_ÂçÅ‰∫åÊúà".split("_"),monthsShort:"1Êúà_2Êúà_3Êúà_4Êúà_5Êúà_6Êúà_7Êúà_8Êúà_9Êúà_10Êúà_11Êúà_12Êúà".split("_"),weekdays:"ÊòüÊúüÊó•_ÊòüÊúü‰∏Ä_ÊòüÊúü‰∫å_ÊòüÊúü‰∏â_ÊòüÊúüÂõõ_ÊòüÊúü‰∫î_ÊòüÊúüÂÖ≠".split("_"),weekdaysShort:"Âë®Êó•_Âë®‰∏Ä_Âë®‰∫å_Âë®‰∏â_Âë®Âõõ_Âë®‰∫î_Âë®ÂÖ≠".split("_"),weekdaysMin:"Êó•_‰∏Ä_‰∫å_‰∏â_Âõõ_‰∫î_ÂÖ≠".split("_"),longDateFormat:{LT:"AhÁÇπmmÂàÜ",LTS:"AhÁÇπmÂàÜsÁßí",L:"YYYY-MM-DD",LL:"YYYYÂπ¥MMMDÊó•",LLL:"YYYYÂπ¥MMMDÊó•AhÁÇπmmÂàÜ",LLLL:"YYYYÂπ¥MMMDÊó•ddddAhÁÇπmmÂàÜ",l:"YYYY-MM-DD",ll:"YYYYÂπ¥MMMDÊó•",lll:"YYYYÂπ¥MMMDÊó•AhÁÇπmmÂàÜ",llll:"YYYYÂπ¥MMMDÊó•ddddAhÁÇπmmÂàÜ"},meridiemParse:/ÂáåÊô®|Êó©‰∏ä|‰∏äÂçà|‰∏≠Âçà|‰∏ãÂçà|Êôö‰∏ä/,meridiemHour:function(t,e){return 12===t&&(t=0),"ÂáåÊô®"===e||"Êó©‰∏ä"===e||"‰∏äÂçà"===e?t:"‰∏ãÂçà"===e||"Êôö‰∏ä"===e?t+12:t>=11?t:t+12},meridiem:function(t,e,n){var i=100*t+e;return i<600?"ÂáåÊô®":i<900?"Êó©‰∏ä":i<1130?"‰∏äÂçà":i<1230?"‰∏≠Âçà":i<1800?"‰∏ãÂçà":"Êôö‰∏ä"},calendar:{sameDay:function(){return 0===this.minutes()?"[‰ªäÂ§©]Ah[ÁÇπÊï¥]":"[‰ªäÂ§©]LT"},nextDay:function(){return 0===this.minutes()?"[ÊòéÂ§©]Ah[ÁÇπÊï¥]":"[ÊòéÂ§©]LT"},lastDay:function(){return 0===this.minutes()?"[Êò®Â§©]Ah[ÁÇπÊï¥]":"[Êò®Â§©]LT"},nextWeek:function(){var e,n;return e=t().startOf("week"),n=this.diff(e,"days")>=7?"[‰∏ã]":"[Êú¨]",0===this.minutes()?n+"dddAhÁÇπÊï¥":n+"dddAhÁÇπmm"},lastWeek:function(){var e,n;return e=t().startOf("week"),n=this.unix()<e.unix()?"[‰∏ä]":"[Êú¨]",0===this.minutes()?n+"dddAhÁÇπÊï¥":n+"dddAhÁÇπmm"},sameElse:"LL"},ordinalParse:/\d{1,2}(Êó•|Êúà|Âë®)/,ordinal:function(t,e){switch(e){case"d":case"D":case"DDD":return t+"Êó•";case"M":return t+"Êúà";case"w":case"W":return t+"Âë®";default:return t}},relativeTime:{future:"%sÂÜÖ",past:"%sÂâç",s:"Âá†Áßí",m:"1 ÂàÜÈíü",mm:"%d ÂàÜÈíü",h:"1 Â∞èÊó∂",hh:"%d Â∞èÊó∂",d:"1 Â§©",dd:"%d Â§©",M:"1 ‰∏™Êúà",MM:"%d ‰∏™Êúà",y:"1 Âπ¥",yy:"%d Âπ¥"},week:{dow:1,doy:4}});return e}),function(t,e){define("moment_with_locales",["moment","moment_af","moment_de","moment_es","moment_fr","moment_he","moment_hu","moment_id","moment_it","moment_ja","moment_nb","moment_nl","moment_pl","moment_pt-br","moment_ru","moment_uk","moment_zh"],function(t){return t})}(this),function(t,e){"function"==typeof define&&define.amd?define("strophe-sha1",[],function(){return e()}):t.SHA1=e()}(this,function(){function t(t,i){t[i>>5]|=128<<24-i%32,t[(i+64>>9<<4)+15]=i;var o,a,c,l,u,h,d,f,p=new Array(80),_=1732584193,m=-271733879,g=-1732584194,v=271733878,y=-1009589776;for(o=0;o<t.length;o+=16){for(l=_,u=m,h=g,d=v,f=y,a=0;a<80;a++)a<16?p[a]=t[o+a]:p[a]=r(p[a-3]^p[a-8]^p[a-14]^p[a-16],1),c=s(s(r(_,5),e(a,m,g,v)),s(s(y,p[a]),n(a))),y=v,v=g,g=r(m,30),m=_,_=c;_=s(_,l),m=s(m,u),g=s(g,h),v=s(v,d),y=s(y,f)}return[_,m,g,v,y]}function e(t,e,n,i){return t<20?e&n|~e&i:t<40?e^n^i:t<60?e&n|e&i|n&i:e^n^i}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function i(e,n){var i=o(e);i.length>16&&(i=t(i,8*e.length));for(var s=new Array(16),r=new Array(16),a=0;a<16;a++)s[a]=909522486^i[a],r[a]=1549556828^i[a];var c=t(s.concat(o(n)),512+8*n.length);return t(r.concat(c),672)}function s(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n}function r(t,e){return t<<e|t>>>32-e}function o(t){for(var e=[],n=255,i=0;i<8*t.length;i+=8)e[i>>5]|=(t.charCodeAt(i/8)&n)<<24-i%32;return e}function a(t){for(var e="",n=255,i=0;i<32*t.length;i+=8)e+=String.fromCharCode(t[i>>5]>>>24-i%32&n);return e}function c(t){for(var e,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="",r=0;r<4*t.length;r+=3)for(e=(t[r>>2]>>8*(3-r%4)&255)<<16|(t[r+1>>2]>>8*(3-(r+1)%4)&255)<<8|t[r+2>>2]>>8*(3-(r+2)%4)&255,n=0;n<4;n++)s+=8*r+6*n>32*t.length?"=":i.charAt(e>>6*(3-n)&63);return s}return{b64_hmac_sha1:function(t,e){return c(i(t,e))},b64_sha1:function(e){return c(t(o(e),8*e.length))},binb2str:a,core_hmac_sha1:i,str_hmac_sha1:function(t,e){return a(i(t,e))},str_sha1:function(e){return a(t(o(e),8*e.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-base64",[],function(){return e()}):t.Base64=e()}(this,function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e={encode:function(e){var n,i,s,r,o,a,c,l="",u=0;do n=e.charCodeAt(u++),i=e.charCodeAt(u++),s=e.charCodeAt(u++),r=n>>2,o=(3&n)<<4|i>>4,a=(15&i)<<2|s>>6,c=63&s,isNaN(i)?(o=(3&n)<<4,a=c=64):isNaN(s)&&(c=64),l=l+t.charAt(r)+t.charAt(o)+t.charAt(a)+t.charAt(c);while(u<e.length);return l},decode:function(e){var n,i,s,r,o,a,c,l="",u=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),a=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),n=r<<2|o>>4,i=(15&o)<<4|a>>2,s=(3&a)<<6|c,l+=String.fromCharCode(n),64!=a&&(l+=String.fromCharCode(i)),64!=c&&(l+=String.fromCharCode(s));while(u<e.length);return l}};return e}),function(t,e){"function"==typeof define&&define.amd?define("strophe-md5",[],function(){return e()}):t.MD5=e()}(this,function(t){var e=function(t,e){var n=(65535&t)+(65535&e),i=(t>>16)+(e>>16)+(n>>16);return i<<16|65535&n},n=function(t,e){return t<<e|t>>>32-e},i=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},s=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},r=function(t){for(var e="0123456789abcdef",n="",i=0;i<4*t.length;i++)n+=e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15);return n},o=function(t,i,s,r,o,a){return e(n(e(e(i,t),e(r,a)),o),s)},a=function(t,e,n,i,s,r,a){return o(e&n|~e&i,t,e,s,r,a)},c=function(t,e,n,i,s,r,a){return o(e&i|n&~i,t,e,s,r,a)},l=function(t,e,n,i,s,r,a){return o(e^n^i,t,e,s,r,a)},u=function(t,e,n,i,s,r,a){
return o(n^(e|~i),t,e,s,r,a)},h=function(t,n){t[n>>5]|=128<<n%32,t[(n+64>>>9<<4)+14]=n;for(var i,s,r,o,h=1732584193,d=-271733879,f=-1732584194,p=271733878,_=0;_<t.length;_+=16)i=h,s=d,r=f,o=p,h=a(h,d,f,p,t[_+0],7,-680876936),p=a(p,h,d,f,t[_+1],12,-389564586),f=a(f,p,h,d,t[_+2],17,606105819),d=a(d,f,p,h,t[_+3],22,-1044525330),h=a(h,d,f,p,t[_+4],7,-176418897),p=a(p,h,d,f,t[_+5],12,1200080426),f=a(f,p,h,d,t[_+6],17,-1473231341),d=a(d,f,p,h,t[_+7],22,-45705983),h=a(h,d,f,p,t[_+8],7,1770035416),p=a(p,h,d,f,t[_+9],12,-1958414417),f=a(f,p,h,d,t[_+10],17,-42063),d=a(d,f,p,h,t[_+11],22,-1990404162),h=a(h,d,f,p,t[_+12],7,1804603682),p=a(p,h,d,f,t[_+13],12,-40341101),f=a(f,p,h,d,t[_+14],17,-1502002290),d=a(d,f,p,h,t[_+15],22,1236535329),h=c(h,d,f,p,t[_+1],5,-165796510),p=c(p,h,d,f,t[_+6],9,-1069501632),f=c(f,p,h,d,t[_+11],14,643717713),d=c(d,f,p,h,t[_+0],20,-373897302),h=c(h,d,f,p,t[_+5],5,-701558691),p=c(p,h,d,f,t[_+10],9,38016083),f=c(f,p,h,d,t[_+15],14,-660478335),d=c(d,f,p,h,t[_+4],20,-405537848),h=c(h,d,f,p,t[_+9],5,568446438),p=c(p,h,d,f,t[_+14],9,-1019803690),f=c(f,p,h,d,t[_+3],14,-187363961),d=c(d,f,p,h,t[_+8],20,1163531501),h=c(h,d,f,p,t[_+13],5,-1444681467),p=c(p,h,d,f,t[_+2],9,-51403784),f=c(f,p,h,d,t[_+7],14,1735328473),d=c(d,f,p,h,t[_+12],20,-1926607734),h=l(h,d,f,p,t[_+5],4,-378558),p=l(p,h,d,f,t[_+8],11,-2022574463),f=l(f,p,h,d,t[_+11],16,1839030562),d=l(d,f,p,h,t[_+14],23,-35309556),h=l(h,d,f,p,t[_+1],4,-1530992060),p=l(p,h,d,f,t[_+4],11,1272893353),f=l(f,p,h,d,t[_+7],16,-155497632),d=l(d,f,p,h,t[_+10],23,-1094730640),h=l(h,d,f,p,t[_+13],4,681279174),p=l(p,h,d,f,t[_+0],11,-358537222),f=l(f,p,h,d,t[_+3],16,-722521979),d=l(d,f,p,h,t[_+6],23,76029189),h=l(h,d,f,p,t[_+9],4,-640364487),p=l(p,h,d,f,t[_+12],11,-421815835),f=l(f,p,h,d,t[_+15],16,530742520),d=l(d,f,p,h,t[_+2],23,-995338651),h=u(h,d,f,p,t[_+0],6,-198630844),p=u(p,h,d,f,t[_+7],10,1126891415),f=u(f,p,h,d,t[_+14],15,-1416354905),d=u(d,f,p,h,t[_+5],21,-57434055),h=u(h,d,f,p,t[_+12],6,1700485571),p=u(p,h,d,f,t[_+3],10,-1894986606),f=u(f,p,h,d,t[_+10],15,-1051523),d=u(d,f,p,h,t[_+1],21,-2054922799),h=u(h,d,f,p,t[_+8],6,1873313359),p=u(p,h,d,f,t[_+15],10,-30611744),f=u(f,p,h,d,t[_+6],15,-1560198380),d=u(d,f,p,h,t[_+13],21,1309151649),h=u(h,d,f,p,t[_+4],6,-145523070),p=u(p,h,d,f,t[_+11],10,-1120210379),f=u(f,p,h,d,t[_+2],15,718787259),d=u(d,f,p,h,t[_+9],21,-343485551),h=e(h,i),d=e(d,s),f=e(f,r),p=e(p,o);return[h,d,f,p]},d={hexdigest:function(t){return r(h(i(t),8*t.length))},hash:function(t){return s(h(i(t),8*t.length))}};return d}),function(t,e){"function"==typeof define&&define.amd?define("strophe-utils",[],function(){return e()}):t.stropheUtils=e()}(this,function(){var t={utf16to8:function(t){var e,n,i="",s=t.length;for(e=0;e<s;e++)n=t.charCodeAt(e),n>=0&&n<=127?i+=t.charAt(e):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},addCookies:function(t){var e,n,i,s,r,o,a;for(e in t||{})r="",o="",a="",n=t[e],i="object"==typeof n,s=escape(unescape(i?n.value:n)),i&&(r=n.expires?";expires="+n.expires:"",o=n.domain?";domain="+n.domain:"",a=n.path?";path="+n.path:""),document.cookie=e+"="+s+r+o+a}};return t}),function(t,e){return"function"==typeof define&&define.amd?void define("strophe-polyfill",[],function(){return e()}):e()}(this,function(){Function.prototype.bind||(Function.prototype.bind=function(t){var e=this,n=Array.prototype.slice,i=Array.prototype.concat,s=n.call(arguments,1);return function(){return e.apply(t?t:this,i.call(s,n.call(arguments,0)))}}),Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1})}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,i;if(null===this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),i=0;i<r;){var o;i in s&&(o=s[i],t.call(n,o,i,s)),i++}}),function(t,e){if("function"==typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return e.apply(this,arguments)});else{var n=e(t.SHA1,t.Base64,t.MD5,t.stropheUtils);window.Strophe=n.Strophe,window.$build=n.$build,window.$iq=n.$iq,window.$msg=n.$msg,window.$pres=n.$pres,window.SHA1=n.SHA1,window.Base64=n.Base64,window.MD5=n.MD5,window.b64_hmac_sha1=n.SHA1.b64_hmac_sha1,window.b64_sha1=n.SHA1.b64_sha1,window.str_hmac_sha1=n.SHA1.str_hmac_sha1,window.str_sha1=n.SHA1.str_sha1}}(this,function(t,e,n,i){function s(t,e){return new c.Builder(t,e)}function r(t){return new c.Builder("message",t)}function o(t){return new c.Builder("iq",t)}function a(t){return new c.Builder("presence",t)}var c;return c={VERSION:"@VERSION@",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<c.XHTML.tags.length;e++)if(t==c.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if("undefined"!=typeof c.XHTML.attributes[t]&&c.XHTML.attributes[t].length>0)for(var n=0;n<c.XHTML.attributes[t].length;n++)if(e==c.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<c.XHTML.css.length;e++)if(t==c.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){c.NS[t]=e},forEachChild:function(t,e,n){var i,s;for(i=0;i<t.childNodes.length;i++)s=t.childNodes[i],s.nodeType!=c.ElementType.NORMAL||e&&!this.isTagEqual(s,e)||n(s)},isTagEqual:function(t,e){return t.tagName==e},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom(),t.appendChild(t.createElement("strophe"))):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return c._xmlGenerator||(c._xmlGenerator=c._makeGenerator()),c._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;var e,n,i,s=c.xmlGenerator().createElement(t);for(e=1;e<arguments.length;e++){var r=arguments[e];if(r)if("string"==typeof r||"number"==typeof r)s.appendChild(c.xmlTextNode(r));else if("object"==typeof r&&"function"==typeof r.sort)for(n=0;n<r.length;n++){var o=r[n];"object"==typeof o&&"function"==typeof o.sort&&void 0!==o[1]&&null!==o[1]&&s.setAttribute(o[0],o[1])}else if("object"==typeof r)for(i in r)r.hasOwnProperty(i)&&void 0!==r[i]&&null!==r[i]&&s.setAttribute(i,r[i])}return s},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return c.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;if(window.DOMParser){var n=new DOMParser;e=n.parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType==c.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==c.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return c.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType==c.ElementType.NORMAL){for(n=c.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(c.copyElement(t.childNodes[e]))}else t.nodeType==c.ElementType.TEXT&&(n=c.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,i,s,r,o,a,l,u,h,d;if(t.nodeType==c.ElementType.NORMAL)if(s=t.nodeName.toLowerCase(),c.XHTML.validTag(s))try{for(n=c.xmlElement(s),e=0;e<c.XHTML.attributes[s].length;e++)if(r=c.XHTML.attributes[s][e],o=t.getAttribute(r),"undefined"!=typeof o&&null!==o&&""!==o&&o!==!1&&0!==o)if("style"==r&&"object"==typeof o&&"undefined"!=typeof o.cssText&&(o=o.cssText),"style"==r){for(a=[],l=o.split(";"),i=0;i<l.length;i++)u=l[i].split(":"),h=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),c.XHTML.validCSS(h)&&(d=u[1].replace(/^\s*/,"").replace(/\s*$/,""),a.push(h+": "+d));a.length>0&&(o=a.join("; "),n.setAttribute(r,o))}else n.setAttribute(r,o);for(e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]))}catch(t){n=c.xmlTextNode("")}else for(n=c.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]));else if(t.nodeType==c.ElementType.FRAGMENT)for(n=c.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(c.createHtml(t.childNodes[e]));else t.nodeType==c.ElementType.TEXT&&(n=c.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=c.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){"undefined"!=typeof t.stack&&c.fatal(t.stack),t.sourceURL?c.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?c.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):c.fatal("error: "+t.message)},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,i,s=t.nodeName;for(t.getAttribute("_realname")&&(s=t.getAttribute("_realname")),e="<"+s,n=0;n<t.attributes.length;n++)"_realname"!=t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+c.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch(i=t.childNodes[n],i.nodeType){case c.ElementType.NORMAL:e+=c.serialize(i);break;case c.ElementType.TEXT:e+=c.xmlescape(i.nodeValue);break;case c.ElementType.CDATA:e+="<![CDATA["+i.nodeValue+"]]>"}e+="</"+s+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){c._connectionPlugins[t]=e}},c.Builder=function(t,e){"presence"!=t&&"message"!=t&&"iq"!=t||(e&&!e.xmlns?e.xmlns=c.NS.CLIENT:e||(e={xmlns:c.NS.CLIENT})),this.nodeTree=c.xmlElement(t,e),this.node=this.nodeTree},c.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return c.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var e in t)t.hasOwnProperty(e)&&(void 0===t[e]?this.node.removeAttribute(e):this.node.setAttribute(e,t[e]));return this},c:function(t,e,n){var i=c.xmlElement(t,e,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(t){var e,n=c.xmlGenerator();try{e=void 0!==n.importNode}catch(t){e=!1}var i=e?n.importNode(t,!0):c.copyElement(t);return this.node.appendChild(i),this.node=i,this},t:function(t){var e=c.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=c.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},c.Handler=function(t,e,n,i,s,r,o){this.handler=t,this.ns=e,this.name=n,this.type=i,this.id=s,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(c.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=r?c.getBareJidFromJid(r):null:this.from=r,this.user=!0},c.Handler.prototype={getNamespace:function(t){var e=t.getAttribute("xmlns");return e&&this.options.ignoreNamespaceFragment&&(e=e.split("#")[0]),e},namespaceMatch:function(t){var e=!1;if(!this.ns)return!0;var n=this;return c.forEachChild(t,null,function(t){n.getNamespace(t)===n.ns&&(e=!0)}),e=e||this.getNamespace(t)===this.ns},isMatch:function(t){var e=t.getAttribute("from");this.options.matchBareFromJid&&(e=c.getBareJidFromJid(e));var n=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!c.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?this.type.indexOf(n)==-1:n!=this.type)||this.id&&t.getAttribute("id")!=this.id||this.from&&e!=this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw c._handleError(t),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},c.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},c.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},c.Connection=function(t,e){this.service=t,this.options=e||{};var n=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new c.Websocket(this):this._proto=new c.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100),i.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms);for(var s in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(s)){var r=c._connectionPlugins[s],o=function(){};o.prototype=r,this[s]=new o,this[s].init(this)}},c.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},addProtocolErrorHandler:function(t,e,n){this.protocolErrorHandlers[t][e]=n},connect:function(t,e,n,i,s,r,o){this.jid=t,this.authzid=c.getBareJidFromJid(this.jid),this.authcid=o||c.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=c.getDomainFromJid(this.jid),this._changeConnectStatus(c.Status.CONNECTING,null),this._proto._connect(i,s,r)},attach:function(t,e,n,i,s,r,o){if(!(this._proto instanceof c.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,i,s,r,o)},restore:function(t,e,n,i,s){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,i,s)},_sessionCachingSupported:function(){if(this._proto instanceof c.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(t,e,n,i){var s=null,r=this;"function"==typeof t.tree&&(t=t.tree());var o=t.getAttribute("id");o||(o=this.getUniqueId("sendIQ"),t.setAttribute("id",o));var a=t.getAttribute("to"),l=this.jid,u=this.addHandler(function(t){s&&r.deleteTimedHandler(s);var i=!1,o=t.getAttribute("from");if(o!==a&&(a||o!==c.getBareJidFromJid(l)&&o!==c.getDomainFromJid(l)&&o!==l)||(i=!0),!i)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+o+"\nExpected jid: "+a};var u=t.getAttribute("type");if("result"==u)e&&e(t);else{if("error"!=u)throw{name:"StropheError",message:"Got bad IQ type of "+u};n&&n(t)}},null,"iq",["error","result"],o);return i&&(s=this.addTimedHandler(i,function(){return r.deleteHandler(u),n&&n(null),!1})),this.send(t),o},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100)},addTimedHandler:function(t,e){var n=new c.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,i,s,r,o){var a=new c.Handler(t,e,n,i,s,r,o);return this.addHandlers.push(a),a},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},registerSASLMechanisms:function(t){this.mechanisms={},t=t||[c.SASLAnonymous,c.SASLExternal,c.SASLMD5,c.SASLOAuthBearer,c.SASLPlain,c.SASLSHA1],t.forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(c.Status.DISCONNECTING,t),c.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=a({xmlns:c.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else c.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(t,e){for(var n in c._connectionPlugins)if(c._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(t,e)}catch(t){c.error(""+n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){c._handleError(t),c.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),c.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(c.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){c.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==c.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==c.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(c.serialize(n)));for(var i,s;this.removeHandlers.length>0;)s=this.removeHandlers.pop(),i=this.handlers.indexOf(s),i>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var r,o,a=n.getAttribute("type");if(null!==a&&"terminate"==a){if(this.disconnecting)return;return r=n.getAttribute("condition"),o=n.getElementsByTagName("conflict"),null!==r?("remote-stream-error"==r&&o.length>0&&(r="conflict"),this._changeConnectStatus(c.Status.CONNFAIL,r)):this._changeConnectStatus(c.Status.CONNFAIL,"unknown"),void this._doDisconnect(r)}var l=this;c.forEachChild(n,null,function(t){var e,n;for(n=l.handlers,l.handlers=[],e=0;e<n.length;e++){var i=n[e];try{!i.isMatch(t)||!l.authenticated&&i.user?l.handlers.push(i):i.run(t)&&l.handlers.push(i)}catch(t){c.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(t,e,n){c.info("_connect_cb was called"),this.connected=!0;var i;try{i=this._proto._reqToData(t)}catch(t){if("badformat"!=t)throw t;this._changeConnectStatus(c.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(i){this.xmlInput!==c.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==c.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(c.serialize(i)));var s=this._proto._connect_cb(i);if(s!==c.Status.CONNFAIL){var r;if(r=i.getElementsByTagNameNS?i.getElementsByTagNameNS(c.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0,!r)return void this._proto._no_auth_received(e);var o,a,l=[],u=i.getElementsByTagName("mechanism");if(u.length>0)for(o=0;o<u.length;o++)a=c.getText(u[o]),this.mechanisms[a]&&l.push(this.mechanisms[a]);return 0===l.length&&0===i.getElementsByTagName("auth").length?void this._proto._no_auth_received(e):void(this.do_authentication!==!1&&this.authenticate(l))}}},sortMechanismsByPriority:function(t){var e,n,i,s;for(e=0;e<t.length-1;++e){for(i=e,n=e+1;n<t.length;++n)t[n].prototype.priority>t[i].prototype.priority&&(i=n);i!=e&&(s=t[e],t[e]=t[i],t[i]=s)}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);var n=0,i=!1;for(n=0;n<t.length;++n)if(t[n].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[n],this._sasl_mechanism.onStart(this);var r=s("auth",{xmlns:c.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var o=this._sasl_mechanism.onChallenge(this,null);r.t(e.encode(o))}this.send(r.tree()),i=!0;break}return i},_attemptLegacyAuth:function(){null===c.getNodeFromJid(this.jid)?(this._changeConnectStatus(c.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(c.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(o({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var n=e.decode(c.getText(t)),i=this._sasl_mechanism.onChallenge(this,n),r=s("response",{xmlns:c.NS.SASL});return""!==i&&r.t(e.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(t){var e=o({type:"set",id:"_auth_2"}).c("query",{xmlns:c.NS.AUTH}).c("username",{}).t(c.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return c.getResourceFromJid(this.jid)||(this.jid=c.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(c.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var n,i=e.decode(c.getText(t)),s=/([a-z]+)=([^,]+)(,|$)/,r=i.match(s);if("v"==r[1]&&(n=r[2]),n!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}c.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],a=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return this._sasl_auth1_cb.bind(this)(e),!1};return o.push(this._addSysHandler(function(t){a.bind(this)(o,t)}.bind(this),null,"stream:features",null,null)),o.push(this._addSysHandler(function(t){a.bind(this)(o,t)}.bind(this),c.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)n=t.childNodes[e],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var i=c.getResourceFromJid(this.jid);return i?this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).c("resource",{}).t(i).tree()):this.send(o({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:c.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"==t.getAttribute("type")){c.info("SASL binding failed.");var e,n=t.getElementsByTagName("conflict");return n.length>0&&(e="conflict"),this._changeConnectStatus(c.Status.AUTHFAIL,e),!1}var i,s=t.getElementsByTagName("bind");return s.length>0?(i=s[0].getElementsByTagName("jid"),void(i.length>0&&(this.jid=c.getText(i[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(o({type:"set",id:"_session_auth_2"}).c("session",{xmlns:c.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null))))):(c.info("SASL binding failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(t){if("result"==t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null);else if("error"==t.getAttribute("type"))return c.info("Session creation failed."),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(c.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"==t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(c.Status.CONNECTED,null)):"error"==t.getAttribute("type")&&(this._changeConnectStatus(c.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new c.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,i,s){var r=new c.Handler(t,e,n,i,s);return r.user=!1,this.addHandlers.push(r),r},_onDisconnectTimeout:function(){return c.info("_onDisconnectTimeout was called"),this._changeConnectStatus(c.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n,i;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e),t>=0&&this.timedHandlers.splice(t,1);var s=(new Date).getTime();for(i=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(n=e.lastCalled+e.period,n-s<=0?e.run()&&i.push(e):i.push(e));this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this),100))}},c.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},c.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},c.SASLAnonymous=function(){},c.SASLAnonymous.prototype=new c.SASLMechanism("ANONYMOUS",!1,10),c.SASLAnonymous.prototype.test=function(t){return null===t.authcid},c.SASLPlain=function(){},c.SASLPlain.prototype=new c.SASLMechanism("PLAIN",!0,20),c.SASLPlain.prototype.test=function(t){return null!==t.authcid},c.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,i.utf16to8(e)},c.SASLSHA1=function(){},c.SASLSHA1.prototype=new c.SASLMechanism("SCRAM-SHA-1",!0,40),c.SASLSHA1.prototype.test=function(t){return null!==t.authcid},c.SASLSHA1.prototype.onChallenge=function(s,r,o){var a=o||n.hexdigest(1234567890*Math.random()),c="n="+i.utf16to8(s.authcid);return c+=",r=",c+=a,s._sasl_data.cnonce=a,s._sasl_data["client-first-message-bare"]=c,
c="n,,"+c,this.onChallenge=function(n,s){for(var r,o,a,c,l,u,h,d,f,p,_,m,g="c=biws,",v=n._sasl_data["client-first-message-bare"]+","+s+",",y=n._sasl_data.cnonce,b=/([a-z]+)=([^,]+)(,|$)/;s.match(b);){var w=s.match(b);switch(s=s.replace(w[0],""),w[1]){case"r":r=w[2];break;case"s":o=w[2];break;case"i":a=w[2]}}if(r.substr(0,y.length)!==y)return n._sasl_data={},n._sasl_failure_cb();for(g+="r="+r,v+=g,o=e.decode(o),o+="\0\0\0",f=i.utf16to8(n.pass),c=u=t.core_hmac_sha1(f,o),h=1;h<a;h++){for(l=t.core_hmac_sha1(f,t.binb2str(u)),d=0;d<5;d++)c[d]^=l[d];u=l}for(c=t.binb2str(c),p=t.core_hmac_sha1(c,"Client Key"),_=t.str_hmac_sha1(c,"Server Key"),m=t.core_hmac_sha1(t.str_sha1(t.binb2str(p)),v),n._sasl_data["server-signature"]=t.b64_hmac_sha1(_,v),d=0;d<5;d++)p[d]^=m[d];return g+=",p="+e.encode(t.binb2str(p))}.bind(this),c},c.SASLMD5=function(){},c.SASLMD5.prototype=new c.SASLMechanism("DIGEST-MD5",!1,30),c.SASLMD5.prototype.test=function(t){return null!==t.authcid},c.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},c.SASLMD5.prototype.onChallenge=function(t,e,s){for(var r,o=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,a=s||n.hexdigest(""+1234567890*Math.random()),c="",l=null,u="",h="";e.match(o);)switch(r=e.match(o),e=e.replace(r[0],""),r[2]=r[2].replace(/^"(.+)"$/,"$1"),r[1]){case"realm":c=r[2];break;case"nonce":u=r[2];break;case"qop":h=r[2];break;case"host":l=r[2]}var d=t.servtype+"/"+t.domain;null!==l&&(d=d+"/"+l);var f=i.utf16to8(t.authcid+":"+c+":"+this._connection.pass),p=n.hash(f)+":"+u+":"+a,_="AUTHENTICATE:"+d,m="";return m+="charset=utf-8,",m+="username="+this._quote(i.utf16to8(t.authcid))+",",m+="realm="+this._quote(c)+",",m+="nonce="+this._quote(u)+",",m+="nc=00000001,",m+="cnonce="+this._quote(a)+",",m+="digest-uri="+this._quote(d)+",",m+="response="+n.hexdigest(n.hexdigest(p)+":"+u+":00000001:"+a+":auth:"+n.hexdigest(_))+",",m+="qop=auth",this.onChallenge=function(){return""},m},c.SASLOAuthBearer=function(){},c.SASLOAuthBearer.prototype=new c.SASLMechanism("OAUTHBEARER",!0,50),c.SASLOAuthBearer.prototype.test=function(t){return null!==t.authcid},c.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,a=";return e+=t.authzid,e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",i.utf16to8(e)},c.SASLExternal=function(){},c.SASLExternal.prototype=new c.SASLMechanism("EXTERNAL",!0,60),c.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},{Strophe:c,$build:s,$msg:r,$iq:o,$pres:a,SHA1:t,Base64:e,MD5:n}}),function(t,e){return"function"==typeof define&&define.amd?void define("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build)}):e(Strophe,$build)}(this,function(t,e){return t.Request=function(e,n,i,s){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=i,this.date=NaN,this.sends=s||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var t=new Date;return(t-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var t=new Date;return(t-this.dead)/1e3},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,i){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var s=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});i&&s.attrs({route:i});var r=this._conn._connect_cb;this._requests.push(new t.Request(s.tree(),this._onRequestStateChange.bind(this,r.bind(this._conn)),s.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,i,s,r,o,a){this._conn.jid=e,this.sid=n,this.rid=i,this._conn.connect_callback=s,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=r||this.wait,this.hold=o||this.hold,this.window=a||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,i,s,r){var o=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!("undefined"!=typeof o&&null!==o&&o.rid&&o.sid&&o.jid)||"undefined"!=typeof e&&null!==e&&t.getBareJidFromJid(o.jid)!=t.getBareJidFromJid(e))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(o.jid,o.sid,o.rid,n,i,s,r)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,i,s=e.getAttribute("type");if(null!==s&&"terminate"==s)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),i=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var r=e.getAttribute("requests");r&&(this.window=parseInt(r,10));var o=e.getAttribute("hold");o&&(this.hold=parseInt(o,10));var a=e.getAttribute("wait");a&&(this.wait=parseInt(a,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var e,n=this._getRequestStatus(t);e=this._conn.protocolErrorHandlers.HTTP[n],e&&e.call(this,n)},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)t=this._requests.pop(),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),i=0;i<e.length;i++)null!==e[i]&&("restart"===e[i]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[i]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var s=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),s>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(e,n){var i;if(4==e.xhr.readyState)try{i=e.xhr.status}catch(e){t.error("Caught an error while retrieving a request's status, reqStatus: "+i)}return"undefined"==typeof i&&(i="number"==typeof n?n:0),i},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);if(4===n.xhr.readyState){var i=this._getRequestStatus(n);if(this.disconnecting&&i>=400)return this._hitError(i),void this._callProtocolErrorHandlers(n);if((i>0&&i<500||n.sends>5)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200==i){var s=this._requests[0]==n,r=this._requests[1]==n;(r||s&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0}else 0===i||i>=400&&i<600||i>=12e3?(t.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),this._hitError(i),this._callProtocolErrorHandlers(n),i>=400&&i<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect())):t.error("request id "+n.id+"."+n.sends+" error "+i+" happened");i>0&&i<500&&!(n.sends>5)||this._throttledRequestHandler()}},_processRequest:function(e){var n=this,i=this._requests[e],s=this._getRequestStatus(i,-1);if(i.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var r=i.age(),o=!isNaN(r)&&r>Math.floor(t.TIMEOUT*this.wait),a=null!==i.dead&&i.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4==i.xhr.readyState&&(s<1||s>=500);if((o||a||c)&&(a&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){t.debug("request id "+i.id+"."+i.sends+" posting");try{var l=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),"undefined"!=typeof i.xhr.setRequestHeader&&i.xhr.setRequestHeader("Content-Type",l),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var u=function(){if(i.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&i.xhr.setRequestHeader(e,t[e])}i.xhr.send(i.data)};if(i.sends>1){var h=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout(function(){u()},h)}else u();i.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e==this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var i=new t.Request(n.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),n.tree().getAttribute("rid"));this._requests.push(i),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){this._onIdle()}.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){return"function"==typeof define&&define.amd?void define("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)}):e(Strophe,$build)}(this,function(t,e){return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";n+="ws"===t.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==e.indexOf("/")?window.location.pathname+e:e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var i;if(i=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===i.length)return!1;for(var s=i[0],r="",o="",a="urn:ietf:params:xml:ns:xmpp-streams",c=0;c<s.childNodes.length;c++){var l=s.childNodes[c];if(l.getAttribute("xmlns")!==a)break;"text"===l.nodeName?o=l.textContent:r=l.nodeName}var u="WebSocket stream error: ";return u+=r?r:"unknown",o&&(u+=" - "+r),t.error(u),this._conn._changeConnectStatus(n,r),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(e){var n=this._check_streamerror(e,t.Status.CONNFAIL);if(n)return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,i=e.getAttribute("xmlns");"string"!=typeof i?n="Missing xmlns in <open />":i!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+i);var s=e.getAttribute("version");return"string"!=typeof s?n="Missing version in <open />":"1.0"!==s&&(n="Wrong version in <open />: "+s),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var i=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(i),this._conn.rawInput(e.data),this._handleStreamStart(i)&&this._connect_cb(i)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var s=e.getAttribute("see-other-uri");s?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var r=this._streamWrap(e.data),o=(new DOMParser).parseFromString(r,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(o,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var i=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(i);var s=t.serialize(i);this._conn.rawOutput(s);try{this.socket.send(s)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=e.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var i,s;i="restart"===e[n]?this._buildStream().tree():e[n],s=t.serialize(i),this._conn.xmlOutput(i),this._conn.rawOutput(s),this.socket.send(s)}this._conn._data=[]}},_onMessage:function(e){var n,i,s='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===s)return this._conn.rawInput(s),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else i=this._streamWrap(e.data),n=(new DOMParser).parseFromString(i,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},t}),function(t){"function"==typeof define&&define.amd&&define("strophe",["strophe-core","strophe-bosh","strophe-websocket"],function(t){return t})}(this),function(t){"function"==typeof define&&define.amd?define("jquery.browser",["jquery"],function(e){return t(e)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):t(window.jQuery)}(function(t){"use strict";function e(t){void 0===t&&(t=window.navigator.userAgent),t=t.toLowerCase();var e=/(edge)\/([\w.]+)/.exec(t)||/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(iemobile)[\/]([\w.]+)/.exec(t)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[],n=/(ipad)/.exec(t)||/(ipod)/.exec(t)||/(windows phone)/.exec(t)||/(iphone)/.exec(t)||/(kindle)/.exec(t)||/(silk)/.exec(t)||/(android)/.exec(t)||/(win)/.exec(t)||/(mac)/.exec(t)||/(linux)/.exec(t)||/(cros)/.exec(t)||/(playbook)/.exec(t)||/(bb)/.exec(t)||/(blackberry)/.exec(t)||[],i={},s={browser:e[5]||e[3]||e[1]||"",version:e[2]||e[4]||"0",versionNumber:e[4]||e[2]||"0",platform:n[0]||""};if(s.browser&&(i[s.browser]=!0,i.version=s.version,i.versionNumber=parseInt(s.versionNumber,10)),s.platform&&(i[s.platform]=!0),(i.android||i.bb||i.blackberry||i.ipad||i.iphone||i.ipod||i.kindle||i.playbook||i.silk||i["windows phone"])&&(i.mobile=!0),(i.cros||i.mac||i.linux||i.win)&&(i.desktop=!0),(i.chrome||i.opr||i.safari)&&(i.webkit=!0),i.rv||i.iemobile){var r="msie";s.browser=r,i[r]=!0}if(i.edge){delete i.edge;var o="msedge";s.browser=o,i[o]=!0}if(i.safari&&i.blackberry){var a="blackberry";s.browser=a,i[a]=!0}if(i.safari&&i.playbook){var c="playbook";s.browser=c,i[c]=!0}if(i.bb){var l="blackberry";s.browser=l,i[l]=!0}if(i.opr){var u="opera";s.browser=u,i[u]=!0}if(i.safari&&i.android){var h="android";s.browser=h,i[h]=!0}if(i.safari&&i.kindle){var d="kindle";s.browser=d,i[d]=!0}if(i.safari&&i.silk){var f="silk";s.browser=f,i[f]=!0}return i.name=s.browser,i.platform=s.platform,i}return window.jQBrowser=e(window.navigator.userAgent),window.jQBrowser.uaMatch=e,t&&(t.browser=window.jQBrowser),window.jQBrowser}),define("text",["module"],function(t){"use strict";function e(t,e){return void 0===t||""===t?e:t}function n(t,n,i,s){if(n===s)return!0;if(t===i){if("http"===t)return e(n,"80")===e(s,"80");if("https"===t)return e(n,"443")===e(s,"443")}return!1}var i,s,r,o,a,c=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],l=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,u=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,h="undefined"!=typeof location&&location.href,d=h&&location.protocol&&location.protocol.replace(/\:/,""),f=h&&location.hostname,p=h&&(location.port||void 0),_={},m=t.config&&t.config()||{};return i={version:"2.0.15",strip:function(t){if(t){t=t.replace(l,"");var e=t.match(u);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:m.createXhr||function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){n=c[e];try{t=new ActiveXObject(n)}catch(t){}if(t){c=[n];break}}return t},parseName:function(t){var e,n,i,s=!1,r=t.lastIndexOf("."),o=0===t.indexOf("./")||0===t.indexOf("../");return r!==-1&&(!o||r>1)?(e=t.substring(0,r),n=t.substring(r+1)):e=t,i=n||e,r=i.indexOf("!"),r!==-1&&(s="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:e=i),{moduleName:e,ext:n,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,e,s,r){var o,a,c,l=i.xdRegExp.exec(t);return!l||(o=l[2],a=l[3],a=a.split(":"),c=a[1],a=a[0],(!o||o===e)&&(!a||a.toLowerCase()===s.toLowerCase())&&(!c&&!a||n(o,c,e,r)))},finishLoad:function(t,e,n,s){n=e?i.strip(n):n,m.isBuild&&(_[t]=n),s(n)},load:function(t,e,n,s){if(s&&s.isBuild&&!s.inlineText)return void n();m.isBuild=s&&s.isBuild;var r=i.parseName(t),o=r.moduleName+(r.ext?"."+r.ext:""),a=e.toUrl(o),c=m.useXhr||i.useXhr;return 0===a.indexOf("empty:")?void n():void(!h||c(a,d,f,p)?i.get(a,function(e){i.finishLoad(t,r.strip,e,n)},function(t){n.error&&n.error(t)}):e([o],function(t){i.finishLoad(r.moduleName+"."+r.ext,r.strip,t,n)}))},write:function(t,e,n,s){if(_.hasOwnProperty(e)){var r=i.jsEscape(_[e]);n.asModule(t+"!"+e,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,e,n,s,r){var o=i.parseName(e),a=o.ext?"."+o.ext:"",c=o.moduleName+a,l=n.toUrl(o.moduleName+a)+".js";i.load(c,n,function(e){var n=function(t){return s(l,t)};n.asModule=function(t,e){return s.asModule(t,l,e)},i.write(t,c,n,r)},r)}},"node"===m.env||!m.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(s=require.nodeRequire("fs"),i.get=function(t,e,n){try{var i=s.readFileSync(t,"utf8");"\ufeff"===i[0]&&(i=i.substring(1)),e(i)}catch(t){n&&n(t)}}):"xhr"===m.env||!m.env&&i.createXhr()?i.get=function(t,e,n,s){var r,o=i.createXhr();if(o.open("GET",t,!0),s)for(r in s)s.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),s[r]);m.onXhr&&m.onXhr(o,t),o.onreadystatechange=function(i){var s,r;4===o.readyState&&(s=o.status||0,s>399&&s<600?(r=new Error(t+" HTTP status: "+s),r.xhr=o,n&&n(r)):e(o.responseText),m.onXhrComplete&&m.onXhrComplete(o,t))},o.send(null)}:"rhino"===m.env||!m.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?i.get=function(t,e){var n,i,s="utf-8",r=new java.io.File(t),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),c="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(o),n.append(i);c=String(n.toString())}finally{a.close()}e(c)}:("xpconnect"===m.env||!m.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),a="@mozilla.org/windows-registry-key;1"in r,i.get=function(t,e){var n,i,s,c={};a&&(t=t.replace(/\//g,"\\")),s=new FileUtils.File(t);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(s,1,0,!1),i=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),i.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),i.readString(n.available(),c),i.close(),n.close(),e(c.value)}catch(t){throw new Error((s&&s.path||"")+": "+t)}}),i}),define("tpl",["text","underscore"],function(t,e){"use strict";var n={},i="define('{pluginName}!{moduleName}', function () { return {source}; });\n";return{version:"0.0.2",load:function(i,s,r,o){if(o.tpl&&o.tpl.templateSettings&&(e.templateSettings=o.tpl.templateSettings),n[i])r(n[i]);else{var a=o.tpl&&!e.isUndefined(o.tpl.extension)?o.tpl.extension:".html",c=o.tpl&&o.tpl.path||"";t.load(c+i+a,s,function(t){n[i]=e.template(t),r(n[i])},o)}},write:function(t,e,s){var r=n[e],o=r&&r.source;o&&s.asModule(t+"!"+e,i.replace("{pluginName}",t).replace("{moduleName}",e).replace("{source}",o))}}}),define("tpl!field",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<field var="'+(null==(__t=name)?"":__t)+'">',_.isArray(value)?(__p+="\n    ",_.each(value,function(t){__p+="<value>"+(null==(__t=t)?"":__t)+"</value>"}),__p+="\n"):__p+="\n    <value>"+(null==(__t=value)?"":__t)+"</value>\n",__p+="</field>\n";return __p}}),define("tpl!select_option",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<option value="'+(null==(__t=value)?"":__t)+'" ',selected&&(__p+=' selected="selected" '),__p+=" >"+(null==(__t=label)?"":__t)+"</option>\n";return __p}}),define("tpl!form_select",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<label>"+(null==(__t=label)?"":__t)+'</label>\n<select name="'+(null==(__t=name)?"":__t)+'"  ',multiple&&(__p+=' multiple="multiple" '),__p+=">"+(null==(__t=options)?"":__t)+"</select>\n";return __p}}),define("tpl!form_textarea",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<label class="label-ta">'+(null==(__t=label)?"":__t)+'</label>\n<textarea name="'+(null==(__t=name)?"":__t)+'">'+(null==(__t=value)?"":__t)+"</textarea>\n";return __p}}),define("tpl!form_checkbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<label>"+(null==(__t=label)?"":__t)+'</label>\n<input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'" '+(null==(__t=checked)?"":__t)+">\n";return __p}}),define("tpl!form_username",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<div class="input-group">\n    <input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'"\n        ',value&&(__p+=' value="'+(null==(__t=value)?"":__t)+'" '),__p+="\n        ",required&&(__p+=' class="required" '),__p+=' />\n    <span title="'+(null==(__t=domain)?"":__t)+'">'+(null==(__t=domain)?"":__t)+"</span>\n</div>\n";return __p}}),define("tpl!form_input",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<input name="'+(null==(__t=name)?"":__t)+'" type="'+(null==(__t=type)?"":__t)+'" \n    ',value&&(__p+=' value="'+(null==(__t=value)?"":__t)+'" '),__p+="\n    ",required&&(__p+=' class="required" '),__p+=" >\n";return __p}}),define("tpl!form_captcha",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",label&&(__p+="\n<label>\n    "+(null==(__t=label)?"":__t)+"\n</label>\n"),__p+='\n<img src="data:'+(null==(__t=type)?"":__t)+";base64,"+(null==(__t=data)?"":__t)+'">\n<input name="'+(null==(__t=name)?"":__t)+'" type="text" ',required&&(__p+=' class="required" '),__p+=" >\n\n\n";return __p}}),function(t,e){define("utils",["jquery","jquery.browser","underscore","tpl!field","tpl!select_option","tpl!form_select","tpl!form_textarea","tpl!form_checkbox","tpl!form_username","tpl!form_input","tpl!form_captcha"],e)}(this,function(t,e,n,i,s,r,o,a,c,l,u){"use strict";var h={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},d=function(e){var n=new t.Deferred;return t("<img>",{src:e,error:n.reject,load:n.resolve}),n.promise()};t.expr[":"].emptyVal=function(t){return""===t.value},t.fn.hasScrollBar=function(){return!!t.contains(document,this.get(0))&&this.parent().height()<this.get(0).scrollHeight},t.fn.throttledHTML=n.throttle(t.fn.html,500),t.fn.addHyperlinks=function(){return this.length>0&&this.each(function(e,i){var s,r,o=t(i),a=o.html(),c=a.match(/\b(https?:\/\/|www\.|https?:\/\/www\.)[^\s<]{2,200}\b/g);if(c)for(e=0;e<c.length;e++)s=0===c[e].indexOf("http://")||0===c[e].indexOf("https://")?"":"http://",r=encodeURI(decodeURI(c[e])).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"),a=a.replace(c[e],'<a target="_blank" rel="noopener" href="'+s+r+'">'+c[e]+"</a>");o.html(a),n.each(c,function(t){d(t).then(function(){var e=0===t.indexOf("http://")||0===t.indexOf("https://")?"":"http://",n=encodeURI(decodeURI(t)).replace(/[!'()]/g,escape).replace(/\*/g,"%2A"),i='<a target="_blank" rel="noopener" href="'+e+n+'">'+t+"</a>";event.target.className="chat-image",a=a.replace(i,event.target.outerHTML),o.throttledHTML(a)})})}),this},t.fn.addEmoticons=function(e){return e&&this.length>0&&this.each(function(e,n){var i=t(n).html();i=i.replace(/&gt;:\)/g,'<span class="emoticon icon-evil"></span>'),i=i.replace(/:\)/g,'<span class="emoticon icon-smiley"></span>'),i=i.replace(/:\-\)/g,'<span class="emoticon icon-smiley"></span>'),i=i.replace(/;\)/g,'<span class="emoticon icon-wink"></span>'),i=i.replace(/;\-\)/g,'<span class="emoticon icon-wink"></span>'),i=i.replace(/:D/g,'<span class="emoticon icon-grin"></span>'),i=i.replace(/:\-D/g,'<span class="emoticon icon-grin"></span>'),i=i.replace(/:P/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/:\-P/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/:p/g,'<span class="emoticon icon-tongue"></span>'),
i=i.replace(/:\-p/g,'<span class="emoticon icon-tongue"></span>'),i=i.replace(/8\)/g,'<span class="emoticon icon-cool"></span>'),i=i.replace(/:S/g,'<span class="emoticon icon-confused"></span>'),i=i.replace(/:\\/g,'<span class="emoticon icon-wondering"></span>'),i=i.replace(/:\/ /g,'<span class="emoticon icon-wondering"></span>'),i=i.replace(/&gt;:\(/g,'<span class="emoticon icon-angry"></span>'),i=i.replace(/:\(/g,'<span class="emoticon icon-sad"></span>'),i=i.replace(/:\-\(/g,'<span class="emoticon icon-sad"></span>'),i=i.replace(/:O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/:\-O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/\=\-O/g,'<span class="emoticon icon-shocked"></span>'),i=i.replace(/\(\^.\^\)b/g,'<span class="emoticon icon-thumbs-up"></span>'),i=i.replace(/&lt;3/g,'<span class="emoticon icon-heart"></span>'),t(n).html(i)}),this};var f={__:function(e){if("undefined"==typeof Jed)return e;"undefined"==typeof this.i18n&&(this.i18n=locales.en),"string"==typeof this.i18n&&(this.i18n=t.parseJSON(this.i18n)),"undefined"==typeof this.jed&&(this.jed=new Jed(this.i18n));var n=this.jed.translate(e);return arguments.length>1?n.fetch.apply(n,[].slice.call(arguments,1)):n.fetch()},___:function(t){return t},isLocaleAvailable:function(t,e){if(e(t))return t;var n=t.split("-")[0];return n!==t&&e(n)?n:void 0},detectLocale:function(t){var e,n;if(window.navigator.userLanguage&&(e=f.isLocaleAvailable(window.navigator.userLanguage,t)),window.navigator.languages&&!e)for(n=0;n<window.navigator.languages.length&&!e;n++)e=f.isLocaleAvailable(window.navigator.languages[n],t);return window.navigator.browserLanguage&&!e&&(e=f.isLocaleAvailable(window.navigator.browserLanguage,t)),window.navigator.language&&!e&&(e=f.isLocaleAvailable(window.navigator.language,t)),window.navigator.systemLanguage&&!e&&(e=f.isLocaleAvailable(window.navigator.systemLanguage,t)),e||"en"},isOTRMessage:function(e){var n=t(e).children("body"),i=n.length>0?n.text():void 0;return i&&!!i.match(/^\?OTR/)},isHeadlineMessage:function(e){var n=t(e),i=n.attr("from");return"headline"===n.attr("type")||"error"!==n.attr("type")&&"undefined"!=typeof i&&i.indexOf("@")===-1},merge:function t(e,i){for(var s in i)n.isObject(e[s])?t(e[s],i[s]):e[s]=i[s]},applyUserSettings:function t(e,i,s){for(var r in i)n.isUndefined(s[r])||(n.isObject(i[r])?t(e[r],i[r],s[r]):e[r]=s[r])},refreshWebkit:function(){t.browser.webkit&&window.requestAnimationFrame&&window.requestAnimationFrame(function(){var t=document.getElementById("conversejs");t.style.display="none";t.offsetHeight;t.style.display="block"})},webForm2xForm:function(e){var n,s=t(e);if(s.is("[type=checkbox]"))n=s.is(":checked")&&1||0;else if(s.is("textarea")){n=[];for(var r=s.val().split("\n"),o=0;o<r.length;o++){var a=t.trim(r[o]);""!==a&&n.push(a)}}else n=s.val();return t(i({name:s.attr("name"),value:n}))[0]},contains:function(t,e){return function(i){if("object"==typeof t){var s=!1;return n.each(t,function(t){s=s||i.get(t).toLowerCase().indexOf(e.toLowerCase())!==-1}),s}if("string"==typeof t)return i.get(t).toLowerCase().indexOf(e.toLowerCase())!==-1;throw new TypeError("contains: wrong attribute type. Must be string or array.")}},xForm2webForm:function(e,i){var d,f,p,_,m,g=[];if("list-single"===e.attr("type")||"list-multi"===e.attr("type")){for(m=[],p=e.children("value"),d=0;d<p.length;d++)m.push(t(p[d]).text());for(f=e.children("option"),d=0;d<f.length;d++)_=t(f[d]).find("value").text(),g.push(s({value:_,label:t(f[d]).attr("label"),selected:m.indexOf(_)>=0,required:e.find("required").length}));return r({name:e.attr("var"),label:e.attr("label"),options:g.join(""),multiple:"list-multi"===e.attr("type"),required:e.find("required").length})}return"fixed"===e.attr("type")?t('<p class="form-help">').text(e.find("value").text()):"jid-multi"===e.attr("type")?o({name:e.attr("var"),label:e.attr("label")||"",value:e.find("value").text(),required:e.find("required").length}):"boolean"===e.attr("type")?a({name:e.attr("var"),type:h[e.attr("type")],label:e.attr("label")||"",checked:"1"===e.find("value").text()&&'checked="1"'||"",required:e.find("required").length}):e.attr("type")&&"username"===e.attr("var")?c({domain:" @"+this.domain,name:e.attr("var"),type:h[e.attr("type")],label:e.attr("label")||"",value:e.find("value").text(),required:e.find("required").length}):e.attr("type")?l({name:e.attr("var"),type:h[e.attr("type")],label:e.attr("label")||"",value:e.find("value").text(),required:e.find("required").length}):"ocr"===e.attr("var")?n.reduce(n.map(e.find("uri"),t.proxy(function(t){return u({label:this.$field.attr("label"),name:this.$field.attr("var"),data:this.$stanza.find('data[cid="'+t.textContent.replace(/^cid:/,"")+'"]').text(),type:t.getAttribute("type"),required:this.$field.find("required").length})},{$stanza:i,$field:e})),function(t,e){return t+e},""):void 0}};return f.contains.not=function(t,e){return function(n){return!f.contains(t,e)(n)}},f}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();(void 0===e||e>n.length)&&(e=n.length),e-=t.length;var i=n.indexOf(t,e);return i!==-1&&i===e}),String.prototype.splitOnce=function(t){var e=this.split(t);return[e.shift(),e.join(t)]},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),define("polyfill",function(){}),function(t,e){"function"==typeof define&&define.amd?define("pluggable",["underscore"],e):window.pluggable=e(_)}(this,function(t){"use strict";function e(t,e){this.name=e,this.plugged=t,this.plugged.__super__={},this.plugins={},this.initialized_plugins=[]}return t.extend(e.prototype,{wrappedOverride:function(e,n,i){return"function"==typeof i&&("undefined"==typeof this.__super__&&(this.__super__={}),this.__super__[e]=i.bind(this)),n.apply(this,t.rest(arguments,3))},_overrideAttribute:function(e,n){var i=n.overrides[e];if("function"==typeof i){var s=t.partial(this.wrappedOverride,e,i,this.plugged[e]);this.plugged[e]=s}else this.plugged[e]=i},_extendObject:function(e,n){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged),t.each(n,function(n,i){if("events"===i)e.prototype[i]=t.extend(n,e.prototype[i]);else if("function"==typeof n){var s=t.partial(this.wrappedOverride,i,n,e.prototype[i]);e.prototype[i]=s}else e.prototype[i]=n}.bind(this))},loadOptionalDependencies:function(e){t.each(e.optional_dependencies,function(n){var i=this.plugins[n];if(i){if(t.contains(i.optional_dependencies,e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+n+'"';this.initializePlugin(i)}else this.throwUndefinedDependencyError('Could not find optional dependency "'+n+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}.bind(this))},throwUndefinedDependencyError:function(t){if(this.plugged.strict_plugin_dependencies)throw t;return void console.log(t)},applyOverrides:function(e){t.each(Object.keys(e.overrides||{}),function(t){var n=e.overrides[t];"object"==typeof n?"undefined"==typeof this.plugged[t]?this.throwUndefinedDependencyError('Error: Plugin "'+e.__name__+'" tried to override '+t+" but it's not found."):this._extendObject(this.plugged[t],n):this._overrideAttribute(t,e)}.bind(this))},initializePlugin:function(e){t.contains(this.initialized_plugins,e.__name__)||(t.extend(e,this.properties),e.optional_dependencies&&this.loadOptionalDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__))},registerPlugin:function(t,e){e.__name__=t,this.plugins[t]=e},initializePlugins:function(e){t.size(this.plugins)&&(this.properties=e,t.each(t.values(this.plugins),this.initializePlugin.bind(this)))}}),{enable:function(n,i,s){"undefined"==typeof s&&(s="pluginSocket"),"undefined"==typeof i&&(i="plugged");var r={};return r[s]=new e(n,i),t.extend(n,r)}}}),define("tpl!chats_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="minimized-chats">\n    <a id="toggle-minimized-chats" href="#"></a>\n    <div class="flyout minimized-chats-flyout"></div>\n</div>\n';return __p}}),function(t,e){"function"==typeof define&&define.amd?define("strophe.disco",["strophe"],function(t){return e(t.Strophe,t.$build,t.$iq,t.$msg,t.$pres),t}):e(t.Strophe,t.$build,t.$iq,t.$msg,t.$pres)}(this,function(t,e,n,i,s){t.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(e){this._connection=e,this._identities=[],this._features=[],this._items=[],e.addHandler(this._onDiscoInfo.bind(this),t.NS.DISCO_INFO,"iq","get",null,null),e.addHandler(this._onDiscoItems.bind(this),t.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(t,e,n,i){for(var s=0;s<this._identities.length;s++)if(this._identities[s].category==t&&this._identities[s].type==e&&this._identities[s].name==n&&this._identities[s].lang==i)return!1;return this._identities.push({category:t,type:e,name:n,lang:i}),!0},addFeature:function(t){for(var e=0;e<this._features.length;e++)if(this._features[e]==t)return!1;return this._features.push(t),!0},removeFeature:function(t){for(var e=0;e<this._features.length;e++)if(this._features[e]===t)return this._features.splice(e,1),!0;return!1},addItem:function(t,e,n,i){return!(n&&!i)&&(this._items.push({jid:t,name:e,node:n,call_back:i}),!0)},info:function(e,i,s,r,o){var a={xmlns:t.NS.DISCO_INFO};i&&(a.node=i);var c=n({from:this._connection.jid,to:e,type:"get"}).c("query",a);this._connection.sendIQ(c,s,r,o)},items:function(e,i,s,r,o){var a={xmlns:t.NS.DISCO_ITEMS};i&&(a.node=i);var c=n({from:this._connection.jid,to:e,type:"get"}).c("query",a);this._connection.sendIQ(c,s,r,o)},_buildIQResult:function(t,e){var i=t.getAttribute("id"),s=t.getAttribute("from"),r=n({type:"result",id:i});return null!==s&&r.attrs({to:s}),r.c("query",e)},_onDiscoInfo:function(e){var n,i=e.getElementsByTagName("query")[0].getAttribute("node"),s={xmlns:t.NS.DISCO_INFO};i&&(s.node=i);var r=this._buildIQResult(e,s);for(n=0;n<this._identities.length;n++)s={category:this._identities[n].category,type:this._identities[n].type},this._identities[n].name&&(s.name=this._identities[n].name),this._identities[n].lang&&(s["xml:lang"]=this._identities[n].lang),r.c("identity",s).up();for(n=0;n<this._features.length;n++)r.c("feature",{var:this._features[n]}).up();return this._connection.send(r.tree()),!0},_onDiscoItems:function(e){var n,i,s={xmlns:t.NS.DISCO_ITEMS},r=e.getElementsByTagName("query")[0].getAttribute("node");if(r){for(s.node=r,n=[],i=0;i<this._items.length;i++)if(this._items[i].node==r){n=this._items[i].call_back(e);break}}else n=this._items;var o=this._buildIQResult(e,s);for(i=0;i<n.length;i++){var a={jid:n[i].jid};n[i].name&&(a.name=n[i].name),n[i].node&&(a.node=n[i].node),o.c("item",a).up()}return this._connection.send(o.tree()),!0}})}),function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,i,s){e.Backbone=t(e,s,n,i)});else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(t){}t(e,exports,i,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(t,e,n,i){var s=t.Backbone,r=Array.prototype.slice;e.VERSION="1.3.3",e.$=i,e.noConflict=function(){return t.Backbone=s,this},e.emulateHTTP=!1,e.emulateJSON=!1;var o=function(t,e,i){switch(t){case 1:return function(){return n[e](this[i])};case 2:return function(t){return n[e](this[i],t)};case 3:return function(t,s){return n[e](this[i],c(t,this),s)};case 4:return function(t,s,r){return n[e](this[i],c(t,this),s,r)};default:return function(){var t=r.call(arguments);return t.unshift(this[i]),n[e].apply(n,t)}}},a=function(t,e,i){n.each(e,function(e,s){n[s]&&(t.prototype[s]=o(e,s,i))})},c=function(t,e){return n.isFunction(t)?t:n.isObject(t)&&!e._isModel(t)?l(t):n.isString(t)?function(e){return e.get(t)}:t},l=function(t){var e=n.matches(t);return function(t){return e(t.attributes)}},u=e.Events={},h=/\s+/,d=function(t,e,i,s,r){var o,a=0;if(i&&"object"==typeof i){void 0!==s&&"context"in r&&void 0===r.context&&(r.context=s);for(o=n.keys(i);a<o.length;a++)e=d(t,e,o[a],i[o[a]],r)}else if(i&&h.test(i))for(o=i.split(h);a<o.length;a++)e=t(e,o[a],s,r);else e=t(e,i,s,r);return e};u.on=function(t,e,n){return f(this,t,e,n)};var f=function(t,e,n,i,s){if(t._events=d(p,t._events||{},e,n,{context:i,ctx:t,listening:s}),s){var r=t._listeners||(t._listeners={});r[s.id]=s}return t};u.listenTo=function(t,e,i){if(!t)return this;var s=t._listenId||(t._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),o=r[s];if(!o){var a=this._listenId||(this._listenId=n.uniqueId("l"));o=r[s]={obj:t,objId:s,id:a,listeningTo:r,count:0}}return f(t,e,i,this,o),this};var p=function(t,e,n,i){if(n){var s=t[e]||(t[e]=[]),r=i.context,o=i.ctx,a=i.listening;a&&a.count++,s.push({callback:n,context:r,ctx:r||o,listening:a})}return t};u.off=function(t,e,n){return this._events?(this._events=d(_,this._events,t,e,{context:n,listeners:this._listeners}),this):this},u.stopListening=function(t,e,i){var s=this._listeningTo;if(!s)return this;for(var r=t?[t._listenId]:n.keys(s),o=0;o<r.length;o++){var a=s[r[o]];if(!a)break;a.obj.off(e,i,this)}return this};var _=function(t,e,i,s){if(t){var r,o=0,a=s.context,c=s.listeners;if(e||i||a){for(var l=e?[e]:n.keys(t);o<l.length;o++){e=l[o];var u=t[e];if(!u)break;for(var h=[],d=0;d<u.length;d++){var f=u[d];i&&i!==f.callback&&i!==f.callback._callback||a&&a!==f.context?h.push(f):(r=f.listening,r&&0===--r.count&&(delete c[r.id],delete r.listeningTo[r.objId]))}h.length?t[e]=h:delete t[e]}return t}for(var p=n.keys(c);o<p.length;o++)r=c[p[o]],delete c[r.id],delete r.listeningTo[r.objId]}};u.once=function(t,e,i){var s=d(m,{},t,e,n.bind(this.off,this));return"string"==typeof t&&null==i&&(e=void 0),this.on(s,e,i)},u.listenToOnce=function(t,e,i){var s=d(m,{},e,i,n.bind(this.stopListening,this,t));return this.listenTo(t,s)};var m=function(t,e,i,s){if(i){var r=t[e]=n.once(function(){s(e,r),i.apply(this,arguments)});r._callback=i}return t};u.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),i=0;i<e;i++)n[i]=arguments[i+1];return d(g,this._events,t,void 0,n),this};var g=function(t,e,n,i){if(t){var s=t[e],r=t.all;s&&r&&(r=r.slice()),s&&v(s,i),r&&v(r,[e].concat(i))}return t},v=function(t,e){var n,i=-1,s=t.length,r=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++i<s;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r);return;case 2:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,o);return;case 3:for(;++i<s;)(n=t[i]).callback.call(n.ctx,r,o,a);return;default:for(;++i<s;)(n=t[i]).callback.apply(n.ctx,e);return}};u.bind=u.on,u.unbind=u.off,n.extend(e,u);var y=e.Model=function(t,e){var i=t||{};e||(e={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),e.parse&&(i=this.parse(i,e)||{});var s=n.result(this,"defaults");i=n.defaults(n.extend({},s,i),s),this.set(i,e),this.changed={},this.initialize.apply(this,arguments)};n.extend(y.prototype,u,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(t){return n.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return n.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!n.iteratee(t,this)(this.attributes)},set:function(t,e,i){if(null==t)return this;var s;if("object"==typeof t?(s=t,i=e):(s={})[t]=e,i||(i={}),!this._validate(s,i))return!1;var r=i.unset,o=i.silent,a=[],c=this._changing;this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={});var l=this.attributes,u=this.changed,h=this._previousAttributes;for(var d in s)e=s[d],n.isEqual(l[d],e)||a.push(d),n.isEqual(h[d],e)?delete u[d]:u[d]=e,r?delete l[d]:l[d]=e;if(this.idAttribute in s&&(this.id=this.get(this.idAttribute)),!o){a.length&&(this._pending=i);for(var f=0;f<a.length;f++)this.trigger("change:"+a[f],this,l[a[f]],i)}if(c)return this;if(!o)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,n.extend({},e,{unset:!0}))},clear:function(t){var e={};for(var i in this.attributes)e[i]=void 0;return this.set(e,n.extend({},t,{unset:!0}))},hasChanged:function(t){return null==t?!n.isEmpty(this.changed):n.has(this.changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&n.clone(this.changed);var e=this._changing?this._previousAttributes:this.attributes,i={};for(var s in t){var r=t[s];n.isEqual(e[s],r)||(i[s]=r)}return!!n.size(i)&&i},previous:function(t){return null!=t&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(t){t=n.extend({parse:!0},t);var e=this,i=t.success;return t.success=function(n){var s=t.parse?e.parse(n,t):n;return!!e.set(s,t)&&(i&&i.call(t.context,e,n,t),void e.trigger("sync",e,n,t))},B(this,t),this.sync("read",this,t)},save:function(t,e,i){var s;null==t||"object"==typeof t?(s=t,i=e):(s={})[t]=e,i=n.extend({validate:!0,parse:!0},i);var r=i.wait;if(s&&!r){if(!this.set(s,i))return!1}else if(!this._validate(s,i))return!1;var o=this,a=i.success,c=this.attributes;i.success=function(t){o.attributes=c;var e=i.parse?o.parse(t,i):t;return r&&(e=n.extend({},s,e)),!(e&&!o.set(e,i))&&(a&&a.call(i.context,o,t,i),void o.trigger("sync",o,t,i))},B(this,i),s&&r&&(this.attributes=n.extend({},c,s));var l=this.isNew()?"create":i.patch?"patch":"update";"patch"!==l||i.attrs||(i.attrs=s);var u=this.sync(l,this,i);return this.attributes=c,u},destroy:function(t){t=t?n.clone(t):{};var e=this,i=t.success,s=t.wait,r=function(){e.stopListening(),e.trigger("destroy",e,e.collection,t)};t.success=function(n){s&&r(),i&&i.call(t.context,e,n,t),e.isNew()||e.trigger("sync",e,n,t)};var o=!1;return this.isNew()?n.defer(t.success):(B(this,t),o=this.sync("delete",this,t)),s||r(),o},url:function(){var t=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();if(this.isNew())return t;var e=this.get(this.idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(t){return this._validate({},n.extend({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=n.extend({},this.attributes,t);var i=this.validationError=this.validate(t,e)||null;return!i||(this.trigger("invalid",this,i,n.extend(e,{validationError:i})),!1)}});var b={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};a(y,b,"attributes");var w=e.Collection=function(t,e){e||(e={}),e.model&&(this.model=e.model),void 0!==e.comparator&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,n.extend({silent:!0},e))},S={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},M=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var i,s=Array(t.length-n),r=e.length;for(i=0;i<s.length;i++)s[i]=t[i+n];for(i=0;i<r;i++)t[i+n]=e[i];for(i=0;i<s.length;i++)t[i+r+n]=s[i]};n.extend(w.prototype,u,{model:y,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return e.sync.apply(this,arguments)},add:function(t,e){return this.set(t,n.extend({merge:!1},e,x))},remove:function(t,e){e=n.extend({},e);var i=!n.isArray(t);t=i?[t]:t.slice();var s=this._removeModels(t,e);return!e.silent&&s.length&&(e.changes={added:[],merged:[],removed:s},this.trigger("update",this,e)),i?s[0]:s},set:function(t,e){if(null!=t){e=n.extend({},S,e),e.parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var i=!n.isArray(t);t=i?[t]:t.slice();var s=e.at;null!=s&&(s=+s),s>this.length&&(s=this.length),s<0&&(s+=this.length+1);var r,o,a=[],c=[],l=[],u=[],h={},d=e.add,f=e.merge,p=e.remove,_=!1,m=this.comparator&&null==s&&e.sort!==!1,g=n.isString(this.comparator)?this.comparator:null;for(o=0;o<t.length;o++){r=t[o];var v=this.get(r);if(v){if(f&&r!==v){var y=this._isModel(r)?r.attributes:r;e.parse&&(y=v.parse(y,e)),v.set(y,e),l.push(v),m&&!_&&(_=v.hasChanged(g))}h[v.cid]||(h[v.cid]=!0,a.push(v)),t[o]=v}else d&&(r=t[o]=this._prepareModel(r,e),r&&(c.push(r),this._addReference(r,e),h[r.cid]=!0,a.push(r)))}if(p){for(o=0;o<this.length;o++)r=this.models[o],h[r.cid]||u.push(r);u.length&&this._removeModels(u,e)}var b=!1,w=!m&&d&&p;if(a.length&&w?(b=this.length!==a.length||n.some(this.models,function(t,e){return t!==a[e]}),this.models.length=0,M(this.models,a,0),this.length=this.models.length):c.length&&(m&&(_=!0),M(this.models,c,null==s?this.length:s),this.length=this.models.length),_&&this.sort({silent:!0}),!e.silent){for(o=0;o<c.length;o++)null!=s&&(e.index=s+o),r=c[o],r.trigger("add",r,this,e);(_||b)&&this.trigger("sort",this,e),(c.length||u.length||l.length)&&(e.changes={added:c,removed:u,merged:l},this.trigger("update",this,e))}return i?t[0]:t}},reset:function(t,e){e=e?n.clone(e):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],e);return e.previousModels=this.models,this._reset(),t=this.add(t,n.extend({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,n.extend({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,n.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return r.apply(this.models,arguments)},get:function(t){if(null!=t)return this._byId[t]||this._byId[this.modelId(t.attributes||t)]||t.cid&&this._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){return t<0&&(t+=this.length),this.models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,!0)},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var i=e.length;return n.isFunction(e)&&(e=n.bind(e,this)),1===i||n.isString(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},pluck:function(t){return this.map(t+"")},fetch:function(t){t=n.extend({parse:!0},t);var e=t.success,i=this;return t.success=function(n){var s=t.reset?"reset":"set";i[s](n,t),e&&e.call(t.context,i,n,t),i.trigger("sync",i,n,t)},B(this,t),this.sync("read",this,t)},create:function(t,e){e=e?n.clone(e):{};var i=e.wait;if(t=this._prepareModel(t,e),!t)return!1;i||this.add(t,e);var s=this,r=e.success;return e.success=function(t,e,n){i&&s.add(t,n),r&&r.call(n.context,t,e,n)},t.save(null,e),t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t){return t[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?n.clone(e):{},e.collection=this;var i=new this.model(t,e);return i.validationError?(this.trigger("invalid",this,i.validationError,e),!1):i},_removeModels:function(t,e){for(var n=[],i=0;i<t.length;i++){var s=this.get(t[i]);if(s){var r=this.indexOf(s);this.models.splice(r,1),this.length--,delete this._byId[s.cid];var o=this.modelId(s.attributes);null!=o&&delete this._byId[o],e.silent||(e.index=r,s.trigger("remove",s,this,e)),n.push(s),this._removeReference(s,e)}}return n},_isModel:function(t){return t instanceof y},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes);null!=n&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes);null!=n&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){if(e){if(("add"===t||"remove"===t)&&n!==this)return;if("destroy"===t&&this.remove(e,i),"change"===t){var s=this.modelId(e.previousAttributes()),r=this.modelId(e.attributes);s!==r&&(null!=s&&delete this._byId[s],null!=r&&(this._byId[r]=e))}}this.trigger.apply(this,arguments)}});var k={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};a(w,k,"models");var C=e.View=function(t){this.cid=n.uniqueId("view"),n.extend(this,n.pick(t,A)),this._ensureElement(),this.initialize.apply(this,arguments)},T=/^(\S+)\s*(.*)$/,A=["model","collection","el","id","attributes","className","tagName","events"];n.extend(C.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=n.result(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var i=t[e];if(n.isFunction(i)||(i=this[i]),i){var s=e.match(T);this.delegate(s[1],s[2],n.bind(i,this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var t=n.extend({},n.result(this,"attributes"));this.id&&(t.id=n.result(this,"id")),this.className&&(t.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),e.sync=function(t,i,s){var r=E[t];n.defaults(s||(s={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var o={type:r,dataType:"json"};if(s.url||(o.url=n.result(i,"url")||F()),null!=s.data||!i||"create"!==t&&"update"!==t&&"patch"!==t||(o.contentType="application/json",o.data=JSON.stringify(s.attrs||i.toJSON(s))),s.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",s.emulateJSON&&(o.data._method=r);var a=s.beforeSend;s.beforeSend=function(t){if(t.setRequestHeader("X-HTTP-Method-Override",r),a)return a.apply(this,arguments)}}"GET"===o.type||s.emulateJSON||(o.processData=!1);var c=s.error;s.error=function(t,e,n){s.textStatus=e,s.errorThrown=n,c&&c.call(s.context,t,e,n)};var l=s.xhr=e.ajax(n.extend(o,s));return i.trigger("request",i,l,s),l};var E={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var D=e.Router=function(t){t||(t={}),t.routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},N=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,j=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(D.prototype,u,{initialize:function(){},route:function(t,i,s){n.isRegExp(t)||(t=this._routeToRegExp(t)),n.isFunction(i)&&(s=i,i=""),s||(s=this[i]);var r=this;return e.history.route(t,function(n){var o=r._extractParameters(t,n);r.execute(s,o,i)!==!1&&(r.trigger.apply(r,["route:"+i].concat(o)),r.trigger("route",i,o),e.history.trigger("route",r,i,o))}),this},execute:function(t,e,n){t&&t.apply(this,e)},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var t,e=n.keys(this.routes);null!=(t=e.pop());)this.route(t,this.routes[t])}},_routeToRegExp:function(t){return t=t.replace(I,"\\$&").replace(N,"(?:$1)?").replace(O,function(t,e){return e?t:"([^/?]+)"}).replace(j,"([^?]*?)"),new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var i=t.exec(e).slice(1);return n.map(i,function(t,e){return e===i.length-1?t||null:t?decodeURIComponent(t):null})}});var R=e.History=function(){this.handlers=[],this.checkUrl=n.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},L=/^[#\/]|\s+$/g,H=/^\/+|\/+$/g,P=/#.*$/;R.started=!1,n.extend(R.prototype,u,{interval:50,atRoot:function(){var t=this.location.pathname.replace(/[^\/]$/,"$&/");return t===this.root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment(this.location.pathname),e=t.slice(0,this.root.length-1)+"/";return e===this.root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=this.location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){return null==t&&(t=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),t.replace(L,"")},start:function(t){if(R.started)throw new Error("Backbone.history has already been started");if(R.started=!0,this.options=n.extend({root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(H,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var e=this.root.slice(0,-1)||"/";return this.location.replace(e+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,s=i.insertBefore(this.iframe,i.firstChild).contentWindow;s.document.open(),s.document.close(),s.location.hash="#"+this.fragment}var r=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};this._usePushState?t("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&t("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),R.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e!==this.fragment&&(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(t){return!!this.matchRoot()&&(t=this.fragment=this.getFragment(t),
n.some(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0}))},navigate:function(t,e){if(!R.started)return!1;e&&e!==!0||(e={trigger:!!e}),t=this.getFragment(t||"");var n=this.root;""!==t&&"?"!==t.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+t;if(t=this.decodeFragment(t.replace(P,"")),this.fragment!==t){if(this.fragment=t,this._usePushState)this.history[e.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,t,e.replace),this.iframe&&t!==this.getHash(this.iframe.contentWindow)){var s=this.iframe.contentWindow;e.replace||(s.document.open(),s.document.close()),this._updateHash(s.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,n){if(n){var i=t.href.replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash="#"+e}}),e.history=new R;var Y=function(t,e){var i,s=this;return i=t&&n.has(t,"constructor")?t.constructor:function(){return s.apply(this,arguments)},n.extend(i,s,e),i.prototype=n.create(s.prototype,t),i.prototype.constructor=i,i.__super__=s.prototype,i};y.extend=w.extend=D.extend=C.extend=R.extend=Y;var F=function(){throw new Error('A "url" property or function must be specified')},B=function(t,e){var n=e.error;e.error=function(i){n&&n.call(e.context,t,i,e),t.trigger("error",t,i,e)}};return e}),function(t,e){"object"==typeof exports&&"function"==typeof require?module.exports=e(require("backbone"),require("underscore")):"function"==typeof define&&define.amd?define("backbone.browserStorage",["backbone","underscore"],function(n,i){return e(n||t.Backbone,i||t._)}):e(Backbone,_)}(this,function(t,e){function n(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function i(){return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function s(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1}function r(t,e){for(var n in e)t[n]=e[n];return t}function o(t,n,i){var s;if("local"===i&&!window.localStorage)throw"Backbone.browserStorage: Environment does not support localStorage.";if("session"===i&&!window.sessionStorage)throw"Backbone.browserStorage: Environment does not support sessionStorage.";if(this.name=t,this.serializer=n||{serialize:function(t){return e.isObject(t)?JSON.stringify(t):t},deserialize:function(t){return t&&JSON.parse(t)}},"session"===i)this.store=window.sessionStorage;else{if("local"!==i)throw"Backbone.browserStorage: No storage type was specified";this.store=window.localStorage}s=this.store.getItem(this.name),this.records=s&&s.split(",")||[]}t.BrowserStorage={local:function(t,e){return o.bind(this,t,e,"local")()},session:function(t,e){return o.bind(this,t,e,"session")()}};var a={save:function(){this.store.setItem(this.name,this.records.join(","))},create:function(t){return t.id||(t.id=i(),t.set(t.idAttribute,t.id)),this.store.setItem(this._itemName(t.id),this.serializer.serialize(t)),this.records.push(t.id.toString()),this.save(),this.find(t)!==!1},update:function(t){this.store.setItem(this._itemName(t.id),this.serializer.serialize(t));var e=t.id.toString();return s(this.records,e)||(this.records.push(e),this.save()),this.find(t)!==!1},find:function(t){return this.serializer.deserialize(this.store.getItem(this._itemName(t.id)))},findAll:function(){for(var t,e,n=[],i=0;i<this.records.length;i++)t=this.records[i],e=this.serializer.deserialize(this.store.getItem(this._itemName(t))),null!==e&&n.push(e);return n},destroy:function(t){this.store.removeItem(this._itemName(t.id));for(var e=t.id.toString(),n=0;n<this.records.length;n++)this.records[n]===e&&this.records.splice(n,1);return this.save(),t},browserStorage:function(){return{session:sessionStorage,local:localStorage}},_clear:function(){var t,e=this.store;t=new RegExp("^"+this.name.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"-"),e.removeItem(this.name);for(var n in e)t.test(n)&&e.removeItem(n);this.records.length=0},_storageSize:function(){return this.store.length},_itemName:function(t){return this.name+"-"+t}};return r(t.BrowserStorage.session.prototype,a),r(t.BrowserStorage.local.prototype,a),t.BrowserStorage.sync=t.localSync=function(e,n,i){var s,r,o=n.browserStorage||n.collection.browserStorage,a=t.$?t.$.Deferred&&t.$.Deferred():t.Deferred&&t.Deferred();try{switch(e){case"read":s=void 0!==n.id?o.find(n):o.findAll();break;case"create":s=o.create(n);break;case"update":s=o.update(n);break;case"delete":s=o.destroy(n)}}catch(t){r=22===t.code&&0===o._storageSize()?"Private browsing is unsupported":t.message}return s?(i&&i.success&&("0.9.10"===t.VERSION?i.success(n,s,i):i.success(s)),a&&a.resolve(s)):(r=r?r:"Record Not Found",i&&i.error&&("0.9.10"===t.VERSION?i.error(n,r,i):i.error(r)),a&&a.reject(r)),i&&i.complete&&i.complete(s),a&&a.promise()},t.ajaxSync=t.sync,t.getSyncMethod=function(e){return e.browserStorage||e.collection&&e.collection.browserStorage?t.localSync:t.ajaxSync},t.sync=function(e,n,i){return t.getSyncMethod(n).apply(this,[e,n,i])},t.BrowserStorage}),function(t,e){"function"==typeof define&&define.amd?define("backbone.overview",["underscore","backbone"],e):e(_||t._,Backbone||t.Backbone)}(this,function(t,e){"use strict";var n=e.Overview=function(n){var i=this;this.views={},this.keys=t.partial(t.keys,this.views),this.getAll=t.partial(t.identity,this.views),this.get=function(t){return i.views[t]},this.xget=function(e){return t.filter(i.views,function(t,n){return n!==e})},this.add=function(t,e){return i.views[t]=e,e},this.remove=function(t){"undefined"==typeof t&&(new e.View).remove.apply(i);var n=i.views[t];if(n)return delete i.views[t],n.remove(),n},this.removeAll=function(){return t.each(t.keys(i.views),i.remove),i},e.View.apply(this,Array.prototype.slice.apply(arguments))},i=["all","any","chain","collect","contains","detect","difference","drop","each","every","filter","find","first","foldl","foldr","forEach","head","include","indexOf","initial","inject","invoke","isEmpty","last","lastIndexOf","map","max","min","reduce","reduceRight","reject","rest","sample","select","shuffle","size","some","sortBy","tail","take","toArray","without"];return t.each(i,function(e){n.prototype[e]=function(){var n=Array.prototype.slice.call(arguments);return n.unshift(this.views),t[e].apply(t,n)}}),t.extend(n.prototype,e.View.prototype),n.extend=e.View.extend,e.Overview}),function(t,e){define("converse-core",["jquery","underscore","polyfill","utils","moment_with_locales","strophe","pluggable","tpl!chats_panel","strophe.disco","backbone.browserStorage","backbone.overview"],e)}(this,function(t,e,n,i,s,r,o,a){var c=r.$build,l=r.$iq,u=r.$pres,h=r.SHA1.b64_sha1;r=r.Strophe,e.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var d={},f={templates:{chats_panel:a},emit:function(e,n){t(d).trigger(e,n)},once:function(e,n,i){i&&(n=n.bind(i)),t(d).one(e,n)},on:function(n,i,s){e.contains(["ready","initialized"],n)&&f.log('Warning: The "'+n+'" event has been deprecated and will be removed, please use "connected".'),s&&(i=i.bind(s)),t(d).bind(n,i)},off:function(e,n){t(d).unbind(e,n)}};o.enable(f,"converse","pluggable"),f.STATUS_WEIGHTS={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},f.ANONYMOUS="anonymous",f.CLOSED="closed",f.EXTERNAL="external",f.LOGIN="login",f.LOGOUT="logout",f.OPENED="opened",f.PREBIND="prebind";var p={0:"ERROR",1:"CONNECTING",2:"CONNFAIL",3:"AUTHENTICATING",4:"AUTHFAIL",5:"CONNECTED",6:"DISCONNECTED",7:"DISCONNECTING",8:"ATTACHED",9:"REDIRECT"};return f.log=function(t,e){var n;n="undefined"==typeof console||"undefined"==typeof console.log?{log:function(){},error:function(){}}:console,f.debug&&("error"===e?n.log("ERROR: "+t):n.log(t))},f.initialize=function(n,o){"use strict";n="undefined"!=typeof n?n:{};var a,d=new t.Deferred,f=this;"onpagehide"in window?a="pagehide":"onbeforeunload"in window?a="beforeunload":"onunload"in window&&(a="unload"),r.log=function(t,e){f.log(t+" "+e,t)},r.error=function(t){f.log(t,"error")},r.addNamespace("CARBONS","urn:xmpp:carbons:2"),r.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),r.addNamespace("CSI","urn:xmpp:csi:0"),r.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),r.addNamespace("XFORM","jabber:x:data"),r.addNamespace("NICK","http://jabber.org/protocol/nick"),r.addNamespace("HINTS","urn:xmpp:hints"),r.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},this.INACTIVE="inactive",this.ACTIVE="active",this.COMPOSING="composing",this.PAUSED="paused",this.GONE="gone",this.isConverseLocale=function(t){return"undefined"!=typeof locales[t]},this.isMomentLocale=function(t){return s.locale()!==s.locale(t)},s.locale||(s.locale=s.lang),s.locale(i.detectLocale(this.isMomentLocale)),this.i18n=n.i18n?n.i18n:locales[i.detectLocale(this.isConverseLocale)]||{};var _=i.__.bind(this),m=_("Click to hide these contacts");if(this.default_settings={allow_contact_requests:!0,animate:!0,authentication:"login",auto_away:0,auto_login:!1,auto_reconnect:!1,auto_subscribe:!1,auto_xa:0,bosh_service_url:void 0,connection_options:{},credentials_url:null,csi_waiting_time:0,debug:!1,default_state:"online",expose_rid_and_sid:!1,filter_by_resource:!1,forward_messages:!1,hide_offline_users:!1,include_offline_state:!1,jid:void 0,keepalive:!1,locked_domain:void 0,message_carbons:!1,password:void 0,prebind:!1,prebind_url:null,rid:void 0,roster_groups:!1,show_only_online_users:!1,sid:void 0,storage:"session",message_storage:"session",strict_plugin_dependencies:!1,synchronize_availability:!0,websocket_url:void 0,xhr_custom_status:!1,xhr_custom_status_url:""},e.extend(this,this.default_settings),e.extend(this,e.pick(n,Object.keys(this.default_settings))),this.prebind===!0&&(this.authentication=f.PREBIND),this.authentication===f.ANONYMOUS&&this.auto_login&&!this.jid)throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");t.fx.off=!this.animate,this.callback=o||function(){},this.send_initial_presence=!0,this.msg_counter=0,this.user_settings=n,this.wrappedChatBox=function(t){if(t){var e=f.chatboxviews.get(t.get("id"));return{close:e.close.bind(e),focus:e.focus.bind(e),get:t.get.bind(t),open:e.show.bind(e),set:t.set.bind(t)}}},this.generateResource=function(){return"/converse.js-"+Math.floor(139749825*Math.random()).toString()},this.sendCSI=function(t){f.features[r.NS.CSI],f.connection.send(c(t,{xmlns:r.NS.CSI})),f.inactive=t===f.INACTIVE},this.onUserActivity=function(){f.idle_seconds>0&&(f.idle_seconds=0),f.connection.authenticated&&(f.inactive&&f.sendCSI(f.ACTIVE),f.auto_changed_status===!0&&(f.auto_changed_status=!1,f.xmppstatus.setStatus(f.default_state)))},this.onEverySecond=function(){if(f.connection.authenticated){var t=f.xmppstatus.getStatus();f.idle_seconds++,f.csi_waiting_time>0&&f.idle_seconds>f.csi_waiting_time&&!f.inactive&&f.sendCSI(f.INACTIVE),f.auto_away>0&&f.idle_seconds>f.auto_away&&"away"!==t&&"xa"!==t?(f.auto_changed_status=!0,f.xmppstatus.setStatus("away")):f.auto_xa>0&&f.idle_seconds>f.auto_xa&&"xa"!==t&&(f.auto_changed_status=!0,f.xmppstatus.setStatus("xa"))}},this.registerIntervalHandler=function(){f.auto_away<1&&f.auto_xa<1&&f.csi_waiting_time<1||(f.idle_seconds=0,f.auto_changed_status=!1,t(window).on("click mousemove keypress focus"+a,f.onUserActivity),f.everySecondTrigger=window.setInterval(f.onEverySecond,1e3))},this.giveFeedback=function(e,n,i){t(".conn-feedback").each(function(i,s){var r=t(s);r.addClass("conn-feedback").text(e),n?r.addClass(n):r.removeClass("error")}),f.emit("feedback",{klass:n,message:i,subject:e})},this.rejectPresenceSubscription=function(t,e){var n=u({to:t,type:"unsubscribed"});e&&""!==e&&n.c("status").t(e),f.connection.send(n)},this.reconnect=e.debounce(function(t){f.log("The connection has dropped, attempting to reconnect."),f.giveFeedback(_("Reconnecting"),"warn",_("The connection has dropped, attempting to reconnect.")),f.connection.reconnecting=!0,f.connection.disconnect("re-connecting"),f.connection.reset(),f._tearDown(),"prebind"!==f.authentication?f.autoLogin():f.prebind_url&&f.startNewBOSHSession()},1e3),this.onDisconnected=function(t){if(f.disconnection_cause!==f.LOGOUT){if(f.disconnection_cause===r.Status.CONNFAIL&&f.auto_reconnect)return f.reconnect(t),f.log("RECONNECTING"),"reconnecting";if((f.disconnection_cause===r.Status.DISCONNECTING||f.disconnection_cause===r.Status.DISCONNECTED)&&f.auto_reconnect)return window.setTimeout(e.partial(f.reconnect,t),3e3),f.log("RECONNECTING IN 3 SECONDS"),"reconnecting"}return delete f.connection.reconnecting,f._tearDown(),f.chatboxviews.closeAllChatBoxes(),f.emit("disconnected"),f.log("DISCONNECTED"),"disconnected"},this.setDisconnectionCause=function(t){"undefined"==typeof f.disconnection_cause&&(f.disconnection_cause=t)},this.onConnectStatusChanged=function(t,e){f.log("Status changed to: "+p[t]),t===r.Status.CONNECTED||t===r.Status.ATTACHED?(f.send_initial_presence=!0,delete f.disconnection_cause,f.connection.reconnecting?(f.log(t===r.Status.CONNECTED?"Reconnected":"Reattached"),f.onReconnected()):(f.log(t===r.Status.CONNECTED?"Connected":"Attached"),f.connection.restored&&(f.send_initial_presence=!1),f.onConnected())):t===r.Status.DISCONNECTED?(f.setDisconnectionCause(t),f.onDisconnected(e),t===r.Status.DISCONNECTING&&e&&f.giveFeedback(_("Disconnected"),"warn",_("The connection to the chat server has dropped"))):t===r.Status.ERROR?f.giveFeedback(_("Connection error"),"error",_("An error occurred while connecting to the chat server.")):t===r.Status.CONNECTING?f.giveFeedback(_("Connecting")):t===r.Status.AUTHENTICATING?f.giveFeedback(_("Authenticating")):t===r.Status.AUTHFAIL?(f.giveFeedback(_("Authentication failed."),"error"),f.connection.disconnect(_("Authentication Failed")),f.disconnection_cause=r.Status.AUTHFAIL):t!==r.Status.CONNFAIL&&t!==r.Status.DISCONNECTING||f.setDisconnectionCause(t)},this.updateMsgCounter=function(){this.msg_counter>0?document.title.search(/^Messages \(\d+\) /)===-1?document.title="Messages ("+this.msg_counter+") "+document.title:document.title=document.title.replace(/^Messages \(\d+\) /,"Messages ("+this.msg_counter+") "):document.title.search(/^Messages \(\d+\) /)!==-1&&(document.title=document.title.replace(/^Messages \(\d+\) /,""))},this.incrementMsgCounter=function(){this.msg_counter+=1,this.updateMsgCounter()},this.clearMsgCounter=function(){this.msg_counter=0,this.updateMsgCounter()},this.initStatus=function(){var e=new t.Deferred;this.xmppstatus=new this.XMPPStatus;var n=h("converse.xmppstatus-"+f.bare_jid);return this.xmppstatus.id=n,this.xmppstatus.browserStorage=new Backbone.BrowserStorage[f.storage](n),this.xmppstatus.fetch({success:e.resolve,error:e.resolve}),f.emit("statusInitialized"),e.promise()},this.initSession=function(){this.session=new this.Session;var t=h("converse.bosh-session");this.session.id=t,this.session.browserStorage=new Backbone.BrowserStorage[f.storage](t),this.session.fetch()},this.clearSession=function(){e.isUndefined(this.roster)||this.roster.browserStorage._clear(),this.session.browserStorage._clear()},this.logOut=function(){f.disconnection_cause=f.LOGOUT,"undefined"!=typeof f.connection&&(f.connection.disconnect(),f.connection.reset()),f.clearSession(),f._tearDown(),f.chatboxviews.closeAllChatBoxes(),f.emit("logout")},this.saveWindowState=function(t,e){var n,i="visible",s="hidden",r={focus:i,focusin:i,pageshow:i,blur:s,focusout:s,pagehide:s};t=t||document.createEvent("Events"),n=t.type in r?r[t.type]:document[e]?"hidden":"visible","visible"===n&&f.clearMsgCounter(),f.windowState=n},this.registerGlobalEventHandlers=function(){var t="hidden";t in document?document.addEventListener("visibilitychange",e.partial(f.saveWindowState,e,t)):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",e.partial(f.saveWindowState,e,t)):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",e.partial(f.saveWindowState,e,t)):(t="msHidden")in document?document.addEventListener("msvisibilitychange",e.partial(f.saveWindowState,e,t)):"onfocusin"in document?document.onfocusin=document.onfocusout=e.partial(f.saveWindowState,e,t):window.onpageshow=window.onpagehide=window.onfocus=window.onblur=e.partial(f.saveWindowState,e,t),void 0!==document[t]&&e.partial(f.saveWindowState,e,t)({type:document[t]?"blur":"focus"})},this.enableCarbons=function(){if(this.message_carbons&&!this.session.get("carbons_enabled")){var e=new r.Builder("iq",{from:this.connection.jid,id:"enablecarbons",type:"set"}).c("enable",{xmlns:r.NS.CARBONS});this.connection.addHandler(function(e){t(e).find("error").length>0?f.log("ERROR: An error occured while trying to enable message carbons."):(this.session.save({carbons_enabled:!0}),f.log("Message carbons have been enabled."))}.bind(this),null,"iq",null,"enablecarbons"),this.connection.send(e)}},this.initRoster=function(){f.roster=new f.RosterContacts,f.roster.browserStorage=new Backbone.BrowserStorage.session(h("converse.contacts-"+f.bare_jid)),f.rostergroups=new f.RosterGroups,f.rostergroups.browserStorage=new Backbone.BrowserStorage.session(h("converse.roster.groups"+f.bare_jid)),f.emit("rosterInitialized")},this.populateRoster=function(){f.rostergroups.fetchRosterGroups().then(function(){f.emit("rosterGroupsFetched"),f.roster.fetchRosterContacts().then(function(){f.emit("rosterContactsFetched"),f.sendInitialPresence()})})},this.unregisterPresenceHandler=function(){"undefined"!=typeof f.presence_ref&&(f.connection.deleteHandler(f.presence_ref),delete f.presence_ref)},this.registerPresenceHandler=function(){f.unregisterPresenceHandler(),f.presence_ref=f.connection.addHandler(function(t){return f.roster.presenceHandler(t),!0},null,"presence",null)},this.sendInitialPresence=function(){f.send_initial_presence&&f.xmppstatus.sendPresence()},this.onStatusInitialized=function(){f.registerIntervalHandler(),f.initRoster(),f.populateRoster(),f.chatboxes.onConnected(),f.registerPresenceHandler(),f.giveFeedback(_("Contacts")),"function"==typeof f.callback&&f.callback(),d.resolve(),f.emit("initialized")},this.setUserJid=function(){f.jid=f.connection.jid,f.bare_jid=r.getBareJidFromJid(f.connection.jid),f.resource=r.getResourceFromJid(f.connection.jid),f.domain=r.getDomainFromJid(f.connection.jid)},this.onConnected=function(t){f.connection.flush(),f.chatboxviews.closeAllChatBoxes(),f.setUserJid(),f.features=new f.Features,f.enableCarbons(),f.initStatus().done(f.onStatusInitialized),f.emit("connected"),f.emit("ready")},this.onReconnected=function(){f.setUserJid(),f.registerPresenceHandler(),f.chatboxes.registerMessageHandler(),f.emit("rosterReadyAfterReconnection"),f.populateRoster(),f.chatboxes.onConnected(),f.xmppstatus.sendPresence(),f.emit("reconnected"),f.giveFeedback(_("Contacts"))},this.RosterContact=Backbone.Model.extend({initialize:function(t,n){var i=t.jid,s=r.getBareJidFromJid(i),o=r.getResourceFromJid(i);t.jid=s,this.set(e.extend({id:s,jid:s,fullname:s,chat_status:"offline",user_id:r.getNodeFromJid(i),resources:o?[o]:[],groups:[],image_type:"image/png",image:"iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAIAAABt+uBvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gwHCy455JBsggAABkJJREFUeNrtnM1PE1sUwHvvTD8otWLHST/Gimi1CEgr6M6FEWuIBo2pujDVsNDEP8GN/4MbN7oxrlipG2OCgZgYlxAbkRYw1KqkIDRCSkM7nXvvW8x7vjyNeQ9m7p1p3z1LQk/v/Dhz7vkEXL161cHl9wI5Ag6IA+KAOCAOiAPigDggLhwQB2S+iNZ+PcYY/SWEEP2HAAAIoSAIoihCCP+ngDDGtVotGAz29/cfOXJEUZSOjg6n06lp2sbGRqlUWlhYyGazS0tLbrdbEASrzgksyeYJId3d3el0uqenRxRFAAAA4KdfIIRgjD9+/Pj8+fOpqSndslofEIQwHA6Pjo4mEon//qmFhYXHjx8vLi4ihBgDEnp7e9l8E0Jo165dQ0NDd+/eDYVC2/qsJElDQ0OEkKWlpa2tLZamxAhQo9EIBoOjo6MXL17csZLe3l5FUT59+lQul5l5JRaAVFWNRqN37tw5ceKEQVWRSOTw4cOFQuHbt2+iKLYCIISQLMu3b99OJpOmKAwEAgcPHszn8+vr6wzsiG6UQQhxuVyXLl0aGBgwUW0sFstkMl6v90fo1KyAMMYDAwPnzp0zXfPg4GAqlWo0Gk0MiBAiy/L58+edTqf5Aa4onj59OhaLYYybFRCEMBaL0fNxBw4cSCQStN0QRUBut3t4eJjq6U+dOiVJElVPRBFQIBDo6+ujCqirqyscDlONGykC2lYyYSR6pBoQQapHZwAoHo/TuARYAOrs7GQASFEUqn6aIiBJkhgA6ujooFpUo6iaTa7koFwnaoWadLNe81tbWwzoaJrWrICWl5cZAFpbW6OabVAEtLi4yABQsVjUNK0pAWWzWQaAcrlcswKanZ1VVZUqHYRQEwOq1Wpv3ryhCmh6erpcLjdrNl+v1ycnJ+l5UELI27dvv3//3qxxEADgy5cvExMT9Mznw4cPtFtAdAPFarU6Pj5eKpVM17yxsfHy5cvV1VXazXu62gVBKBQKT58+rdVqJqrFGL948eLdu3dU8/g/H4FBUaJYLAqC0NPTY9brMD4+PjY25mDSracOCABACJmZmXE6nUePHjWu8NWrV48ePSKEsGlAs7Agfd5nenq6Wq0mk0kjDzY2NvbkyRMIIbP2PLvhBUEQ8vl8NpuNx+M+n29bzhVjvLKycv/+/YmJCcazQuwA6YzW1tYmJyf1SY+2trZ/rRk1Go1SqfT69esHDx4UCgVmNaa/zZ/9ABUhRFXVYDB48uTJeDweiUQkSfL7/T9MA2NcqVTK5fLy8vL8/PzU1FSxWHS5XJaM4wGr9sUwxqqqer3eUCgkSZJuUBBCfTRvc3OzXC6vrKxUKhWn02nhCJ5lM4oQQo/HgxD6+vXr58+fHf8sDOp+HQDg8XgclorFU676dKLlo6yWRdItIBwQB8QBcUCtfosRQjRNQwhhjPUC4w46WXryBSHU1zgEQWBz99EFhDGu1+t+v//48ePxeFxRlD179ng8nh0Efgiher2+vr6ur3HMzMysrq7uTJVdACGEurq6Ll++nEgkPB7Pj9jPoDHqOxyqqubz+WfPnuVyuV9XPeyeagAAAoHArVu3BgcHab8CuVzu4cOHpVKJUnfA5GweY+xyuc6cOXPv3r1IJMLAR8iyPDw8XK/Xi8Wiqqqmm5KZgBBC7e3tN27cuHbtGuPVpf7+/lAoNDs7W61WzfVKpgHSSzw3b95MpVKW3MfRaDQSiczNzVUqFRMZmQOIEOL1eq9fv3727FlL1t50URRFluX5+flqtWpWEGAOIFEUU6nUlStXLKSjy759+xwOx9zcnKZpphzGHMzhcDiTydgk9r1w4YIp7RPTAAmCkMlk2FeLf/tIEKbTab/fbwtAhJBoNGrutpNx6e7uPnTokC1eMU3T0um0DZPMkZER6wERQnw+n/FFSxpy7Nix3bt3WwwIIcRgIWnHkkwmjecfRgGx7DtuV/r6+iwGhDHev3+/bQF1dnYaH6E2CkiWZdsC2rt3r8WAHA5HW1ubbQGZcjajgOwTH/4qNko1Wlg4IA6IA+KAOKBWBUQIsfNojyliKIoRRfH9+/dut9umf3wzpoUNNQ4BAJubmwz+ic+OxefzWWlBhJD29nbug7iT5sIBcUAcEAfEAXFAHBAHxOVn+QMrmWpuPZx12gAAAABJRU5ErkJggg==",status:""},t)),this.on("destroy",function(){this.removeFromRoster()}.bind(this)),this.on("change:chat_status",function(t){f.emit("contactStatusChanged",t.attributes)})},subscribe:function(t){this.save("ask","subscribe");var e=u({to:this.get("jid"),type:"subscribe"});t&&""!==t&&e.c("status").t(t).up();var n=f.xmppstatus.get("fullname");return n&&""!==n&&e.c("nick",{xmlns:r.NS.NICK}).t(n).up(),this},ackSubscribe:function(){f.connection.send(u({type:"subscribe",to:this.get("jid")}))},ackUnsubscribe:function(t){f.connection.send(u({type:"unsubscribe",to:this.get("jid")})),this.destroy()},unauthorize:function(t){return f.rejectPresenceSubscription(this.get("jid"),t),this},authorize:function(t){var e=u({to:this.get("jid"),type:"subscribed"});return t&&""!==t&&e.c("status").t(t),f.connection.send(e),this},removeResource:function(t){var n,i=this.get("resources");return t?(n=e.indexOf(i,t),n!==-1&&(i.splice(n,1),this.save({resources:i})),i.length):(this.save({resources:[]}),0)},removeFromRoster:function(t){var e=l({type:"set"}).c("query",{xmlns:r.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return f.connection.sendIQ(e,t,t),this}}),this.RosterContacts=Backbone.Collection.extend({model:f.RosterContact,comparator:function(t,e){var n,i,s=t.get("chat_status")||"offline",r=e.get("chat_status")||"offline";return f.STATUS_WEIGHTS[s]===f.STATUS_WEIGHTS[r]?(n=t.get("fullname").toLowerCase(),i=e.get("fullname").toLowerCase(),n<i?-1:n>i?1:0):f.STATUS_WEIGHTS[s]<f.STATUS_WEIGHTS[r]?-1:1},fetchRosterContacts:function(){var e=new t.Deferred;return this.fetch({add:!0,success:function(t){0===t.length?(f.send_initial_presence=!0,f.roster.fetchFromServer(e.resolve)):(f.emit("cachedRoster",t),e.resolve())}}),e.promise()},subscribeToSuggestedItems:function(e){return t(e).find("item").each(function(t,e){"add"===this.getAttribute("action")&&f.roster.addAndSubscribe(this.getAttribute("jid"),null,f.xmppstatus.get("fullname"))}),!0},isSelf:function(t){return r.getBareJidFromJid(t)===r.getBareJidFromJid(f.connection.jid)},addAndSubscribe:function(t,e,n,i,s){this.addContact(t,e,n,s).done(function(t){t instanceof f.RosterContact&&t.subscribe(i)})},sendContactAddIQ:function(t,n,i,s,o){n=e.isEmpty(n)?t:n;var a=l({type:"set"}).c("query",{xmlns:r.NS.ROSTER}).c("item",{jid:t,name:n});e.map(i,function(t){a.c("group").t(t).up()}),f.connection.sendIQ(a,s,o)},addContact:function(n,i,s,r){var o=new t.Deferred;return s=s||[],i=e.isEmpty(i)?n:i,this.sendContactAddIQ(n,i,s,function(t){var a=this.create(e.extend({ask:void 0,fullname:i,groups:s,jid:n,requesting:!1,subscription:"none"},r),{sort:!1});o.resolve(a)}.bind(this),function(t){alert(_("Sorry, there was an error while trying to add "+i+" as a contact.")),f.log(t),o.resolve(t)}),o.promise()},addResource:function(t,n){var i,s=this.get(t);s&&(i=s.get("resources"),i?e.indexOf(i,n)===-1&&(i.push(n),s.set({resources:i})):s.set({resources:[n]}))},subscribeBack:function(t){var e=this.get(t);e instanceof f.RosterContact?e.authorize().subscribe():this.addContact(t,"",[],{subscription:"from"}).done(function(t){t instanceof f.RosterContact&&t.authorize().subscribe()})},getNumOnlineContacts:function(){var t,n=0,i=["offline","unavailable"],s=this.models,r=s.length;for(f.show_only_online_users&&(i=e.union(i,["dnd","xa","away"])),t=0;t<r;t++)e.indexOf(i,s[t].get("chat_status"))===-1&&n++;return n},onRosterPush:function(e){var n=e.getAttribute("id"),i=e.getAttribute("from");return i&&""!==i&&r.getBareJidFromJid(i)!==f.bare_jid?(f.connection.send(l({type:"error",id:n,from:f.connection.jid}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:r.NS.ROSTER})),!0):(f.connection.send(l({type:"result",id:n,from:f.connection.jid})),t(e).children("query").find("item").each(function(t,e){this.updateContact(e)}.bind(this)),f.emit("rosterPush",e),!0)},fetchFromServer:function(t){var e=l({type:"get",id:f.connection.getUniqueId("roster")}).c("query",{xmlns:r.NS.ROSTER});return f.connection.sendIQ(e,function(){this.onReceivedFromServer.apply(this,arguments),t.apply(this,arguments)}.bind(this))},onReceivedFromServer:function(e){t(e).children("query").find("item").each(function(t,e){this.updateContact(e)}.bind(this)),f.emit("roster",e)},updateContact:function(e){var n=e.getAttribute("jid");if(!this.isSelf(n)){var i=[],s=this.get(n),o=e.getAttribute("ask"),a=e.getAttribute("subscription");if(t.map(e.getElementsByTagName("group"),function(t){i.push(r.getText(t))}),s){if("remove"===a)return s.destroy();s.save({subscription:a,ask:o,requesting:null,groups:i})}else{if("none"===a&&null===o||"remove"===a)return;this.create({ask:o,fullname:e.getAttribute("name")||n,groups:i,jid:n,subscription:a},{sort:!1})}}},createRequestingContact:function(e){var n=r.getBareJidFromJid(e.getAttribute("from")),i=t(e).children("nick[xmlns="+r.NS.NICK+"]").text(),s={jid:n,subscription:"none",ask:null,requesting:!0,fullname:i||n};this.create(s),f.emit("contactRequest",s)},handleIncomingSubscription:function(t){var e=t.getAttribute("from"),n=r.getBareJidFromJid(e),i=this.get(n);f.allow_contact_requests||f.rejectPresenceSubscription(e,_("This client does not allow presence subscriptions")),f.auto_subscribe?i&&"to"===i.get("subscription")?i.authorize():this.subscribeBack(n):i?"none"!==i.get("subscription")?i.authorize():"subscribe"===i.get("ask")&&i.authorize():i||this.createRequestingContact(t)},presenceHandler:function(e){var n=t(e),i=e.getAttribute("type");if("error"===i)return!0;var s=e.getAttribute("from"),o=r.getBareJidFromJid(s),a=r.getResourceFromJid(s),c=n.find("show").text()||"online",l=n.find("status"),u=this.get(o);if(this.isSelf(o))return void(f.connection.jid===s||"unavailable"===i||f.synchronize_availability!==!0&&f.synchronize_availability!==a||(f.xmppstatus.save({status:c}),l.length&&f.xmppstatus.save({status_message:l.text()})));if(0!==(n.find("x").attr("xmlns")||"").indexOf(r.NS.MUC))if(u&&l.text()!==u.get("status")&&u.save({status:l.text()}),"subscribed"===i&&u)u.ackSubscribe();else if("unsubscribed"===i&&u)u.ackUnsubscribe();else{if("unsubscribe"===i)return;"subscribe"===i?this.handleIncomingSubscription(e):"unavailable"===i&&u?0===u.removeResource(a)&&u.save({chat_status:"offline"}):u&&(this.addResource(o,a),u.save({chat_status:c}))}}}),this.RosterGroup=Backbone.Model.extend({initialize:function(t,n){this.set(e.extend({description:m,state:f.OPENED},t)),this.contacts=new f.RosterContacts}}),this.RosterGroups=Backbone.Collection.extend({model:f.RosterGroup,fetchRosterGroups:function(){var e=new t.Deferred;return this.fetch({silent:!0,success:e.resolve}),e.promise()}}),this.Message=Backbone.Model.extend({defaults:function(){return{msgid:f.connection.getUniqueId()}}}),this.Messages=Backbone.Collection.extend({model:f.Message,comparator:"time"}),this.ChatBox=Backbone.Model.extend({initialize:function(){this.messages=new f.Messages,this.messages.browserStorage=new Backbone.BrowserStorage[f.message_storage](h("converse.messages"+this.get("jid")+f.bare_jid)),this.save({box_id:h(this.get("jid")),chat_state:void 0,num_unread:this.get("num_unread")||0,time_opened:this.get("time_opened")||s().valueOf(),url:"",user_id:r.getNodeFromJid(this.get("jid"))})},getMessageAttributes:function(t,n,i){n=n||t.find("delay");var o,a,c,l,u,h=t.attr("type");o="error"===h?t.find("error").children("text").text():t.children("body").text();var d=n.length>0,p=this.get("fullname"),_="groupchat"===h,m=t.find(f.COMPOSING).length&&f.COMPOSING||t.find(f.PAUSED).length&&f.PAUSED||t.find(f.INACTIVE).length&&f.INACTIVE||t.find(f.ACTIVE).length&&f.ACTIVE||t.find(f.GONE).length&&f.GONE;return u=_?r.unescapeNode(r.getResourceFromJid(t.attr("from"))):r.getBareJidFromJid(t.attr("from")),e.isEmpty(p)&&(p=u),d?(a=n.attr("stamp"),c=a):c=s().format(),l=_&&u===this.get("nick")||!_&&u===f.bare_jid?"me":"them",{type:h,chat_state:m,delayed:d,fullname:p,message:o||void 0,msgid:t.attr("id"),sender:l,time:c}},createMessage:function(t,e,n){return this.messages.create(this.getMessageAttributes.apply(this,arguments))}}),this.ChatBoxes=Backbone.Collection.extend({model:f.ChatBox,comparator:"time_opened",registerMessageHandler:function(){f.connection.addHandler(this.onMessage.bind(this),null,"message","chat"),f.connection.addHandler(this.onErrorMessage.bind(this),null,"message","error")},chatBoxMayBeShown:function(t){return!0},onChatBoxesFetched:function(t){var e=this;t.each(function(t){e.chatBoxMayBeShown(t)&&t.trigger("show")}),f.emit("chatBoxesFetched")},onConnected:function(){this.browserStorage=new Backbone.BrowserStorage[f.storage](h("converse.chatboxes-"+f.bare_jid)),this.registerMessageHandler(),this.fetch({add:!0,success:this.onChatBoxesFetched.bind(this)})},onErrorMessage:function(e){var n=t(e),i=r.getBareJidFromJid(n.attr("from"));if(i===f.bare_jid)return!0;var s=this.getChatBox(i);return!s||(s.createMessage(n,null,e),!0)},onMessage:function(e){var n,s,o,a,c,l,u,h,d,p=t(e),_=p.attr("from"),m=p.attr("to"),g=r.getResourceFromJid(m);return f.filter_by_resource&&g&&g!==f.resource?(f.log("onMessage: Ignoring incoming message intended for a different resource: "+m,"info"),!0):i.isHeadlineMessage(e)?(f.log("onMessage: Ignoring incoming headline message sent with type 'chat' from JID: "+_,"info"),!0):(s=p.find("forwarded"),s.length&&(p=s.children("message"),o=s.children("delay"),_=p.attr("from"),m=p.attr("to")),a=r.getBareJidFromJid(_),c=r.getResourceFromJid(_),l=a===f.bare_jid,u=p.attr("id"),l?(n=r.getBareJidFromJid(m),d=r.getResourceFromJid(m)):(n=a,d=c),f.emit("message",e),!(h=this.getChatBox(n,p.find("body").length>0))||(!(!u||!h.messages.findWhere({msgid:u}))||(h.createMessage(p,o,e),!0)))},getChatBox:function(t,n,i){t=t.toLowerCase();var s=r.getBareJidFromJid(t),o=this.get(s);if(!o&&n){var a=f.roster.get(s);if(void 0===a)return void f.log("Could not get roster item for JID "+s,"error");o=this.create(e.extend({id:s,jid:s,fullname:e.isEmpty(a.get("fullname"))?t:a.get("fullname"),image_type:a.get("image_type"),image:a.get("image"),url:a.get("url")},i||{}))}return o}}),this.ChatBoxViews=Backbone.Overview.extend({initialize:function(){this.model.on("add",this.onChatBoxAdded,this),this.model.on("destroy",this.removeChat,this)},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var n=t("#conversejs");n.length||(n=t('<div id="conversejs">'),t("body").append(n)),n.html(f.templates.chats_panel()),this.setElement(n,!1)}},onChatBoxAdded:function(t){return this.get(t.get("id"))},removeChat:function(t){this.remove(t.get("id"))},closeAllChatBoxes:function(){return this.each(function(t){t.close()}),this},chatBoxMayBeShown:function(t){return this.model.chatBoxMayBeShown(t)},getChatBox:function(t,e){var n=this.model.get(t.jid);
return!n&&e&&(n=this.model.create(t,{error:function(t,e){f.log(e.responseText)}})),n},showChat:function(t){var e=this.getChatBox(t,!0);return this.chatBoxMayBeShown(e)&&e.trigger("show",!0),e}}),this.XMPPStatus=Backbone.Model.extend({initialize:function(){this.set({status:this.getStatus()}),this.on("change",function(t){e.has(t.changed,"status")&&f.emit("statusChanged",this.get("status")),e.has(t.changed,"status_message")&&f.emit("statusMessageChanged",this.get("status_message"))}.bind(this))},constructPresence:function(t,e){var n;return t="string"==typeof t?t:this.get("status")||f.default_state,e="string"==typeof e?e:void 0,n="unavailable"===t||"probe"===t||"error"===t||"unsubscribe"===t||"unsubscribed"===t||"subscribe"===t||"subscribed"===t?u({type:t}):"offline"===t?u({type:"unavailable"}):"online"===t?u():u().c("show").t(t).up(),e&&n.c("status").t(e),n},sendPresence:function(t,e){f.connection.send(this.constructPresence(t,e))},setStatus:function(t){this.sendPresence(t),this.save({status:t})},getStatus:function(){return this.get("status")||f.default_state},setStatusMessage:function(e){this.sendPresence(this.getStatus(),e);var n=this.get("status_message");this.save({status_message:e}),this.xhr_custom_status&&t.ajax({url:this.xhr_custom_status_url,type:"POST",data:{msg:e}}),n===e&&this.trigger("update-status-ui",this)}}),this.Session=Backbone.Model,this.Feature=Backbone.Model,this.Features=Backbone.Collection.extend({model:f.Feature,initialize:function(){this.addClientIdentities().addClientFeatures(),this.browserStorage=new Backbone.BrowserStorage[f.storage](h("converse.features"+f.bare_jid)),this.on("add",this.onFeatureAdded,this),0===this.browserStorage.records.length?(f.connection.disco.info(f.domain,null,this.onInfo.bind(this)),f.connection.disco.items(f.domain,null,this.onItems.bind(this))):this.fetch({add:!0})},onFeatureAdded:function(t){f.emit("serviceDiscovered",t)},addClientIdentities:function(){return f.connection.disco.addIdentity("client","web","Converse.js"),this},addClientFeatures:function(){return f.connection.disco.addFeature(r.NS.BOSH),f.connection.disco.addFeature(r.NS.CHATSTATES),f.connection.disco.addFeature(r.NS.DISCO_INFO),f.connection.disco.addFeature(r.NS.ROSTERX),f.message_carbons&&f.connection.disco.addFeature(r.NS.CARBONS),this},onItems:function(e){t(e).find("query item").each(function(e,n){f.connection.disco.info(t(n).attr("jid"),null,this.onInfo.bind(this))}.bind(this))},onInfo:function(e){var n=t(e);0===n.find("identity[category=server][type=im]").length&&0===n.find("identity[category=conference][type=text]").length||n.find("feature").each(function(e,i){var s=t(i).attr("var");this[s]=!0,this.create({var:s,from:n.attr("from")})}.bind(this))}}),this.setUpXMLLogging=function(){r.log=function(t,e){f.log(e,t)},this.debug&&(this.connection.xmlInput=function(t){f.log(t.outerHTML)},this.connection.xmlOutput=function(t){f.log(t.outerHTML)})},this.fetchLoginCredentials=function(){var e=new t.Deferred;return t.ajax({url:f.credentials_url,type:"GET",dataType:"json",success:function(t){e.resolve({jid:t.jid,password:t.password})},error:function(t){delete f.connection,f.emit("noResumeableSession"),e.reject(t)}}),e.promise()},this.startNewBOSHSession=function(){t.ajax({url:this.prebind_url,type:"GET",dataType:"json",success:function(t){this.connection.attach(t.jid,t.sid,t.rid,this.onConnectStatusChanged)}.bind(this),error:function(t){delete this.connection,this.emit("noResumeableSession")}.bind(this)})},this.attemptPreboundSession=function(t){if(this.jid&&this.sid&&this.rid)return this.connection.attach(this.jid,this.sid,this.rid,this.onConnectStatusChanged);if(!this.keepalive)throw new Error("attemptPreboundSession: If you use prebind and not keepalive, then you MUST supply JID, RID and SID values");if(!this.jid)throw new Error("attemptPreboundSession: when using 'keepalive' with 'prebind, you must supply the JID of the current user.");try{return this.connection.restore(this.jid,this.onConnectStatusChanged)}catch(t){this.log("Could not restore session for jid: "+this.jid+" Error message: "+t.message),this.clearSession()}this.prebind_url?this.startNewBOSHSession():(delete this.connection,this.emit("noResumeableSession"))},this.autoLogin=function(t){if(t&&(this.jid=t.jid,this.password=t.password),this.authentication===f.ANONYMOUS){if(!this.jid)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling converse.user.login.");this.connection.connect(this.jid.toLowerCase(),null,this.onConnectStatusChanged)}else if(this.authentication===f.LOGIN){var e=f.connection.pass||this.password;if(!e){if(this.auto_login&&!this.password)throw new Error("initConnection: If you use auto_login and authentication='login' then you also need to provide a password.");return f.disconnection_cause=r.Status.AUTHFAIL,f.onDisconnected(),void f.giveFeedback("")}var n=r.getResourceFromJid(this.jid);n?this.jid=r.getBareJidFromJid(this.jid).toLowerCase()+"/"+n:this.jid=this.jid.toLowerCase()+f.generateResource(),this.connection.connect(this.jid,e,this.onConnectStatusChanged)}},this.attemptNonPreboundSession=function(){if(this.keepalive)try{return this.connection.restore(this.jid,this.onConnectStatusChanged)}catch(t){this.log("Could not restore session. Error message: "+t.message),this.clearSession()}if(this.auto_login)if(this.credentials_url)this.fetchLoginCredentials().done(this.autoLogin.bind(this));else{if(!this.jid)throw new Error("initConnection: If you use auto_login, you also needto give either a jid value (and if applicable a password) or you need to pass in a URL from where the username and password can be fetched (via credentials_url).");this.autoLogin()}},this.logIn=function(t){t||this.authentication===f.ANONYMOUS?this.autoLogin(t):this.authentication===f.PREBIND?this.attemptPreboundSession():this.attemptNonPreboundSession()},this.initConnection=function(){if(!this.connection){if(!this.bosh_service_url&&!this.websocket_url)throw new Error("initConnection: you must supply a value for either the bosh_service_url or websocket_url or both.");if(("WebSocket"in window||"MozWebSocket"in window)&&this.websocket_url)this.connection=new r.Connection(this.websocket_url,this.connection_options);else{if(!this.bosh_service_url)throw new Error("initConnection: this browser does not support websockets and bosh_service_url wasn't specified.");this.connection=new r.Connection(this.bosh_service_url,e.extend(this.connection_options,{keepalive:this.keepalive}))}}},this._tearDown=function(){return this.unregisterPresenceHandler(),this.roster&&this.roster.off().reset(),this.chatboxes.remove(),this.features&&this.features.reset(),t(window).off("click mousemove keypress focus"+a,f.onUserActivity),window.clearInterval(f.everySecondTrigger),this},this._initialize=function(){return this.chatboxes=new this.ChatBoxes,this.chatboxviews=new this.ChatBoxViews({model:this.chatboxes}),this.initSession(),this.initConnection(),this.setUpXMLLogging(),this.logIn(),this},n.connection&&(this.connection=n.connection);var g=function(t){i.merge(f.default_settings,t),i.merge(f,t),i.applyUserSettings(f,t,f.user_settings)};return f.pluggable.initialized_plugins=[],f.pluggable.initializePlugins({updateSettings:g,converse:f}),f.emit("pluginsInitialized"),f._initialize(),f.registerGlobalEventHandlers(),e.isUndefined(f.connection)||"jasmine tests"!==f.connection.service?d.promise():f},f}),function(t,e){define("converse-api",["jquery","underscore","moment_with_locales","strophe","utils","converse-core"],e)}(this,function(t,e,n,i,s,r){var o=i.Strophe;return{initialize:function(t,e){return r.initialize(t,e)},log:r.log,connection:{connected:function(){return r.connection&&r.connection.connected||!1},disconnect:function(){r.connection.disconnect()}},user:{jid:function(){return r.connection.jid},login:function(t){r.initConnection(),r.logIn(t)},logout:function(){r.logOut()},status:{get:function(){return r.xmppstatus.get("status")},set:function(t,n){var i={status:t};if(!e.contains(e.keys(r.STATUS_WEIGHTS),t))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof n&&(i.status_message=n),r.xmppstatus.sendPresence(t),r.xmppstatus.save(i)},message:{get:function(){return r.xmppstatus.get("status_message")},set:function(t){r.xmppstatus.save({status_message:t})}}}},settings:{get:function(t){if(e.contains(Object.keys(r.default_settings),t))return r[t]},set:function(t,n){var i={};"object"==typeof t?e.extend(r,e.pick(t,Object.keys(r.default_settings))):"string"==typeof t&&(i[t]=n,e.extend(r,e.pick(i,Object.keys(r.default_settings))))}},contacts:{get:function(t){var n=function(t){var e=r.roster.get(o.getBareJidFromJid(t));return e?e.attributes:null};if("undefined"==typeof t)t=r.roster.pluck("jid");else if("string"==typeof t)return n(t);return e.map(t,n)},add:function(t,n){if("string"!=typeof t||t.indexOf("@")<0)throw new TypeError("contacts.add: invalid jid");r.roster.addAndSubscribe(t,e.isEmpty(n)?t:n)}},chats:{open:function(t){var n;return"undefined"==typeof t?(r.log("chats.open: You need to provide at least one JID","error"),null):"string"==typeof t?n=r.wrappedChatBox(r.chatboxes.getChatBox(t,!0)):e.map(t,function(t){return n=r.wrappedChatBox(r.chatboxes.getChatBox(t,!0))})},get:function(t){if("undefined"==typeof t){var n=[];return r.chatboxes.each(function(t){"chatroom"!==t.get("type")&&n.push(r.wrappedChatBox(t))}),n}return"string"==typeof t?r.wrappedChatBox(r.chatboxes.getChatBox(t)):e.map(t,e.partial(e.compose(r.wrappedChatBox.bind(r),r.chatboxes.getChatBox.bind(r.chatboxes)),e,!0))}},tokens:{get:function(t){return r.expose_rid_and_sid&&"undefined"!=typeof r.connection?"rid"===t.toLowerCase()?r.connection.rid||r.connection._proto.rid:"sid"===t.toLowerCase()?r.connection.sid||r.connection._proto.sid:void 0:null}},listen:{once:function(t,e,n){r.once(t,e,n)},on:function(t,e,n){r.on(t,e,n)},not:function(t,e){r.off(t,e)},stanza:function(t,e,n){"function"==typeof e?(n=e,e={}):e=e||{},r.connection.addHandler(n,e.ns,t,e.type,e.id,e.from,e)}},send:function(t){r.connection.send(t)},plugins:{add:function(t,e){e.__name__=t,r.pluggable.plugins[t]=e},remove:function(t){delete r.plugins[t]},override:function(t,e){r._overrideAttribute(t,e)},extend:function(t,e){r._extendObject(t,e)}},env:{$build:i.$build,$iq:i.$iq,$msg:i.$msg,$pres:i.$pres,Strophe:i.Strophe,b64_sha1:i.SHA1.b64_sha1,_:e,jQuery:t,moment:n,utils:s}}}),function(t,e){function n(t){return h.PF.compile(t||"nplurals=2; plural=(n != 1);")}function i(t,e){this._key=t,this._i18n=e}var s=Array.prototype,r=Object.prototype,o=s.slice,a=r.hasOwnProperty,c=s.forEach,l={},u={forEach:function(t,e,n){var i,s,r;if(null!==t)if(c&&t.forEach===c)t.forEach(e,n);else if(t.length===+t.length){for(i=0,s=t.length;i<s;i++)if(i in t&&e.call(n,t[i],i,t)===l)return}else for(r in t)if(a.call(t,r)&&e.call(n,t[r],r,t)===l)return},extend:function(t){return this.forEach(o.call(arguments,1),function(e){for(var n in e)t[n]=e[n]}),t}},h=function(t){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages"},this.options=u.extend({},this.defaults,t),this.textdomain(this.options.domain),t.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+t.domain+"`")};h.context_delimiter=String.fromCharCode(4),u.extend(i.prototype,{onDomain:function(t){return this._domain=t,this},withContext:function(t){return this._context=t,this},ifPlural:function(t,e){return this._val=t,this._pkey=e,this},fetch:function(t){return"[object Array]"!={}.toString.call(t)&&(t=[].slice.call(arguments)),(t&&t.length?h.sprintf:function(t){return t})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),t)}}),u.extend(h.prototype,{translate:function(t){return new i(t,this)},textdomain:function(t){return t?void(this._textdomain=t):this._textdomain},gettext:function(t){return this.dcnpgettext.call(this,e,e,t)},dgettext:function(t,n){return this.dcnpgettext.call(this,t,e,n)},dcgettext:function(t,n){return this.dcnpgettext.call(this,t,e,n)},ngettext:function(t,n,i){return this.dcnpgettext.call(this,e,e,t,n,i)},dngettext:function(t,n,i,s){return this.dcnpgettext.call(this,t,e,n,i,s)},dcngettext:function(t,n,i,s){return this.dcnpgettext.call(this,t,e,n,i,s)},pgettext:function(t,n){return this.dcnpgettext.call(this,e,t,n)},dpgettext:function(t,e,n){return this.dcnpgettext.call(this,t,e,n)},dcpgettext:function(t,e,n){return this.dcnpgettext.call(this,t,e,n)},npgettext:function(t,n,i,s){return this.dcnpgettext.call(this,e,t,n,i,s)},dnpgettext:function(t,e,n,i,s){return this.dcnpgettext.call(this,t,e,n,i,s)},dcnpgettext:function(t,e,i,s,r){s=s||i,t=t||this._textdomain,r="undefined"==typeof r?1:r;var o;if(!this.options)return o=new h,o.dcnpgettext.call(o,void 0,void 0,i,s,r);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[t])throw new Error("Domain `"+t+"` was not found.");if(!this.options.locale_data[t][""])throw new Error("No locale meta information provided.");if(!i)throw new Error("No translation key found.");if("number"!=typeof r&&(r=parseInt(r,10),isNaN(r)))throw new Error("The number that was passed in is not a number.");var a,c,l=e?e+h.context_delimiter+i:i,u=this.options.locale_data,d=u[t],f=d[""].plural_forms||(u.messages||this.defaults.locale_data.messages)[""].plural_forms,p=n(f)(r)+1;if(!d)throw new Error("No domain named `"+t+"` could be found.");return a=d[l],!a||p>=a.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l),c=[null,i,s],c[n(f)(r)+1]):(c=a[p],c?c:(c=[null,i,s],c[n(f)(r)+1]))}});var d=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t,e){for(var n=[];e>0;n[--e]=t);return n.join("")}var n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,i){var s,r,o,a,c,l,u,h=1,f=n.length,p="",_=[];for(r=0;r<f;r++)if(p=t(n[r]),"string"===p)_.push(n[r]);else if("array"===p){if(a=n[r],a[2])for(s=i[h],o=0;o<a[2].length;o++){if(!s.hasOwnProperty(a[2][o]))throw d('[sprintf] property "%s" does not exist',a[2][o]);s=s[a[2][o]]}else s=a[1]?i[a[1]]:i[h++];if(/[^s]/.test(a[8])&&"number"!=t(s))throw d("[sprintf] expecting number but found %s",t(s));switch("undefined"!=typeof s&&null!==s||(s=""),a[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=a[7]?s.toExponential(a[7]):s.toExponential();break;case"f":s=a[7]?parseFloat(s).toFixed(a[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&a[7]?s.substring(0,a[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(a[8])&&a[3]&&s>=0?"+"+s:s,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",u=a[6]-String(s).length,c=a[6]?e(l,u):"",_.push(a[5]?s+c:c+s)}return _.join("")},n.cache={},n.parse=function(t){for(var e=t,n=[],i=[],s=0;e;){if(null!==(n=/^[^\x25]+/.exec(e)))i.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(e)))i.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw"[sprintf] huh?";if(n[2]){s|=1;var r=[],o=n[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";r.push(a[1])}n[2]=r}else s|=2;if(3===s)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";i.push(n)}e=e.substring(n[0].length)}return i},n}(),f=function(t,e){return e.unshift(t),d.apply(null,e)};h.parse_plural=function(t,e){return t=t.replace(/n/g,e),h.parse_expression(t)},h.sprintf=function(t,e){return"[object Array]"=={}.toString.call(e)?f(t,[].slice.call(e)):d.apply(this,[].slice.call(arguments))},h.prototype.sprintf=function(){return h.sprintf.apply(this,arguments)},h.PF={},h.PF.parse=function(t){var e=h.PF.extractPluralExpr(t);return h.PF.parser.parse.call(h.PF.parser,e)},h.PF.compile=function(t){function e(t){return t===!0?1:t?t:0}var n=h.PF.parse(t);return function(t){return e(h.PF.interpreter(n)(t))}},h.PF.interpreter=function(t){return function(e){switch(t.type){case"GROUP":return h.PF.interpreter(t.expr)(e);case"TERNARY":return h.PF.interpreter(t.expr)(e)?h.PF.interpreter(t.truthy)(e):h.PF.interpreter(t.falsey)(e);case"OR":return h.PF.interpreter(t.left)(e)||h.PF.interpreter(t.right)(e);case"AND":return h.PF.interpreter(t.left)(e)&&h.PF.interpreter(t.right)(e);case"LT":return h.PF.interpreter(t.left)(e)<h.PF.interpreter(t.right)(e);case"GT":return h.PF.interpreter(t.left)(e)>h.PF.interpreter(t.right)(e);case"LTE":return h.PF.interpreter(t.left)(e)<=h.PF.interpreter(t.right)(e);case"GTE":return h.PF.interpreter(t.left)(e)>=h.PF.interpreter(t.right)(e);case"EQ":return h.PF.interpreter(t.left)(e)==h.PF.interpreter(t.right)(e);case"NEQ":return h.PF.interpreter(t.left)(e)!=h.PF.interpreter(t.right)(e);case"MOD":return h.PF.interpreter(t.left)(e)%h.PF.interpreter(t.right)(e);case"VAR":return e;case"NUM":return t.val;default:throw new Error("Invalid Token found.")}}},h.PF.extractPluralExpr=function(t){t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(t)||(t=t.concat(";"));var e,n=/nplurals\=(\d+);/,i=/plural\=(.*);/,s=t.match(n),r={};if(!(s.length>1))throw new Error("nplurals not found in plural_forms string: "+t);if(r.nplurals=s[1],t=t.replace(n,""),e=t.match(i),!(e&&e.length>1))throw new Error("`plural` expression not found: "+t);return e[1]},h.PF.parser=function(){var t={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(t,e,n,i,s,r,o){var a=r.length-1;switch(s){case 1:return{type:"GROUP",expr:r[a-1]};case 2:this.$={type:"TERNARY",expr:r[a-4],truthy:r[a-2],falsey:r[a]};break;case 3:this.$={type:"OR",left:r[a-2],right:r[a]};break;case 4:this.$={type:"AND",left:r[a-2],right:r[a]};break;case 5:this.$={type:"LT",left:r[a-2],right:r[a]};break;case 6:this.$={type:"LTE",left:r[a-2],right:r[a]};break;case 7:this.$={type:"GT",left:r[a-2],right:r[a]};break;case 8:this.$={type:"GTE",left:r[a-2],right:r[a]};break;case 9:this.$={type:"NEQ",left:r[a-2],right:r[a]};break;case 10:this.$={type:"EQ",left:r[a-2],right:r[a]};break;case 11:this.$={type:"MOD",left:r[a-2],right:r[a]};break;case 12:this.$={type:"GROUP",expr:r[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(t)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(t,e){throw new Error(t)},parse:function(t){function e(t){s.length=s.length-2*t,r.length=r.length-t,o.length=o.length-t}function n(){var t;return t=i.lexer.lex()||1,"number"!=typeof t&&(t=i.symbols_[t]||t),t}var i=this,s=[0],r=[null],o=[],a=this.table,c="",l=0,u=0,h=0,d=2,f=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var p=this.lexer.yylloc;o.push(p),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var _,m,g,v,y,b,w,S,x,M={};;){if(g=s[s.length-1],this.defaultActions[g]?v=this.defaultActions[g]:(null==_&&(_=n()),v=a[g]&&a[g][_]),"undefined"==typeof v||!v.length||!v[0]){if(!h){x=[];for(b in a[g])this.terminals_[b]&&b>2&&x.push("'"+this.terminals_[b]+"'");var k="";k=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+x.join(", ")+", got '"+this.terminals_[_]+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==_?"end of input":"'"+(this.terminals_[_]||_)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[_]||_,line:this.lexer.yylineno,loc:p,expected:x})}if(3==h){if(_==f)throw new Error(k||"Parsing halted.");u=this.lexer.yyleng,c=this.lexer.yytext,l=this.lexer.yylineno,p=this.lexer.yylloc,_=n()}for(;;){if(d.toString()in a[g])break;if(0==g)throw new Error(k||"Parsing halted.");e(1),g=s[s.length-1]}m=_,_=d,g=s[s.length-1],v=a[g]&&a[g][d],h=3}if(v[0]instanceof Array&&v.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+_);switch(v[0]){case 1:s.push(_),r.push(this.lexer.yytext),o.push(this.lexer.yylloc),s.push(v[1]),_=null,m?(_=m,m=null):(u=this.lexer.yyleng,c=this.lexer.yytext,l=this.lexer.yylineno,p=this.lexer.yylloc,h>0&&h--);break;case 2:if(w=this.productions_[v[1]][1],M.$=r[r.length-w],M._$={first_line:o[o.length-(w||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(w||1)].first_column,last_column:o[o.length-1].last_column},y=this.performAction.call(M,c,u,l,this.yy,v[1],r,o),"undefined"!=typeof y)return y;w&&(s=s.slice(0,-1*w*2),r=r.slice(0,-1*w),o=o.slice(0,-1*w)),s.push(this.productions_[v[1]][0]),r.push(M.$),o.push(M._$),S=a[s[s.length-2]][s[s.length-1]],s.push(S);break;case 3:return!0}}return!0}},e=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e)},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t;var e=t.match(/\n/);return e&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n;this._more||(this.yytext="",this.match="");for(var i=this._currentRules(),s=0;s<i.length;s++)if(e=this._input.match(this.rules[i[s]]))return n=e[0].match(/\n.*/g),n&&(this.yylineno+=n.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:n?n[n.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],t=this.performAction.call(this,this.yy,this,i[s],this.conditionStack[this.conditionStack.length-1]),t?t:void 0;return""===this._input?this.EOF:void this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return"undefined"!=typeof t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return t.performAction=function(t,e,n,i){switch(n){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},t.rules=[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],t.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}},t}();return t.lexer=e,t}(),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=h),exports.Jed=h):("function"==typeof define&&define.amd&&define("jed",[],function(){return h}),t.Jed=h)}(this),define("text!en",[],function(){return'{\n   "domain": "converse",\n   "locale_data": {\n      "converse": {\n         "": {\n            "domain": "converse",\n            "plural_forms": "nplurals=2; plural=(n != 1);",\n            "lang": "en"\n         },\n         "Bookmark this room": [\n            null,\n            ""\n         ],\n         "The name for this bookmark:": [\n            null,\n            ""\n         ],\n         "Would you like this room to be automatically joined upon startup?": [\n            null,\n            ""\n         ],\n         "What should your nickname for this room be?": [\n            null,\n            ""\n         ],\n         "Save": [\n            null,\n            "Save"\n         ],\n         "Cancel": [\n            null,\n            "Cancel"\n         ],\n         "Sorry, something went wrong while trying to save your bookmark.": [\n            null,\n            ""\n         ],\n         "Bookmarked Rooms": [\n            null,\n            ""\n         ],\n         "Are you sure you want to remove the bookmark \\"%1$s\\"?": [\n            null,\n            ""\n         ],\n         "Click to open this room": [\n            null,\n            "Click to open this room"\n         ],\n         "Show more information on this room": [\n            null,\n            "Show more information on this room"\n         ],\n         "Remove this bookmark": [\n            null,\n            ""\n         ],\n         "Close this chat box": [\n            null,\n            ""\n         ],\n         "Personal message": [\n            null,\n            ""\n         ],\n         "me": [\n            null,\n            ""\n         ],\n         "A very large message has been received.This might be due to an attack meant to degrade the chat performance.Output has been shortened.": [\n            null,\n            ""\n         ],\n         "is typing": [\n            null,\n            ""\n         ],\n         "has stopped typing": [\n            null,\n            ""\n         ],\n         "has gone away": [\n            null,\n            ""\n         ],\n         "Show this menu": [\n            null,\n            "Show this menu"\n         ],\n         "Write in the third person": [\n            null,\n            "Write in the third person"\n         ],\n         "Remove messages": [\n            null,\n            "Remove messages"\n         ],\n         "Are you sure you want to clear the messages from this chat box?": [\n            null,\n            ""\n         ],\n         "has gone offline": [\n            null,\n            ""\n         ],\n         "is busy": [\n            null,\n            ""\n         ],\n         "Clear all messages": [\n            null,\n            ""\n         ],\n         "Insert a smiley": [\n            null,\n            ""\n         ],\n         "Start a call": [\n            null,\n            ""\n         ],\n         "Contacts": [\n            null,\n            ""\n         ],\n         "Connecting": [\n            null,\n            ""\n         ],\n         "XMPP Username:": [\n            null,\n            ""\n         ],\n         "Password:": [\n            null,\n            "Password:"\n         ],\n         "Click here to log in anonymously": [\n            null,\n            "Click here to log in anonymously"\n         ],\n         "Log In": [\n            null,\n            "Log In"\n         ],\n         "Username": [\n            null,\n            ""\n         ],\n         "user@server": [\n            null,\n            ""\n         ],\n         "Sign in": [\n            null,\n            "Sign in"\n         ],\n         "I am %1$s": [\n            null,\n            "I am %1$s"\n         ],\n         "Click here to write a custom status message": [\n            null,\n            "Click here to write a custom status message"\n         ],\n         "Click to change your chat status": [\n            null,\n            "Click to change your chat status"\n         ],\n         "Custom status": [\n            null,\n            "Custom status"\n         ],\n         "online": [\n            null,\n            "online"\n         ],\n         "busy": [\n            null,\n            "busy"\n         ],\n         "away for long": [\n            null,\n            "away for long"\n         ],\n         "away": [\n            null,\n            "away"\n         ],\n         "Online": [\n            null,\n            ""\n         ],\n         "Busy": [\n            null,\n            ""\n         ],\n         "Away": [\n            null,\n            ""\n         ],\n         "Offline": [\n            null,\n            ""\n         ],\n         "Log out": [\n            null,\n            ""\n         ],\n         "Contact name": [\n            null,\n            ""\n         ],\n         "Search": [\n            null,\n            ""\n         ],\n         "e.g. user@example.org": [\n            null,\n            ""\n         ],\n         "Add": [\n            null,\n            ""\n         ],\n         "Click to add new chat contacts": [\n            null,\n            ""\n         ],\n         "Add a contact": [\n            null,\n            ""\n         ],\n         "No users found": [\n            null,\n            ""\n         ],\n         "Click to add as a chat contact": [\n            null,\n            ""\n         ],\n         "Toggle chat": [\n            null,\n            ""\n         ],\n         "Click to hide these contacts": [\n            null,\n            ""\n         ],\n         "Reconnecting": [\n            null,\n            ""\n         ],\n         "The connection has dropped, attempting to reconnect.": [\n            null,\n            ""\n         ],\n         "Disconnected": [\n            null,\n            ""\n         ],\n         "The connection to the chat server has dropped": [\n            null,\n            ""\n         ],\n         "Connection error": [\n            null,\n            ""\n         ],\n         "Authenticating": [\n            null,\n            ""\n         ],\n         "Authentication failed.": [\n            null,\n            ""\n         ],\n         "Authentication Failed": [\n            null,\n            ""\n         ],\n         "Sorry, there was an error while trying to add ": [\n            null,\n            ""\n         ],\n         "This client does not allow presence subscriptions": [\n            null,\n            ""\n         ],\n         "Close this box": [\n            null,\n            ""\n         ],\n         "Minimize this box": [\n            null,\n            ""\n         ],\n         "Click to restore this chat": [\n            null,\n            ""\n         ],\n         "Minimized": [\n            null,\n            ""\n         ],\n         "Minimize this chat box": [\n            null,\n            ""\n         ],\n         "Message": [\n            null,\n            "Message"\n         ],\n         "Hide the list of occupants": [\n            null,\n            ""\n         ],\n         "Error: could not execute the command": [\n            null,\n            ""\n         ],\n         "Error: the \\"": [\n            null,\n            ""\n         ],\n         "Are you sure you want to clear the messages from this room?": [\n            null,\n            ""\n         ],\n         "Change user\'s affiliation to admin": [\n            null,\n            ""\n         ],\n         "Ban user from room": [\n            null,\n            ""\n         ],\n         "Change user role to occupant": [\n            null,\n            ""\n         ],\n         "Kick user from room": [\n            null,\n            ""\n         ],\n         "Write in 3rd person": [\n            null,\n            ""\n         ],\n         "Grant membership to a user": [\n            null,\n            ""\n         ],\n         "Remove user\'s ability to post messages": [\n            null,\n            ""\n         ],\n         "Change your nickname": [\n            null,\n            ""\n         ],\n         "Grant moderator role to user": [\n            null,\n            ""\n         ],\n         "Grant ownership of this room": [\n            null,\n            ""\n         ],\n         "Revoke user\'s membership": [\n            null,\n            ""\n         ],\n         "Set room topic": [\n            null,\n            ""\n         ],\n         "Allow muted user to post messages": [\n            null,\n            ""\n         ],\n         "An error occurred while trying to save the form.": [\n            null,\n            "An error occurred while trying to save the form."\n         ],\n         "The nickname you chose is reserved or currently in use, please choose a different one.": [\n            null,\n            ""\n         ],\n         "Please choose your nickname": [\n            null,\n            ""\n         ],\n         "Nickname": [\n            null,\n            ""\n         ],\n         "This chatroom requires a password": [\n            null,\n            "This chatroom requires a password"\n         ],\n         "Password: ": [\n            null,\n            "Password: "\n         ],\n         "Submit": [\n            null,\n            "Submit"\n         ],\n         "This room is not anonymous": [\n            null,\n            "This room is not anonymous"\n         ],\n         "This room now shows unavailable members": [\n            null,\n            "This room now shows unavailable members"\n         ],\n         "This room does not show unavailable members": [\n            null,\n            "This room does not show unavailable members"\n         ],\n         "Non-privacy-related room configuration has changed": [\n            null,\n            "Non-privacy-related room configuration has changed"\n         ],\n         "Room logging is now enabled": [\n            null,\n            "Room logging is now enabled"\n         ],\n         "Room logging is now disabled": [\n            null,\n            "Room logging is now disabled"\n         ],\n         "This room is now non-anonymous": [\n            null,\n            "This room is now non-anonymous"\n         ],\n         "This room is now semi-anonymous": [\n            null,\n            "This room is now semi-anonymous"\n         ],\n         "This room is now fully-anonymous": [\n            null,\n            "This room is now fully-anonymous"\n         ],\n         "A new room has been created": [\n            null,\n            "A new room has been created"\n         ],\n         "You have been banned from this room": [\n            null,\n            "You have been banned from this room"\n         ],\n         "You have been kicked from this room": [\n            null,\n            "You have been kicked from this room"\n         ],\n         "You have been removed from this room because of an affiliation change": [\n            null,\n            "You have been removed from this room because of an affiliation change"\n         ],\n         "You have been removed from this room because the room has changed to members-only and you\'re not a member": [\n            null,\n            "You have been removed from this room because the room has changed to members-only and you\'re not a member"\n         ],\n         "You have been removed from this room because the MUC (Multi-user chat) service is being shut down.": [\n            null,\n            "You have been removed from this room because the MUC (Multi-user chat) service is being shut down."\n         ],\n         "<strong>%1$s</strong> has been banned": [\n            null,\n            "<strong>%1$s</strong> has been banned"\n         ],\n         "<strong>%1$s</strong>\'s nickname has changed": [\n            null,\n            ""\n         ],\n         "<strong>%1$s</strong> has been kicked out": [\n            null,\n            "<strong>%1$s</strong> has been kicked out"\n         ],\n         "<strong>%1$s</strong> has been removed because of an affiliation change": [\n            null,\n            "<strong>%1$s</strong> has been removed because of an affiliation change"\n         ],\n         "<strong>%1$s</strong> has been removed for not being a member": [\n            null,\n            "<strong>%1$s</strong> has been removed for not being a member"\n         ],\n         "Your nickname has been automatically set to: <strong>%1$s</strong>": [\n            null,\n            ""\n         ],\n         "Your nickname has been changed to: <strong>%1$s</strong>": [\n            null,\n            ""\n         ],\n         "The reason given is: \\"": [\n            null,\n            ""\n         ],\n         "You are not on the member list of this room": [\n            null,\n            "You are not on the member list of this room"\n         ],\n         "No nickname was specified": [\n            null,\n            "No nickname was specified"\n         ],\n         "You are not allowed to create new rooms": [\n            null,\n            "You are not allowed to create new rooms"\n         ],\n         "Your nickname doesn\'t conform to this room\'s policies": [\n            null,\n            "Your nickname doesn\'t conform to this room\'s policies"\n         ],\n         "This room does not (yet) exist": [\n            null,\n            "This room does not (yet) exist"\n         ],\n         "Topic set by %1$s to: %2$s": [\n            null,\n            "Topic set by %1$s to: %2$s"\n         ],\n         "Invite": [\n            null,\n            ""\n         ],\n         "Occupants": [\n            null,\n            ""\n         ],\n         "You are about to invite %1$s to the chat room \\"%2$s\\". ": [\n            null,\n            ""\n         ],\n         "You may optionally include a message, explaining the reason for the invitation.": [\n            null,\n            ""\n         ],\n         "Room name": [\n            null,\n            ""\n         ],\n         "Server": [\n            null,\n            "Server"\n         ],\n         "Join Room": [\n            null,\n            ""\n         ],\n         "Show rooms": [\n            null,\n            ""\n         ],\n         "Rooms": [\n            null,\n            ""\n         ],\n         "No rooms on %1$s": [\n            null,\n            ""\n         ],\n         "Rooms on %1$s": [\n            null,\n            "Rooms on %1$s"\n         ],\n         "Description:": [\n            null,\n            "Description:"\n         ],\n         "Occupants:": [\n            null,\n            "Occupants:"\n         ],\n         "Features:": [\n            null,\n            "Features:"\n         ],\n         "Requires authentication": [\n            null,\n            "Requires authentication"\n         ],\n         "Hidden": [\n            null,\n            "Hidden"\n         ],\n         "Requires an invitation": [\n            null,\n            "Requires an invitation"\n         ],\n         "Moderated": [\n            null,\n            "Moderated"\n         ],\n         "Non-anonymous": [\n            null,\n            "Non-anonymous"\n         ],\n         "Open room": [\n            null,\n            "Open room"\n         ],\n         "Permanent room": [\n            null,\n            "Permanent room"\n         ],\n         "Public": [\n            null,\n            "Public"\n         ],\n         "Semi-anonymous": [\n            null,\n            "Semi-anonymous"\n         ],\n         "Temporary room": [\n            null,\n            "Temporary room"\n         ],\n         "Unmoderated": [\n            null,\n            "Unmoderated"\n         ],\n         "%1$s has invited you to join a chat room: %2$s": [\n            null,\n            ""\n         ],\n         "%1$s has invited you to join a chat room: %2$s, and left the following reason: \\"%3$s\\"": [\n            null,\n            ""\n         ],\n         "Notification from %1$s": [\n            null,\n            ""\n         ],\n         "%1$s says": [\n            null,\n            ""\n         ],\n         "has come online": [\n            null,\n            ""\n         ],\n         "wants to be your contact": [\n            null,\n            ""\n         ],\n         "Re-establishing encrypted session": [\n            null,\n            ""\n         ],\n         "Generating private key.": [\n            null,\n            ""\n         ],\n         "Your browser might become unresponsive.": [\n            null,\n            ""\n         ],\n         "Authentication request from %1$s\\n\\nYour chat contact is attempting to verify your identity, by asking you the question below.\\n\\n%2$s": [\n            null,\n            ""\n         ],\n         "Could not verify this user\'s identify.": [\n            null,\n            ""\n         ],\n         "Exchanging private key with contact.": [\n            null,\n            ""\n         ],\n         "Your messages are not encrypted anymore": [\n            null,\n            ""\n         ],\n         "Your messages are now encrypted but your contact\'s identity has not been verified.": [\n            null,\n            ""\n         ],\n         "Your contact\'s identify has been verified.": [\n            null,\n            ""\n         ],\n         "Your contact has ended encryption on their end, you should do the same.": [\n            null,\n            ""\n         ],\n         "Your message could not be sent": [\n            null,\n            ""\n         ],\n         "We received an unencrypted message": [\n            null,\n            ""\n         ],\n         "We received an unreadable encrypted message": [\n            null,\n            ""\n         ],\n         "Here are the fingerprints, please confirm them with %1$s, outside of this chat.\\n\\nFingerprint for you, %2$s: %3$s\\n\\nFingerprint for %1$s: %4$s\\n\\nIf you have confirmed that the fingerprints match, click OK, otherwise click Cancel.": [\n            null,\n            ""\n         ],\n         "You will be prompted to provide a security question and then an answer to that question.\\n\\nYour contact will then be prompted the same question and if they type the exact same answer (case sensitive), their identity will be verified.": [\n            null,\n            ""\n         ],\n         "What is your security question?": [\n            null,\n            ""\n         ],\n         "What is the answer to the security question?": [\n            null,\n            ""\n         ],\n         "Invalid authentication scheme provided": [\n            null,\n            ""\n         ],\n         "Your messages are not encrypted. Click here to enable OTR encryption.": [\n            null,\n            ""\n         ],\n         "Your messages are encrypted, but your contact has not been verified.": [\n            null,\n            ""\n         ],\n         "Your messages are encrypted and your contact verified.": [\n            null,\n            ""\n         ],\n         "Your contact has closed their end of the private session, you should do the same": [\n            null,\n            ""\n         ],\n         "End encrypted conversation": [\n            null,\n            ""\n         ],\n         "Refresh encrypted conversation": [\n            null,\n            ""\n         ],\n         "Start encrypted conversation": [\n            null,\n            ""\n         ],\n         "Verify with fingerprints": [\n            null,\n            ""\n         ],\n         "Verify with SMP": [\n            null,\n            ""\n         ],\n         "What\'s this?": [\n            null,\n            ""\n         ],\n         "unencrypted": [\n            null,\n            ""\n         ],\n         "unverified": [\n            null,\n            ""\n         ],\n         "verified": [\n            null,\n            ""\n         ],\n         "finished": [\n            null,\n            ""\n         ],\n         " e.g. conversejs.org": [\n            null,\n            ""\n         ],\n         "Your XMPP provider\'s domain name:": [\n            null,\n            ""\n         ],\n         "Fetch registration form": [\n            null,\n            ""\n         ],\n         "Tip: A list of public XMPP providers is available": [\n            null,\n            ""\n         ],\n         "here": [\n            null,\n            ""\n         ],\n         "Register": [\n            null,\n            ""\n         ],\n         "Sorry, the given provider does not support in band account registration. Please try with a different provider.": [\n            null,\n            ""\n         ],\n         "Requesting a registration form from the XMPP server": [\n            null,\n            ""\n         ],\n         "Something went wrong while establishing a connection with \\"%1$s\\". Are you sure it exists?": [\n            null,\n            ""\n         ],\n         "Now logging you in": [\n            null,\n            ""\n         ],\n         "Registered successfully": [\n            null,\n            ""\n         ],\n         "Return": [\n            null,\n            ""\n         ],\n         "The provider rejected your registration attempt. Please check the values you entered for correctness.": [\n            null,\n            ""\n         ],\n         "This contact is busy": [\n            null,\n            ""\n         ],\n         "This contact is online": [\n            null,\n            ""\n         ],\n         "This contact is offline": [\n            null,\n            ""\n         ],\n         "This contact is unavailable": [\n            null,\n            ""\n         ],\n         "This contact is away for an extended period": [\n            null,\n            ""\n         ],\n         "This contact is away": [\n            null,\n            ""\n         ],\n         "Groups": [\n            null,\n            ""\n         ],\n         "My contacts": [\n            null,\n            ""\n         ],\n         "Pending contacts": [\n            null,\n            ""\n         ],\n         "Contact requests": [\n            null,\n            ""\n         ],\n         "Ungrouped": [\n            null,\n            ""\n         ],\n         "Filter": [\n            null,\n            ""\n         ],\n         "State": [\n            null,\n            ""\n         ],\n         "Any": [\n            null,\n            ""\n         ],\n         "Chatty": [\n            null,\n            ""\n         ],\n         "Extended Away": [\n            null,\n            ""\n         ],\n         "Click to remove this contact": [\n            null,\n            "Click to remove this contact"\n         ],\n         "Click to accept this contact request": [\n            null,\n            ""\n         ],\n         "Click to decline this contact request": [\n            null,\n            ""\n         ],\n         "Click to chat with this contact": [\n            null,\n            "Click to chat with this contact"\n         ],\n         "Name": [\n            null,\n            ""\n         ],\n         "Are you sure you want to remove this contact?": [\n            null,\n            ""\n         ],\n         "Sorry, there was an error while trying to remove ": [\n            null,\n            ""\n         ],\n         "Are you sure you want to decline this contact request?": [\n            null,\n            ""\n         ]\n      }\n   }\n}';
}),function(t,e){define("locales",["jed","text!en"],function(e,n){return t.locales={af:arguments[1],ca:arguments[2],de:arguments[3],en:arguments[4],es:arguments[5],fr:arguments[6],he:arguments[7],hu:arguments[8],id:arguments[9],it:arguments[10],ja:arguments[11],nb:arguments[12],nl:arguments[13],pl:arguments[14],"pt-br":arguments[15],ru:arguments[16],uk:arguments[17],zh:arguments[18]},t.locales})}(this),define("tpl!chatbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head chat-head-chatbox">\n        <a class="chatbox-btn close-chatbox-button icon-close" title="'+(null==(__t=info_close)?"":__t)+'"></a>\n        <div class="chat-title">\n            ',url&&(__p+='\n                <a href="'+(null==(__t=url)?"":__t)+'" target="_blank" rel="noopener" class="user">\n            '),__p+="\n                    "+(null==(__t=title)?"":__t)+"\n            ",url&&(__p+="\n                </a>\n            "),__p+='\n            <p class="user-custom-message"><p/>\n        </div>\n    </div>\n    <div class="chat-body">\n        <div class="chat-content"></div>\n        <div class="new-msgs-indicator hidden">‚ñº '+(null==(__t=unread_msgs)?"":__t)+" ‚ñº</div>\n        ",show_textarea&&(__p+='\n        <form class="sendXMPPMessage" action="" method="post">\n            ',show_toolbar&&(__p+='\n                <ul class="chat-toolbar no-text-select"></ul>\n            '),__p+='\n        <textarea\n            type="text"\n            class="chat-textarea"\n            placeholder="'+(null==(__t=label_personal_message)?"":__t)+'"/>\n        </form>\n        '),__p+="\n    </div>\n</div>\n";return __p}}),define("tpl!new_day",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<time class="chat-info chat-date" data-isodate="'+(null==(__t=isodate)?"":__t)+'">'+(null==(__t=datestring)?"":__t)+"</time>\n";return __p}}),define("tpl!action",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-message '+(null==(__t=extra_classes)?"":__t)+'" data-isodate="'+(null==(__t=isodate)?"":__t)+'">\n    <span class="chat-msg-author chat-msg-'+(null==(__t=sender)?"":__t)+'">'+(null==(__t=time)?"":__t)+" **"+(null==(__t=username)?"":__t)+' </span>\n    <span class="chat-msg-content"><!-- message gets added here via renderMessage --></span>\n</div>\n';return __p}}),define("tpl!message",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-message '+(null==(__t=extra_classes)?"":__t)+'" data-isodate="'+(null==(__t=isodate)?"":__t)+'" data-msgid="'+(null==(__t=msgid)?"":__t)+'">\n    <span class="chat-msg-author chat-msg-'+(null==(__t=sender)?"":__t)+'">'+(null==(__t=time)?"":__t)+" "+(null==(__t=username)?"":__t)+':&nbsp;</span>\n    <span class="chat-msg-content"><!-- message gets added here via renderMessage --></span>\n</div>\n';return __p}}),define("tpl!toolbar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",show_emoticons&&(__p+='\n    <li class="toggle-smiley icon-happy" title="'+(null==(__t=label_insert_smiley)?"":__t)+'">\n        <ul>\n            <li><a class="icon-smiley" href="#" data-emoticon=":)"></a></li>\n            <li><a class="icon-wink" href="#" data-emoticon=";)"></a></li>\n            <li><a class="icon-grin" href="#" data-emoticon=":D"></a></li>\n            <li><a class="icon-tongue" href="#" data-emoticon=":P"></a></li>\n            <li><a class="icon-cool" href="#" data-emoticon="8)"></a></li>\n            <li><a class="icon-evil" href="#" data-emoticon=">:)"></a></li>\n            <li><a class="icon-confused" href="#" data-emoticon=":S"></a></li>\n            <li><a class="icon-wondering" href="#" data-emoticon=":\\"></a></li>\n            <li><a class="icon-angry" href="#" data-emoticon=">:("></a></li>\n            <li><a class="icon-sad" href="#" data-emoticon=":("></a></li>\n            <li><a class="icon-shocked" href="#" data-emoticon=":O"></a></li>\n            <li><a class="icon-thumbs-up" href="#" data-emoticon="(^.^)b"></a></li>\n            <li><a class="icon-heart" href="#" data-emoticon="<3"></a></li>\n        </ul>\n    </li>\n'),__p+="\n",show_call_button&&(__p+='\n<li class="toggle-call"><a class="icon-phone" title="'+(null==(__t=label_start_call)?"":__t)+'"></a></li>\n'),__p+="\n",show_clear_button&&(__p+='\n<li class="toggle-clear"><a class="icon-remove" title="'+(null==(__t=label_clear)?"":__t)+'"></a></li>\n'),__p+="\n";return __p}}),define("tpl!avatar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<canvas height="32px" width="32px" class="avatar"></canvas>\n';return __p}}),function(t,e){define("converse-chatview",["converse-core","converse-api","tpl!chatbox","tpl!new_day","tpl!action","tpl!message","tpl!toolbar","tpl!avatar"],e)}(this,function(t,e,n,i,s,r,o,a){"use strict";t.templates.chatbox=n,t.templates.new_day=i,t.templates.action=s,t.templates.message=r,t.templates.toolbar=o,t.templates.avatar=a;var c=e.env.jQuery,l=e.env.utils,u=e.env.Strophe,h=e.env.$msg,d=e.env._,f=l.__.bind(t),p=e.env.moment,_={ENTER:13,FORWARD_SLASH:47};e.plugins.add("converse-chatview",{overrides:{ChatBoxViews:{onChatBoxAdded:function(e){var n=this.get(e.get("id"));return n?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new t.ChatBoxView({model:e}),this.add(e.get("id"),n),n)}}},initialize:function(){this.updateSettings({show_toolbar:!0,chatview_avatar_width:32,chatview_avatar_height:32,visible_toolbar_buttons:{emoticons:!0,call:!1,clear:!0}}),t.ChatBoxView=Backbone.View.extend({length:200,tagName:"div",className:"chatbox",is_chatroom:!1,events:{"click .close-chatbox-button":"close","keypress .chat-textarea":"keyPressed","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","click .toggle-clear":"clearMessages","click .toggle-call":"toggleCall","click .new-msgs-indicator":"viewUnreadMessages"},initialize:function(){this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:chat_state",this.sendChatState,this),this.model.on("change:chat_status",this.onChatStatusChanged,this),this.model.on("change:image",this.renderAvatar,this),this.model.on("change:status",this.onStatusChanged,this),this.model.on("showHelpMessages",this.showHelpMessages,this),this.model.on("sendMessage",this.sendMessage,this),this.render().fetchMessages().insertIntoDOM().afterShown(),this.$el.find(".chat-content").on("scroll",this.markScrolled.bind(this)),t.emit("chatBoxInitialized",this)},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(t.templates.chatbox(d.extend(this.model.toJSON(),{show_toolbar:t.show_toolbar,show_textarea:!0,title:this.model.get("fullname"),unread_msgs:f("You have unread messages"),info_close:f("Close this chat box"),label_personal_message:f("Personal message")}))),this.$content=this.$el.find(".chat-content"),this.renderToolbar().renderAvatar(),t.emit("chatBoxOpened",this),l.refreshWebkit(),this.showStatusMessage()},afterMessagesFetched:function(){},fetchMessages:function(){return this.model.messages.fetch({add:!0,success:this.afterMessagesFetched.bind(this)}),this},insertIntoDOM:function(){return c("#conversejs").prepend(this.$el),this},clearStatusNotification:function(){this.$content.find("div.chat-event").remove()},showStatusNotification:function(t,e,n){e||this.clearStatusNotification();var i=c('<div class="chat-info"></div>').text(t);n||i.addClass("chat-event"),this.$content.append(i),this.scrollDown()},addSpinner:function(){this.$content.first().hasClass("spinner")||this.$content.prepend('<span class="spinner"/>')},clearSpinner:function(){this.$content.children(":first").is("span.spinner")&&this.$content.children(":first").remove()},insertDayIndicator:function(e,n){var i=p(e).startOf("day"),s=n?this.$content.prepend:this.$content.append;s.call(this.$content,t.templates.new_day({isodate:i.format(),datestring:i.format("dddd MMM Do YYYY")}))},insertMessage:function(t,e){var n=this,i=e?this.$content.prepend:this.$content.append;d.compose(this.scrollDownMessageHeight.bind(this),function(t){return i.call(n.$content,t),t})(this.renderMessage(t))},showMessage:function(t){var e,n,i=this.$content.find(".chat-message:first"),s=i.data("isodate"),r=p(t.time)||p,o=this.$content.find(".chat-message:last").data("isodate");return s?r.isAfter(o)||r.isSame(o)?(r.isAfter(o,"day")&&this.insertDayIndicator(r),void this.insertMessage(t)):r.isBefore(s)||r.isSame(s)?(this.insertMessage(t,"prepend"),void(r.isBefore(s,"day")&&this.insertDayIndicator(r,"prepend"))):(r=r.format(),e=d.map(this.$content.find(".chat-message"),function(t){return c(t).data("isodate")}),e.push(r),e.sort(),n=e.indexOf(r)-1,void d.compose(this.scrollDownMessageHeight.bind(this),function(t){return t.insertAfter(this.$content.find('.chat-message[data-isodate="'+e[n]+'"]')),t}.bind(this))(this.renderMessage(t))):(this.insertDayIndicator(r),void this.insertMessage(t))},getExtraMessageTemplateAttributes:function(t){return{}},renderMessage:function(e){var n,i,s=p(e.time)||p,r=e.message,o=r.match(/^\/(.*?)(?: (.*))?$/),a=this.model.get("fullname")||e.fullname,l=e.delayed&&"delayed"||"";o&&"me"===o[1]?(r=r.replace(/^\/me/,""),n=t.templates.action,i=a):(n=t.templates.message,i="me"===e.sender&&f("me")||a),this.$content.find("div.chat-event").remove(),this.is_chatroom&&"them"===e.sender&&new RegExp("\\b"+this.model.get("nick")+"\\b").test(r)&&(l+=" mentioned"),r.length>8e3&&(r=r.substring(0,10)+"...",this.showStatusNotification(f("A very large message has been received.This might be due to an attack meant to degrade the chat performance.Output has been shortened."),!0,!0));var u=c(n(d.extend(this.getExtraMessageTemplateAttributes(e),{msgid:e.msgid,sender:e.sender,time:s.format("hh:mm"),isodate:s.format(),username:i,extra_classes:l})));return u.find(".chat-msg-content").first().text(r).addHyperlinks().addEmoticons(t.visible_toolbar_buttons.emoticons),u},showHelpMessages:function(t,e,n){var i,s=t.length;for(i=0;i<s;i++)this.$content.append(c('<div class="chat-'+(e||"info")+'">'+t[i]+"</div>"));return n===!0?this.$content.append('<span class="spinner"/>'):n===!1&&this.$content.find("span.spinner").remove(),this.scrollDown()},handleChatStateMessage:function(e){e.get("chat_state")===t.COMPOSING?(this.showStatusNotification(e.get("fullname")+" "+f("is typing")),this.clear_status_timeout=window.setTimeout(this.clearStatusNotification.bind(this),3e4)):e.get("chat_state")===t.PAUSED?this.showStatusNotification(e.get("fullname")+" "+f("has stopped typing")):d.contains([t.INACTIVE,t.ACTIVE],e.get("chat_state"))?this.$content.find("div.chat-event").remove():e.get("chat_state")===t.GONE&&this.showStatusNotification(e.get("fullname")+" "+f("has gone away"))},shouldShowOnTextMessage:function(){return!this.$el.is(":visible")},updateNewMessageIndicators:function(e){e.get("archive_id")||(this.model.get("scrolled",!0)&&this.$el.find(".new-msgs-indicator").removeClass("hidden"),("hidden"===t.windowState||this.model.get("scrolled",!0))&&t.incrementMsgCounter())},handleTextMessage:function(t){this.showMessage(d.clone(t.attributes)),"me"!==t.get("sender")?this.updateNewMessageIndicators(t):this.model.set("scrolled",!1),this.shouldShowOnTextMessage()?this.show():this.scrollDown()},handleErrorMessage:function(t){var e=c("[data-msgid="+t.get("msgid")+"]");e.length&&(e.after(c('<div class="chat-info chat-error"></div>').text(t.get("message"))),this.scrollDown())},onMessageAdded:function(t){"undefined"!=typeof this.clear_status_timeout&&(window.clearTimeout(this.clear_status_timeout),delete this.clear_status_timeout),"error"===t.get("type")?this.handleErrorMessage(t):t.get("message")?this.handleTextMessage(t):this.handleChatStateMessage(t)},createMessageStanza:function(e){return h({from:t.connection.jid,to:this.model.get("jid"),type:"chat",id:e.get("msgid")}).c("body").t(e.get("message")).up().c(t.ACTIVE,{xmlns:u.NS.CHATSTATES}).up()},sendMessage:function(e){var n=this.createMessageStanza(e);t.connection.send(n),t.forward_messages&&t.connection.send(h({to:t.bare_jid,type:"chat",id:e.get("msgid")}).c("forwarded",{xmlns:"urn:xmpp:forward:0"}).c("delay",{xmns:"urn:xmpp:delay",stamp:(new Date).getTime()}).up().cnode(n.tree()))},onMessageSubmitted:function(e){if(!t.connection.authenticated)return this.showHelpMessages(["Sorry, the connection has been lost, and your message could not be sent"],"error");var n,i=e.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(i){if("clear"===i[1])return this.clearMessages();if("help"===i[1])return n=["<strong>/help</strong>:"+f("Show this menu"),"<strong>/me</strong>:"+f("Write in the third person"),"<strong>/clear</strong>:"+f("Remove messages")],void this.showHelpMessages(n)}var s=t.xmppstatus.get("fullname");s=d.isEmpty(s)?t.bare_jid:s;var r=this.model.messages.create({fullname:s,sender:"me",time:p().format(),message:e});this.sendMessage(r)},sendChatState:function(){t.connection.send(h({to:this.model.get("jid"),type:"chat"}).c(this.model.get("chat_state"),{xmlns:u.NS.CHATSTATES}).up().c("no-store",{xmlns:u.NS.HINTS}).up().c("no-permanent-store",{xmlns:u.NS.HINTS}))},setChatState:function(e,n){return"undefined"!=typeof this.chat_state_timeout&&(window.clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===t.COMPOSING?this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),t.TIMEOUTS.PAUSED,t.PAUSED):e===t.PAUSED&&(this.chat_state_timeout=window.setTimeout(this.setChatState.bind(this),t.TIMEOUTS.INACTIVE,t.INACTIVE)),n||this.model.get("chat_state")===e||this.model.set("chat_state",e),this},keyPressed:function(e){var n,i=c(e.target);e.keyCode===_.ENTER?(e.preventDefault(),n=i.val(),i.val("").focus(),""!==n&&(this.onMessageSubmitted(n),t.emit("messageSend",n)),this.setChatState(t.ACTIVE)):this.setChatState(t.COMPOSING,e.keyCode===_.FORWARD_SLASH)},clearMessages:function(t){t&&t.preventDefault&&t.preventDefault();var e=confirm(f("Are you sure you want to clear the messages from this chat box?"));return e===!0&&(this.$content.empty(),this.model.messages.reset(),this.model.messages.browserStorage._clear()),this},insertIntoTextArea:function(t){var e=this.$el.find("textarea.chat-textarea"),n=e.val();n&&" "!==n[n.length-1]&&(n+=" "),e.focus().val(n+t+" ")},insertEmoticon:function(t){t.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200);var e=c(t.target);e=e.is("a")?e:e.children("a"),this.insertIntoTextArea(e.data("emoticon"))},toggleEmoticonMenu:function(t){t.stopPropagation(),this.$el.find(".toggle-smiley ul").slideToggle(200)},toggleCall:function(e){e.stopPropagation(),t.emit("callButtonClicked",{connection:t.connection,model:this.model})},onChatStatusChanged:function(t){var e=t.get("chat_status"),n=t.get("fullname");n=d.isEmpty(n)?t.get("jid"):n,this.$el.is(":visible")&&("offline"===e?this.showStatusNotification(n+" "+f("has gone offline")):"away"===e?this.showStatusNotification(n+" "+f("has gone away")):"dnd"===e?this.showStatusNotification(n+" "+f("is busy")):"online"===e&&this.$el.find("div.chat-event").remove())},onStatusChanged:function(e){this.showStatusMessage(),t.emit("contactStatusMessageChanged",{contact:e.attributes,message:e.get("status")})},showStatusMessage:function(t){return t=t||this.model.get("status"),"string"==typeof t&&this.$el.find("p.user-custom-message").text(t).attr("title",t),this},close:function(e){return e&&e.preventDefault&&e.preventDefault(),t.connection.connected&&(this.model.set("chat_state",t.INACTIVE),this.sendChatState(),this.model.destroy()),this.remove(),t.emit("chatBoxClosed",this),this},getToolbarOptions:function(e){return d.extend(e||{},{label_clear:f("Clear all messages"),label_insert_smiley:f("Insert a smiley"),label_start_call:f("Start a call"),show_call_button:t.visible_toolbar_buttons.call,show_clear_button:t.visible_toolbar_buttons.clear,show_emoticons:t.visible_toolbar_buttons.emoticons})},renderToolbar:function(e,n){if(t.show_toolbar)return e=e||t.templates.toolbar,n=d.extend(this.model.toJSON(),this.getToolbarOptions(n||{})),this.$el.find(".chat-toolbar").html(e(n)),this},renderAvatar:function(){if(this.model.get("image")){var e=t.chatview_avatar_width,n=t.chatview_avatar_height,i="data:"+this.model.get("image_type")+";base64,"+this.model.get("image"),s=c(t.templates.avatar({width:e,height:n})).get(0);if(!s.getContext||!s.getContext("2d"))return this;var r=s.getContext("2d"),o=new Image;return o.onload=function(){var t=o.width/o.height;t<1?r.drawImage(o,0,0,e,n*(1/t)):r.drawImage(o,0,0,e,n*t)},o.src=i,this.$el.find(".chat-title").before(s),this}},focus:function(){return this.$el.find(".chat-textarea").focus(),t.emit("chatBoxFocused",this),this},hide:function(){return this.$el.hide(),l.refreshWebkit(),this},afterShown:function(){t.connection.connected&&this.model.save(),this.setChatState(t.ACTIVE),this.scrollDown(),focus&&this.focus()},_show:function(t){return this.$el.is(":visible")&&"1"===this.$el.css("opacity")?void(t&&this.focus()):void this.$el.fadeIn(this.afterShown.bind(this))},show:function(t){return"undefined"==typeof this.debouncedShow&&(this.debouncedShow=d.debounce(this._show,250,!0)),this.debouncedShow.apply(this,arguments),this},markScrolled:d.debounce(function(t){t&&t.preventDefault&&t.preventDefault();var e=this.$content.scrollTop()+this.$content.innerHeight()>=this.$content[0].scrollHeight-10;e?(this.model.set("scrolled",!1),this.$el.find(".new-msgs-indicator").addClass("hidden")):this.model.set("scrolled",!0)},150),viewUnreadMessages:function(){this.model.set("scrolled",!1),this.scrollDown()},scrollDownMessageHeight:function(t){return this.$content.is(":visible")&&!this.model.get("scrolled")&&this.$content.scrollTop(this.$content.scrollTop()+t[0].scrollHeight),this},scrollDown:function(){return this.$content.is(":visible")&&!this.model.get("scrolled")&&(this.$content.scrollTop(this.$content[0].scrollHeight),this.$el.find(".new-msgs-indicator").addClass("hidden")),this}})}})}),define("tpl!add_contact_dropdown",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dl class="add-converse-contact dropdown">\n    <dt id="xmpp-contact-search" class="fancy-dropdown">\n        <a class="toggle-xmpp-contact-form icon-plus" href="#" title="'+(null==(__t=label_click_to_chat)?"":__t)+'"> '+(null==(__t=label_add_contact)?"":__t)+'</a>\n    </dt>\n    <dd class="search-xmpp"><ul></ul></dd>\n</dl>\n';return __p}}),define("tpl!add_contact_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <form class="pure-form add-xmpp-contact">\n        <input type="text"\n            name="identifier"\n            class="username"\n            placeholder="'+(null==(__t=label_contact_username)?"":__t)+'"/>\n        <button class="pure-button button-primary" type="submit">'+(null==(__t=label_add)?"":__t)+"</button>\n    </form>\n</li>\n";return __p}}),define("tpl!change_status_message",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form id="set-custom-xmpp-status" class="pure-form">\n<fieldset>\n    <span class="input-button-group">\n        <input type="text" class="custom-xmpp-status" '+(null==(__t=status_message)?"":__t)+' placeholder="'+(null==(__t=label_custom_status)?"":__t)+'"/>\n        <input type="submit" class="pure-button button-primary" value="'+(null==(__t=label_save)?"":__t)+'"/>\n    </span>\n</fieldset>\n</form>\n';return __p}}),define("tpl!chat_status",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="xmpp-status">\n    <a class="choose-xmpp-status '+(null==(__t=chat_status)?"":__t)+" icon-"+(null==(__t=chat_status)?"":__t)+'" data-value="'+(null==(__t=status_message)?"":__t)+'" href="#" title="'+(null==(__t=desc_change_status)?"":__t)+'">\n        '+(null==(__t=status_message)?"":__t)+'\n    </a>\n    <a class="change-xmpp-status-message icon-pencil" href="#" title="'+(null==(__t=desc_custom_status)?"":__t)+'"></a>\n</div>\n';return __p}}),define("tpl!choose_status",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dl id="target" class="dropdown">\n    <dt id="fancy-xmpp-status-select" class="fancy-dropdown"></dt>\n    <dd><ul class="xmpp-status-menu"></ul></dd>\n</dl>\n';return __p}}),define("tpl!contacts_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form set-xmpp-status" action="" method="post">\n    <span id="xmpp-status-holder">\n        <select id="select-xmpp-status" style="display:none">\n            <option value="online">'+(null==(__t=label_online)?"":__t)+'</option>\n            <option value="dnd">'+(null==(__t=label_busy)?"":__t)+'</option>\n            <option value="away">'+(null==(__t=label_away)?"":__t)+"</option>\n            ",include_offline_state&&(__p+='\n            <option value="offline">'+(null==(__t=label_offline)?"":__t)+"</option>\n            "),__p+="\n            ",allow_logout&&(__p+='\n            <option value="logout">'+(null==(__t=label_logout)?"":__t)+"</option>\n            "),__p+="\n        </select>\n    </span>\n</form>\n";return __p}}),define("tpl!contacts_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="s ',is_current&&(__p+=" current "),__p+='"\n       data-id="users" href="#users">\n    '+(null==(__t=label_contacts)?"":__t)+"\n</a></li>\n";return __p}}),define("tpl!controlbox",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head controlbox-head">\n        <ul id="controlbox-tabs"></ul>\n        ',sticky_controlbox||(__p+='\n            <a class="chatbox-btn close-chatbox-button icon-close"></a>\n        '),__p+='\n    </div>\n    <div class="controlbox-panes"></div>\n</div>\n';return __p}}),define("tpl!controlbox_toggle",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="conn-feedback">'+(null==(__t=label_toggle)?"":__t)+"</span>\n";return __p}}),define("tpl!login_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form pure-form-stacked converse-form" id="converse-login" method="post">\n    ',auto_login&&(__p+='\n        <span class="spinner login-submit"/>\n    '),__p+="\n    ",auto_login||(__p+="\n        ",authentication!=LOGIN&&authentication!=EXTERNAL||(__p+="\n            <label>"+(null==(__t=label_username)?"":__t)+'</label>\n            <input type="text" name="jid" placeholder="'+(null==(__t=placeholder_username)?"":__t)+'">\n            ',authentication!==EXTERNAL&&(__p+="\n                <label>"+(null==(__t=label_password)?"":__t)+'</label>\n                <input type="password" name="password" placeholder="'+(null==(__t=placeholder_password)?"":__t)+'">\n            '),__p+='\n            <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_login)?"":__t)+'">\n            <span class="conn-feedback"></span>\n        '),__p+="\n        ",authentication==ANONYMOUS&&(__p+='\n            <input type="pure-button button-primary" class="submit login-anon" value="'+(null==(__t=label_anon_login)?"":__t)+'"/>\n        '),__p+="\n        ",authentication==PREBIND&&(__p+="\n            <p>Disconnected.</p>\n        "),__p+="\n    "),__p+="\n</form>\n";return __p}}),define("tpl!login_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="current" href="#login-dialog">'+(null==(__t=label_sign_in)?"":__t)+"</a></li>\n";return __p}}),define("tpl!search_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <form class="search-xmpp-contact">\n        <input type="text"\n            name="identifier"\n            class="username"\n            placeholder="'+(null==(__t=label_contact_name)?"":__t)+'"/>\n        <button type="submit">'+(null==(__t=label_search)?"":__t)+"</button>\n    </form>\n</li>\n";return __p}}),define("tpl!status_option",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <a href="#" class="'+(null==(__t=value)?"":__t)+'" data-value="'+(null==(__t=value)?"":__t)+'">\n        <span class="icon-'+(null==(__t=value)?"":__t)+'"></span>\n        '+(null==(__t=text)?"":__t)+"\n    </a>\n</li>\n";return __p}}),define("tpl!group_header",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="#" class="group-toggle icon-'+(null==(__t=toggle_state)?"":__t)+'" title="'+(null==(__t=desc_group_toggle)?"":__t)+'">'+(null==(__t=label_group)?"":__t)+"</a>\n";return __p}}),define("tpl!pending_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_chat_pending_contacts&&(__p+='\n<a class="open-chat"href="#">\n'),__p+='\n<span class="pending-contact-name" title="Name: '+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+'">'+(null==(__t=fullname)?"":__t)+"</span> \n",allow_chat_pending_contacts&&(__p+="\n</a>\n"),__p+='\n<a class="remove-xmpp-contact icon-remove" title="'+(null==(__t=desc_remove)?"":__t)+'" href="#"></a>\n';return __p}}),define("tpl!requesting_contact",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_chat_pending_contacts&&(__p+='\n<a class="open-chat"href="#">\n'),__p+='\n<span class="req-contact-name" title="Name: '+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+'">'+(null==(__t=fullname)?"":__t)+"</span>\n",allow_chat_pending_contacts&&(__p+="\n</a>\n"),__p+='\n<span class="request-actions">\n    <a class="accept-xmpp-request icon-checkmark" title="'+(null==(__t=desc_accept)?"":__t)+'" href="#"></a>\n    <a class="decline-xmpp-request icon-close" title="'+(null==(__t=desc_decline)?"":__t)+'" href="#"></a>\n</span>\n';return __p}}),define("tpl!roster",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form roster-filter-group input-button-group">\n    <input value="'+(null==(__t=filter_text)?"":__t)+'" class="roster-filter"\n           placeholder="'+(null==(__t=placeholder)?"":__t)+'"\n           ',"state"===filter_type&&(__p+='  style="display: none" '),__p+=' >\n    <select class="state-type" ',"state"!==filter_type&&(__p+='  style="display: none" '),__p+=' >\n        <option value="">'+(null==(__t=label_any)?"":__t)+"</option>\n        <option ","online"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="online">'+(null==(__t=label_online)?"":__t)+"</option>\n        <option ","chat"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="chat">'+(null==(__t=label_chatty)?"":__t)+"</option>\n        <option ","dnd"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="dnd">'+(null==(__t=label_busy)?"":__t)+"</option>\n        <option ","away"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="away">'+(null==(__t=label_away)?"":__t)+"</option>\n        <option ","xa"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="xa">'+(null==(__t=label_xa)?"":__t)+"</option>\n        <option ","offline"===chat_state&&(__p+=' selected="selected" '),__p+='\n            value="offline">'+(null==(__t=label_offline)?"":__t)+'</option>\n    </select>\n    <select class="filter-type">\n        <option ',"contacts"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="contacts">'+(null==(__t=label_contacts)?"":__t)+"</option>\n        <option ","groups"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="groups">'+(null==(__t=label_groups)?"":__t)+"</option>\n        <option ","state"===filter_type&&(__p+=' selected="selected" '),__p+='\n                value="state">'+(null==(__t=label_state)?"":__t)+"</option>\n    </select>\n</form>\n";return __p}}),define("tpl!roster_item",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="open-chat" title="'+(null==(__t=title_fullname)?"":__t)+": "+(null==(__t=fullname)?"":__t)+"\nJID: "+(null==(__t=jid)?"":__t)+"\n"+(null==(__t=desc_chat)?"":__t)+'" href="#"><span class="icon-'+(null==(__t=chat_status)?"":__t)+'" title="'+(null==(__t=desc_status)?"":__t)+'"></span>'+(null==(__t=fullname)?"":__t)+"</a>\n",allow_contact_removal&&(__p+='\n<a class="remove-xmpp-contact icon-remove" title="'+(null==(__t=desc_remove)?"":__t)+'" href="#"></a>\n'),__p+="\n";return __p}}),function(t,e){define("converse-rosterview",["converse-core","converse-api","tpl!group_header","tpl!pending_contact","tpl!requesting_contact","tpl!roster","tpl!roster_item"],e)}(this,function(t,e,n,i,s,r,o){"use strict";t.templates.group_header=n,t.templates.pending_contact=i,t.templates.requesting_contact=s,t.templates.roster=r,t.templates.roster_item=o;var a=e.env.jQuery,c=e.env.utils,l=e.env.Strophe,u=e.env.$iq,h=e.env.b64_sha1,d=e.env._,f=c.__.bind(t);e.plugins.add("rosterview",{overrides:{afterReconnected:function(){this.rosterview.registerRosterXHandler(),this.__super__.afterReconnected.apply(this,arguments)},RosterGroups:{comparator:function(){return t.RosterGroupsComparator.apply(this,arguments)}}},initialize:function(){this.updateSettings({allow_chat_pending_contacts:!1,allow_contact_removal:!0,show_toolbar:!0});var e={dnd:f("This contact is busy"),online:f("This contact is online"),offline:f("This contact is offline"),unavailable:f("This contact is unavailable"),xa:f("This contact is away for an extended period"),away:f("This contact is away")},n=f("Contacts"),i=f("Groups"),s=f("My contacts"),r=f("Pending contacts"),o=f("Contact requests"),p=f("Ungrouped"),_={};_[o]=0,_[s]=1,_[p]=2,_[r]=3,t.RosterGroupsComparator=function(t,e){t=t.get("name"),e=e.get("name");var n=d.keys(_),i=d.contains(n,t),s=d.contains(n,e);return i||s?i&&s?_[t]<_[e]?-1:_[t]>_[e]?1:0:!i&&s?e===o?1:-1:i&&!s?t===o?-1:1:void 0:t.toLowerCase()<e.toLowerCase()?-1:t.toLowerCase()>e.toLowerCase()?1:0},t.RosterFilter=Backbone.Model.extend({initialize:function(){this.set({filter_text:"",filter_type:"contacts",chat_state:""
})}}),t.RosterFilterView=Backbone.View.extend({tagName:"span",events:{"keydown .roster-filter":"liveFilter","click .onX":"clearFilter","mousemove .x":"toggleX","change .filter-type":"changeTypeFilter","change .state-type":"changeChatStateFilter"},initialize:function(){this.model.on("change",this.render,this)},render:function(){this.$el.html(t.templates.roster(d.extend(this.model.toJSON(),{placeholder:f("Filter"),label_contacts:n,label_groups:i,label_state:f("State"),label_any:f("Any"),label_online:f("Online"),label_chatty:f("Chatty"),label_busy:f("Busy"),label_away:f("Away"),label_xa:f("Extended Away"),label_offline:f("Offline")})));var e=this.$(".roster-filter");return e[this.tog(e.val())]("x"),this.$el},tog:function(t){return t?"addClass":"removeClass"},toggleX:function(t){t&&t.preventDefault&&t.preventDefault();var e=t.target;a(e)[this.tog(e.offsetWidth-18<t.clientX-e.getBoundingClientRect().left)]("onX")},changeChatStateFilter:function(t){t&&t.preventDefault&&t.preventDefault(),this.model.save({chat_state:this.$(".state-type").val()})},changeTypeFilter:function(t){t&&t.preventDefault&&t.preventDefault();var e=t.target.value;"state"===e?this.model.save({filter_type:e,chat_state:this.$(".state-type").val()}):this.model.save({filter_type:e,filter_text:this.$(".roster-filter").val()})},liveFilter:d.debounce(function(t){t&&t.preventDefault&&t.preventDefault(),this.model.save({filter_type:this.$(".filter-type").val(),filter_text:this.$(".roster-filter").val()})},250),isActive:function(){return!("state"!==this.model.get("filter_type")&&!this.model.get("filter_text"))},show:function(){return this.$el.is(":visible")?this:(this.$el.show(),this)},hide:function(){if(!this.$el.is(":visible"))return this;if(!(this.$(".roster-filter").val().length>0))return this.model.save({filter_text:"",chat_state:""}),this.$el.hide(),this},clearFilter:function(t){t&&t.preventDefault&&(t.preventDefault(),a(t.target).removeClass("x onX").val("")),this.model.save({filter_text:""})}}),t.RosterView=Backbone.Overview.extend({tagName:"div",id:"converse-roster",initialize:function(){this.roster_handler_ref=this.registerRosterHandler(),this.rosterx_handler_ref=this.registerRosterXHandler(),t.roster.on("add",this.onContactAdd,this),t.roster.on("change",this.onContactChange,this),t.roster.on("destroy",this.update,this),t.roster.on("remove",this.update,this),this.model.on("add",this.onGroupAdd,this),this.model.on("reset",this.reset,this),t.on("rosterGroupsFetched",this.positionFetchedGroups,this),t.on("rosterContactsFetched",this.update,this),this.createRosterFilter()},render:function(){return this.$roster=a('<dl class="roster-contacts" style="display: none;"></dl>'),this.$el.html(this.filter_view.render()),t.allow_contact_requests||this.$el.addClass("no-contact-requests"),this},createRosterFilter:function(){var e=new t.RosterFilter;e.id=h("converse.rosterfilter"+t.bare_jid),e.browserStorage=new Backbone.BrowserStorage.local(this.filter.id),this.filter_view=new t.RosterFilterView({model:e}),this.filter_view.model.on("change",this.updateFilter,this),this.filter_view.model.fetch()},updateFilter:d.debounce(function(){var t=this.filter_view.model.get("filter_type");"state"===t?this.filter(this.filter_view.model.get("chat_state"),t):this.filter(this.filter_view.model.get("filter_text"),t)},100),unregisterHandlers:function(){t.connection.deleteHandler(this.roster_handler_ref),delete this.roster_handler_ref,t.connection.deleteHandler(this.rosterx_handler_ref),delete this.rosterx_handler_ref},update:d.debounce(function(){return 0===this.$roster.parent().length&&this.$el.append(this.$roster.show()),this.showHideFilter()},t.animate?100:0),showHideFilter:function(){if(this.$el.is(":visible"))return this.$roster.hasScrollBar()?this.filter_view.show():this.filter_view.isActive()||this.filter_view.hide(),this},filter:function(t,e){d.each(this.getAll(),function(t){t.model.contacts.length>0&&t.show().filter("")}),t=t.toLowerCase(),"groups"===e?d.each(this.getAll(),function(e,n){e.model.get("name").toLowerCase().indexOf(t.toLowerCase())===-1?e.hide():e.model.contacts.length>0&&e.show()}):d.each(this.getAll(),function(n){n.filter(t,e)})},reset:function(){return t.roster.reset(),this.removeAll(),this.$roster=a('<dl class="roster-contacts" style="display: none;"></dl>'),this.render().update(),this},registerRosterHandler:function(){t.connection.addHandler(t.roster.onRosterPush.bind(t.roster),l.NS.ROSTER,"iq","set")},registerRosterXHandler:function(){var e=0;t.connection.addHandler(function(n){return window.setTimeout(function(){t.connection.flush(),t.roster.subscribeToSuggestedItems.bind(t.roster)(n)},e),e+=250*a(n).find("item").length,!0},l.NS.ROSTERX,"message",null)},onGroupAdd:function(e){var n=new t.RosterGroupView({model:e});this.add(e.get("name"),n.render()),this.positionGroup(n)},onContactAdd:function(t){this.addRosterContact(t).update(),this.updateFilter()},onContactChange:function(t){this.updateChatBox(t).update(),d.has(t.changed,"subscription")&&("from"===t.changed.subscription?this.addContactToGroup(t,r):d.contains(["both","to"],t.get("subscription"))&&this.addExistingContact(t)),d.has(t.changed,"ask")&&"subscribe"===t.changed.ask&&this.addContactToGroup(t,r),d.has(t.changed,"subscription")&&"true"===t.changed.requesting&&this.addContactToGroup(t,o),this.updateFilter()},updateChatBox:function(e){var n=t.chatboxes.get(e.get("jid")),i={};return n?(d.has(e.changed,"chat_status")&&(i.chat_status=e.get("chat_status")),d.has(e.changed,"status")&&(i.status=e.get("status")),n.save(i),this):this},positionFetchedGroups:function(e,n,i){this.model.sort(),this.model.each(function(e,n){var i=this.get(e.get("name"));i||(i=new t.RosterGroupView({model:e}),this.add(e.get("name"),i.render())),0===n?this.$roster.append(i.$el):this.appendGroup(i)}.bind(this))},positionGroup:function(t){var e=this.$roster.find(".roster-group"),n=e.length?this.model.indexOf(t.model):0;return 0===n?this.$roster.prepend(t.$el):n===this.model.length-1?this.appendGroup(t):a(e.eq(n)).before(t.$el),this},appendGroup:function(t){var e=this.$roster.find(".roster-group").last(),n=e.siblings("dd");return n.length>0?n.last().after(t.$el):e.after(t.$el),this},getGroup:function(t){var e=this.get(t);return e?e.model:this.model.create({name:t,id:h(t)})},addContactToGroup:function(t,e){this.getGroup(e).contacts.add(t)},addExistingContact:function(e){var n;t.roster_groups?(n=e.get("groups"),0===n.length&&(n=[p])):n=[s],d.each(n,d.bind(this.addContactToGroup,this,e))},addRosterContact:function(t){return"both"===t.get("subscription")||"to"===t.get("subscription")?this.addExistingContact(t):"subscribe"===t.get("ask")||"from"===t.get("subscription")?this.addContactToGroup(t,r):t.get("requesting")===!0&&this.addContactToGroup(t,o),this}}),t.RosterContactView=Backbone.View.extend({tagName:"dd",events:{"click .accept-xmpp-request":"acceptRequest","click .decline-xmpp-request":"declineRequest","click .open-chat":"openChat","click .remove-xmpp-contact":"removeContact"},initialize:function(){this.model.on("change",this.render,this),this.model.on("remove",this.remove,this),this.model.on("destroy",this.remove,this),this.model.on("open",this.openChat,this)},render:function(){if(!this.mayBeShown())return this.$el.hide(),this;var n=this.model,i=n.get("ask"),s=n.get("chat_status"),r=n.get("requesting"),o=n.get("subscription"),a=["current-xmpp-contact","pending-xmpp-contact","requesting-xmpp-contact"].concat(d.keys(e));return d.each(a,function(t){this.el.className.indexOf(t)!==-1&&this.$el.removeClass(t)},this),this.$el.addClass(s).data("status",s),"subscribe"===i||"from"===o?(this.$el.addClass("pending-xmpp-contact"),this.$el.html(t.templates.pending_contact(d.extend(n.toJSON(),{desc_remove:f("Click to remove this contact"),allow_chat_pending_contacts:t.allow_chat_pending_contacts})))):r===!0?(this.$el.addClass("requesting-xmpp-contact"),this.$el.html(t.templates.requesting_contact(d.extend(n.toJSON(),{desc_accept:f("Click to accept this contact request"),desc_decline:f("Click to decline this contact request"),allow_chat_pending_contacts:t.allow_chat_pending_contacts}))),t.controlboxtoggle.showControlBox()):"both"!==o&&"to"!==o||(this.$el.addClass("current-xmpp-contact"),this.$el.removeClass(d.without(["both","to"],o)[0]).addClass(o),this.$el.html(t.templates.roster_item(d.extend(n.toJSON(),{desc_status:e[s||"offline"],desc_chat:f("Click to chat with this contact"),desc_remove:f("Click to remove this contact"),title_fullname:f("Name"),allow_contact_removal:t.allow_contact_removal})))),this},isGroupCollapsed:function(){var e=this.$el.prevAll("dt:first").data("group"),n=t.rosterview.model.where({name:e})[0];return n.get("state")===t.CLOSED},mayBeShown:function(){var e=this.model.get("chat_status");return!(t.show_only_online_users&&"online"!==e||t.hide_offline_users&&"offline"===e)||("subscribe"===this.model.get("ask")||"from"===this.model.get("subscription")||this.model.get("requesting")===!0)},openChat:function(e){return e&&e.preventDefault&&e.preventDefault(),t.chatboxviews.showChat(this.model.attributes)},removeContact:function(e){if(e&&e.preventDefault&&e.preventDefault(),t.allow_contact_removal){var n=confirm(f("Are you sure you want to remove this contact?"));if(n===!0){var i=u({type:"set"}).c("query",{xmlns:l.NS.ROSTER}).c("item",{jid:this.model.get("jid"),subscription:"remove"});t.connection.sendIQ(i,function(t){this.model.destroy(),this.remove()}.bind(this),function(e){alert(f("Sorry, there was an error while trying to remove "+name+" as a contact.")),t.log(e)})}}},acceptRequest:function(e){e&&e.preventDefault&&e.preventDefault(),t.roster.sendContactAddIQ(this.model.get("jid"),this.model.get("fullname"),[],function(){this.model.authorize().subscribe()}.bind(this))},declineRequest:function(t){t&&t.preventDefault&&t.preventDefault();var e=confirm(f("Are you sure you want to decline this contact request?"));return e===!0&&this.model.unauthorize().destroy(),this}}),t.RosterGroupView=Backbone.Overview.extend({tagName:"dt",className:"roster-group",events:{"click a.group-toggle":"toggle"},initialize:function(){this.model.contacts.on("add",this.addContact,this),this.model.contacts.on("change:subscription",this.onContactSubscriptionChange,this),this.model.contacts.on("change:requesting",this.onContactRequestChange,this),this.model.contacts.on("change:chat_status",function(t){this.model.contacts.sort(),this.positionContact(t).render()},this),this.model.contacts.on("destroy",this.onRemove,this),this.model.contacts.on("remove",this.onRemove,this),t.roster.on("change:groups",this.onContactGroupChange,this)},render:function(){return this.$el.attr("data-group",this.model.get("name")),this.$el.html(a(t.templates.group_header({label_group:this.model.get("name"),desc_group_toggle:this.model.get("description"),toggle_state:this.model.get("state")}))),this},addContact:function(e){var n=new t.RosterContactView({model:e});this.add(e.get("id"),n),n=this.positionContact(e).render(),n.mayBeShown()&&(this.model.get("state")===t.CLOSED?("none"!==n.$el[0].style.display&&n.$el.hide(),this.$el.is(":visible")||this.$el.show()):"block"!==this.$el[0].style.display&&this.show())},positionContact:function(t){var e=this.get(t.get("id")),n=this.model.contacts.indexOf(t);return e.$el.detach(),0===n?this.$el.after(e.$el):n===this.model.contacts.length-1?this.$el.nextUntil("dt").last().after(e.$el):this.$el.nextUntil("dt").eq(n).before(e.$el),e},show:function(){return this.$el.show(),d.each(this.getAll(),function(t){t.mayBeShown()&&!t.isGroupCollapsed()&&t.$el.show()}),this},hide:function(){this.$el.nextUntil("dt").addBack().hide()},filter:function(e,n){var i;0===e.length?(this.model.get("state")===t.OPENED&&this.model.contacts.each(function(t){var e=this.get(t.get("id"));e.mayBeShown()&&!e.isGroupCollapsed()&&e.$el.show()}.bind(this)),this.showIfNecessary()):(e=e.toLowerCase(),i="state"===n?this.model.get("name")===o?this.model.contacts.filter(function(t){return c.contains.not("chat_status",e)(t)&&!t.get("requesting")}):this.model.contacts.filter(c.contains.not("chat_status",e)):this.model.contacts.filter(c.contains.not("fullname",e)),i.length===this.model.contacts.length?this.hide():(d.each(i,function(t){this.get(t.get("id")).$el.hide()}.bind(this)),d.each(this.model.contacts.reject(c.contains.not("fullname",e)),function(t){this.get(t.get("id")).$el.show()}.bind(this)),this.showIfNecessary()))},showIfNecessary:function(){!this.$el.is(":visible")&&this.model.contacts.length>0&&this.$el.show()},toggle:function(e){e&&e.preventDefault&&e.preventDefault();var n=a(e.target);n.hasClass("icon-opened")?(this.$el.nextUntil("dt").slideUp(),this.model.save({state:t.CLOSED}),n.removeClass("icon-opened").addClass("icon-closed")):(n.removeClass("icon-closed").addClass("icon-opened"),this.model.save({state:t.OPENED}),this.filter(t.rosterview.$(".roster-filter").val()||"",t.rosterview.$(".filter-type").val()))},onContactGroupChange:function(t){var e=d.contains(t.get("groups"),this.model.get("name")),n=t.get("id"),i=!this.get(n);e&&!i?this.model.contacts.remove(n):!e&&i&&this.addContact(t)},onContactSubscriptionChange:function(t){this.model.get("name")===r&&"from"!==t.get("subscription")&&this.model.contacts.remove(t.get("id"))},onContactRequestChange:function(t){this.model.get("name")!==o||t.get("requesting")||(this.model.contacts.remove(t.get("id"),{silent:!0}),this.get(t.get("id")).remove(),this.onRemove(t))},onRemove:function(t){this.remove(t.get("id")),0===this.model.contacts.length&&this.$el.hide()}});var m=function(){t.rosterview=new t.RosterView({model:t.rostergroups}),t.rosterview.render()};t.on("rosterInitialized",m),t.on("rosterReadyAfterReconnection",m)}})}),function(t,e){define("converse-controlbox",["converse-core","converse-api","tpl!add_contact_dropdown","tpl!add_contact_form","tpl!change_status_message","tpl!chat_status","tpl!choose_status","tpl!contacts_panel","tpl!contacts_tab","tpl!controlbox","tpl!controlbox_toggle","tpl!login_panel","tpl!login_tab","tpl!search_contact","tpl!status_option","converse-chatview","converse-rosterview"],e)}(this,function(t,e,n,i,s,r,o,a,c,l,u,h,d,f,p){"use strict";t.templates.add_contact_dropdown=n,t.templates.add_contact_form=i,t.templates.change_status_message=s,t.templates.chat_status=r,t.templates.choose_status=o,t.templates.contacts_panel=a,t.templates.contacts_tab=c,t.templates.controlbox=l,t.templates.controlbox_toggle=u,t.templates.login_panel=h,t.templates.login_tab=d,t.templates.search_contact=f,t.templates.status_option=p;var _="users",m=e.env.Strophe,g=e.env.utils,v=e.env.jQuery,y=e.env._,b=g.__.bind(t),w=e.env.moment;e.plugins.add("converse-controlbox",{overrides:{initSession:function(){this.controlboxtoggle=new this.ControlBoxToggle,this.__super__.initSession.apply(this,arguments)},initConnection:function(){this.__super__.initConnection.apply(this,arguments),this.connection&&this.addControlBox()},onDisconnected:function(){var e=this.__super__.onDisconnected.apply(this,arguments),n=t.chatboxviews.get("controlbox");return n.model.set({connected:!1}),"disconnected"===e&&(n.$("#controlbox-tabs").empty(),n.renderLoginPanel()),e},afterReconnected:function(){this.__super__.afterReconnected.apply(this,arguments);var e=t.chatboxviews.get("controlbox");e.model.get("connected")?t.chatboxviews.get("controlbox").onConnected():e.model.set({connected:!0})},_tearDown:function(){this.__super__._tearDown.apply(this,arguments),this.rosterview&&(this.rosterview.unregisterHandlers(),this.rosterview.model.off().reset(),this.rosterview.each(function(t){t.removeAll(),t.remove()}),this.rosterview.removeAll().remove())},clearSession:function(){this.__super__.clearSession.apply(this,arguments),y.isUndefined(this.connection)&&this.connection.connected&&this.chatboxes.get("controlbox").save({connected:!1})},ChatBoxes:{chatBoxMayBeShown:function(t){return this.__super__.chatBoxMayBeShown.apply(this,arguments)&&"controlbox"!==t.get("id")},onChatBoxesFetched:function(t,e){this.__super__.onChatBoxesFetched.apply(this,arguments),y.include(y.pluck(e,"id"),"controlbox")||this.add({id:"controlbox",box_id:"controlbox"}),this.get("controlbox").save({connected:!0})}},ChatBoxViews:{onChatBoxAdded:function(e){if("controlbox"===e.get("box_id")){var n=this.get(e.get("id"));return n?(n.model=e,n.initialize(),n):(n=new t.ControlBoxView({model:e}),this.add(e.get("id"),n))}return this.__super__.onChatBoxAdded.apply(this,arguments)},closeAllChatBoxes:function(){return this.each(function(e){t.connection.connected&&"controlbox"===e.model.get("id")||e.close()}),this},getChatBoxWidth:function(e){var n=this.get("controlbox");return"controlbox"===e.model.get("id")?n&&n.$el.is(":visible")?n.$el.outerWidth(!0):t.controlboxtoggle.$el.outerWidth(!0):this.__super__.getChatBoxWidth.apply(this,arguments)}},ChatBox:{initialize:function(){"controlbox"===this.get("id")?this.set({time_opened:w(0).valueOf(),num_unread:0}):this.__super__.initialize.apply(this,arguments)}},ChatBoxView:{insertIntoDOM:function(){return this.$el.insertAfter(t.chatboxviews.get("controlbox").$el),this}}},initialize:function(){var t=this.converse;this.updateSettings({allow_logout:!0,default_domain:void 0,show_controlbox_by_default:!1,sticky_controlbox:!1,xhr_user_search:!1,xhr_user_search_url:""});var e=b("Contacts");t.addControlBox=function(){return t.chatboxes.add({id:"controlbox",box_id:"controlbox",closed:!t.show_controlbox_by_default})},t.ControlBoxView=t.ChatBoxView.extend({tagName:"div",className:"chatbox",id:"controlbox",events:{"click a.close-chatbox-button":"close","click ul#controlbox-tabs li a":"switchTab"},initialize:function(){this.$el.insertAfter(t.controlboxtoggle.$el),this.model.on("change:connected",this.onConnected,this),this.model.on("destroy",this.hide,this),this.model.on("hide",this.hide,this),this.model.on("show",this.show,this),this.model.on("change:closed",this.ensureClosedState,this),this.render(),this.model.get("connected")&&this.insertRoster(),"undefined"==typeof this.model.get("closed")&&this.model.set("closed",!t.show_controlbox_by_default),this.model.get("closed")?this.hide():this.show()},render:function(){return this.$el.html(t.templates.controlbox(y.extend(this.model.toJSON(),{sticky_controlbox:t.sticky_controlbox}))),t.connection.connected&&t.connection.authenticated&&!t.connection.disconnecting?this.contactspanel&&this.contactspanel.$el.is(":visible")||this.renderContactsPanel():this.renderLoginPanel(),this},giveFeedback:function(t,e){var n=this.$(".conn-feedback");n.addClass("conn-feedback").text(t),e&&n.addClass(e)},onConnected:function(){this.model.get("connected")&&this.render().insertRoster()},insertRoster:function(){return this.contactspanel.$el.append(t.rosterview.$el),this},renderLoginPanel:function(){var e=this.$(".conn-feedback");return this.loginpanel=new t.LoginPanel({$parent:this.$el.find(".controlbox-panes"),model:this}),this.loginpanel.render(),e.length&&e.text()!==b("Connecting")&&this.$(".conn-feedback").replaceWith(e),this},renderContactsPanel:function(){y.isUndefined(this.model.get("active-panel"))&&this.model.save({"active-panel":_}),this.contactspanel=new t.ContactsPanel({$parent:this.$el.find(".controlbox-panes")}),this.contactspanel.render(),t.xmppstatusview=new t.XMPPStatusView({model:t.xmppstatus}),t.xmppstatusview.render()},close:function(e){return e&&e.preventDefault&&e.preventDefault(),t.connection.connected?this.model.save({closed:!0}):this.model.trigger("hide"),t.emit("controlBoxClosed",this),this},ensureClosedState:function(){this.model.get("closed")?this.hide():this.show()},hide:function(e){return this.$el.hide("fast",function(){g.refreshWebkit(),t.emit("chatBoxClosed",this),t.connection.connected||t.controlboxtoggle.render(),t.controlboxtoggle.show(function(){"function"==typeof e&&e()})}),this},onControlBoxToggleHidden:function(){var e=this;this.$el.show("fast",function(){t.controlboxtoggle.updateOnlineCount(),g.refreshWebkit(),t.emit("controlBoxOpened",e)})},show:function(){return t.controlboxtoggle.hide(this.onControlBoxToggleHidden.bind(this)),this},switchTab:function(e){e&&e.preventDefault&&e.preventDefault();var n=v(e.target),i=n.parent().siblings("li").children("a"),s=v(n.attr("href"));return v(i.attr("href")).addClass("hidden"),i.removeClass("current"),n.addClass("current"),s.removeClass("hidden"),t.connection.connected&&this.model.save({"active-panel":n.data("id")}),this},showHelpMessages:function(t){}}),t.LoginPanel=Backbone.View.extend({tagName:"div",id:"login-dialog",className:"controlbox-pane",events:{"submit form#converse-login":"authenticate"},initialize:function(e){e.$parent.html(this.$el.html(t.templates.login_panel({ANONYMOUS:t.ANONYMOUS,EXTERNAL:t.EXTERNAL,LOGIN:t.LOGIN,PREBIND:t.PREBIND,auto_login:t.auto_login,authentication:t.authentication,label_username:b("XMPP Username:"),label_password:b("Password:"),label_anon_login:b("Click here to log in anonymously"),label_login:b("Log In"),placeholder_username:(t.locked_domain||t.default_domain)&&b("Username")||b("user@server"),placeholder_password:b("password")}))),this.$tabs=e.$parent.parent().find("#controlbox-tabs")},render:function(){return this.$tabs.append(t.templates.login_tab({label_sign_in:b("Sign in")})),this.$el.find("input#jid").focus(),this.$el.is(":visible")||this.$el.show(),this},authenticate:function(e){e&&e.preventDefault&&e.preventDefault();var n=v(e.target);if(t.authentication===t.ANONYMOUS)return void this.connect(n,t.jid,null);var i=n.find("input[name=jid]"),s=i.val(),r=n.find("input[name=password]"),o=r.val(),a=!1;return s||(a=!0,i.addClass("error")),o||t.authentication===t.EXTERNAL||(a=!0,r.addClass("error")),a?void 0:(t.locked_domain?s=m.escapeNode(s)+"@"+t.locked_domain:t.default_domain&&s.indexOf("@")===-1&&(s=s+"@"+t.default_domain),this.connect(n,s,o),!1)},connect:function(e,n,i){var s;e&&e.find("input[type=submit]").hide().after('<span class="spinner login-submit"/>'),n&&(s=m.getResourceFromJid(n),n=s?m.getBareJidFromJid(n).toLowerCase()+"/"+s:n.toLowerCase()+t.generateResource()),t.connection.connect(n,i,t.onConnectStatusChanged)},remove:function(){this.$tabs.empty(),this.$el.parent().empty()}}),t.XMPPStatusView=Backbone.View.extend({el:"span#xmpp-status-holder",events:{"click a.choose-xmpp-status":"toggleOptions","click #fancy-xmpp-status-select a.change-xmpp-status-message":"renderStatusChangeForm","submit #set-custom-xmpp-status":"setStatusMessage","click .dropdown dd ul li a":"setStatus"},initialize:function(){this.model.on("change:status",this.updateStatusUI,this),this.model.on("change:status_message",this.updateStatusUI,this),this.model.on("update-status-ui",this.updateStatusUI,this)},render:function(){var e,n=this.$el.find("select#select-xmpp-status"),i=this.model.get("status")||"offline",s=v("option",n),r=[];return this.$el.html(t.templates.choose_status()),this.$el.find("#fancy-xmpp-status-select").html(t.templates.chat_status({status_message:this.model.get("status_message")||b("I am %1$s",this.getPrettyStatus(i)),chat_status:i,desc_custom_status:b("Click here to write a custom status message"),desc_change_status:b("Click to change your chat status")})),s.each(function(){r.push(t.templates.status_option({value:v(this).val(),text:this.text}))}),e=this.$el.find("#target dd ul").hide(),e.append(r.join("")),n.remove(),this},toggleOptions:function(t){t.preventDefault(),v(t.target).parent().parent().siblings("dd").find("ul").toggle("fast")},renderStatusChangeForm:function(e){e.preventDefault();var n=this.model.get("status")||"offline",i=t.templates.change_status_message({status_message:n,label_custom_status:b("Custom status"),label_save:b("Save")}),s=this.$el.find(".xmpp-status");s.parent().addClass("no-border"),s.replaceWith(i),this.$el.find(".custom-xmpp-status").focus().focus()},setStatusMessage:function(t){t.preventDefault(),this.model.setStatusMessage(v(t.target).find("input").val())},setStatus:function(e){e.preventDefault();var n=v(e.currentTarget),i=n.attr("data-value");"logout"===i?(this.$el.find(".dropdown dd ul").hide(),t.logOut()):(this.model.setStatus(i),this.$el.find(".dropdown dd ul").hide())},getPrettyStatus:function(t){return"chat"===t?b("online"):"dnd"===t?b("busy"):"xa"===t?b("away for long"):"away"===t?b("away"):"offline"===t?b("offline"):b(t)||b("online")},updateStatusUI:function(e){var n=e.get("status"),i=e.get("status_message")||b("I am %1$s",this.getPrettyStatus(n));this.$el.find("#fancy-xmpp-status-select").removeClass("no-border").html(t.templates.chat_status({chat_status:n,status_message:i,desc_custom_status:b("Click here to write a custom status message"),desc_change_status:b("Click to change your chat status")}))}}),t.ContactsPanel=Backbone.View.extend({tagName:"div",className:"controlbox-pane",id:"users",events:{"click a.toggle-xmpp-contact-form":"toggleContactForm","submit form.add-xmpp-contact":"addContactFromForm","submit form.search-xmpp-contact":"searchContacts","click a.subscribe-to-user":"addContactFromList"},initialize:function(t){t.$parent.append(this.$el),this.$tabs=t.$parent.parent().find("#controlbox-tabs")},render:function(){var n,i=t.templates.contacts_panel({label_online:b("Online"),label_busy:b("Busy"),label_away:b("Away"),label_offline:b("Offline"),label_logout:b("Log out"),include_offline_state:t.include_offline_state,allow_logout:t.allow_logout}),s=t.chatboxes.get("controlbox");return this.$tabs.append(t.templates.contacts_tab({label_contacts:e,is_current:s.get("active-panel")===_})),n=t.xhr_user_search?t.templates.search_contact({label_contact_name:b("Contact name"),label_search:b("Search")}):t.templates.add_contact_form({label_contact_username:b("e.g. user@example.org"),label_add:b("Add")}),t.allow_contact_requests&&(i+=t.templates.add_contact_dropdown({label_click_to_chat:b("Click to add new chat contacts"),label_add_contact:b("Add a contact")})),this.$el.html(i),this.$el.find(".search-xmpp ul").append(n),s.get("active-panel")!==_&&this.$el.addClass("hidden"),this},toggleContactForm:function(t){t.preventDefault(),this.$el.find(".search-xmpp").toggle("fast",function(){v(this).is(":visible")&&v(this).find("input.username").focus()})},searchContacts:function(e){e.preventDefault(),v.getJSON(t.xhr_user_search_url+"?q="+v(e.target).find("input.username").val(),function(t){var e=v(".search-xmpp ul");e.find("li.found-user").remove(),e.find("li.chat-info").remove(),t.length||e.append('<li class="chat-info">'+b("No users found")+"</li>"),v(t).each(function(t,n){e.append(v('<li class="found-user"></li>').append(v('<a class="subscribe-to-user" href="#" title="'+b("Click to add as a chat contact")+'"></a>').attr("data-recipient",m.getNodeFromJid(n.id)+"@"+m.getDomainFromJid(n.id)).text(n.fullname)))})})},addContactFromForm:function(e){e.preventDefault();var n=v(e.target).find("input"),i=n.val();return i?(t.roster.addAndSubscribe(i),void v(".search-xmpp").hide()):void n.addClass("error")},addContactFromList:function(e){e.preventDefault();var n=v(e.target),i=n.attr("data-recipient"),s=n.text();t.roster.addAndSubscribe(i,s),n.parent().remove(),v(".search-xmpp").hide()}}),t.ControlBoxToggle=Backbone.View.extend({tagName:"a",className:"toggle-controlbox",id:"toggle-controlbox",events:{click:"onClick"},attributes:{href:"#"},initialize:function(){v("#conversejs").prepend(this.render()),this.updateOnlineCount(),t.on("initialized",function(){t.roster.on("add",this.updateOnlineCount,this),t.roster.on("change",this.updateOnlineCount,this),t.roster.on("destroy",this.updateOnlineCount,this),t.roster.on("remove",this.updateOnlineCount,this)}.bind(this))},render:function(){return this.$el.html(t.templates.controlbox_toggle({label_toggle:b("Toggle chat")})).hide()},updateOnlineCount:y.debounce(function(){if("undefined"!=typeof t.roster){var e=this.$("#online-count");e.text("("+t.roster.getNumOnlineContacts()+")"),e.is(":visible")||e.show()}},t.animate?100:0),hide:function(t){this.$el.fadeOut("fast",t)},show:function(t){this.$el.show("fast",t)},showControlBox:function(){var e=t.chatboxes.get("controlbox");e||(e=t.addControlBox()),t.connection.connected?e.save({closed:!1}):e.trigger("show")},onClick:function(e){if(e.preventDefault(),v("div#controlbox").is(":visible")){var n=t.chatboxes.get("controlbox");t.connection.connected?n.save({closed:!0}):n.trigger("hide")}else this.showControlBox()}})}})});var CryptoJS=CryptoJS||function(t,e){var n={},i=n.lib={},s=i.Base=function(){function t(){}return{extend:function(e){t.prototype=this;var n=new t;return e&&n.mixIn(e),n.hasOwnProperty("init")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),r=i.WordArray=s.extend({init:function(t,n){t=this.words=t||[],n!=e?this.sigBytes=n:this.sigBytes=4*t.length},toString:function(t){return(t||a).stringify(this)},concat:function(t){var e=this.words,n=t.words,i=this.sigBytes,s=t.sigBytes;if(this.clamp(),i%4)for(var r=0;r<s;r++){var o=n[r>>>2]>>>24-r%4*8&255;e[i+r>>>2]|=o<<24-(i+r)%4*8}else if(n.length>65535)for(var r=0;r<s;r+=4)e[i+r>>>2]=n[r>>>2];else e.push.apply(e,n);return this.sigBytes+=s,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],i=0;i<e;i+=4)n.push(4294967296*t.random()|0);return new r.init(n,e)}}),o=n.enc={},a=o.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],s=0;s<n;s++){var r=e[s>>>2]>>>24-s%4*8&255;i.push((r>>>4).toString(16)),i.push((15&r).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n[i>>>3]|=parseInt(t.substr(i,2),16)<<24-i%8*4;return new r.init(n,e/2)}},c=o.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,i=[],s=0;s<n;s++){var r=e[s>>>2]>>>24-s%4*8&255;i.push(String.fromCharCode(r))}return i.join("")},parse:function(t){for(var e=t.length,n=[],i=0;i<e;i++)n[i>>>2]|=(255&t.charCodeAt(i))<<24-i%4*8;return new r.init(n,e)}},l=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},u=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=l.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,i=n.words,s=n.sigBytes,o=this.blockSize,a=4*o,c=s/a;c=e?t.ceil(c):t.max((0|c)-this._minBufferSize,0);var l=c*o,u=t.min(4*l,s);if(l){for(var h=0;h<l;h+=o)this._doProcessBlock(i,h);var d=i.splice(0,l);n.sigBytes-=u}return new r.init(d,u)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),h=(i.Hasher=u.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new h.HMAC.init(t,n).finalize(e)}}}),n.algo={});return n}(Math);define("crypto.core",function(){}),function(){var t=CryptoJS,e=t.lib,n=e.WordArray,i=t.enc;i.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,i=this._map;t.clamp();for(var s=[],r=0;r<n;r+=3)for(var o=e[r>>>2]>>>24-r%4*8&255,a=e[r+1>>>2]>>>24-(r+1)%4*8&255,c=e[r+2>>>2]>>>24-(r+2)%4*8&255,l=o<<16|a<<8|c,u=0;u<4&&r+.75*u<n;u++)s.push(i.charAt(l>>>6*(3-u)&63));var h=i.charAt(64);if(h)for(;s.length%4;)s.push(h);return s.join("")},parse:function(t){var e=t.length,i=this._map,s=i.charAt(64);if(s){var r=t.indexOf(s);r!=-1&&(e=r)}for(var o=[],a=0,c=0;c<e;c++)if(c%4){
var l=i.indexOf(t.charAt(c-1))<<c%4*2,u=i.indexOf(t.charAt(c))>>>6-c%4*2;o[a>>>2]|=(l|u)<<24-a%4*8,a++}return n.create(o,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),define("crypto.enc-base64",["crypto.core"],function(){}),function(t){function e(t,e,n,i,s,r,o){var a=t+(e&n|~e&i)+s+o;return(a<<r|a>>>32-r)+e}function n(t,e,n,i,s,r,o){var a=t+(e&i|n&~i)+s+o;return(a<<r|a>>>32-r)+e}function i(t,e,n,i,s,r,o){var a=t+(e^n^i)+s+o;return(a<<r|a>>>32-r)+e}function s(t,e,n,i,s,r,o){var a=t+(n^(e|~i))+s+o;return(a<<r|a>>>32-r)+e}var r=CryptoJS,o=r.lib,a=o.WordArray,c=o.Hasher,l=r.algo,u=[];!function(){for(var e=0;e<64;e++)u[e]=4294967296*t.abs(t.sin(e+1))|0}();var h=l.MD5=c.extend({_doReset:function(){this._hash=new a.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,r){for(var o=0;o<16;o++){var a=r+o,c=t[a];t[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var l=this._hash.words,h=t[r+0],d=t[r+1],f=t[r+2],p=t[r+3],_=t[r+4],m=t[r+5],g=t[r+6],v=t[r+7],y=t[r+8],b=t[r+9],w=t[r+10],S=t[r+11],x=t[r+12],M=t[r+13],k=t[r+14],C=t[r+15],T=l[0],A=l[1],E=l[2],D=l[3];T=e(T,A,E,D,h,7,u[0]),D=e(D,T,A,E,d,12,u[1]),E=e(E,D,T,A,f,17,u[2]),A=e(A,E,D,T,p,22,u[3]),T=e(T,A,E,D,_,7,u[4]),D=e(D,T,A,E,m,12,u[5]),E=e(E,D,T,A,g,17,u[6]),A=e(A,E,D,T,v,22,u[7]),T=e(T,A,E,D,y,7,u[8]),D=e(D,T,A,E,b,12,u[9]),E=e(E,D,T,A,w,17,u[10]),A=e(A,E,D,T,S,22,u[11]),T=e(T,A,E,D,x,7,u[12]),D=e(D,T,A,E,M,12,u[13]),E=e(E,D,T,A,k,17,u[14]),A=e(A,E,D,T,C,22,u[15]),T=n(T,A,E,D,d,5,u[16]),D=n(D,T,A,E,g,9,u[17]),E=n(E,D,T,A,S,14,u[18]),A=n(A,E,D,T,h,20,u[19]),T=n(T,A,E,D,m,5,u[20]),D=n(D,T,A,E,w,9,u[21]),E=n(E,D,T,A,C,14,u[22]),A=n(A,E,D,T,_,20,u[23]),T=n(T,A,E,D,b,5,u[24]),D=n(D,T,A,E,k,9,u[25]),E=n(E,D,T,A,p,14,u[26]),A=n(A,E,D,T,y,20,u[27]),T=n(T,A,E,D,M,5,u[28]),D=n(D,T,A,E,f,9,u[29]),E=n(E,D,T,A,v,14,u[30]),A=n(A,E,D,T,x,20,u[31]),T=i(T,A,E,D,m,4,u[32]),D=i(D,T,A,E,y,11,u[33]),E=i(E,D,T,A,S,16,u[34]),A=i(A,E,D,T,k,23,u[35]),T=i(T,A,E,D,d,4,u[36]),D=i(D,T,A,E,_,11,u[37]),E=i(E,D,T,A,v,16,u[38]),A=i(A,E,D,T,w,23,u[39]),T=i(T,A,E,D,M,4,u[40]),D=i(D,T,A,E,h,11,u[41]),E=i(E,D,T,A,p,16,u[42]),A=i(A,E,D,T,g,23,u[43]),T=i(T,A,E,D,b,4,u[44]),D=i(D,T,A,E,x,11,u[45]),E=i(E,D,T,A,C,16,u[46]),A=i(A,E,D,T,f,23,u[47]),T=s(T,A,E,D,h,6,u[48]),D=s(D,T,A,E,v,10,u[49]),E=s(E,D,T,A,k,15,u[50]),A=s(A,E,D,T,m,21,u[51]),T=s(T,A,E,D,x,6,u[52]),D=s(D,T,A,E,p,10,u[53]),E=s(E,D,T,A,w,15,u[54]),A=s(A,E,D,T,d,21,u[55]),T=s(T,A,E,D,y,6,u[56]),D=s(D,T,A,E,C,10,u[57]),E=s(E,D,T,A,g,15,u[58]),A=s(A,E,D,T,M,21,u[59]),T=s(T,A,E,D,_,6,u[60]),D=s(D,T,A,E,S,10,u[61]),E=s(E,D,T,A,f,15,u[62]),A=s(A,E,D,T,b,21,u[63]),l[0]=l[0]+T|0,l[1]=l[1]+A|0,l[2]=l[2]+E|0,l[3]=l[3]+D|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;n[s>>>5]|=128<<24-s%32;var r=t.floor(i/4294967296),o=i;n[(s+64>>>9<<4)+15]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[(s+64>>>9<<4)+14]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,c=a.words,l=0;l<4;l++){var u=c[l];c[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}return a},clone:function(){var t=c.clone.call(this);return t._hash=this._hash.clone(),t}});r.MD5=c._createHelper(h),r.HmacMD5=c._createHmacHelper(h)}(Math),define("crypto.md5",["crypto.core"],function(){}),function(){var t=CryptoJS,e=t.lib,n=e.Base,i=e.WordArray,s=t.algo,r=s.MD5,o=s.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var n=this.cfg,s=n.hasher.create(),r=i.create(),o=r.words,a=n.keySize,c=n.iterations;o.length<a;){l&&s.update(l);var l=s.update(t).finalize(e);s.reset();for(var u=1;u<c;u++)l=s.finalize(l),s.reset();r.concat(l)}return r.sigBytes=4*a,r}});t.EvpKDF=function(t,e,n){return o.create(n).compute(t,e)}}(),define("crypto.evpkdf",["crypto.md5"],function(){}),CryptoJS.lib.Cipher||function(t){var e=CryptoJS,n=e.lib,i=n.Base,s=n.WordArray,r=n.BufferedBlockAlgorithm,o=e.enc,a=(o.Utf8,o.Base64),c=e.algo,l=c.EvpKDF,u=n.Cipher=r.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,n){this.cfg=this.cfg.extend(n),this._xformMode=t,this._key=e,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?S:y}return function(e){return{encrypt:function(n,i,s){return t(i).encrypt(e,n,i,s)},decrypt:function(n,i,s){return t(i).decrypt(e,n,i,s)}}}}()}),h=(n.StreamCipher=u.extend({_doFinalize:function(){var t=this._process(!0);return t},blockSize:1}),e.mode={}),d=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),f=h.CBC=function(){function e(e,n,i){var s=this._iv;if(s){var r=s;this._iv=t}else var r=this._prevBlock;for(var o=0;o<i;o++)e[n+o]^=r[o]}var n=d.extend();return n.Encryptor=n.extend({processBlock:function(t,n){var i=this._cipher,s=i.blockSize;e.call(this,t,n,s),i.encryptBlock(t,n),this._prevBlock=t.slice(n,n+s)}}),n.Decryptor=n.extend({processBlock:function(t,n){var i=this._cipher,s=i.blockSize,r=t.slice(n,n+s);i.decryptBlock(t,n),e.call(this,t,n,s),this._prevBlock=r}}),n}(),p=e.pad={},_=p.Pkcs7={pad:function(t,e){for(var n=4*e,i=n-t.sigBytes%n,r=i<<24|i<<16|i<<8|i,o=[],a=0;a<i;a+=4)o.push(r);var c=s.create(o,i);t.concat(c)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}},m=(n.BlockCipher=u.extend({cfg:u.cfg.extend({mode:f,padding:_}),reset:function(){u.reset.call(this);var t=this.cfg,e=t.iv,n=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=n.createEncryptor;else{var i=n.createDecryptor;this._minBufferSize=1}this._mode=i.call(n,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else{var e=this._process(!0);t.unpad(e)}return e},blockSize:4}),n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),g=e.format={},v=g.OpenSSL={stringify:function(t){var e=t.ciphertext,n=t.salt;if(n)var i=s.create([1398893684,1701076831]).concat(n).concat(e);else var i=e;return i.toString(a)},parse:function(t){var e=a.parse(t),n=e.words;if(1398893684==n[0]&&1701076831==n[1]){var i=s.create(n.slice(2,4));n.splice(0,4),e.sigBytes-=16}return m.create({ciphertext:e,salt:i})}},y=n.SerializableCipher=i.extend({cfg:i.extend({format:v}),encrypt:function(t,e,n,i){i=this.cfg.extend(i);var s=t.createEncryptor(n,i),r=s.finalize(e),o=s.cfg;return m.create({ciphertext:r,key:n,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:i.format})},decrypt:function(t,e,n,i){i=this.cfg.extend(i),e=this._parse(e,i.format);var s=t.createDecryptor(n,i).finalize(e.ciphertext);return s},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),b=e.kdf={},w=b.OpenSSL={execute:function(t,e,n,i){i||(i=s.random(8));var r=l.create({keySize:e+n}).compute(t,i),o=s.create(r.words.slice(e),4*n);return r.sigBytes=4*e,m.create({key:r,iv:o,salt:i})}},S=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:w}),encrypt:function(t,e,n,i){i=this.cfg.extend(i);var s=i.kdf.execute(n,t.keySize,t.ivSize);i.iv=s.iv;var r=y.encrypt.call(this,t,e,s.key,i);return r.mixIn(s),r},decrypt:function(t,e,n,i){i=this.cfg.extend(i),e=this._parse(e,i.format);var s=i.kdf.execute(n,t.keySize,t.ivSize,e.salt);i.iv=s.iv;var r=y.decrypt.call(this,t,e,s.key,i);return r}})}(),define("crypto.cipher-core",["crypto.enc-base64","crypto.evpkdf"],function(){}),function(){var t=CryptoJS,e=t.lib,n=e.BlockCipher,i=t.algo,s=[],r=[],o=[],a=[],c=[],l=[],u=[],h=[],d=[],f=[];!function(){for(var t=[],e=0;e<256;e++)e<128?t[e]=e<<1:t[e]=e<<1^283;for(var n=0,i=0,e=0;e<256;e++){var p=i^i<<1^i<<2^i<<3^i<<4;p=p>>>8^255&p^99,s[n]=p,r[p]=n;var _=t[n],m=t[_],g=t[m],v=257*t[p]^16843008*p;o[n]=v<<24|v>>>8,a[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,l[n]=v;var v=16843009*g^65537*m^257*_^16843008*n;u[p]=v<<24|v>>>8,h[p]=v<<16|v>>>16,d[p]=v<<8|v>>>24,f[p]=v,n?(n=_^t[t[t[g^_]]],i^=t[t[i]]):n=i=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],_=i.AES=n.extend({_doReset:function(){for(var t=this._key,e=t.words,n=t.sigBytes/4,i=this._nRounds=n+6,r=4*(i+1),o=this._keySchedule=[],a=0;a<r;a++)if(a<n)o[a]=e[a];else{var c=o[a-1];a%n?n>6&&a%n==4&&(c=s[c>>>24]<<24|s[c>>>16&255]<<16|s[c>>>8&255]<<8|s[255&c]):(c=c<<8|c>>>24,c=s[c>>>24]<<24|s[c>>>16&255]<<16|s[c>>>8&255]<<8|s[255&c],c^=p[a/n|0]<<24),o[a]=o[a-n]^c}for(var l=this._invKeySchedule=[],_=0;_<r;_++){var a=r-_;if(_%4)var c=o[a];else var c=o[a-4];_<4||a<=4?l[_]=c:l[_]=u[s[c>>>24]]^h[s[c>>>16&255]]^d[s[c>>>8&255]]^f[s[255&c]]}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,o,a,c,l,s)},decryptBlock:function(t,e){var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n,this._doCryptBlock(t,e,this._invKeySchedule,u,h,d,f,r);var n=t[e+1];t[e+1]=t[e+3],t[e+3]=n},_doCryptBlock:function(t,e,n,i,s,r,o,a){for(var c=this._nRounds,l=t[e]^n[0],u=t[e+1]^n[1],h=t[e+2]^n[2],d=t[e+3]^n[3],f=4,p=1;p<c;p++){var _=i[l>>>24]^s[u>>>16&255]^r[h>>>8&255]^o[255&d]^n[f++],m=i[u>>>24]^s[h>>>16&255]^r[d>>>8&255]^o[255&l]^n[f++],g=i[h>>>24]^s[d>>>16&255]^r[l>>>8&255]^o[255&u]^n[f++],v=i[d>>>24]^s[l>>>16&255]^r[u>>>8&255]^o[255&h]^n[f++];l=_,u=m,h=g,d=v}var _=(a[l>>>24]<<24|a[u>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^n[f++],m=(a[u>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&l])^n[f++],g=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[l>>>8&255]<<8|a[255&u])^n[f++],v=(a[d>>>24]<<24|a[l>>>16&255]<<16|a[u>>>8&255]<<8|a[255&h])^n[f++];t[e]=_,t[e+1]=m,t[e+2]=g,t[e+3]=v},keySize:8});t.AES=n._createHelper(_)}(),define("crypto.aes",["crypto.cipher-core"],function(){}),function(){var t=CryptoJS,e=t.lib,n=e.WordArray,i=e.Hasher,s=t.algo,r=[],o=s.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],s=n[1],o=n[2],a=n[3],c=n[4],l=0;l<80;l++){if(l<16)r[l]=0|t[e+l];else{var u=r[l-3]^r[l-8]^r[l-14]^r[l-16];r[l]=u<<1|u>>>31}var h=(i<<5|i>>>27)+c+r[l];h+=l<20?(s&o|~s&a)+1518500249:l<40?(s^o^a)+1859775393:l<60?(s&o|s&a|o&a)-1894007588:(s^o^a)-899497514,c=a,a=o,o=s<<30|s>>>2,s=i,i=h}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+o|0,n[3]=n[3]+a|0,n[4]=n[4]+c|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return e[i>>>5]|=128<<24-i%32,e[(i+64>>>9<<4)+14]=Math.floor(n/4294967296),e[(i+64>>>9<<4)+15]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(o),t.HmacSHA1=i._createHmacHelper(o)}(),define("crypto.sha1",["crypto.core"],function(){}),function(t){var e=CryptoJS,n=e.lib,i=n.WordArray,s=n.Hasher,r=e.algo,o=[],a=[];!function(){function e(e){for(var n=t.sqrt(e),i=2;i<=n;i++)if(!(e%i))return!1;return!0}function n(t){return 4294967296*(t-(0|t))|0}for(var i=2,s=0;s<64;)e(i)&&(s<8&&(o[s]=n(t.pow(i,.5))),a[s]=n(t.pow(i,1/3)),s++),i++}();var c=[],l=r.SHA256=s.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,i=n[0],s=n[1],r=n[2],o=n[3],l=n[4],u=n[5],h=n[6],d=n[7],f=0;f<64;f++){if(f<16)c[f]=0|t[e+f];else{var p=c[f-15],_=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,m=c[f-2],g=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;c[f]=_+c[f-7]+g+c[f-16]}var v=l&u^~l&h,y=i&s^i&r^s&r,b=(i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22),w=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),S=d+w+v+a[f]+c[f],x=b+y;d=h,h=u,u=l,l=o+S|0,o=r,r=s,s=i,i=S+x|0}n[0]=n[0]+i|0,n[1]=n[1]+s|0,n[2]=n[2]+r|0,n[3]=n[3]+o|0,n[4]=n[4]+l|0,n[5]=n[5]+u|0,n[6]=n[6]+h|0,n[7]=n[7]+d|0},_doFinalize:function(){var e=this._data,n=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;return n[s>>>5]|=128<<24-s%32,n[(s+64>>>9<<4)+14]=t.floor(i/4294967296),n[(s+64>>>9<<4)+15]=i,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=s.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=s._createHelper(l),e.HmacSHA256=s._createHmacHelper(l)}(Math),define("crypto.sha256",["crypto.core"],function(){}),function(){var t=CryptoJS,e=t.lib,n=e.Base,i=t.enc,s=i.Utf8,r=t.algo;r.HMAC=n.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=s.parse(e));var n=t.blockSize,i=4*n;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),o=this._iKey=e.clone(),a=r.words,c=o.words,l=0;l<n;l++)a[l]^=1549556828,c[l]^=909522486;r.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,n=e.finalize(t);e.reset();var i=e.finalize(this._oKey.clone().concat(n));return i}})}(),define("crypto.hmac",["crypto.core"],function(){}),CryptoJS.pad.NoPadding={pad:function(){},unpad:function(){}},define("crypto.pad-nopadding",["crypto.cipher-core"],function(){}),CryptoJS.mode.CTR=function(){var t=CryptoJS.lib.BlockCipherMode.extend(),e=t.Encryptor=t.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize,s=this._iv,r=this._counter;s&&(r=this._counter=s.slice(0),this._iv=void 0);var o=r.slice(0);n.encryptBlock(o,0),r[i-1]=r[i-1]+1|0;for(var a=0;a<i;a++)t[e+a]^=o[a]}});return t.Decryptor=e,t}(),define("crypto.mode-ctr",["crypto.cipher-core"],function(){}),function(t,e){"function"==typeof define&&define.amd?define("crypto",["crypto.core","crypto.enc-base64","crypto.md5","crypto.evpkdf","crypto.cipher-core","crypto.aes","crypto.sha1","crypto.sha256","crypto.hmac","crypto.pad-nopadding","crypto.mode-ctr"],function(){return CryptoJS}):t.CryptoJS=e()}(this),function(t,e){"function"==typeof define&&define.amd?define("bigint",[],e.bind(t,t.crypto||t.msCrypto)):"undefined"!=typeof module&&module.exports?module.exports=e(require("crypto")):t.BigInt=e(t.crypto||t.msCrypto)}(this,function(t){function e(t){var e,n,i,s;for(n=new Array(t),e=0;e<t;e++)n[e]=0;for(n[0]=2,i=0;n[i]<t;){for(e=n[i]*n[i];e<t;e+=n[i])n[e]=1;for(i++,n[i]=n[i-1]+1;n[i]<t&&n[n[i]];n[i]++);}for(s=new Array(i),e=0;e<i;e++)s[e]=n[e];return s}function n(t,e){var n,i,s,r;if(mt.length!=t.length&&(mt=T(t),gt=T(t),vt=T(t)),A(vt,e),A(gt,t),A(mt,t),D(gt,-1),D(mt,-1),k(gt))return 0;for(s=0;0==gt[s];s++);for(n=1,i=2;gt[s]%i==0;i*=2,n++);if(r=s*nt+n-1,r&&N(gt,r),W(vt,gt,t),!x(vt,1)&&!M(vt,mt)){for(i=1;i<=r-1&&!M(vt,mt);){if(q(vt,t),x(vt,1))return 0;i++}if(!M(vt,mt))return 0}return 1}function i(t){var e,n,i;for(e=t.length-1;0==t[e]&&e>0;e--);for(n=0,i=t[e];i;i>>=1,n++);return n+=nt*e}function s(t,e){var n=w(0,(t.length>e?t.length:e)*nt,0);return A(n,t),n}function r(t,e){var n=T(t);return z(n,e),U(n,1)}function o(t,e){var n=s(t,t.length+e.length);return B(n,e),U(n,1)}function a(t,e,n){var i=s(t,n.length);return W(i,U(e,2),U(n,2),0),U(i,1)}function c(t,e){var n=s(t,t.length>e.length?t.length+1:e.length+1);return Y(n,e),U(n,1)}function l(t,e){var n=s(t,t.length>e.length?t.length+1:e.length+1);return F(n,e),U(n,1)}function u(t,e){var n,i=s(t,e.length);return n=p(i,e),n?U(i,1):null}function h(t,e,n){var i=s(t,n.length);return $(i,e,n),U(i,1)}function d(t,e){var n,i;return n=Math.floor((t-1)/nt)+2,i=w(0,0,n),f(i,t,e),i}function f(t,e,n){var i,s;for(i=0;i<t.length;i++)t[i]=0;for(s=Math.floor((e-1)/nt)+1,i=0;i<s;i++)t[i]=et(nt);t[s-1]&=(2<<(e-1)%nt)-1,1==n&&(t[s-1]|=1<<(e-1)%nt)}function p(t,e){var n=1+2*Math.max(t.length,e.length);if(!(1&t[0]||1&e[0]))return E(t,0),0;for(bt.length!=n&&(bt=new Array(n),yt=new Array(n),wt=new Array(n),St=new Array(n),xt=new Array(n),Mt=new Array(n)),A(bt,t),A(yt,e),E(wt,1),E(St,0),E(xt,0),E(Mt,1);;){for(;!(1&bt[0]);)O(bt),1&wt[0]||1&St[0]?(F(wt,e),O(wt),Y(St,t),O(St)):(O(wt),O(St));for(;!(1&yt[0]);)O(yt),1&xt[0]||1&Mt[0]?(F(xt,e),O(xt),Y(Mt,t),O(Mt)):(O(xt),O(Mt));if(v(yt,bt)?(Y(yt,bt),Y(xt,wt),Y(Mt,St)):(Y(bt,yt),Y(wt,xt),Y(St,Mt)),x(bt,0)){for(;m(xt);)F(xt,e);return A(t,xt),x(yt,1)?1:(E(t,0),0)}}}function _(t,e){for(var n=1,i=0;;){if(1==t)return n;if(0==t)return 0;if(i-=n*Math.floor(e/t),e%=t,1==e)return i;if(0==e)return 0;n-=i*Math.floor(t/e),t%=e}}function m(t){return t[t.length-1]>>nt-1&1}function g(t,e,n){var i,s=t.length,r=e.length,o=s+n<r?s+n:r;for(i=r-1-n;i<s&&i>=0;i++)if(t[i]>0)return 1;for(i=s-1+n;i<r;i++)if(e[i]>0)return 0;for(i=o-1;i>=n;i--){if(t[i-n]>e[i])return 1;if(t[i-n]<e[i])return 0}return 0}function v(t,e){var n,i=t.length<e.length?t.length:e.length;for(n=t.length;n<e.length;n++)if(e[n])return 0;for(n=e.length;n<t.length;n++)if(t[n])return 1;for(n=i-1;n>=0;n--){if(t[n]>e[n])return 1;if(t[n]<e[n])return 0}return 0}function y(t,e,n,i){var s,r,o,a,c,l,u,h;for(A(i,t),r=e.length;0==e[r-1];r--);for(h=e[r-1],u=0;h;u++)h>>=1;for(u=nt-u,j(e,u),j(i,u),s=i.length;0==i[s-1]&&s>r;s--);for(E(n,0);!g(e,i,s-r);)P(i,e,s-r),n[s-r]++;for(o=s-1;o>=r;o--){for(i[o]==e[r-1]?n[o-r]=st:n[o-r]=Math.floor((i[o]*it+i[o-1])/e[r-1]);c=(r>1?e[r-2]:0)*n[o-r],l=c,c&=st,l=(l-c)/it,a=l+n[o-r]*e[r-1],l=a,a&=st,l=(l-a)/it,l==i[o]?a==i[o-1]?c>(o>1?i[o-2]:0):a>i[o-1]:l>i[o];)n[o-r]--;L(i,e,-n[o-r],o-r),m(i)&&(H(i,e,o-r),n[o-r]--)}N(e,u),N(i,u)}function b(t,e){var n,i=0;for(n=t.length-1;n>=0;n--)i=(i*it+t[n])%e;return i}function w(t,e,n){var i,s;return i=Math.ceil(e/nt)+1,i=n>i?n:i,s=new Array(i),E(s,t),s}function S(t,e,n){var i,s,r,o,a,c=t.length;if(e==-1){for(r=new Array(0);;){for(o=new Array(r.length+1),s=0;s<r.length;s++)o[s+1]=r[s];if(o[0]=parseInt(t,10),r=o,i=t.indexOf(",",0),i<1)break;if(t=t.substring(i+1),0==t.length)break}return r.length<n?(o=new Array(n),A(o,r),o):r}for(var l=e,u=0,h=1==e?c:0;l>1;)1&l&&(u=1),h+=c,l>>=1;for(h+=u*c,r=w(0,h,0),s=0;s<c&&(i=rt.indexOf(t.substring(s,s+1),0),e<=36&&i>=36&&(i-=26),!(i>=e||i<0));s++)I(r,e),D(r,i);for(c=r.length;c>0&&!r[c-1];c--);for(c=n>c+1?n:c+1,o=new Array(c),a=c<r.length?c:r.length,s=0;s<a;s++)o[s]=r[s];for(;s<c;s++)o[s]=0;return o}function x(t,e){var n;if(t[0]!=e)return 0;for(n=1;n<t.length;n++)if(t[n])return 0;return 1}function M(t,e){var n,i=t.length<e.length?t.length:e.length;for(n=0;n<i;n++)if(t[n]!=e[n])return 0;if(t.length>e.length){for(;n<t.length;n++)if(t[n])return 0}else for(;n<e.length;n++)if(e[n])return 0;return 1}function k(t){var e;for(e=0;e<t.length;e++)if(t[e])return 0;return 1}function C(t,e){var n,i,s="";if(ft.length!=t.length?ft=T(t):A(ft,t),e==-1){for(n=t.length-1;n>0;n--)s+=t[n]+",";s+=t[0]}else for(;!k(ft);)i=R(ft,e),s=rt.substring(i,i+1)+s;return 0==s.length&&(s="0"),s}function T(t){var e;return e=new Array(t.length),A(e,t),e}function A(t,e){var n,i=t.length<e.length?t.length:e.length;for(n=0;n<i;n++)t[n]=e[n];for(n=i;n<t.length;n++)t[n]=0}function E(t,e){var n,i;for(i=e,n=0;n<t.length;n++)t[n]=i&st,i>>=nt}function D(t,e){var n,i,s,r;for(t[0]+=e,i=t.length,s=0,n=0;n<i;n++)if(s+=t[n],r=0,s<0&&(r=s&st,r=-((s-r)/it),s+=r*it),t[n]=s&st,s=(s-t[n])/it-r,!s)return}function N(t,e){var n,i=Math.floor(e/nt);if(i){for(n=0;n<t.length-i;n++)t[n]=t[n+i];for(;n<t.length;n++)t[n]=0;e%=nt}for(n=0;n<t.length-1;n++)t[n]=st&(t[n+1]<<nt-e|t[n]>>e);t[n]>>=e}function O(t){var e;for(e=0;e<t.length-1;e++)t[e]=st&(t[e+1]<<nt-1|t[e]>>1);t[e]=t[e]>>1|t[e]&it>>1}function j(t,e){var n,i=Math.floor(e/nt);if(i){for(n=t.length;n>=i;n--)t[n]=t[n-i];for(;n>=0;n--)t[n]=0;e%=nt}if(e){for(n=t.length-1;n>0;n--)t[n]=st&(t[n]<<e|t[n-1]>>nt-e);t[n]=st&t[n]<<e}}function I(t,e){var n,i,s,r;if(e)for(i=t.length,s=0,n=0;n<i;n++)s+=t[n]*e,r=0,s<0&&(r=s&st,r=-((s-r)/it),s+=r*it),t[n]=s&st,s=(s-t[n])/it-r}function R(t,e){var n,i,s=0;for(n=t.length-1;n>=0;n--)i=s*it+t[n],t[n]=Math.floor(i/e),s=i%e;return s}function L(t,e,n,i){var s,r,o,a;for(o=t.length<i+e.length?t.length:i+e.length,a=t.length,r=0,s=i;s<o;s++)r+=t[s]+n*e[s-i],t[s]=r&st,r=(r-t[s])/it;for(s=o;r&&s<a;s++)r+=t[s],t[s]=r&st,r=(r-t[s])/it}function H(t,e,n){var i,s,r,o;for(r=t.length<n+e.length?t.length:n+e.length,o=t.length,s=0,i=n;i<r;i++)s+=t[i]+e[i-n],t[i]=s&st,s=(s-t[i])/it;for(i=r;s&&i<o;i++)s+=t[i],t[i]=s&st,s=(s-t[i])/it}function P(t,e,n){var i,s,r,o;for(r=t.length<n+e.length?t.length:n+e.length,o=t.length,s=0,i=n;i<r;i++)s+=t[i]-e[i-n],t[i]=s&st,s=(s-t[i])/it;for(i=r;s&&i<o;i++)s+=t[i],t[i]=s&st,s=(s-t[i])/it}function Y(t,e){var n,i,s;for(s=t.length<e.length?t.length:e.length,i=0,n=0;n<s;n++)i+=t[n]-e[n],t[n]=i&st,i=(i-t[n])/it;for(n=s;i&&n<t.length;n++)i+=t[n],t[n]=i&st,i=(i-t[n])/it}function F(t,e){var n,i,s;for(s=t.length<e.length?t.length:e.length,i=0,n=0;n<s;n++)i+=t[n]+e[n],t[n]=i&st,i=(i-t[n])/it;for(n=s;i&&n<t.length;n++)i+=t[n],t[n]=i&st,i=(i-t[n])/it}function B(t,e){var n;for(ct.length!=2*t.length&&(ct=new Array(2*t.length)),E(ct,0),n=0;n<e.length;n++)e[n]&&L(ct,t,e[n],n);A(t,ct)}function z(t,e){ht.length!=t.length?ht=T(t):A(ht,t),dt.length!=t.length&&(dt=T(t)),y(ht,e,dt,t)}function $(t,e,n){var i;for(lt.length!=2*t.length&&(lt=new Array(2*t.length)),E(lt,0),i=0;i<e.length;i++)e[i]&&L(lt,t,e[i],i);z(lt,n),A(t,lt)}function q(t,e){var n,i,s,r,o;for(r=t.length;r>0&&!t[r-1];r--);for(o=r>e.length?2*r:2*e.length,lt.length!=o&&(lt=new Array(o)),E(lt,0),n=0;n<r;n++){for(s=lt[2*n]+t[n]*t[n],lt[2*n]=s&st,s=(s-lt[2*n])/it,i=n+1;i<r;i++)s=lt[n+i]+2*t[n]*t[i]+s,lt[n+i]=s&st,s=(s-lt[n+i])/it;lt[n+r]=s}z(lt,e),A(t,lt)}function U(t,e){var n,i;for(n=t.length;n>0&&!t[n-1];n--);return i=new Array(n+e),A(i,t),i}function W(t,e,n){var i,s,r,o;if(pt.length!=n.length&&(pt=T(n)),0!=(1&n[0])){for(E(pt,0),r=n.length;r>0&&!n[r-1];r--);for(o=it-_(b(n,it),it),pt[r]=1,$(t,pt,n),ut.length!=t.length?ut=T(t):A(ut,t),i=e.length-1;i>0&!e[i];i--);if(0==e[i])return void E(t,1);for(s=1<<nt-1;s&&!(e[i]&s);s>>=1);for(;;){if(!(s>>=1)){if(i--,i<0)return void G(t,ot,n,o);s=1<<nt-1}G(t,t,n,o),s&e[i]&&G(t,ut,n,o)}}else for(A(pt,t),E(t,1);!x(e,0);)1&e[0]&&$(t,pt,n),R(e,2),q(pt,n)}function G(t,e,n,i){var s,r,o,a,c,l,u,h=n.length,d=e.length;for(_t.length!=h&&(_t=new Array(h)),E(_t,0);h>0&&0==n[h-1];h--);for(;d>0&&0==e[d-1];d--);for(u=_t.length-1,s=0;s<h;s++){for(c=_t[0]+t[s]*e[0],a=(c&st)*i&st,o=c+a*n[0],o=(o-(o&st))/it,c=t[s],r=1;r<d-4;)o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++;for(;r<d;)o+=_t[r]+a*n[r]+c*e[r],l=_t[r-1]=o&st,o=(o-l)/it,r++;for(;r<h-4;)o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++,o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++;for(;r<h;)o+=_t[r]+a*n[r],l=_t[r-1]=o&st,o=(o-l)/it,r++;for(;r<u;)o+=_t[r],l=_t[r-1]=o&st,o=(o-l)/it,r++;_t[r-1]=o&st}v(n,_t)||Y(_t,n),A(t,_t)}function V(t,e,n){return h(t,u(e,n),n)}function J(t,e,n){return t=r(t,n),e=r(e,n),v(e,t)&&(t=l(t,n)),c(t,e)}function X(t){for(var e=Math.floor(t/nt)+2,n=new Array(e),i=0;i<e;i++)n[i]=0;return n[e-2]=1<<t%nt,n}function K(t,e){e||(e=0),t=T(t);for(var n="";!k(t);)n=Ct[255&t[0]]+n,N(t,8);for(;n.length<e;)n="\0"+n;return n}function Q(t){var e=S("0",10,t.length);return t.forEach(function(t,n){n&&j(e,8),e[0]|=t}),e}function Z(){return Tt(40)}function tt(){return Tt(1)[0]}function et(t){if(t>31)throw new Error("Too many bits.");var e=0,n=0,i=Math.floor(t/8),s=(1<<t%8)-1;for(s&&(n=tt()&s);e<i;e++)n=256*n+tt();return n}var nt=26,it=1<<nt,st=it-1,rt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-",ot=w(1,1,1),at=new Array(0),ct=at,lt=at,ut=at,ht=at,dt=at,ft=at,pt=at,_t=at,mt=at,gt=at,vt=at,yt=at,bt=at,wt=at,St=at,xt=at,Mt=at,kt=at,Ct=function(){for(var t=0,e={};t<256;++t)e[t]=String.fromCharCode(t);return e}(),Tt=function(){return"undefined"!=typeof t&&"function"==typeof t.randomBytes?function(e){try{var n=t.randomBytes(e)}catch(t){throw t}return Array.prototype.slice.call(n,0)}:"undefined"!=typeof t&&"function"==typeof t.getRandomValues?function(e){var n=new Uint8Array(e);return t.getRandomValues(n),Array.prototype.slice.call(n,0)}:void console.log("Keys should not be generated without CSPRNG.")}();return{str2bigInt:S,bigInt2str:C,int2bigInt:w,multMod:h,powMod:a,inverseMod:u,randBigInt:d,randBigInt_:f,equals:M,equalsInt:x,sub:c,mod:r,modInt:b,mult:o,divInt_:R,rightShift_:N,dup:T,greater:v,add:l,isZero:k,bitSize:i,millerRabin:n,divide_:y,trim:U,primes:kt,findPrimes:e,getSeed:Z,divMod:V,subMod:J,twoToThe:X,bigInt2bits:K,ba2bigInt:Q}}),function(){"use strict";function t(){}function e(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1}function n(t){return function(){return this[t].apply(this,arguments)}}var i=t.prototype;i.getListeners=function(t){var e,n,i=this._getEvents();if("object"==typeof t){e={};for(n in i)i.hasOwnProperty(n)&&t.test(n)&&(e[n]=i[n])}else e=i[t]||(i[t]=[]);return e},i.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},i.getListenersAsObject=function(t){var e,n=this.getListeners(t);return n instanceof Array&&(e={},e[t]=n),e||n},i.addListener=function(t,n){var i,s=this.getListenersAsObject(t),r="object"==typeof n;for(i in s)s.hasOwnProperty(i)&&e(s[i],n)===-1&&s[i].push(r?n:{listener:n,once:!1});return this},i.on=n("addListener"),i.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},i.once=n("addOnceListener"),i.defineEvent=function(t){return this.getListeners(t),this},i.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},i.removeListener=function(t,n){var i,s,r=this.getListenersAsObject(t);for(s in r)r.hasOwnProperty(s)&&(i=e(r[s],n),i!==-1&&r[s].splice(i,1));return this},i.off=n("removeListener"),i.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},i.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},i.manipulateListeners=function(t,e,n){var i,s,r=t?this.removeListener:this.addListener,o=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(i=n.length;i--;)r.call(this,e,n[i]);else for(i in e)e.hasOwnProperty(i)&&(s=e[i])&&("function"==typeof s?r.call(this,i,s):o.call(this,i,s));return this},i.removeEvent=function(t){var e,n=typeof t,i=this._getEvents();if("string"===n)delete i[t];else if("object"===n)for(e in i)i.hasOwnProperty(e)&&t.test(e)&&delete i[e];else delete this._events;return this},i.emitEvent=function(t,e){var n,i,s,r,o=this.getListenersAsObject(t);for(s in o)if(o.hasOwnProperty(s))for(i=o[s].length;i--;)n=o[s][i],n.once===!0&&this.removeListener(t,n.listener),r=n.listener.apply(this,e||[]),r===this._getOnceReturnValue()&&this.removeListener(t,n.listener);return this},i.trigger=n("emitEvent"),i.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},i.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},i._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},i._getEvents=function(){return this._events||(this._events={})},"function"==typeof define&&define.amd?define("eventemitter",[],function(){return t}):"object"==typeof module&&module.exports?module.exports=t:this.EventEmitter=t}.call(this),function(t,e){"function"==typeof define&&define.amd?define("otr",["jquery","jquery.browser","bigint","crypto","eventemitter"],function(t,n,i,s,r){if(!t.browser.msie){var o={BigInt:i,CryptoJS:s,EventEmitter:r,OTR:{},DSA:{}};return e.call(o)}}):(t.OTR={},t.DSA={},e.call(t))}(this,function(){return function(){"use strict";var t=this,e={N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA237327FFFFFFFFFFFFFFFF",G:"2",MSGSTATE_PLAINTEXT:0,MSGSTATE_ENCRYPTED:1,MSGSTATE_FINISHED:2,AUTHSTATE_NONE:0,AUTHSTATE_AWAITING_DHKEY:1,AUTHSTATE_AWAITING_REVEALSIG:2,AUTHSTATE_AWAITING_SIG:3,WHITESPACE_TAG:" \t  \t\t\t\t \t \t \t  ",WHITESPACE_TAG_V2:"  \t\t  \t ",WHITESPACE_TAG_V3:"  \t\t  \t\t",OTR_TAG:"?OTR",OTR_VERSION_1:"\0",OTR_VERSION_2:"\0",OTR_VERSION_3:"\0",SMPSTATE_EXPECT0:0,SMPSTATE_EXPECT1:1,SMPSTATE_EXPECT2:2,SMPSTATE_EXPECT3:3,SMPSTATE_EXPECT4:4,STATUS_SEND_QUERY:0,STATUS_AKE_INIT:1,STATUS_AKE_SUCCESS:2,STATUS_END_OTR:3};"undefined"!=typeof module&&module.exports?module.exports=e:t.OTR.CONST=e}.call(this),function(){"use strict";var t,e,n=this,i={};"undefined"!=typeof module&&module.exports?(module.exports=i={},t=require("../vendor/crypto.js"),e=require("../vendor/bigint.js")):(n.OTR&&(n.OTR.HLP=i),n.DSA&&(n.DSA.HLP=i),t=n.CryptoJS,e=n.BigInt);var s={BYTE:1,SHORT:2,INT:4,CTR:8,MAC:20,SIG:40},r="?OTR",o=".",a=e.str2bigInt("2",10);i.debug=function(t){this.debug&&"function"!=typeof this.debug&&"undefined"!=typeof console&&console.log(t)},i.extend=function(t,e){function n(){this.constructor=t}for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype},i.compare=function(t,e){if(t.length!==e.length)return!1;for(var n=0,i=0;n<t.length;n++)i|=t[n].charCodeAt(0)^e[n].charCodeAt(0);return 0===i},i.randomExponent=function(){return e.randBigInt(1536)},i.smpHash=function(e,n,r){var o=t.algo.SHA256.create();o.update(t.enc.Latin1.parse(i.packBytes(e,s.BYTE))),o.update(t.enc.Latin1.parse(i.packMPI(n))),r&&o.update(t.enc.Latin1.parse(i.packMPI(r)));var a=o.finalize();return i.bits2bigInt(a.toString(t.enc.Latin1))},i.makeMac=function(e,n){var s=t.enc.Latin1.parse(n),r=t.HmacSHA256(t.enc.Latin1.parse(e),s);return i.mask(r.toString(t.enc.Latin1),0,160)},i.make1Mac=function(e,n){var i=t.enc.Latin1.parse(n),s=t.HmacSHA1(t.enc.Latin1.parse(e),i);return s.toString(t.enc.Latin1)},i.encryptAes=function(e,n,i){var s={mode:t.mode.CTR,iv:t.enc.Latin1.parse(i),padding:t.pad.NoPadding},r=t.AES.encrypt(e,t.enc.Latin1.parse(n),s),o=t.enc.Base64.parse(r.toString());return t.enc.Latin1.stringify(o)},i.decryptAes=function(e,n,i){e=t.enc.Latin1.parse(e);var s={mode:t.mode.CTR,iv:t.enc.Latin1.parse(i),padding:t.pad.NoPadding};return t.AES.decrypt(t.enc.Base64.stringify(e),t.enc.Latin1.parse(n),s)},i.multPowMod=function(t,n,i,s,r){return e.multMod(e.powMod(t,n,r),e.powMod(i,s,r),r)},i.ZKP=function(t,n,s,r){return e.equals(n,i.smpHash(t,s,r))},i.GTOE=function(t,n){return e.equals(t,n)||e.greater(t,n)},i.between=function(t,n,i){return e.greater(t,n)&&e.greater(i,t)},i.checkGroup=function(t,e){return i.GTOE(t,a)&&i.GTOE(e,t)},i.h1=function(e,n){var i=t.algo.SHA1.create();return i.update(t.enc.Latin1.parse(e)),i.update(t.enc.Latin1.parse(n)),i.finalize().toString(t.enc.Latin1)},i.h2=function(e,n){var i=t.algo.SHA256.create();return i.update(t.enc.Latin1.parse(e)),i.update(t.enc.Latin1.parse(n)),i.finalize().toString(t.enc.Latin1)},i.mask=function(t,e,n){return t.substr(e/8,n/8)};var c=String.fromCharCode;i.packBytes=function(t,e){t=t.toString(16);for(var n,i="";e>0;e--)n=t.length?t.substr(-2,2):"0",t=t.substr(0,t.length-2),i=c(parseInt(n,16))+i;return i},i.packINT=function(t){return i.packBytes(t,s.INT)},i.packCtr=function(t){return i.padCtr(i.packBytes(t,s.CTR))},i.padCtr=function(t){return t+"\0\0\0\0\0\0\0\0"},i.unpackCtr=function(t){return t=i.toByteArray(t.substring(0,8)),i.unpack(t)},i.unpack=function(t){for(var e=0,n=0,i=t.length;n<i;n++)e=256*e+t[n];return e},i.packData=function(t){return i.packINT(t.length)+t},i.bits2bigInt=function(t){return t=i.toByteArray(t),e.ba2bigInt(t)},i.packMPI=function(t){return i.packData(e.bigInt2bits(e.trim(t,0)))},i.packSHORT=function(t){return i.packBytes(t,s.SHORT);
},i.unpackSHORT=function(t){return t=i.toByteArray(t),i.unpack(t)},i.packTLV=function(t,e){return i.packSHORT(t)+i.packSHORT(e.length)+e},i.readLen=function(t){return t=i.toByteArray(t.substring(0,4)),i.unpack(t)},i.readData=function(t){var e=i.unpack(t.splice(0,4));return[e,t]},i.readMPI=function(t){return t=i.toByteArray(t),t=i.readData(t),e.ba2bigInt(t[1])},i.packMPIs=function(t){return t.reduce(function(t,e){return t+i.packMPI(e)},"")},i.unpackMPIs=function(t,e){for(var n=0,s=[];n<t;n++)s.push("MPI");return i.splitype(s,e).map(function(t){return i.readMPI(t)})},i.wrapMsg=function(e,n,s,a,c){e=t.enc.Base64.stringify(t.enc.Latin1.parse(e)),e=r+":"+e+o;var l;if(s&&(l="|",l+=i.readLen(a).toString(16),l+="|",l+=i.readLen(c).toString(16)),!n)return[null,e];var u=Math.ceil(e.length/n);if(u>65535)return["Too many fragments"];if(1==u)return[null,e];var h,d,f,p,_,m=[];for(h=1;h<=u;h++)d=(h-1)*n,f=h*n,p=e.slice(d,f),_=r,s&&(_+=l),_+=","+h+",",_+=u+",",_+=p+",",m.push(_);return[null,m]},i.splitype=function t(e,n){var r=[];return e.forEach(function(e){var o;switch(e){case"PUBKEY":o=t(["SHORT","MPI","MPI","MPI","MPI"],n).join("");break;case"DATA":case"MPI":o=n.substring(0,i.readLen(n)+4);break;default:o=n.substring(0,s[e])}r.push(o),n=n.substring(o.length)}),r};var l=function(){for(var t=0,e={};t<256;++t)e[String.fromCharCode(t)]=t;for(t=128;t<256;++t)e[String.fromCharCode(63232+t)]=t;return e}();i.toByteArray=function(t){for(var e=[],n=t.split(""),i=-1,s=n.length,r=s%8;r--;)++i,e[i]=l[n[i]];for(r=s>>3;r--;)e.push(l[n[++i]],l[n[++i]],l[n[++i]],l[n[++i]],l[n[++i]],l[n[++i]],l[n[++i]],l[n[++i]]);return e}}.call(this),function(){"use strict";function t(){var t=(new Date).getTime();return function(e){if(g&&"undefined"!=typeof console){var n=(new Date).getTime();console.log(e+": "+(n-t)),t=n}}}function e(t,n){var i=c.randBigInt(c.bitSize(n));return h.between(i,t,n)?i:e(t,n)}function n(t,e){var n,i=3e4,s=c.bitSize(t),r=c.primes;for(0===r.length&&(r=c.findPrimes(i)),v.length!=t.length&&(v=c.dup(t)),n=0;n<r.length&&r[n]<=i;n++)if(0===c.modInt(t,r[n])&&!c.equalsInt(t,r[n]))return 0;for(n=0;n<e;n++){for(c.randBigInt_(v,s,0);!c.greater(t,v);)c.randBigInt_(v,s,0);if(!c.millerRabin(t,v))return 0}return 1}function i(e){for(var i,s,r,o,a=t(),l=y[e].repeat,u=y[e].N,h=c.twoToThe(e-1),d=4*e,f=!1;;)if(i=c.randBigInt(u,1),i[0]|=1,n(i,l)){for(a("q"),o=0;o<d;o++)if(s=c.randBigInt(e,1),s[0]|=1,r=c.mod(s,i),r=c.sub(r,p),s=c.sub(s,r),!c.greater(h,s)&&n(s,l)){a("p"),b[e]={p:s,q:i},f=!0;break}if(f)break}for(var m,g=c.dup(_),v=c.sub(s,p),w=c.multMod(v,c.inverseMod(i,s),s);;){m=c.powMod(g,w,s);{if(!c.equals(m,p))return b[e].g=m,void a("g");g=c.add(g,p)}}throw new Error("Unreachable!")}function s(t,n){if(!(this instanceof s))return new s(t,n);if(n=n||{},t){var r=this;return["p","q","g","y","x"].forEach(function(e){r[e]=t[e]}),void(this.type=t.type||m)}var o=parseInt(n.bit_length?n.bit_length:1024,10);if(!y[o])throw new Error("Unsupported bit length.");b[o]||i(o),this.p=b[o].p,this.q=b[o].q,this.g=b[o].g,this.type=m,this.x=e(f,this.q),this.y=c.powMod(this.g,this.x,this.p),n.nocache&&(b[o]=null)}function r(t){var e,n;if(e=t.indexOf("("),n=t.lastIndexOf(")"),e<0||n<0)throw new Error("Malformed S-Expression");t=t.substring(e+1,n);var i=t.search(/\s/),s={type:t.substring(0,i),val:[]};if(t=t.substring(i+1,n),e=t.indexOf("("),e<0)s.val.push(t);else for(var o,a,c,l;e>-1;){for(o=e+1,a=t.length,c=1,l=0;o<a&&l<c;o++)"("===t[o]&&c++,")"===t[o]&&l++;s.val.push(r(t.substring(e,++o))),t=t.substring(++o),e=t.indexOf("(")}return s}function o(t){if(!t.type)throw new Error("Parse error.");var e,n;return"privkeys"===t.type?(e=[],t.val.forEach(function(t){e.push(o(t))}),e):(e={},t.val.forEach(function(t){n=t.val[0],"string"==typeof n?0===n.indexOf("#")&&(n=n.substring(1,n.lastIndexOf("#")),n=c.str2bigInt(n,16)):n=o(t),e[t.type]=n}),e)}var a,c,l,u,h,d=this;"undefined"!=typeof module&&module.exports?(module.exports=s,a=require("../vendor/crypto.js"),c=require("../vendor/bigint.js"),u=require("path").join(__dirname,"/dsa-webworker.js"),h=require("./helpers.js")):(Object.keys(d.DSA).forEach(function(t){s[t]=d.DSA[t]}),d.DSA=s,a=d.CryptoJS,c=d.BigInt,l=d.Worker,u="dsa-webworker.js",h=s.HLP);var f=c.str2bigInt("0",10),p=c.str2bigInt("1",10),_=c.str2bigInt("2",10),m="\0\0",g=!1,v=[],y={1024:{N:160,repeat:40},2048:{N:224,repeat:56}},b={};s.prototype={constructor:s,packPublic:function(){var t=this.type;return t+=h.packMPI(this.p),t+=h.packMPI(this.q),t+=h.packMPI(this.g),t+=h.packMPI(this.y)},packPrivate:function(){var t=this.packPublic()+h.packMPI(this.x);return t=a.enc.Latin1.parse(t),t.toString(a.enc.Base64)},generateNonce:function(t){var e=c.bigInt2bits(c.trim(this.x,0)),n=c.bigInt2bits(c.randBigInt(256)),i=a.algo.SHA256.create();i.update(a.enc.Latin1.parse(e)),i.update(t),i.update(a.enc.Latin1.parse(n));var s=i.finalize();return s=h.bits2bigInt(s.toString(a.enc.Latin1)),c.rightShift_(s,256-c.bitSize(this.q)),h.between(s,f,this.q)?s:this.generateNonce(t)},sign:function(t){t=a.enc.Latin1.parse(t);for(var e,n=c.str2bigInt(t.toString(a.enc.Hex),16),i=f,s=f;c.isZero(s)||c.isZero(i);)e=this.generateNonce(t),i=c.mod(c.powMod(this.g,e,this.p),this.q),c.isZero(i)||(s=c.inverseMod(e,this.q),s=c.mult(s,c.add(n,c.mult(this.x,i))),s=c.mod(s,this.q));return[i,s]},fingerprint:function(){var t=this.packPublic();return this.type===m&&(t=t.substring(2)),t=a.enc.Latin1.parse(t),a.SHA1(t).toString(a.enc.Hex)}},s.parsePublic=function(t,e){var n=["SHORT","MPI","MPI","MPI","MPI"];e&&n.push("MPI"),t=h.splitype(n,t);var i={type:t[0],p:h.readMPI(t[1]),q:h.readMPI(t[2]),g:h.readMPI(t[3]),y:h.readMPI(t[4])};return e&&(i.x=h.readMPI(t[5])),new s(i)},s.parsePrivate=function(t,e){return e?o(r(t))[0]["private-key"].dsa:(t=a.enc.Base64.parse(t),t=t.toString(a.enc.Latin1),s.parsePublic(t,!0))},s.verify=function(t,e,n,i){if(!h.between(n,f,t.q)||!h.between(i,f,t.q))return!1;var s=a.enc.Latin1.parse(e);s=c.str2bigInt(s.toString(a.enc.Hex),16);var r=c.inverseMod(i,t.q),o=c.multMod(s,r,t.q),l=c.multMod(n,r,t.q);o=c.powMod(t.g,o,t.p),l=c.powMod(t.y,l,t.p);var u=c.mod(c.multMod(o,l,t.p),t.q);return c.equals(u,n)},s.createInWebWorker=function(t,e){var n={path:u,seed:c.getSeed};t&&"object"==typeof t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),"undefined"!=typeof module&&module.exports&&(l=require("webworker-threads").Worker);var i=new l(n.path);i.onmessage=function(t){var n=t.data;switch(n.type){case"debug":if(!g||"undefined"==typeof console)return;console.log(n.val);break;case"data":i.terminate(),e(s.parsePrivate(n.val));break;default:throw new Error("Unrecognized type.")}},i.postMessage({seed:n.seed(),imports:n.imports,debug:g})}}.call(this),function(){"use strict";var t,e,n,i=this,s={};"undefined"!=typeof module&&module.exports?(module.exports=s,t=require("../vendor/crypto.js"),e=require("./const.js"),n=require("./helpers.js")):(i.OTR.Parse=s,t=i.CryptoJS,e=i.OTR.CONST,n=i.OTR.HLP);var r={};r[e.WHITESPACE_TAG_V2]=e.OTR_VERSION_2,r[e.WHITESPACE_TAG_V3]=e.OTR_VERSION_3,s.parseMsg=function(i,s){var o=[],a=s.indexOf(e.OTR_TAG);if(!~a){if(this.initFragment(i),u=s.indexOf(e.WHITESPACE_TAG),~u){s=s.split(""),s.splice(u,16);for(var c,l=s.length;u<l;)c=s.slice(u,u+8).join(""),Object.hasOwnProperty.call(r,c)?(s.splice(u,8),o.push(r[c])):u+=8;s=s.join("")}return{msg:s,ver:o}}var u=a+e.OTR_TAG.length,h=s[u];if(","===h||"|"===h)return this.msgFragment(i,s.substring(u+1),"|"===h);if(this.initFragment(i),~["?","v"].indexOf(h)){"?"===s[u]&&(o.push(e.OTR_VERSION_1),u+=1);var d={2:e.OTR_VERSION_2,3:e.OTR_VERSION_3},f=s.substring(u+1),p=f.indexOf("?");return p>=1&&(f=f.substring(0,p).split(""),"v"===s[u]&&f.forEach(function(t){Object.hasOwnProperty.call(d,t)&&o.push(d[t])})),{cls:"query",ver:o}}if(":"===h){u+=1;var _=s.substring(u,u+4);if(_.length<4)return{msg:s};_=t.enc.Base64.parse(_).toString(t.enc.Latin1);var m=_.substring(0,2),g=_.substring(2);if(!i["ALLOW_V"+n.unpackSHORT(m)])return{msg:s};u+=4;var v=s.substring(u).indexOf(".");if(!~v)return{msg:s};s=t.enc.Base64.parse(s.substring(u,u+v)),s=t.enc.Latin1.stringify(s);var y;m===e.OTR_VERSION_3&&(y=s.substring(0,8),s=s.substring(8));var b;return~["","\n","",""].indexOf(g)?b="ake":""===g&&(b="data"),{version:m,type:g,msg:s,cls:b,instance_tags:y}}return" Error:"===s.substring(u,u+7)?(i.ERROR_START_AKE&&i.sendQueryMsg(),{msg:s.substring(u+7),cls:"error"}):{msg:s}},s.initFragment=function(t){t.fragment={s:"",j:0,k:0}},s.msgFragment=function(t,e,i){if(e=e.split(","),i){var s=e.shift().split("|"),r=n.packINT(parseInt(s[0],16)),o=n.packINT(parseInt(s[1],16));if(t.checkInstanceTags(r+o))return}if(!(e.length<4||isNaN(parseInt(e[0],10))||isNaN(parseInt(e[1],10)))){var a=parseInt(e[0],10),c=parseInt(e[1],10);return e=e[2],c<a||0===c||0===a?void this.initFragment(t):(1===a?(this.initFragment(t),t.fragment={k:1,n:c,s:e}):c===t.fragment.n&&a===t.fragment.k+1?(t.fragment.s+=e,t.fragment.k+=1):this.initFragment(t),c===a?(e=t.fragment.s,this.initFragment(t),this.parseMsg(t,e)):void 0)}}}.call(this),function(){"use strict";function t(t,e,i,s,o){var a=n.enc.Latin1.parse(o),c=n.algo.HMAC.create(n.algo.SHA256,a);return c.update(n.enc.Latin1.parse(r.packMPI(t))),c.update(n.enc.Latin1.parse(r.packMPI(e))),c.update(n.enc.Latin1.parse(i)),c.update(n.enc.Latin1.parse(s)),c.finalize().toString(n.enc.Latin1)}function e(t){if(!(this instanceof e))return new e(t);this.otr=t,this.our_dh=t.our_old_dh,this.our_keyid=t.our_keyid-1,this.their_y=null,this.their_keyid=null,this.their_priv_pk=null,this.ssid=null,this.transmittedRS=!1,this.r=null;var n=this;["sendMsg"].forEach(function(t){n[t]=n[t].bind(n)})}var n,i,s,r,o,a=this;"undefined"!=typeof module&&module.exports?(module.exports=e,n=require("../vendor/crypto.js"),i=require("../vendor/bigint.js"),s=require("./const.js"),r=require("./helpers.js"),o=require("./dsa.js")):(a.OTR.AKE=e,n=a.CryptoJS,i=a.BigInt,s=a.OTR.CONST,r=a.OTR.HLP,o=a.DSA);var c=i.str2bigInt(s.N,16),l=i.sub(c,i.str2bigInt("2",10));e.prototype={constructor:e,createKeys:function(t){var e=i.powMod(t,this.our_dh.privateKey,c),n=r.packMPI(e);this.ssid=r.mask(r.h2("\0",n),0,64);var s=r.h2("",n);this.c=r.mask(s,0,128),this.c_prime=r.mask(s,128,128),this.m1=r.h2("",n),this.m2=r.h2("",n),this.m1_prime=r.h2("",n),this.m2_prime=r.h2("",n)},verifySignMac:function(e,i,s,a,c,l,u,h){var d=r.makeMac(i,s);if(!r.compare(e,d))return["MACs do not match."];var f=r.decryptAes(i.substring(4),a,h);f=r.splitype(["PUBKEY","INT","SIG"],f.toString(n.enc.Latin1));var p=t(c,l,f[0],f[1],u),_=o.parsePublic(f[0]),m=r.bits2bigInt(f[2].substring(0,20)),g=r.bits2bigInt(f[2].substring(20));return o.verify(_,p,m,g)?[null,r.readLen(f[1]),_]:["Cannot verify signature of m."]},makeM:function(e,s,o,a){var c=this.otr.priv.packPublic(),l=r.packINT(this.our_keyid),u=t(this.our_dh.publicKey,e,c,l,s);u=this.otr.priv.sign(u);var h=c+l;h+=i.bigInt2bits(u[0],20),h+=i.bigInt2bits(u[1],20),h=n.enc.Latin1.parse(h);var d=r.packData(r.encryptAes(h,o,r.packCtr(0))),f=r.makeMac(d,a);return d+f},akeSuccess:function(t){return r.debug.call(this.otr,"success"),i.equals(this.their_y,this.our_dh.publicKey)?this.otr.error("equal keys - we have a problem.",!0):(this.otr.our_old_dh=this.our_dh,this.otr.their_priv_pk=this.their_priv_pk,this.their_keyid===this.otr.their_keyid&&i.equals(this.their_y,this.otr.their_y)||this.their_keyid===this.otr.their_keyid-1&&i.equals(this.their_y,this.otr.their_old_y)||(this.otr.their_y=this.their_y,this.otr.their_old_y=null,this.otr.their_keyid=this.their_keyid,this.otr.sessKeys[0]=[new this.otr.DHSession(this.otr.our_dh,this.otr.their_y),null],this.otr.sessKeys[1]=[new this.otr.DHSession(this.otr.our_old_dh,this.otr.their_y),null]),this.otr.ssid=this.ssid,this.otr.transmittedRS=this.transmittedRS,this.otr_version=t,this.otr.authstate=s.AUTHSTATE_NONE,this.otr.msgstate=s.MSGSTATE_ENCRYPTED,this.r=null,this.myhashed=null,this.dhcommit=null,this.encrypted=null,this.hashed=null,this.otr.trigger("status",[s.STATUS_AKE_SUCCESS]),void this.otr.sendStored())},handleAKE:function(t){var e,o,a,c=t.version;switch(t.type){case"":if(r.debug.call(this.otr,"d-h key message"),t=r.splitype(["DATA","DATA"],t.msg),this.otr.authstate===s.AUTHSTATE_AWAITING_DHKEY){var u=r.readMPI(this.myhashed),h=r.readMPI(t[1]);if(i.greater(u,h)){a="",e=this.dhcommit;break}this.our_dh=this.otr.dh(),this.otr.authstate=s.AUTHSTATE_NONE,this.r=null,this.myhashed=null}else this.otr.authstate===s.AUTHSTATE_AWAITING_SIG&&(this.our_dh=this.otr.dh());this.otr.authstate=s.AUTHSTATE_AWAITING_REVEALSIG,this.encrypted=t[0].substring(4),this.hashed=t[1].substring(4),a="\n",e=r.packMPI(this.our_dh.publicKey);break;case"\n":if(r.debug.call(this.otr,"reveal signature message"),t=r.splitype(["MPI"],t.msg),this.otr.authstate!==s.AUTHSTATE_AWAITING_DHKEY){if(this.otr.authstate!==s.AUTHSTATE_AWAITING_SIG)return;if(!i.equals(this.their_y,r.readMPI(t[0])))return}if(this.otr.authstate=s.AUTHSTATE_AWAITING_SIG,this.their_y=r.readMPI(t[0]),!r.checkGroup(this.their_y,l))return this.otr.error("Illegal g^y.",!0);this.createKeys(this.their_y),a="",e=r.packMPI(this.r),e+=this.makeM(this.their_y,this.m1,this.c,this.m2),this.m1=null,this.m2=null,this.c=null;break;case"":if(r.debug.call(this.otr,"signature message"),this.otr.authstate!==s.AUTHSTATE_AWAITING_REVEALSIG)return;t=r.splitype(["DATA","DATA","MAC"],t.msg),this.r=r.readMPI(t[0]);var d=n.enc.Hex.parse(i.bigInt2str(this.r,16));d=n.enc.Latin1.stringify(d);var f=r.decryptAes(this.encrypted,d,r.packCtr(0));f=f.toString(n.enc.Latin1),this.their_y=r.readMPI(f);var p=n.SHA256(n.enc.Latin1.parse(f));return r.compare(this.hashed,p.toString(n.enc.Latin1))?r.checkGroup(this.their_y,l)?(this.createKeys(this.their_y),o=this.verifySignMac(t[2],t[1],this.m2,this.c,this.their_y,this.our_dh.publicKey,this.m1,r.packCtr(0)),o[0]?this.otr.error(o[0],!0):(this.their_keyid=o[1],this.their_priv_pk=o[2],e=this.makeM(this.their_y,this.m1_prime,this.c_prime,this.m2_prime),this.m1=null,this.m2=null,this.m1_prime=null,this.m2_prime=null,this.c=null,this.c_prime=null,this.sendMsg(c,"",e),void this.akeSuccess(c))):this.otr.error("Illegal g^x.",!0):this.otr.error("Hashed g^x does not match.",!0);case"":if(r.debug.call(this.otr,"data message"),this.otr.authstate!==s.AUTHSTATE_AWAITING_SIG)return;return t=r.splitype(["DATA","MAC"],t.msg),o=this.verifySignMac(t[1],t[0],this.m2_prime,this.c_prime,this.their_y,this.our_dh.publicKey,this.m1_prime,r.packCtr(0)),o[0]?this.otr.error(o[0],!0):(this.their_keyid=o[1],this.their_priv_pk=o[2],this.m1_prime=null,this.m2_prime=null,this.c_prime=null,this.transmittedRS=!0,void this.akeSuccess(c));default:return}this.sendMsg(c,a,e)},sendMsg:function(t,e,n){var i=t+e,o=t===s.OTR_VERSION_3;return o&&(r.debug.call(this.otr,"instance tags"),i+=this.otr.our_instance_tag,i+=this.otr.their_instance_tag),i+=n,i=r.wrapMsg(i,this.otr.fragment_size,o,this.otr.our_instance_tag,this.otr.their_instance_tag),i[0]?this.otr.error(i[0]):void this.otr.io(i[1])},initiateAKE:function(t){r.debug.call(this.otr,"d-h commit message"),this.otr.trigger("status",[s.STATUS_AKE_INIT]),this.otr.authstate=s.AUTHSTATE_AWAITING_DHKEY;var e=r.packMPI(this.our_dh.publicKey);e=n.enc.Latin1.parse(e),this.r=i.randBigInt(128);var o=n.enc.Hex.parse(i.bigInt2str(this.r,16));o=n.enc.Latin1.stringify(o),this.myhashed=n.SHA256(e),this.myhashed=r.packData(this.myhashed.toString(n.enc.Latin1)),this.dhcommit=r.packData(r.encryptAes(e,o,r.packCtr(0))),this.dhcommit+=this.myhashed,this.sendMsg(t,"",this.dhcommit)}}}.call(this),function(){"use strict";function t(e){return this instanceof t?(this.version=1,this.our_fp=e.our_fp,this.their_fp=e.their_fp,this.ssid=e.ssid,this.debug=!!e.debug,void this.init()):new t(e)}var e,n,i,s,r,o=this;"undefined"!=typeof module&&module.exports?(module.exports=t,e=require("../vendor/crypto.js"),n=require("../vendor/bigint.js"),i=require("../vendor/eventemitter.js"),s=require("./const.js"),r=require("./helpers.js")):(o.OTR.SM=t,e=o.CryptoJS,n=o.BigInt,i=o.EventEmitter,s=o.OTR.CONST,r=o.OTR.HLP);var a=n.str2bigInt(s.G,10),c=n.str2bigInt(s.N,16),l=n.sub(c,n.str2bigInt("2",10)),u=n.sub(c,n.str2bigInt("1",10));n.divInt_(u,2),r.extend(t,i),t.prototype.init=function(){this.smpstate=s.SMPSTATE_EXPECT1,this.secret=null},t.prototype.makeSecret=function(t,n){var i=e.algo.SHA256.create();i.update(e.enc.Latin1.parse(r.packBytes(this.version,1))),i.update(e.enc.Hex.parse(t?this.our_fp:this.their_fp)),i.update(e.enc.Hex.parse(t?this.their_fp:this.our_fp)),i.update(e.enc.Latin1.parse(this.ssid)),i.update(e.enc.Latin1.parse(n));var s=i.finalize();this.secret=r.bits2bigInt(s.toString(e.enc.Latin1))},t.prototype.makeG2s=function(){this.a2=r.randomExponent(),this.a3=r.randomExponent(),this.g2a=n.powMod(a,this.a2,c),this.g3a=n.powMod(a,this.a3,c),r.checkGroup(this.g2a,l)&&r.checkGroup(this.g3a,l)||this.makeG2s()},t.prototype.computeGs=function(t,e){this.g2=n.powMod(t,this.a2,c),this.g3=n.powMod(e,this.a3,c)},t.prototype.computePQ=function(t){this.p=n.powMod(this.g3,t,c),this.q=r.multPowMod(a,t,this.g2,this.secret,c)},t.prototype.computeR=function(){this.r=n.powMod(this.QoQ,this.a3,c)},t.prototype.computeRab=function(t){return n.powMod(t,this.a3,c)},t.prototype.computeC=function(t,e){return r.smpHash(t,n.powMod(a,e,c))},t.prototype.computeD=function(t,e,i){return n.subMod(t,n.multMod(e,i,u),u)},t.prototype.handleSM=function(t){var i,o,u,h,d,f,p,_,m,g,v,y,b,w,S={2:s.SMPSTATE_EXPECT1,3:s.SMPSTATE_EXPECT2,4:s.SMPSTATE_EXPECT3,5:s.SMPSTATE_EXPECT4,7:s.SMPSTATE_EXPECT1};if(6===t.type)return this.init(),void this.trigger("abort");if(this.smpstate!==S[t.type])return this.abort();switch(this.smpstate){case s.SMPSTATE_EXPECT1:r.debug.call(this,"smp tlv 2");var x,M;return 7===t.type&&(x=t.msg.indexOf("\0"),M=t.msg.substring(0,x),t.msg=t.msg.substring(x+1)),b=r.readLen(t.msg.substr(0,4)),6!==b?this.abort():(t=r.unpackMPIs(6,t.msg.substring(4)),r.checkGroup(t[0],l)&&r.checkGroup(t[3],l)&&r.ZKP(1,t[1],r.multPowMod(a,t[2],t[0],t[1],c))&&r.ZKP(2,t[4],r.multPowMod(a,t[5],t[3],t[4],c))?(this.g3ao=t[3],this.makeG2s(),o=r.randomExponent(),u=r.randomExponent(),this.c2=this.computeC(3,o),this.c3=this.computeC(4,u),this.d2=this.computeD(o,this.a2,this.c2),this.d3=this.computeD(u,this.a3,this.c3),this.computeGs(t[0],t[3]),this.smpstate=s.SMPSTATE_EXPECT0,M=e.enc.Latin1.parse(M).toString(e.enc.Utf8),void this.trigger("question",[M])):this.abort());case s.SMPSTATE_EXPECT2:if(r.debug.call(this,"smp tlv 3"),b=r.readLen(t.msg.substr(0,4)),11!==b)return this.abort();if(t=r.unpackMPIs(11,t.msg.substring(4)),!(r.checkGroup(t[0],l)&&r.checkGroup(t[3],l)&&r.checkGroup(t[6],l)&&r.checkGroup(t[7],l)))return this.abort();if(!r.ZKP(3,t[1],r.multPowMod(a,t[2],t[0],t[1],c)))return this.abort();if(!r.ZKP(4,t[4],r.multPowMod(a,t[5],t[3],t[4],c)))return this.abort();if(this.g3ao=t[3],this.computeGs(t[0],t[3]),d=r.multPowMod(this.g3,t[9],t[6],t[8],c),f=r.multPowMod(a,t[9],this.g2,t[10],c),f=n.multMod(f,n.powMod(t[7],t[8],c),c),!r.ZKP(5,t[8],d,f))return this.abort();var k=r.randomExponent();this.computePQ(k);var C=r.randomExponent(),T=r.randomExponent(),A=r.multPowMod(a,C,this.g2,T,c),E=r.smpHash(6,n.powMod(this.g3,C,c),A),D=this.computeD(C,k,E),N=this.computeD(T,this.secret,E);this.QoQ=n.divMod(this.q,t[7],c),this.PoP=n.divMod(this.p,t[6],c),this.computeR(),h=r.randomExponent(),g=n.powMod(this.QoQ,h,c),v=r.smpHash(7,n.powMod(a,h,c),g),y=this.computeD(h,this.a3,v),this.smpstate=s.SMPSTATE_EXPECT4,i=r.packINT(8)+r.packMPIs([this.p,this.q,E,D,N,this.r,v,y]),i=r.packTLV(4,i);break;case s.SMPSTATE_EXPECT3:if(r.debug.call(this,"smp tlv 4"),b=r.readLen(t.msg.substr(0,4)),8!==b)return this.abort();if(t=r.unpackMPIs(8,t.msg.substring(4)),!r.checkGroup(t[0],l)||!r.checkGroup(t[1],l)||!r.checkGroup(t[5],l))return this.abort();if(d=r.multPowMod(this.g3,t[3],t[0],t[2],c),f=r.multPowMod(a,t[3],this.g2,t[4],c),f=n.multMod(f,n.powMod(t[1],t[2],c),c),!r.ZKP(6,t[2],d,f))return this.abort();if(p=r.multPowMod(a,t[7],this.g3ao,t[6],c),this.QoQ=n.divMod(t[1],this.q,c),_=r.multPowMod(this.QoQ,t[7],t[5],t[6],c),!r.ZKP(7,t[6],p,_))return this.abort();this.computeR(),h=r.randomExponent(),g=n.powMod(this.QoQ,h,c),v=r.smpHash(8,n.powMod(a,h,c),g),y=this.computeD(h,this.a3,v),i=r.packINT(3)+r.packMPIs([this.r,v,y]),i=r.packTLV(5,i),m=this.computeRab(t[5]),w=!!n.equals(m,n.divMod(t[0],this.p,c)),this.trigger("trust",[w,"answered"]),this.init();break;case s.SMPSTATE_EXPECT4:return r.debug.call(this,"smp tlv 5"),b=r.readLen(t.msg.substr(0,4)),3!==b?this.abort():(t=r.unpackMPIs(3,t.msg.substring(4)),r.checkGroup(t[0],l)?(p=r.multPowMod(a,t[2],this.g3ao,t[1],c),_=r.multPowMod(this.QoQ,t[2],t[0],t[1],c),r.ZKP(8,t[1],p,_)?(m=this.computeRab(t[0]),w=!!n.equals(m,this.PoP),this.trigger("trust",[w,"asked"]),void this.init()):this.abort()):this.abort())}this.sendMsg(i)},t.prototype.sendMsg=function(t){this.trigger("send",[this.ssid,"\0"+t])},t.prototype.rcvSecret=function(t,e){r.debug.call(this,"receive secret");var n,i=!1;this.smpstate===s.SMPSTATE_EXPECT0?n=this.answer:(n=this.initiate,i=!0),this.makeSecret(i,t),n.call(this,e)},t.prototype.answer=function(){r.debug.call(this,"smp answer");var t=r.randomExponent();this.computePQ(t);var e=r.randomExponent(),i=r.randomExponent(),o=r.multPowMod(a,e,this.g2,i,c),l=r.smpHash(5,n.powMod(this.g3,e,c),o),u=this.computeD(e,t,l),h=this.computeD(i,this.secret,l);this.smpstate=s.SMPSTATE_EXPECT3;var d=r.packINT(11)+r.packMPIs([this.g2a,this.c2,this.d2,this.g3a,this.c3,this.d3,this.p,this.q,l,u,h]);this.sendMsg(r.packTLV(3,d))},t.prototype.initiate=function(t){r.debug.call(this,"smp initiate"),this.smpstate!==s.SMPSTATE_EXPECT1&&this.abort(),this.makeG2s();var e=r.randomExponent(),n=r.randomExponent();this.c2=this.computeC(1,e),this.c3=this.computeC(2,n),this.d2=this.computeD(e,this.a2,this.c2),this.d3=this.computeD(n,this.a3,this.c3),this.smpstate=s.SMPSTATE_EXPECT2;var i="",o=2;t&&(i+=t,i+="\0",o=7),i+=r.packINT(6)+r.packMPIs([this.g2a,this.c2,this.d2,this.g3a,this.c3,this.d3]),this.sendMsg(r.packTLV(o,i))},t.prototype.abort=function(){this.init(),this.sendMsg(r.packTLV(6,"")),this.trigger("abort")}}.call(this),function(){"use strict";function t(e){if(!(this instanceof t))return new t(e);if(e=e||{},e.priv&&!(e.priv instanceof h))throw new Error("Requires long-lived DSA key.");if(this.priv=e.priv?e.priv:new h,this.fragment_size=e.fragment_size||0,this.fragment_size<0)throw new Error("Fragment size must be a positive integer.");if(this.send_interval=e.send_interval||0,this.send_interval<0)throw new Error("Send interval must be a positive integer.");this.outgoing=[],this.our_instance_tag=e.instance_tag||t.makeInstanceTag(),this.debug=!!e.debug,this.smw=e.smw,this.init();var n=this;["sendMsg","receiveMsg"].forEach(function(t){n[t]=n[t].bind(n)}),i.call(this)}var e,n,i,s,r,o,a,c,l,u,h,d=this;"undefined"!=typeof module&&module.exports?(module.exports=t,e=require("../vendor/crypto.js"),n=require("../vendor/bigint.js"),i=require("../vendor/eventemitter.js"),r=require("path").join(__dirname,"/sm-webworker.js"),o=require("./const.js"),a=require("./helpers.js"),c=require("./parse.js"),l=require("./ake.js"),u=require("./sm.js"),h=require("./dsa.js"),t.CONST=o):(Object.keys(d.OTR).forEach(function(e){t[e]=d.OTR[e]}),d.OTR=t,e=d.CryptoJS,n=d.BigInt,i=d.EventEmitter,s=d.Worker,r="sm-webworker.js",o=t.CONST,a=t.HLP,c=t.Parse,l=t.AKE,u=t.SM,h=d.DSA);var f=n.str2bigInt(o.G,10),p=n.str2bigInt(o.N,16),_=Math.pow(2,53)-1,m=Math.pow(2,31)-1;a.extend(t,i),t.prototype.init=function(){this.msgstate=o.MSGSTATE_PLAINTEXT,this.authstate=o.AUTHSTATE_NONE,this.ALLOW_V2=!0,this.ALLOW_V3=!0,this.REQUIRE_ENCRYPTION=!1,this.SEND_WHITESPACE_TAG=!1,this.WHITESPACE_START_AKE=!1,this.ERROR_START_AKE=!1,c.initFragment(this),this.their_y=null,this.their_old_y=null,this.their_keyid=0,this.their_priv_pk=null,this.their_instance_tag="\0\0\0\0",this.our_dh=this.dh(),this.our_old_dh=this.dh(),this.our_keyid=2,this.sessKeys=[new Array(2),new Array(2)],this.storedMgs=[],this.oldMacKeys=[],this.sm=null,this._akeInit(),this.receivedPlaintext=!1},t.prototype._akeInit=function(){this.ake=new l(this),this.transmittedRS=!1,this.ssid=null},t.prototype._SMW=function(t,e){this.otr=t;var i={path:r,seed:n.getSeed};"object"==typeof t.smw&&Object.keys(t.smw).forEach(function(e){i[e]=t.smw[e]}),"undefined"!=typeof module&&module.exports&&(s=require("webworker-threads").Worker),this.worker=new s(i.path);var o=this;this.worker.onmessage=function(t){var e=t.data;e&&o.trigger(e.method,e.args)},this.worker.postMessage({type:"seed",seed:i.seed(),imports:i.imports}),this.worker.postMessage({type:"init",reqs:e})},a.extend(t.prototype._SMW,i),["handleSM","rcvSecret","abort"].forEach(function(e){t.prototype._SMW.prototype[e]=function(){this.worker.postMessage({type:"method",method:e,args:Array.prototype.slice.call(arguments,0)})}}),t.prototype._smInit=function(){var t={ssid:this.ssid,our_fp:this.priv.fingerprint(),their_fp:this.their_priv_pk.fingerprint(),debug:this.debug};this.smw?(this.sm&&this.sm.worker.terminate(),this.sm=new this._SMW(this,t)):this.sm=new u(t);var e=this;["trust","abort","question"].forEach(function(t){e.sm.on(t,function(){e.trigger("smp",[t].concat(Array.prototype.slice.call(arguments)))})}),this.sm.on("send",function(t,n){e.ssid===t&&(n=e.prepareMsg(n),e.io(n))})},t.prototype.io=function(t,e){t=[].concat(t).map(function(t){return{msg:t,meta:e}}),this.outgoing=this.outgoing.concat(t);var n=this;!function t(e){if(!e){if(!n.outgoing.length)return;var i=n.outgoing.shift();n.trigger("io",[i.msg,i.meta])}setTimeout(t,e?0:n.send_interval)}(!0)},t.prototype.dh=function(){var t={privateKey:n.randBigInt(320)};return t.publicKey=n.powMod(f,t.privateKey,p),t},t.prototype.DHSession=function t(i,s){if(!(this instanceof t))return new t(i,s);var r=n.powMod(s,i.privateKey,p),o=a.packMPI(r);this.id=a.mask(a.h2("\0",o),0,64);var c=n.greater(i.publicKey,s),l=c?"":"",u=c?"":"";this.sendenc=a.mask(a.h1(l,o),0,128),this.sendmac=e.SHA1(e.enc.Latin1.parse(this.sendenc)),this.sendmac=this.sendmac.toString(e.enc.Latin1),this.rcvenc=a.mask(a.h1(u,o),0,128),this.rcvmac=e.SHA1(e.enc.Latin1.parse(this.rcvenc)),this.rcvmac=this.rcvmac.toString(e.enc.Latin1),this.rcvmacused=!1,this.extra_symkey=a.h2("√ø",o),this.send_counter=0,this.rcv_counter=0},t.prototype.rotateOurKeys=function(){var t=this;this.sessKeys[1].forEach(function(e){e&&e.rcvmacused&&t.oldMacKeys.push(e.rcvmac)}),this.our_old_dh=this.our_dh,this.our_dh=this.dh(),this.our_keyid+=1,this.sessKeys[1][0]=this.sessKeys[0][0],this.sessKeys[1][1]=this.sessKeys[0][1],this.sessKeys[0]=[this.their_y?new this.DHSession(this.our_dh,this.their_y):null,this.their_old_y?new this.DHSession(this.our_dh,this.their_old_y):null]},t.prototype.rotateTheirKeys=function(t){this.their_keyid+=1;var e=this;this.sessKeys.forEach(function(t){t[1]&&t[1].rcvmacused&&e.oldMacKeys.push(t[1].rcvmac)}),this.their_old_y=this.their_y,this.sessKeys[0][1]=this.sessKeys[0][0],this.sessKeys[1][1]=this.sessKeys[1][0],this.their_y=t,this.sessKeys[0][0]=new this.DHSession(this.our_dh,this.their_y),this.sessKeys[1][0]=new this.DHSession(this.our_old_dh,this.their_y)},t.prototype.prepareMsg=function(t,n){if(this.msgstate!==o.MSGSTATE_ENCRYPTED||0===this.their_keyid)return this.error("Not ready to encrypt.");var i=this.sessKeys[1][0];if(i.send_counter>=_)return this.error("Should have rekeyed by now.");i.send_counter+=1;var s=a.packCtr(i.send_counter),r=this.ake.otr_version+"",c=this.ake.otr_version===o.OTR_VERSION_3;if(c&&(r+=this.our_instance_tag,r+=this.their_instance_tag),r+="\0",r+=a.packINT(this.our_keyid-1),r+=a.packINT(this.their_keyid),r+=a.packMPI(this.our_dh.publicKey),r+=s.substring(0,8),Math.ceil(t.length/8)>=m)return this.error("Message is too long.");var l=a.encryptAes(e.enc.Latin1.parse(t),i.sendenc,s);return r+=a.packData(l),r+=a.make1Mac(r,i.sendmac),r+=a.packData(this.oldMacKeys.splice(0).join("")),r=a.wrapMsg(r,this.fragment_size,c,this.our_instance_tag,this.their_instance_tag),r[0]?this.error(r[0]):(n&&this.trigger("file",["send",i.extra_symkey,n]),r[1])},t.prototype.handleDataMsg=function(t){var n=t.version+t.type;this.ake.otr_version===o.OTR_VERSION_3&&(n+=t.instance_tags);var i=["BYTE","INT","INT","MPI","CTR","DATA","MAC","DATA"];t=a.splitype(i,t.msg);var s=""===t[0];if(this.msgstate!==o.MSGSTATE_ENCRYPTED||8!==t.length)return void(s||this.error("Received an unreadable encrypted message.",!0));var r=this.our_keyid-a.readLen(t[2]),c=this.their_keyid-a.readLen(t[1]);if(r<0||r>1)return void(s||this.error("Not of our latest keys.",!0));if(c<0||c>1)return void(s||this.error("Not of your latest keys.",!0));var l=c?this.their_old_y:this.their_y;if(1===c&&!l)return void(s||this.error("Do not have that key."));var u=this.sessKeys[r][c],h=a.unpackCtr(t[4]);if(h<=u.rcv_counter)return void(s||this.error("Counter in message is not larger."));u.rcv_counter=h,n+=t.slice(0,6).join("");var d=a.make1Mac(n,u.rcvmac);if(!a.compare(t[6],d))return void(s||this.error("MACs do not match."));u.rcvmacused=!0;var f=a.decryptAes(t[5].substring(4),u.rcvenc,a.padCtr(t[4]));f=f.toString(e.enc.Latin1),r||this.rotateOurKeys(),c||this.rotateTheirKeys(a.readMPI(t[3]));var p=f.indexOf("\0");return~p&&(this.handleTLVs(f.substring(p+1),u),f=f.substring(0,p)),f=e.enc.Latin1.parse(f),f.toString(e.enc.Utf8)},t.prototype.handleTLVs=function(t,n){for(var i,s,r;t.length&&(i=a.unpackSHORT(t.substr(0,2)),s=a.unpackSHORT(t.substr(2,2)),r=t.substr(4,s),!(r.length<s));){switch(i){case 1:this.msgstate=o.MSGSTATE_FINISHED,this.trigger("status",[o.STATUS_END_OTR]);break;case 2:case 3:case 4:case 5:case 6:case 7:if(this.msgstate!==o.MSGSTATE_ENCRYPTED)return void(this.sm&&this.sm.abort());this.sm||this._smInit(),this.sm.handleSM({msg:r,type:i});break;case 8:r=r.substring(4),r=e.enc.Latin1.parse(r),r=r.toString(e.enc.Utf8),this.trigger("file",["receive",n.extra_symkey,r])}t=t.substring(4+s)}},t.prototype.smpSecret=function(t,n){return this.msgstate!==o.MSGSTATE_ENCRYPTED?this.error("Must be encrypted for SMP."):"string"!=typeof t||t.length<1?this.error("Secret is required."):(this.sm||this._smInit(),t=e.enc.Utf8.parse(t).toString(e.enc.Latin1),n=e.enc.Utf8.parse(n).toString(e.enc.Latin1),void this.sm.rcvSecret(t,n))},t.prototype.sendQueryMsg=function(){var t={},e=o.OTR_TAG;this.ALLOW_V2&&(t[2]=!0),this.ALLOW_V3&&(t[3]=!0);var n=Object.keys(t);n.length&&(e+="v",n.forEach(function(t){"1"!==t&&(e+=t)}),e+="?"),this.io(e),this.trigger("status",[o.STATUS_SEND_QUERY])},t.prototype.sendMsg=function(t,n){switch((this.REQUIRE_ENCRYPTION||this.msgstate!==o.MSGSTATE_PLAINTEXT)&&(t=e.enc.Utf8.parse(t),t=t.toString(e.enc.Latin1)),this.msgstate){case o.MSGSTATE_PLAINTEXT:if(this.REQUIRE_ENCRYPTION)return this.storedMgs.push({msg:t,meta:n}),void this.sendQueryMsg();this.SEND_WHITESPACE_TAG&&!this.receivedPlaintext&&(t+=o.WHITESPACE_TAG,this.ALLOW_V3&&(t+=o.WHITESPACE_TAG_V3),this.ALLOW_V2&&(t+=o.WHITESPACE_TAG_V2));break;case o.MSGSTATE_FINISHED:return this.storedMgs.push({msg:t,meta:n}),void this.error("Message cannot be sent at this time.");case o.MSGSTATE_ENCRYPTED:t=this.prepareMsg(t);break;default:throw new Error("Unknown message state.")}t&&this.io(t,n)},t.prototype.receiveMsg=function(t){if(t=c.parseMsg(this,t)){switch(t.cls){case"error":return void this.error(t.msg);case"ake":if(t.version===o.OTR_VERSION_3&&this.checkInstanceTags(t.instance_tags))return;return void this.ake.handleAKE(t);case"data":if(t.version===o.OTR_VERSION_3&&this.checkInstanceTags(t.instance_tags))return;t.msg=this.handleDataMsg(t),t.encrypted=!0;break;case"query":this.msgstate===o.MSGSTATE_ENCRYPTED&&this._akeInit(),this.doAKE(t);break;default:(this.REQUIRE_ENCRYPTION||this.msgstate!==o.MSGSTATE_PLAINTEXT)&&this.error("Received an unencrypted message."),this.receivedPlaintext=!0,this.WHITESPACE_START_AKE&&t.ver.length>0&&this.doAKE(t)}t.msg&&this.trigger("ui",[t.msg,!!t.encrypted])}},t.prototype.checkInstanceTags=function(t){var e=a.readLen(t.substr(0,4)),n=a.readLen(t.substr(4,4));if(n&&n!==a.readLen(this.our_instance_tag))return!0;if(a.readLen(this.their_instance_tag)){if(a.readLen(this.their_instance_tag)!==e)return!0;
}else{if(e<100)return!0;this.their_instance_tag=a.packINT(e)}},t.prototype.doAKE=function(t){this.ALLOW_V3&&~t.ver.indexOf(o.OTR_VERSION_3)?this.ake.initiateAKE(o.OTR_VERSION_3):this.ALLOW_V2&&~t.ver.indexOf(o.OTR_VERSION_2)?this.ake.initiateAKE(o.OTR_VERSION_2):this.error("OTR conversation requested, but no compatible protocol version found.")},t.prototype.error=function(t,e){return e?(this.debug||(t="An OTR error has occurred."),t="?OTR Error:"+t,void this.io(t)):void this.trigger("error",[t])},t.prototype.sendStored=function(){var t=this;this.storedMgs.splice(0).forEach(function(e){var n=t.prepareMsg(e.msg);t.io(n,e.meta)})},t.prototype.sendFile=function(t){if(this.msgstate!==o.MSGSTATE_ENCRYPTED)return this.error("Not ready to encrypt.");if(this.ake.otr_version!==o.OTR_VERSION_3)return this.error("Protocol v3 required.");if(!t)return this.error("Please specify a filename.");var n=e.enc.Utf8.parse(t);if(n=n.toString(e.enc.Latin1),n.length>=65532)return this.error("filename is too long.");var i="\0";i+="\0\b",i+=a.packSHORT(4+n.length),i+="\0\0\0",i+=n,i=this.prepareMsg(i,t),this.io(i)},t.prototype.endOtr=function(){this.msgstate===o.MSGSTATE_ENCRYPTED&&(this.sendMsg("\0\0\0\0"),this.sm&&(this.smw&&this.sm.worker.terminate(),this.sm=null)),this.msgstate=o.MSGSTATE_PLAINTEXT,this.receivedPlaintext=!1,this.trigger("status",[o.STATUS_END_OTR])},t.makeInstanceTag=function(){var e=n.randBigInt(32);return n.greater(n.str2bigInt("100",16),e)?t.makeInstanceTag():a.packINT(parseInt(n.bigInt2str(e,10),10))}}.call(this),{OTR:this.OTR,DSA:this.DSA}}),define("tpl!toolbar_otr",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",allow_otr&&(__p+='\n    <li class="toggle-otr '+(null==(__t=otr_status_class)?"":__t)+'" title="'+(null==(__t=otr_tooltip)?"":__t)+'">\n        <span class="chat-toolbar-text">'+(null==(__t=otr_translated_status)?"":__t)+"</span>\n        ",otr_status==UNENCRYPTED&&(__p+='\n            <span class="icon-unlocked"></span>\n        '),__p+="\n        ",otr_status==UNVERIFIED&&(__p+='\n            <span class="icon-lock"></span>\n        '),__p+="\n        ",otr_status==VERIFIED&&(__p+='\n            <span class="icon-lock"></span>\n        '),__p+="\n        ",otr_status==FINISHED&&(__p+='\n            <span class="icon-unlocked"></span>\n        '),__p+="\n        <ul>\n            ",otr_status==UNENCRYPTED&&(__p+='\n               <li><a class="start-otr" href="#">'+(null==(__t=label_start_encrypted_conversation)?"":__t)+"</a></li>\n            "),__p+="\n            ",otr_status!=UNENCRYPTED&&(__p+='\n               <li><a class="start-otr" href="#">'+(null==(__t=label_refresh_encrypted_conversation)?"":__t)+'</a></li>\n               <li><a class="end-otr" href="#">'+(null==(__t=label_end_encrypted_conversation)?"":__t)+'</a></li>\n               <li><a class="auth-otr" data-scheme="smp" href="#">'+(null==(__t=label_verify_with_smp)?"":__t)+"</a></li>\n            "),__p+="\n            ",otr_status==UNVERIFIED&&(__p+='\n               <li><a class="auth-otr" data-scheme="fingerprint" href="#">'+(null==(__t=label_verify_with_fingerprints)?"":__t)+"</a></li>\n            "),__p+='\n            <li><a href="http://www.cypherpunks.ca/otr/help/3.2.0/levels.php" target="_blank" rel="noopener">'+(null==(__t=label_whats_this)?"":__t)+"</a></li>\n        </ul>\n    </li>\n"),__p+="\n";return __p}}),function(t,e){define("converse-otr",["otr","converse-core","converse-api","tpl!toolbar_otr"],e)}(this,function(t,e,n,i){"use strict";e.templates.toolbar_otr=i;var s=n.env.Strophe,r=n.env.utils,o=n.env.b64_sha1,a=n.env.jQuery,c=n.env._,l=r.__.bind(e),u="undefined"!=typeof crypto&&("function"==typeof crypto.randomBytes||"function"==typeof crypto.getRandomValues),h=u&&"undefined"!=typeof CryptoJS&&"undefined"!=typeof t.OTR&&"undefined"!=typeof t.DSA,d=0,f=1,p=2,_=3,m={},g={};g[d]="unencrypted",g[f]="unverified",g[p]="verified",g[_]="finished",n.plugins.add("converse-otr",{overrides:{_initialize:function(){this.__super__._initialize.apply(this,arguments),this.otr=new this.OTR},registerGlobalEventHandlers:function(){this.__super__.registerGlobalEventHandlers(),a(document).click(function(){a(".toggle-otr ul").is(":visible")&&a(".toggle-otr ul",this).slideUp(),a(".toggle-smiley ul").is(":visible")&&a(".toggle-smiley ul",this).slideUp()})},wrappedChatBox:function(t){var e=this.__super__.wrappedChatBox.apply(this,arguments);if(t)return c.extend(e,{endOTR:t.endOTR.bind(t),initiateOTR:t.initiateOTR.bind(t)})},ChatBox:{initialize:function(){this.__super__.initialize.apply(this,arguments),"controlbox"!==this.get("box_id")&&this.save({otr_status:this.get("otr_status")||d})},shouldPlayNotification:function(t){return this.__super__.shouldPlayNotification.apply(this,arguments)&&!(r.isOTRMessage(t[0])&&!c.contains([f,p],this.get("otr_status")))},createMessage:function(t,e,n){var i=this.__super__.converse,s=t.children("body"),r=s.length>0?s.text():void 0;if(!r||!i.allow_otr)return this.__super__.createMessage.apply(this,arguments);if(r.match(/^\?OTRv23?/))this.initiateOTR(r);else if(c.contains([f,p],this.get("otr_status")))this.otr.receiveMsg(r);else{if(!r.match(/^\?OTR/))return this.__super__.createMessage.apply(this,arguments);this.otr?this.otr.receiveMsg(r):this.initiateOTR(r)}},getSession:function(e){var n,i,s,r,a=this.__super__.converse,c=CryptoJS.lib.PasswordBasedCipher;if(a.cache_otr_key&&(n=a.otr.getSessionPassphrase(),"undefined"!=typeof n&&(i=window.sessionStorage[o(this.id+"instance_tag")],s=window.sessionStorage[o(this.id+"priv_key")],r=window.sessionStorage[o(this.connection.jid+"pass_check")],s&&i&&"undefined"!=typeof r))){var u=c.decrypt(CryptoJS.algo.AES,s,n),h=t.DSA.parsePrivate(u.toString(CryptoJS.enc.Latin1));if("match"===c.decrypt(CryptoJS.algo.AES,r,n).toString(CryptoJS.enc.Latin1))return this.trigger("showHelpMessages",[l("Re-establishing encrypted session")]),void e({key:h,instance_tag:i})}this.trigger("showHelpMessages",[l("Generating private key."),l("Your browser might become unresponsive.")],null,!0),window.setTimeout(function(){var n=t.OTR.makeInstanceTag();e({key:a.otr.generatePrivateKey.call(this,n),instance_tag:n})},500)},updateOTRStatus:function(e){switch(e){case t.OTR.CONST.STATUS_AKE_SUCCESS:this.otr.msgstate===t.OTR.CONST.MSGSTATE_ENCRYPTED&&this.save({otr_status:f});break;case t.OTR.CONST.STATUS_END_OTR:this.otr.msgstate===t.OTR.CONST.MSGSTATE_FINISHED?this.save({otr_status:_}):this.otr.msgstate===t.OTR.CONST.MSGSTATE_PLAINTEXT&&this.save({otr_status:d})}},onSMP:function(t,e){switch(t){case"question":this.otr.smpSecret(prompt(l("Authentication request from %1$s\n\nYour chat contact is attempting to verify your identity, by asking you the question below.\n\n%2$s",[this.get("fullname"),e])));break;case"trust":e===!0?this.save({otr_status:p}):(this.trigger("showHelpMessages",[l("Could not verify this user's identify.")],"error"),this.save({otr_status:f}));break;default:throw new TypeError("ChatBox.onSMP: Unknown type for SMP")}},initiateOTR:function(e){this.save({otr_status:d}),this.getSession(function(n){var i=this.__super__.converse;this.otr=new t.OTR({fragment_size:140,send_interval:200,priv:n.key,instance_tag:n.instance_tag,debug:this.debug}),this.otr.on("status",this.updateOTRStatus.bind(this)),this.otr.on("smp",this.onSMP.bind(this)),this.otr.on("ui",function(t){this.trigger("showReceivedOTRMessage",t)}.bind(this)),this.otr.on("io",function(t){this.trigger("sendMessage",new i.Message({message:t}))}.bind(this)),this.otr.on("error",function(t){this.trigger("showOTRError",t)}.bind(this)),this.trigger("showHelpMessages",[l("Exchanging private key with contact.")]),e?this.otr.receiveMsg(e):this.otr.sendQueryMsg()}.bind(this))},endOTR:function(){this.otr&&this.otr.endOtr(),this.save({otr_status:d})}},ChatBoxView:{events:{"click .toggle-otr":"toggleOTRMenu","click .start-otr":"startOTRFromToolbar","click .end-otr":"endOTR","click .auth-otr":"authOTR"},initialize:function(){var t=this.__super__.converse;this.__super__.initialize.apply(this,arguments),this.model.on("change:otr_status",this.onOTRStatusChanged,this),this.model.on("showOTRError",this.showOTRError,this),this.model.on("showSentOTRMessage",function(t){this.showMessage({message:t,sender:"me"})},this),this.model.on("showReceivedOTRMessage",function(t){this.showMessage({message:t,sender:"them"})},this),(c.contains([f,p],this.model.get("otr_status"))||t.use_otr_by_default)&&this.model.initiateOTR()},createMessageStanza:function(){var t=this.__super__.createMessageStanza.apply(this,arguments);return(this.model.get("otr_status")!==d||r.isOTRMessage(t.nodeTree))&&t.c("private",{xmlns:s.NS.CARBONS}).up().c("no-store",{xmlns:s.NS.HINTS}).up().c("no-permanent-store",{xmlns:s.NS.HINTS}).up().c("no-copy",{xmlns:s.NS.HINTS}),t},onMessageSubmitted:function(t){var e=this.__super__.converse;if(!e.connection.authenticated)return this.showHelpMessages(["Sorry, the connection has been lost, and your message could not be sent"],"error");var n=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(n){if(e.allow_otr&&"endotr"===n[1])return this.endOTR();if(e.allow_otr&&"otr"===n[1])return this.model.initiateOTR()}c.contains([f,p],this.model.get("otr_status"))?(this.model.otr.sendMsg(t),this.model.trigger("showSentOTRMessage",t)):this.__super__.onMessageSubmitted.apply(this,arguments)},onOTRStatusChanged:function(){this.renderToolbar().informOTRChange()},informOTRChange:function(){var t=this.model.toJSON(),e=[];return t.otr_status===d?e.push(l("Your messages are not encrypted anymore")):t.otr_status===f?e.push(l("Your messages are now encrypted but your contact's identity has not been verified.")):t.otr_status===p?e.push(l("Your contact's identify has been verified.")):t.otr_status===_&&e.push(l("Your contact has ended encryption on their end, you should do the same.")),this.showHelpMessages(e,"info",!1)},showOTRError:function(t){var e=this.__super__.converse;"Message cannot be sent at this time."===t?this.showHelpMessages([l("Your message could not be sent")],"error"):"Received an unencrypted message."===t?this.showHelpMessages([l("We received an unencrypted message")],"error"):"Received an unreadable encrypted message."===t?this.showHelpMessages([l("We received an unreadable encrypted message")],"error"):this.showHelpMessages(["Encryption error occured: "+t],"error"),e.log("OTR ERROR:"+t)},startOTRFromToolbar:function(t){a(t.target).parent().parent().slideUp(),t.stopPropagation(),this.model.initiateOTR()},endOTR:function(t){"undefined"!=typeof t&&(t.preventDefault(),t.stopPropagation()),this.model.endOTR()},authOTR:function(t){var e,n,i,s=this.__super__.converse,r=a(t.target).data().scheme;"fingerprint"===r?(e=confirm(l("Here are the fingerprints, please confirm them with %1$s, outside of this chat.\n\nFingerprint for you, %2$s: %3$s\n\nFingerprint for %1$s: %4$s\n\nIf you have confirmed that the fingerprints match, click OK, otherwise click Cancel.",[this.model.get("fullname"),s.xmppstatus.get("fullname")||s.bare_jid,this.model.otr.priv.fingerprint(),this.model.otr.their_priv_pk.fingerprint()])),e===!0?this.model.save({otr_status:p}):this.model.save({otr_status:f})):"smp"===r?(alert(l("You will be prompted to provide a security question and then an answer to that question.\n\nYour contact will then be prompted the same question and if they type the exact same answer (case sensitive), their identity will be verified.")),n=prompt(l("What is your security question?")),n&&(i=prompt(l("What is the answer to the security question?")),this.model.otr.smpSecret(i,n))):this.showHelpMessages([l("Invalid authentication scheme provided")],"error")},toggleOTRMenu:function(t){t.stopPropagation(),this.$el.find(".toggle-otr ul").slideToggle(200)},getOTRTooltip:function(){var t=this.model.toJSON();return t.otr_status===d?l("Your messages are not encrypted. Click here to enable OTR encryption."):t.otr_status===f?l("Your messages are encrypted, but your contact has not been verified."):t.otr_status===p?l("Your messages are encrypted and your contact verified."):t.otr_status===_?l("Your contact has closed their end of the private session, you should do the same"):void 0},renderToolbar:function(t,e){var n=this.__super__.converse;if(n.show_toolbar){var i=this.model.toJSON();return e=c.extend(e||{},{FINISHED:_,UNENCRYPTED:d,UNVERIFIED:f,VERIFIED:p,allow_otr:n.allow_otr&&!this.is_chatroom,label_end_encrypted_conversation:l("End encrypted conversation"),label_refresh_encrypted_conversation:l("Refresh encrypted conversation"),label_start_encrypted_conversation:l("Start encrypted conversation"),label_verify_with_fingerprints:l("Verify with fingerprints"),label_verify_with_smp:l("Verify with SMP"),label_whats_this:l("What's this?"),otr_status_class:g[i.otr_status],otr_tooltip:this.getOTRTooltip(),otr_translated_status:m[i.otr_status]}),this.__super__.renderToolbar.apply(this,arguments),this.$el.find(".chat-toolbar").append(n.templates.toolbar_otr(c.extend(this.model.toJSON(),e||{}))),this}}}},initialize:function(){var e=this.converse;m[d]=l("unencrypted"),m[f]=l("unverified"),m[p]=l("verified"),m[_]=l("finished"),l=r.__.bind(e);var n={allow_otr:!0,cache_otr_key:!1,use_otr_by_default:!1};c.extend(e.default_settings,n),c.extend(e,n),c.extend(e,c.pick(e.user_settings,Object.keys(n))),e.allow_otr=e.allow_otr&&h,e.use_otr_by_default=e.use_otr_by_default&&e.allow_otr,e.OTR=Backbone.Model.extend({getSessionPassphrase:function(){if("prebind"===e.authentication){var t=o(e.connection.jid),n=window.sessionStorage[t];return"undefined"==typeof n&&(n=Math.floor(4294967295*Math.random()).toString(),window.sessionStorage[t]=n),n}return e.connection.pass},generatePrivateKey:function(n){var i=new t.DSA,s=e.connection.jid;if(e.cache_otr_key){var r=CryptoJS.lib.PasswordBasedCipher,a=this.getSessionPassphrase();"undefined"!=typeof a&&(window.sessionStorage[o(s+"priv_key")]=r.encrypt(CryptoJS.algo.AES,i.packPrivate(),a).toString(),window.sessionStorage[o(s+"instance_tag")]=n,window.sessionStorage[o(s+"pass_check")]=r.encrypt(CryptoJS.algo.AES,"match",a).toString())}return i}})}})}),function(t,e){"function"==typeof define&&define.amd?define("strophe.ping",["strophe"],function(t){return e(t.Strophe,t.$build,t.$iq,t.$msg,t.$pres),t}):e(t.Strophe,t.$build,t.$iq,t.$msg,t.$pres)}(this,function(t,e,n,i,s){t.addConnectionPlugin("ping",{_c:null,init:function(e){this._c=e,t.addNamespace("PING","urn:xmpp:ping")},ping:function(e,i,s,r){var o=this._c.getUniqueId("ping"),a=n({type:"get",to:e,id:o}).c("ping",{xmlns:t.NS.PING});this._c.sendIQ(a,i,s,r)},pong:function(t){var e=t.getAttribute("from"),i=t.getAttribute("id"),s=n({type:"result",to:e,id:i});this._c.sendIQ(s)},addPingHandler:function(e){return this._c.addHandler(e,t.NS.PING,"iq","get")}})}),function(t,e){define("converse-ping",["converse-core","converse-api","strophe.ping"],e)}(this,function(t,e){"use strict";var n=e.env.Strophe,i=e.env._;e.plugins.add("converse-ping",{initialize:function(){var t=this.converse;this.updateSettings({ping_interval:180}),t.ping=function(e,i,s,r){return t.lastStanzaDate=new Date,"undefined"!=typeof e&&null!==e||(e=n.getDomainFromJid(t.bare_jid)),"undefined"==typeof r&&(r=null),"undefined"==typeof i&&(i=null),"undefined"==typeof s&&(s=null),!!t.connection&&(t.connection.ping.ping(e,i,s,r),!0)},t.pong=function(e){return t.lastStanzaDate=new Date,t.connection.ping.pong(e),!0},t.registerPongHandler=function(){t.connection.disco.addFeature(n.NS.PING),t.connection.ping.addPingHandler(t.pong)},t.registerPingHandler=function(){t.registerPongHandler(),t.ping_interval>0&&(t.connection.addHandler(function(){return t.lastStanzaDate=new Date,!0}),t.connection.addTimedHandler(1e3,function(){var e=new Date;return t.lastStanzaDate||(t.lastStanzaDate=e),!((e-t.lastStanzaDate)/1e3>t.ping_interval)||t.ping()}))},i.extend(e,{ping:function(e){t.ping(e)}});var s=function(){t.registerPingHandler()};t.on("connected",s),t.on("reconnected",s)}})}),function(t,e){define("converse-notification",["converse-core","converse-api"],e)}(this,function(t,e){"use strict";var n=e.env.jQuery,i=e.env.utils,s=e.env.Strophe,r=e.env._,o=i.__.bind(t),a=i.___;e.plugins.add("converse-notification",{initialize:function(){var t=this.converse;t.supports_html5_notification="Notification"in window,this.updateSettings({notify_all_room_messages:!1,show_desktop_notifications:!0,chatstate_notification_blacklist:[],play_sounds:!1,sounds_path:"/sounds/",notification_icon:"/logo/conversejs128.png"}),t.isOnlyChatStateNotification=function(e){return 0===e.find("body").length&&(0!==e.find(t.ACTIVE).length||0!==e.find(t.COMPOSING).length||0!==e.find(t.INACTIVE).length||0!==e.find(t.PAUSED).length||0!==e.find(t.GONE).length)},t.shouldNotifyOfGroupMessage=function(e){var n=t.notify_all_room_messages,i=e.attr("from"),o=s.getResourceFromJid(i),a=s.getBareJidFromJid(i),c=o&&s.unescapeNode(o)||"";if(""===c||e.find("delay").length>0)return!1;var l=t.chatboxes.get(a),u=e.children("body");if(!u.length)return!1;var h=new RegExp("\\b"+l.get("nick")+"\\b").test(u.text());return n=n===!0||r.isArray(n)&&r.contains(n,a),!(c===l.get("nick")||!n&&!h)},t.shouldNotifyOfMessage=function(e){if(i.isOTRMessage(e))return!1;var r=n(e),o=r.find("forwarded");if(o.length)return!1;if("groupchat"===r.attr("type"))return t.shouldNotifyOfGroupMessage(r);if(i.isHeadlineMessage(e))return!0;var a=s.getBareJidFromJid(r.attr("from"))===t.bare_jid;return!t.isOnlyChatStateNotification(r)&&!a},t.playSoundNotification=function(e){var n;t.play_sounds&&"undefined"!=typeof Audio&&(n=new Audio(t.sounds_path+"msg_received.ogg"),n.canPlayType("/audio/ogg")?n.play():(n=new Audio(t.sounds_path+"msg_received.mp3"),n.play()))},t.areDesktopNotificationsEnabled=function(e){var n=t.supports_html5_notification&&t.show_desktop_notifications&&"granted"===Notification.permission;return e?n:n&&"hidden"===t.windowState},t.showMessageNotification=function(e){var n,i,r,c,l=e.attr("from");if("headline"===e.attr("type")||l.indexOf("@")===-1)i=o(a("Notification from %1$s"),l);else if("groupchat"===e.attr("type"))i=o(a("%1$s says"),s.getResourceFromJid(l));else{if("undefined"==typeof t.roster)return void t.log("Could not send notification, because roster is undefined","error");r=s.getBareJidFromJid(e.attr("from")),c=t.roster.get(r),i=o(a("%1$s says"),c.get("fullname"))}n=new Notification(i,{body:e.children("body").text(),lang:t.i18n.locale_data.converse[""].lang,icon:t.notification_icon}),setTimeout(n.close.bind(n),5e3)},t.showChatStateNotification=function(e){if(!r.contains(t.chatstate_notification_blacklist,e.jid)){var n=e.chat_status,i=null;if("offline"===n?i=o("has gone offline"):"away"===n?i=o("has gone away"):"dnd"===n?i=o("is busy"):"online"===n&&(i=o("has come online")),null!==i){var s=new Notification(e.fullname,{body:i,lang:t.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(s.close.bind(s),5e3)}}},t.showContactRequestNotification=function(e){var n=new Notification(e.fullname,{body:o("wants to be your contact"),lang:t.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(n.close.bind(n),5e3)},t.showFeedbackNotification=function(e){if("error"===e.klass||"warn"===e.klass){var n=new Notification(e.subject,{body:e.message,lang:t.i18n.locale_data.converse[""].lang,icon:"logo/conversejs.png"});setTimeout(n.close.bind(n),5e3)}},t.handleChatStateNotification=function(e,n){t.areDesktopNotificationsEnabled()&&t.showChatStateNotification(n)},t.handleMessageNotification=function(e,i){var s=n(i);return!!t.shouldNotifyOfMessage(i)&&(t.playSoundNotification(s),void(t.areDesktopNotificationsEnabled()&&t.showMessageNotification(s)))},t.handleContactRequestNotification=function(e,n){t.areDesktopNotificationsEnabled(!0)&&t.showContactRequestNotification(n)},t.handleFeedback=function(e,n){t.areDesktopNotificationsEnabled(!0)&&t.showFeedbackNotification(n)},t.requestPermission=function(e){t.supports_html5_notification&&!r.contains(["denied","granted"],Notification.permission)&&Notification.requestPermission()},t.on("pluginsInitialized",function(){t.on("contactRequest",t.handleContactRequestNotification),t.on("contactStatusChanged",t.handleChatStateNotification),t.on("message",t.handleMessageNotification),t.on("feedback",t.handleFeedback),t.on("connected",t.requestPermission)})}})}),define("tpl!chatbox_minimize",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="chatbox-btn toggle-chatbox-button icon-minus" title="'+(null==(__t=info_minimize)?"":__t)+'"></a>\n';return __p}}),define("tpl!toggle_chats",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+=""+(null==(__t=Minimized)?"":__t)+' <span id="minimized-count">('+(null==(__t=num_minimized)?"":__t)+')</span>\n<span class="unread-message-count"\n    ',num_unread||(__p+=' style="display: none" '),__p+='\n    href="#">'+(null==(__t=num_unread)?"":__t)+"</span>\n";return __p}}),define("tpl!trimmed_chat",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a class="chatbox-btn close-chatbox-button icon-close"></a>\n<a class="chat-head-message-count" \n    ',num_unread||(__p+=' style="display: none" '),__p+='\n    href="#">'+(null==(__t=num_unread)?"":__t)+'</a>\n<a href="#" class="restore-chat" title="'+(null==(__t=tooltip)?"":__t)+'">\n    '+(null==(__t=title)?"":__t)+"\n</a>\n";return __p}}),define("tpl!chatarea",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-area">\n    <div class="chat-content"></div>\n    <div class="new-msgs-indicator hidden">‚ñº '+(null==(__t=unread_msgs)?"":__t)+' ‚ñº</div>\n    <form class="sendXMPPMessage" action="" method="post">\n        ',show_toolbar&&(__p+='\n            <ul class="chat-toolbar no-text-select"></ul>\n        '),__p+='\n        <textarea type="text" class="chat-textarea" \n            placeholder="'+(null==(__t=label_message)?"":__t)+'"/>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="flyout box-flyout">\n    <div class="dragresize dragresize-top"></div>\n    <div class="dragresize dragresize-topleft"></div>\n    <div class="dragresize dragresize-left"></div>\n    <div class="chat-head chat-head-chatroom">\n        <a class="chatbox-btn close-chatbox-button icon-close" title="'+(null==(__t=info_close)?"":__t)+'"></a>\n        <a class="chatbox-btn configure-chatroom-button icon-wrench" title="'+(null==(__t=info_configure)?"":__t)+' "style="display:none"></a>\n        <div class="chat-title">\n            '+(null==(__t=_.escape(name))?"":__t)+'\n            <p class="chatroom-topic"><p/>\n        </div>\n    </div>\n    <div class="chat-body chatroom-body"><span class="spinner centered"/></div>\n</div>\n';return __p}}),define("tpl!chatroom_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form pure-form-stacked converse-form chatroom-form">\n        <fieldset>\n            <span class="spinner centered"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_nickname_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form converse-form chatroom-form">\n        <fieldset>\n            <label>'+(null==(__t=heading)?"":__t)+'</label>\n            <p class="validation-message">'+(null==(__t=validation_message)?"":__t)+'</p>\n            <input type="text" required="required" name="nick" class="new-chatroom-nick" placeholder="'+(null==(__t=label_nickname)?"":__t)+'"/>\n        </fieldset>\n        <fieldset>\n            <input type="submit" class="pure-button button-primary" name="join" value="'+(null==(__t=label_join)?"":__t)+'"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_password_form",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chatroom-form-container">\n    <form class="pure-form converse-form chatroom-form">\n        <fieldset>\n            <legend>'+(null==(__t=heading)?"":__t)+"</legend>\n            <label>"+(null==(__t=label_password)?"":__t)+'</label>\n            <input type="password" name="password"/>\n        </fieldset>\n        <fieldset>\n            <input class="pure-button button-primary" type="submit" value="'+(null==(__t=label_submit)?"":__t)+'"/>\n        </fieldset>\n    </form>\n</div>\n';return __p}}),define("tpl!chatroom_sidebar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- <div class="occupants"> -->\n',allow_muc_invitations&&(__p+='\n<form class="pure-form room-invite">\n    <input class="invited-contact" placeholder="'+(null==(__t=label_invitation)?"":__t)+'" type="text"/>\n</form>\n'),__p+='\n<p class="occupants-heading">'+(null==(__t=label_occupants)?"":__t)+':</p>\n<ul class="occupant-list"></ul>\n<!-- </div> -->\n';return __p}}),define("tpl!chatroom_toolbar",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",show_emoticons&&(__p+='\n    <li class="toggle-smiley icon-happy" title="'+(null==(__t=label_insert_smiley)?"":__t)+'">\n        <ul>\n            <li><a class="icon-smiley" href="#" data-emoticon=":)"></a></li>\n            <li><a class="icon-wink" href="#" data-emoticon=";)"></a></li>\n            <li><a class="icon-grin" href="#" data-emoticon=":D"></a></li>\n            <li><a class="icon-tongue" href="#" data-emoticon=":P"></a></li>\n            <li><a class="icon-cool" href="#" data-emoticon="8)"></a></li>\n            <li><a class="icon-evil" href="#" data-emoticon=">:)"></a></li>\n            <li><a class="icon-confused" href="#" data-emoticon=":S"></a></li>\n            <li><a class="icon-wondering" href="#" data-emoticon=":\\"></a></li>\n            <li><a class="icon-angry" href="#" data-emoticon=">:("></a></li>\n            <li><a class="icon-sad" href="#" data-emoticon=":("></a></li>\n            <li><a class="icon-shocked" href="#" data-emoticon=":O"></a></li>\n            <li><a class="icon-thumbs-up" href="#" data-emoticon="(^.^)b"></a></li>\n            <li><a class="icon-heart" href="#" data-emoticon="<3"></a></li>\n        </ul>\n    </li>\n'),__p+="\n",show_call_button&&(__p+='\n<li class="toggle-call"><a class="icon-phone" title="'+(null==(__t=label_start_call)?"":__t)+'"></a></li>\n'),__p+="\n",show_occupants_toggle&&(__p+='\n<li class="toggle-occupants"><a class="icon-hide-users" title="'+(null==(__t=label_hide_occupants)?"":__t)+'"></a></li>\n'),__p+="\n",show_clear_button&&(__p+='\n<li class="toggle-clear"><a class="icon-remove" title="'+(null==(__t=label_clear)?"":__t)+'"></a></li>\n'),__p+="\n\n";return __p}}),define("tpl!chatrooms_tab",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li><a class="s ',is_current&&(__p+=" current "),__p+='"\n       data-id="chatrooms" href="#chatrooms">\n    '+(null==(__t=label_rooms)?"":__t)+"\n</a></li>\n";return __p}}),define("tpl!info",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="chat-info">'+(null==(__t=message)?"":__t)+"</div>\n";return __p}}),define("tpl!occupant",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li class="'+(null==(__t=role)?"":__t)+' occupant" id="'+(null==(__t=id)?"":__t)+'"\n    ',"moderator"===role&&(__p+='\n       title="'+(null==(__t=desc_moderator)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+="\n    ","occupant"===role&&(__p+='\n       title="'+(null==(__t=desc_occupant)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+="\n    ","visitor"===role&&(__p+='\n       title="'+(null==(__t=desc_visitor)?"":__t)+" "+(null==(__t=hint_occupant)?"":__t)+'"\n    '),__p+=">"+(null==(__t=nick)?"":__t)+"</li>\n";return __p}}),define("tpl!room_description",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- FIXME: check markup in mockup -->\n<div class="room-info">\n<p class="room-info"><strong>'+(null==(__t=label_desc)?"":__t)+"</strong> "+(null==(__t=desc)?"":__t)+'</p>\n<p class="room-info"><strong>'+(null==(__t=label_occ)?"":__t)+"</strong> "+(null==(__t=occ)?"":__t)+'</p>\n<p class="room-info"><strong>'+(null==(__t=label_features)?"":__t)+"</strong>\n    <ul>\n        ",passwordprotected&&(__p+='\n        <li class="room-info locked">'+(null==(__t=label_requires_auth)?"":__t)+"</li>\n        "),__p+="\n        ",hidden&&(__p+='\n        <li class="room-info">'+(null==(__t=label_hidden)?"":__t)+"</li>\n        "),__p+="\n        ",membersonly&&(__p+='\n        <li class="room-info">'+(null==(__t=label_requires_invite)?"":__t)+"</li>\n        "),__p+="\n        ",moderated&&(__p+='\n        <li class="room-info">'+(null==(__t=label_moderated)?"":__t)+"</li>\n        "),__p+="\n        ",nonanonymous&&(__p+='\n        <li class="room-info">'+(null==(__t=label_non_anon)?"":__t)+"</li>\n        "),__p+="\n        ",open&&(__p+='\n        <li class="room-info">'+(null==(__t=label_open_room)?"":__t)+"</li>\n        "),__p+="\n        ",persistent&&(__p+='\n        <li class="room-info">'+(null==(__t=label_permanent_room)?"":__t)+"</li>\n        "),__p+="\n        ",publicroom&&(__p+='\n        <li class="room-info">'+(null==(__t=label_public)?"":__t)+"</li>\n        "),__p+="\n        ",semianonymous&&(__p+='\n        <li class="room-info">'+(null==(__t=label_semi_anon)?"":__t)+"</li>\n        "),__p+="\n        ",temporary&&(__p+='\n        <li class="room-info">'+(null==(__t=label_temp_room)?"":__t)+"</li>\n        "),__p+="\n        ",unmoderated&&(__p+='\n        <li class="room-info">'+(null==(__t=label_unmoderated)?"":__t)+"</li>\n        "),__p+="\n    </ul>\n</p>\n</div>\n";return __p}}),define("tpl!room_item",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<dd class="available-chatroom">\n<a class="open-room" data-room-jid="'+(null==(__t=jid)?"":__t)+'"\n   title="'+(null==(__t=open_title)?"":__t)+'" href="#">'+(null==(__t=_.escape(name))?"":__t)+'</a>\n<a class="room-info icon-room-info" data-room-jid="'+(null==(__t=jid)?"":__t)+'"\n   title="'+(null==(__t=info_title)?"":__t)+'" href="#">&nbsp;</a>\n</dd>\n';return __p}}),define("tpl!room_panel",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<form class="pure-form pure-form-stacked converse-form add-chatroom" action="" method="post">\n    <fieldset>\n        <label>'+(null==(__t=label_room_name)?"":__t)+'</label>\n        <input type="text" name="chatroom" class="new-chatroom-name" placeholder="'+(null==(__t=label_room_name)?"":__t)+'"/>\n        ',"hidden"!=server_input_type&&(__p+="\n            <label"+(null==(__t=server_label_global_attr)?"":__t)+">"+(null==(__t=label_server)?"":__t)+"</label>\n        "),__p+='\n        <input type="'+(null==(__t=server_input_type)?"":__t)+'" name="server" class="new-chatroom-server" placeholder="'+(null==(__t=label_server)?"":__t)+'"/>\n        <input type="submit" class="pure-button button-primary" name="join" value="'+(null==(__t=label_join)?"":__t)+'"/>\n        <input type="button" class="pure-button button-secondary" name="show" id="show-rooms" value="'+(null==(__t=label_show_rooms)?"":__t)+'"/>\n    </fieldset>\n</form>\n<dl id="available-chatrooms" class="rooms-list"></dl>\n';
return __p}}),function(t,e){"function"==typeof define&&define.amd?define("typeahead",["jquery"],function(n){e(n,t)}):e(jQuery,t)}(this,function(t,e){var n=function(){"use strict";return{isMsie:function(){return!!/(msie|trident)/i.test(navigator.userAgent)&&navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]},isBlankString:function(t){return!t||/^\s*$/.test(t)},escapeRegExChars:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isArray:t.isArray,isFunction:t.isFunction,isObject:t.isPlainObject,isUndefined:function(t){return"undefined"==typeof t},toStr:function(t){return n.isUndefined(t)||null===t?"":t+""},bind:t.proxy,each:function(e,n){function i(t,e){return n(e,t)}t.each(e,i)},map:t.map,filter:t.grep,every:function(e,n){var i=!0;return e?(t.each(e,function(t,s){if(!(i=n.call(null,s,t,e)))return!1}),!!i):i},some:function(e,n){var i=!1;return e?(t.each(e,function(t,s){if(i=n.call(null,s,t,e))return!1}),!!i):i},mixin:t.extend,getUniqueId:function(){var t=0;return function(){return t++}}(),templatify:function(e){function n(){return String(e)}return t.isFunction(e)?e:n},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i,s;return function(){var r,o,a=this,c=arguments;return r=function(){i=null,n||(s=t.apply(a,c))},o=n&&!i,clearTimeout(i),i=setTimeout(r,e),o&&(s=t.apply(a,c)),s}},throttle:function(t,e){var n,i,s,r,o,a;return o=0,a=function(){o=new Date,s=null,r=t.apply(n,i)},function(){var c=new Date,l=e-(c-o);return n=this,i=arguments,l<=0?(clearTimeout(s),s=null,o=c,r=t.apply(n,i)):s||(s=setTimeout(a,l)),r}},noop:function(){}}}(),i=function(){return{wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'}}(),s=function(){"use strict";var t={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};return n.isMsie()&&n.mixin(t.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"}),n.isMsie()&&n.isMsie()<=7&&n.mixin(t.input,{marginTop:"-1px"}),t}(),r=function(){"use strict";function e(e){e&&e.el||t.error("EventBus initialized without el"),this.$el=t(e.el)}var i="typeahead:";return n.mixin(e.prototype,{trigger:function(t){var e=[].slice.call(arguments,1);this.$el.trigger(i+t,e)}}),e}(),o=function(){"use strict";function t(t,e,n,i){var s;if(!n)return this;for(e=e.split(l),n=i?c(n,i):n,this._callbacks=this._callbacks||{};s=e.shift();)this._callbacks[s]=this._callbacks[s]||{sync:[],async:[]},this._callbacks[s][t].push(n);return this}function n(e,n,i){return t.call(this,"async",e,n,i)}function i(e,n,i){return t.call(this,"sync",e,n,i)}function s(t){var e;if(!this._callbacks)return this;for(t=t.split(l);e=t.shift();)delete this._callbacks[e];return this}function r(t){var e,n,i,s,r;if(!this._callbacks)return this;for(t=t.split(l),i=[].slice.call(arguments,1);(e=t.shift())&&(n=this._callbacks[e]);)s=o(n.sync,this,[e].concat(i)),r=o(n.async,this,[e].concat(i)),s()&&u(r);return this}function o(t,e,n){function i(){for(var i,s=0,r=t.length;!i&&s<r;s+=1)i=t[s].apply(e,n)===!1;return!i}return i}function a(){var t;return t=e.setImmediate?function(t){setImmediate(function(){t()})}:function(t){setTimeout(function(){t()},0)}}function c(t,e){return t.bind?t.bind(e):function(){t.apply(e,[].slice.call(arguments,0))}}var l=/\s+/,u=a();return{onSync:i,onAsync:n,off:s,trigger:r}}(),a=function(t){"use strict";function e(t,e,i){for(var s,r=[],o=0,a=t.length;o<a;o++)r.push(n.escapeRegExChars(t[o]));return s=i?"\\b("+r.join("|")+")\\b":"("+r.join("|")+")",e?new RegExp(s):new RegExp(s,"i")}var i={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(s){function r(e){var n,i,r;return(n=a.exec(e.data))&&(r=t.createElement(s.tagName),s.className&&(r.className=s.className),i=e.splitText(n.index),i.splitText(n[0].length),r.appendChild(i.cloneNode(!0)),e.parentNode.replaceChild(r,i)),!!n}function o(t,e){for(var n,i=3,s=0;s<t.childNodes.length;s++)n=t.childNodes[s],n.nodeType===i?s+=e(n)?1:0:o(n,e)}var a;s=n.mixin({},i,s),s.node&&s.pattern&&(s.pattern=n.isArray(s.pattern)?s.pattern:[s.pattern],a=e(s.pattern,s.caseSensitive,s.wordsOnly),o(s.node,r))}}(e.document),c=function(){"use strict";function e(e){var s,r,o,c,l=this;e=e||{},e.input||t.error("input is missing"),s=n.bind(this._onBlur,this),r=n.bind(this._onFocus,this),o=n.bind(this._onKeydown,this),c=n.bind(this._onInput,this),this.$hint=t(e.hint),this.$input=t(e.input).on("blur.tt",s).on("focus.tt",r).on("keydown.tt",o),0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=n.noop),n.isMsie()?this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(t){a[t.which||t.keyCode]||n.defer(n.bind(l._onInput,l,t))}):this.$input.on("input.tt",c),this.query=this.$input.val(),this.$overflowHelper=i(this.$input)}function i(e){return t('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:e.css("font-family"),fontSize:e.css("font-size"),fontStyle:e.css("font-style"),fontVariant:e.css("font-variant"),fontWeight:e.css("font-weight"),wordSpacing:e.css("word-spacing"),letterSpacing:e.css("letter-spacing"),textIndent:e.css("text-indent"),textRendering:e.css("text-rendering"),textTransform:e.css("text-transform")}).insertAfter(e)}function s(t,n){return e.normalizeQuery(t)===e.normalizeQuery(n)}function r(t){return t.altKey||t.ctrlKey||t.metaKey||t.shiftKey}var a;return a={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"},e.normalizeQuery=function(t){return(t||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")},n.mixin(e.prototype,o,{_onBlur:function(){this.resetInputValue(),this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(t){var e=a[t.which||t.keyCode];this._managePreventDefault(e,t),e&&this._shouldTrigger(e,t)&&this.trigger(e+"Keyed",t)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(t,e){var n,i,s;switch(t){case"tab":i=this.getHint(),s=this.getInputValue(),n=i&&i!==s&&!r(e);break;case"up":case"down":n=!r(e);break;default:n=!1}n&&e.preventDefault()},_shouldTrigger:function(t,e){var n;switch(t){case"tab":n=!r(e);break;default:n=!0}return n},_checkInputValue:function(){var t,e,n;t=this.getInputValue(),e=s(t,this.query),n=!!e&&this.query.length!==t.length,this.query=t,e?n&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(t){this.query=t},getInputValue:function(){return this.$input.val()},setInputValue:function(t,e){this.$input.val(t),e?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(t){this.$hint.val(t)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var t,e,n,i;t=this.getInputValue(),e=this.getHint(),n=t!==e&&0===e.indexOf(t),i=""!==t&&n&&!this.hasOverflow(),!i&&this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var t=this.$input.width()-2;return this.$overflowHelper.text(this.getInputValue()),this.$overflowHelper.width()>=t},isCursorAtEnd:function(){var t,e,i;return t=this.$input.val().length,e=this.$input[0].selectionStart,n.isNumber(e)?e===t:!document.selection||(i=document.selection.createRange(),i.moveStart("character",-t),t===i.text.length)},destroy:function(){this.$hint.off(".tt"),this.$input.off(".tt"),this.$hint=this.$input=this.$overflowHelper=null}}),e}(),l=function(){"use strict";function e(e){e=e||{},e.templates=e.templates||{},e.source||t.error("missing source"),e.name&&!l(e.name)&&t.error("invalid dataset name: "+e.name),this.query=null,this.highlight=!!e.highlight,this.name=e.name||n.getUniqueId(),this.source=e.source,this.displayFn=r(e.display||e.displayKey),this.templates=c(e.templates,this.displayFn),this.$el=t(i.dataset.replace("%CLASS%",this.name))}function r(t){function e(e){return e[t]}return t=t||"value",n.isFunction(t)?t:e}function c(t,e){function i(t){return"<p>"+e(t)+"</p>"}return{empty:t.empty&&n.templatify(t.empty),header:t.header&&n.templatify(t.header),footer:t.footer&&n.templatify(t.footer),suggestion:t.suggestion||i}}function l(t){return/^[_a-zA-Z0-9-]+$/.test(t)}var u="ttDataset",h="ttValue",d="ttDatum";return e.extractDatasetName=function(e){return t(e).data(u)},e.extractValue=function(e){return t(e).data(h)},e.extractDatum=function(e){return t(e).data(d)},n.mixin(e.prototype,o,{_render:function(e,r){function o(){return _.templates.empty({query:e,isEmpty:!0})}function c(){function o(e){var n;return n=t(i.suggestion).append(_.templates.suggestion(e)).data(u,_.name).data(h,_.displayFn(e)).data(d,e),n.children().each(function(){t(this).css(s.suggestionChild)}),n}var c,l;return c=t(i.suggestions).css(s.suggestions),l=n.map(r,o),c.append.apply(c,l),_.highlight&&a({className:"tt-highlight",node:c[0],pattern:e}),c}function l(){return _.templates.header({query:e,isEmpty:!p})}function f(){return _.templates.footer({query:e,isEmpty:!p})}if(this.$el){var p,_=this;this.$el.empty(),p=r&&r.length,!p&&this.templates.empty?this.$el.html(o()).prepend(_.templates.header?l():null).append(_.templates.footer?f():null):p&&this.$el.html(c()).prepend(_.templates.header?l():null).append(_.templates.footer?f():null),this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(t){function e(e){n.canceled||t!==n.query||n._render(t,e)}var n=this;this.query=t,this.canceled=!1,this.source(t,e)},cancel:function(){this.canceled=!0},clear:function(){this.cancel(),this.$el.empty(),this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}}),e}(),u=function(){"use strict";function e(e){var s,r,o,a=this;e=e||{},e.menu||t.error("menu is required"),this.isOpen=!1,this.isEmpty=!0,this.datasets=n.map(e.datasets,i),s=n.bind(this._onSuggestionClick,this),r=n.bind(this._onSuggestionMouseEnter,this),o=n.bind(this._onSuggestionMouseLeave,this),this.$menu=t(e.menu).on("click.tt",".tt-suggestion",s).on("mouseenter.tt",".tt-suggestion",r).on("mouseleave.tt",".tt-suggestion",o),n.each(this.datasets,function(t){a.$menu.append(t.getRoot()),t.onSync("rendered",a._onRendered,a)})}function i(t){return new l(t)}return n.mixin(e.prototype,o,{_onSuggestionClick:function(e){this.trigger("suggestionClicked",t(e.currentTarget))},_onSuggestionMouseEnter:function(e){this._removeCursor(),this._setCursor(t(e.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){function t(t){return t.isEmpty()}this.isEmpty=n.every(this.datasets,t),this.isEmpty?this._hide():this.isOpen&&this._show(),this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(t,e){t.first().addClass("tt-cursor"),!e&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(t){var e,n,i,s;if(this.isOpen){if(n=this._getCursor(),e=this._getSuggestions(),this._removeCursor(),i=e.index(n)+t,i=(i+1)%(e.length+1)-1,i===-1)return void this.trigger("cursorRemoved");i<-1&&(i=e.length-1),this._setCursor(s=e.eq(i)),this._ensureVisible(s)}},_ensureVisible:function(t){var e,n,i,s;e=t.position().top,n=e+t.outerHeight(!0),i=this.$menu.scrollTop(),s=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),e<0?this.$menu.scrollTop(i+e):s<n&&this.$menu.scrollTop(i+(n-s))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(t){this.$menu.css("ltr"===t?s.ltr:s.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(t){var e=null;return t.length&&(e={raw:l.extractDatum(t),value:l.extractValue(t),datasetName:l.extractDatasetName(t)}),e},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(t){function e(e){e.update(t)}n.each(this.datasets,e)},empty:function(){function t(t){t.clear()}n.each(this.datasets,t),this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){function t(t){t.destroy()}this.$menu.off(".tt"),this.$menu=null,n.each(this.datasets,t)}}),e}(),h=function(){"use strict";function e(e){var i,s,a;e=e||{},e.input||t.error("missing input"),this.isActivated=!1,this.autoselect=!!e.autoselect,this.minLength=n.isNumber(e.minLength)?e.minLength:1,this.$node=o(e.input,e.withHint),i=this.$node.find(".tt-dropdown-menu"),s=this.$node.find(".tt-input"),a=this.$node.find(".tt-hint"),s.on("blur.tt",function(t){var e,r,o;e=document.activeElement,r=i.is(e),o=i.has(e).length>0,n.isMsie()&&(r||o)&&(t.preventDefault(),t.stopImmediatePropagation(),n.defer(function(){s.focus()}))}),i.on("mousedown.tt",function(t){t.preventDefault()}),this.eventBus=e.eventBus||new r({el:s}),this.dropdown=new u({menu:i,datasets:e.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this),this.input=new c({input:s,hint:a}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this),this._setLanguageDirection()}function o(e,n){var r,o,c,l;r=t(e),o=t(i.wrapper).css(s.wrapper),c=t(i.dropdown).css(s.dropdown),l=r.clone().css(s.hint).css(a(r)),l.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1}),r.data(h,{dir:r.attr("dir"),autocomplete:r.attr("autocomplete"),spellcheck:r.attr("spellcheck"),style:r.attr("style")}),r.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(n?s.input:s.inputWithNoHint);try{!r.attr("dir")&&r.attr("dir","auto")}catch(t){}return r.wrap(o).parent().prepend(n?l:null).append(c)}function a(t){return{backgroundAttachment:t.css("background-attachment"),backgroundClip:t.css("background-clip"),backgroundColor:t.css("background-color"),backgroundImage:t.css("background-image"),backgroundOrigin:t.css("background-origin"),backgroundPosition:t.css("background-position"),backgroundRepeat:t.css("background-repeat"),backgroundSize:t.css("background-size")}}function l(t){var e=t.find(".tt-input");n.each(e.data(h),function(t,i){n.isUndefined(t)?e.removeAttr(i):e.attr(i,t)}),e.detach().removeData(h).removeClass("tt-input").insertAfter(t),t.remove()}var h="ttAttrs";return n.mixin(e.prototype,{_onSuggestionClicked:function(t,e){var n;(n=this.dropdown.getDatumForSuggestion(e))&&this._select(n)},_onCursorMoved:function(){var t=this.dropdown.getDatumForCursor();this.input.setInputValue(t.value,!0),this.eventBus.trigger("cursorchanged",t.raw,t.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue(),this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint(),this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint(),this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0,this.dropdown.open()},_onBlurred:function(){this.isActivated=!1,this.dropdown.empty(),this.dropdown.close()},_onEnterKeyed:function(t,e){var n,i;n=this.dropdown.getDatumForCursor(),i=this.dropdown.getDatumForTopSuggestion(),n?(this._select(n),e.preventDefault()):this.autoselect&&i&&(this._select(i),e.preventDefault())},_onTabKeyed:function(t,e){var n;(n=this.dropdown.getDatumForCursor())?(this._select(n),e.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close(),this.input.resetInputValue()},_onUpKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorUp(),this.dropdown.open()},_onDownKeyed:function(){var t=this.input.getQuery();this.dropdown.isEmpty&&t.length>=this.minLength?this.dropdown.update(t):this.dropdown.moveCursorDown(),this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(t,e){this.input.clearHintIfInvalid(),e.length>=this.minLength?this.dropdown.update(e):this.dropdown.empty(),this.dropdown.open(),this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint(),this.dropdown.open()},_setLanguageDirection:function(){var t;this.dir!==(t=this.input.getLanguageDirection())&&(this.dir=t,this.$node.css("direction",t),this.dropdown.setLanguageDirection(t))},_updateHint:function(){var t,e,i,s,r,o;t=this.dropdown.getDatumForTopSuggestion(),t&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(e=this.input.getInputValue(),i=c.normalizeQuery(e),s=n.escapeRegExChars(i),r=new RegExp("^(?:"+s+")(.+$)","i"),o=r.exec(t.value),o?this.input.setHint(e+o[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(t){var e,n,i,s;e=this.input.getHint(),n=this.input.getQuery(),i=t||this.input.isCursorAtEnd(),e&&n!==e&&i&&(s=this.dropdown.getDatumForTopSuggestion(),s&&this.input.setInputValue(s.value),this.eventBus.trigger("autocompleted",s.raw,s.datasetName))},_select:function(t){this.input.setQuery(t.value),this.input.setInputValue(t.value,!0),this._setLanguageDirection(),this.eventBus.trigger("selected",t.raw,t.datasetName),this.dropdown.close(),n.defer(n.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(t){t=n.toStr(t),this.isActivated?this.input.setInputValue(t):(this.input.setQuery(t),this.input.setInputValue(t,!0)),this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy(),this.dropdown.destroy(),l(this.$node),this.$node=null}}),e}();return function(){"use strict";var e,i,s;e=t.fn.typeahead,i="ttTypeahead",s={initialize:function(e,s){function o(){var o,a,c=t(this);n.each(s,function(t){t.highlight=!!e.highlight}),a=new h({input:c,eventBus:o=new r({el:c}),withHint:!!n.isUndefined(e.hint)||!!e.hint,minLength:e.minLength,autoselect:e.autoselect,datasets:s}),c.data(i,a)}return s=n.isArray(s)?s:[].slice.call(arguments,1),e=e||{},this.each(o)},open:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.open()}return this.each(e)},close:function(){function e(){var e,n=t(this);(e=n.data(i))&&e.close()}return this.each(e)},val:function(e){function n(){var n,s=t(this);(n=s.data(i))&&n.setVal(e)}function s(t){var e,n;return(e=t.data(i))&&(n=e.getVal()),n}return arguments.length?this.each(n):s(this.first())},destroy:function(){function e(){var e,n=t(this);(e=n.data(i))&&(e.destroy(),n.removeData(i))}return this.each(e)}},t.fn.typeahead=function(e){var n;return s[e]&&"initialize"!==e?(n=this.filter(function(){return!!t(this).data(i)}),s[e].apply(n,[].slice.call(arguments,1))):s.initialize.apply(this,arguments)},t.fn.typeahead.noConflict=function(){return t.fn.typeahead=e,this}}(),{}}),function(t,e){define("converse-muc",["converse-core","converse-api","tpl!chatarea","tpl!chatroom","tpl!chatroom_form","tpl!chatroom_nickname_form","tpl!chatroom_password_form","tpl!chatroom_sidebar","tpl!chatroom_toolbar","tpl!chatrooms_tab","tpl!info","tpl!occupant","tpl!room_description","tpl!room_item","tpl!room_panel","typeahead","converse-chatview"],e)}(this,function(t,e,n,i,s,r,o,a,c,l,u,h,d,f,p){"use strict";t.templates.chatarea=n,t.templates.chatroom=i,t.templates.chatroom_form=s,t.templates.chatroom_nickname_form=r,t.templates.chatroom_password_form=o,t.templates.chatroom_sidebar=a,t.templates.chatrooms_tab=l,t.templates.info=u,t.templates.occupant=h,t.templates.room_description=d,t.templates.room_item=f,t.templates.room_panel=p;var _="chatrooms",m=e.env.Strophe,g=e.env.$iq,v=e.env.$build,y=e.env.$msg,b=e.env.$pres,w=e.env.b64_sha1,S=e.env.utils,x=e.env.jQuery,M=e.env._,k=e.env.moment,C=S.__.bind(t),T=S.___;m.addNamespace("MUC_ADMIN",m.NS.MUC+"#admin"),m.addNamespace("MUC_OWNER",m.NS.MUC+"#owner"),m.addNamespace("MUC_REGISTER","jabber:iq:register"),m.addNamespace("MUC_ROOMCONF",m.NS.MUC+"#roomconfig"),m.addNamespace("MUC_USER",m.NS.MUC+"#user"),e.plugins.add("converse-muc",{optional_dependencies:["converse-controlbox"],overrides:{wrappedChatBox:function(e){if(e){var n=t.chatboxviews.get(e.get("id")),i=this.__super__.wrappedChatBox.apply(this,arguments);return i.is_chatroom=n.is_chatroom,i}},Features:{addClientFeatures:function(){this.__super__.addClientFeatures.apply(this,arguments),t.allow_muc_invitations&&t.connection.disco.addFeature("jabber:x:conference"),t.allow_muc&&t.connection.disco.addFeature(m.NS.MUC)}},ControlBoxView:{renderContactsPanel:function(){var t=this.__super__.converse;this.__super__.renderContactsPanel.apply(this,arguments),t.allow_muc&&(this.roomspanel=new t.RoomsPanel({$parent:this.$el.find(".controlbox-panes"),model:new(Backbone.Model.extend({id:w("converse.roomspanel"+t.bare_jid),browserStorage:new Backbone.BrowserStorage[t.storage](w("converse.roomspanel"+t.bare_jid))}))}),this.roomspanel.render().model.fetch(),this.roomspanel.model.get("nick")||this.roomspanel.model.save({nick:m.getNodeFromJid(t.bare_jid)}))},onConnected:function(){var t=this.__super__.converse;if(this.__super__.onConnected.apply(this,arguments),this.model.get("connected"))if(M.isUndefined(t.muc_domain)){t.features.off("add",this.featureAdded,this),t.features.on("add",this.featureAdded,this);var e=t.features.findWhere({var:m.NS.MUC});e&&this.featureAdded(e)}else this.setMUCDomain(t.muc_domain)},setMUCDomain:function(t){this.roomspanel.model.save({muc_domain:t});var e=this.$el.find("input.new-chatroom-server");e.is(":focus")||e.val(this.roomspanel.model.get("muc_domain"))},featureAdded:function(t){var e=this.__super__.converse;t.get("var")===m.NS.MUC&&e.allow_muc&&this.setMUCDomain(t.get("from"))}},ChatBoxViews:{onChatBoxAdded:function(e){var n=this.get(e.get("id"));return n||"chatroom"!==e.get("type")?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new t.ChatRoomView({model:e}),this.add(e.get("id"),n))}}},initialize:function(){var t=this.converse;this.updateSettings({allow_muc:!0,allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_list_rooms:!1,hide_muc_server:!1,muc_domain:void 0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,visible_toolbar_buttons:{toggle_occupants:!0}}),t.ChatRoomView=t.ChatBoxView.extend({length:300,tagName:"div",className:"chatbox chatroom",is_chatroom:!0,events:{"click .close-chatbox-button":"close","click .configure-chatroom-button":"configureChatRoom","click .toggle-smiley":"toggleEmoticonMenu","click .toggle-smiley ul li":"insertEmoticon","click .toggle-clear":"clearChatRoomMessages","click .toggle-call":"toggleCall","click .toggle-occupants a":"toggleOccupants","click .new-msgs-indicator":"viewUnreadMessages","click .occupant":"onOccupantClicked","keypress .chat-textarea":"keyPressed"},initialize:function(){this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:chat_state",this.sendChatState,this),this.occupantsview=new t.ChatRoomOccupantsView({model:new t.ChatRoomOccupants({nick:this.model.get("nick")})});var e=w("converse.occupants"+t.bare_jid+this.model.get("id")+this.model.get("nick"));this.occupantsview.model.browserStorage=new Backbone.BrowserStorage.session(e),this.occupantsview.chatroomview=this,this.render().$el.hide(),this.occupantsview.model.fetch({add:!0});var n=this.model.get("nick");n?this.join(n):this.checkForReservedNick(),this.fetchMessages().insertIntoDOM(),this.$el.find(".chat-content").on("scroll",this.markScrolled.bind(this)),t.emit("chatRoomOpened",this)},insertIntoDOM:function(){var e=t.chatboxviews.get("controlbox");return e?this.$el.insertAfter(e.$el):x("#conversejs").prepend(this.$el),this},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(t.templates.chatroom(M.extend(this.model.toJSON(),{info_close:C("Close and leave this room"),info_configure:C("Configure this room")}))),this.renderChatArea(),S.refreshWebkit(),this},renderChatArea:function(){return this.$(".chat-area").length||(this.$(".chatroom-body").empty().append(t.templates.chatarea({unread_msgs:C("You have unread messages"),show_toolbar:t.show_toolbar,label_message:C("Message")})).append(this.occupantsview.render().$el),this.renderToolbar(c),this.$content=this.$el.find(".chat-content")),this.toggleOccupants(null,!0),this},getToolbarOptions:function(){return M.extend(t.ChatBoxView.prototype.getToolbarOptions.apply(this,arguments),{label_hide_occupants:C("Hide the list of occupants"),show_occupants_toggle:this.is_chatroom&&t.visible_toolbar_buttons.toggle_occupants})},close:function(e){this.leave(),t.ChatBoxView.prototype.close.apply(this,arguments)},toggleOccupants:function(t,e){t&&(t.preventDefault(),t.stopPropagation()),e&&this.model.set({hidden_occupants:!this.model.get("hidden_occupants")}),this.model.get("hidden_occupants")?(this.model.save({hidden_occupants:!1}),this.$(".icon-show-users").removeClass("icon-show-users").addClass("icon-hide-users"),this.$(".chat-area").removeClass("full"),this.$("div.occupants").removeClass("hidden"),this.scrollDown()):(this.model.save({hidden_occupants:!0}),this.$(".icon-hide-users").removeClass("icon-hide-users").addClass("icon-show-users"),this.$(".occupants").addClass("hidden"),this.$(".chat-area").addClass("full"),this.scrollDown())},onOccupantClicked:function(t){this.insertIntoTextArea(t.target.textContent)},directInvite:function(e,n){var i={xmlns:"jabber:x:conference",jid:this.model.get("jid")};null!==n&&(i.reason=n),this.model.get("password")&&(i.password=this.model.get("password"));var s=y({from:t.connection.jid,to:e,id:t.connection.getUniqueId()}).c("x",i);t.connection.send(s),t.emit("roomInviteSent",{room:this,recipient:e,reason:n})},onCommandError:function(t){this.showStatusNotification(C("Error: could not execute the command"),!0)},handleChatStateMessage:function(e){e.get("fullname")!==this.model.get("nick")&&e.get("chat_state")!==t.GONE&&t.ChatBoxView.prototype.handleChatStateMessage.apply(this,arguments)},sendChatState:function(){var e=this.model.get("chat_state");e!==t.GONE&&t.connection.send(y({to:this.model.get("jid"),type:"groupchat"}).c(e,{xmlns:m.NS.CHATSTATES}).up().c("no-store",{xmlns:m.NS.HINTS}).up().c("no-permanent-store",{xmlns:m.NS.HINTS}))},sendChatRoomMessage:function(e){var n=t.connection.getUniqueId(),i=y({to:this.model.get("jid"),from:t.connection.jid,type:"groupchat",id:n}).c("body").t(e).up().c("x",{xmlns:"jabber:x:event"}).c(t.COMPOSING);t.connection.send(i),this.model.messages.create({fullname:this.model.get("nick"),sender:"me",time:k().format(),message:e,msgid:n})},setAffiliation:function(e,n,i,s,r,o){var a=v("item",{jid:n,affiliation:i}),c=g({to:e,type:"set"}).c("query",{xmlns:m.NS.MUC_ADMIN}).cnode(a.node);return null!==s&&c.c("reason",s),t.connection.sendIQ(c.tree(),r,o)},modifyRole:function(e,n,i,s,r,o){var a=v("item",{nick:n,role:i}),c=g({to:e,type:"set"}).c("query",{xmlns:m.NS.MUC_ADMIN}).cnode(a.node);return null!==s&&c.c("reason",s),t.connection.sendIQ(c.tree(),r,o)},member:function(t,e,n,i,s){return this.setAffiliation(t,e,"member",n,i,s)},revoke:function(t,e,n,i,s){return this.setAffiliation(t,e,"none",n,i,s)},owner:function(t,e,n,i,s){return this.setAffiliation(t,e,"owner",n,i,s)},admin:function(t,e,n,i,s){return this.setAffiliation(t,e,"admin",n,i,s)},validateRoleChangeCommand:function(t,e){return!(e.length<1||e.length>2)||(this.showStatusNotification(C('Error: the "'+t+"\" command takes two arguments, the user's nickname and optionally a reason."),!0),!1)},clearChatRoomMessages:function(t){"undefined"!=typeof t&&t.stopPropagation();var e=confirm(C("Are you sure you want to clear the messages from this room?"));return e===!0&&this.$content.empty(),this},onMessageSubmitted:function(e){var n=e.replace(/^\s*/,"").match(/^\/(.*?)(?: (.*))?$/)||[!1,"",""],i=n[2]&&n[2].splitOnce(" ")||[];switch(n[1]){case"admin":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"admin",i[1],void 0,this.onCommandError.bind(this));break;case"ban":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"outcast",i[1],void 0,this.onCommandError.bind(this));break;case"clear":this.clearChatRoomMessages();break;case"deop":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"occupant",i[1],void 0,this.onCommandError.bind(this));break;case"help":this.showHelpMessages(["<strong>/admin</strong>: "+C("Change user's affiliation to admin"),"<strong>/ban</strong>: "+C("Ban user from room"),"<strong>/clear</strong>: "+C("Remove messages"),"<strong>/deop</strong>: "+C("Change user role to occupant"),"<strong>/help</strong>: "+C("Show this menu"),"<strong>/kick</strong>: "+C("Kick user from room"),"<strong>/me</strong>: "+C("Write in 3rd person"),"<strong>/member</strong>: "+C("Grant membership to a user"),"<strong>/mute</strong>: "+C("Remove user's ability to post messages"),"<strong>/nick</strong>: "+C("Change your nickname"),"<strong>/op</strong>: "+C("Grant moderator role to user"),"<strong>/owner</strong>: "+C("Grant ownership of this room"),"<strong>/revoke</strong>: "+C("Revoke user's membership"),"<strong>/topic</strong>: "+C("Set room topic"),"<strong>/voice</strong>: "+C("Allow muted user to post messages")]);break;case"kick":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"none",i[1],void 0,this.onCommandError.bind(this));break;case"mute":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"visitor",i[1],void 0,this.onCommandError.bind(this));break;case"member":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"member",i[1],void 0,this.onCommandError.bind(this));break;case"nick":t.connection.send(b({from:t.connection.jid,to:this.getRoomJIDAndNick(n[2]),id:t.connection.getUniqueId()}).tree());break;case"owner":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"owner",i[1],void 0,this.onCommandError.bind(this));break;case"op":if(!this.validateRoleChangeCommand(n[1],i))break;
this.modifyRole(this.model.get("jid"),i[0],"moderator",i[1],void 0,this.onCommandError.bind(this));break;case"revoke":if(!this.validateRoleChangeCommand(n[1],i))break;this.setAffiliation(this.model.get("jid"),i[0],"none",i[1],void 0,this.onCommandError.bind(this));break;case"topic":t.connection.send(y({to:this.model.get("jid"),from:t.connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(n[2]).tree());break;case"voice":if(!this.validateRoleChangeCommand(n[1],i))break;this.modifyRole(this.model.get("jid"),i[0],"occupant",i[1],void 0,this.onCommandError.bind(this));break;default:this.sendChatRoomMessage(e)}},handleMUCMessage:function(t){var e=x(t).find('[xmlns="'+m.NS.MAM+'"]').length>0;return!!e||(M.compose(this.onChatRoomMessage.bind(this),this.showStatusMessages.bind(this))(t),!0)},getRoomJIDAndNick:function(t){t?this.model.save({nick:t}):t=this.model.get("nick");var e=this.model.get("jid"),n=m.getNodeFromJid(e),i=m.getDomainFromJid(e);return n+"@"+i+(null!==t?"/"+t:"")},registerHandlers:function(){var e=this.model.get("jid");this.removeHandlers(),this.presence_handler=t.connection.addHandler(this.onChatRoomPresence.bind(this),m.NS.MUC,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.message_handler=t.connection.addHandler(this.handleMUCMessage.bind(this),null,"message",null,null,e,{matchBareFromJid:!0})},removeHandlers:function(){return this.message_handler&&(t.connection.deleteHandler(this.message_handler),delete this.message_handler),this.presence_handler&&(t.connection.deleteHandler(this.presence_handler),delete this.presence_handler),this},join:function(e,n){this.registerHandlers();var i=b({from:t.connection.jid,to:this.getRoomJIDAndNick(e)}).c("x",{xmlns:m.NS.MUC}).c("history",{maxstanzas:t.muc_history_max_stanzas}).up();return n&&i.cnode(m.xmlElement("password",[],n)),this.model.set("connection_status",m.Status.CONNECTING),t.connection.send(i)},cleanup:function(){this.model.set("connection_status",m.Status.DISCONNECTED),this.removeHandlers()},leave:function(e){if(!t.connection.connected)return void this.cleanup();var n=t.connection.getUniqueId(),i=b({type:"unavailable",id:n,from:t.connection.jid,to:this.getRoomJIDAndNick()});null!==e&&i.c("status",e),t.connection.addHandler(this.cleanup.bind(this),null,"presence",null,n),t.connection.send(i)},renderConfigurationForm:function(t){var e=this.$el.find("form.chatroom-form"),n=e.children("fieldset:first"),i=x(t),s=i.find("field"),r=i.find("title").text(),o=i.find("instructions").text();n.find("span.spinner").remove(),n.append(x("<legend>").text(r)),o&&o!==r&&n.append(x('<p class="instructions">').text(o)),M.each(s,function(t){n.append(S.xForm2webForm(x(t),i))}),e.append("<fieldset></fieldset>"),n=e.children("fieldset:last"),n.append('<input type="submit" class="pure-button button-primary" value="'+C("Save")+'"/>'),n.append('<input type="button" class="pure-button button-cancel" value="'+C("Cancel")+'"/>'),n.find("input[type=button]").on("click",this.cancelConfiguration.bind(this)),e.on("submit",this.saveConfiguration.bind(this))},sendConfiguration:function(e,n,i){var s=g({to:this.model.get("jid"),type:"set"}).c("query",{xmlns:m.NS.MUC_OWNER}).c("x",{xmlns:m.NS.XFORM,type:"submit"});return M.each(e,function(t){s.cnode(t).up()}),t.connection.sendIQ(s.tree(),n,i)},saveConfiguration:function(t){t.preventDefault();var e=this,n=x(t.target).find(":input:not([type=button]):not([type=submit])"),i=n.length,s=[];n.each(function(){s.push(S.webForm2xForm(this)),--i||e.sendConfiguration(s,e.onConfigSaved.bind(e),e.onErrorConfigSaved.bind(e))}),this.$el.find("div.chatroom-form-container").hide(function(){x(this).remove(),e.$el.find(".chat-area").removeClass("hidden"),e.$el.find(".occupants").removeClass("hidden")})},onConfigSaved:function(t){},onErrorConfigSaved:function(t){this.showStatusNotification(C("An error occurred while trying to save the form."))},cancelConfiguration:function(t){t.preventDefault();var e=this;this.$el.find("div.chatroom-form-container").hide(function(){x(this).remove(),e.$el.find(".chat-area").removeClass("hidden"),e.$el.find(".occupants").removeClass("hidden")})},configureChatRoom:function(e){"undefined"!=typeof e&&e.preventDefault&&e.preventDefault(),this.$el.find("div.chatroom-form-container").length||(this.$(".chatroom-body").children().addClass("hidden"),this.$(".chatroom-body").append(t.templates.chatroom_form()),t.connection.sendIQ(g({to:this.model.get("jid"),type:"get"}).c("query",{xmlns:m.NS.MUC_OWNER}).tree(),this.renderConfigurationForm.bind(this)))},submitNickname:function(t){t.preventDefault();var e=this.$el.find("input[name=nick]"),n=e.val();return n?(e.removeClass("error"),this.$el.find(".chatroom-form-container").replaceWith('<span class="spinner centered"/>'),void this.join(n)):void e.addClass("error")},checkForReservedNick:function(){this.showSpinner(),t.connection.sendIQ(g({to:this.model.get("jid"),from:t.connection.jid,type:"get"}).c("query",{xmlns:m.NS.DISCO_INFO,node:"x-roomuser-item"}),this.onNickNameFound.bind(this),this.onNickNameNotFound.bind(this))},onNickNameFound:function(t){var e=x(t).find('query[node="x-roomuser-item"] identity').attr("name");e?this.join(e):this.onNickNameNotFound()},onNickNameNotFound:function(e){t.muc_nickname_from_jid?this.join(m.unescapeNode(m.getNodeFromJid(t.bare_jid))):this.renderNicknameForm(e)},getDefaultNickName:function(){return m.unescapeNode(m.getNodeFromJid(t.bare_jid))},onNicknameClash:function(e){if(t.muc_nickname_from_jid){var n=e.getAttribute("from").split("/")[1];if(n===this.getDefaultNickName())this.join(n+"-2");else{var i=n.lastIndexOf("-"),s=n.substring(i+1,n.length);this.join(n.substring(0,i+1)+String(Number(s)+1))}}else this.renderNicknameForm(C("The nickname you chose is reserved or currently in use, please choose a different one."))},renderNicknameForm:function(e){this.$(".chatroom-body").children().addClass("hidden"),this.$("span.centered.spinner").remove(),"string"!=typeof e&&(e=""),this.$(".chatroom-body").append(t.templates.chatroom_nickname_form({heading:C("Please choose your nickname"),label_nickname:C("Nickname"),label_join:C("Enter room"),validation_message:e})),this.$(".chatroom-form").on("submit",this.submitNickname.bind(this))},submitPassword:function(t){t.preventDefault();var e=this.$el.find(".chatroom-form").find("input[type=password]").val();this.$el.find(".chatroom-form-container").replaceWith('<span class="spinner centered"/>'),this.join(this.model.get("nick"),e)},renderPasswordForm:function(){this.$(".chatroom-body").children().addClass("hidden"),this.$("span.centered.spinner").remove(),this.$(".chatroom-body").append(t.templates.chatroom_password_form({heading:C("This chatroom requires a password"),label_password:C("Password: "),label_submit:C("Submit")})),this.$(".chatroom-form").on("submit",this.submitPassword.bind(this))},showDisconnectMessage:function(t){this.$(".chat-area").addClass("hidden"),this.$(".occupants").addClass("hidden"),this.$("span.centered.spinner").remove(),this.$(".chatroom-body").append(x("<p>"+t+"</p>"))},infoMessages:{100:C("This room is not anonymous"),102:C("This room now shows unavailable members"),103:C("This room does not show unavailable members"),104:C("Non-privacy-related room configuration has changed"),170:C("Room logging is now enabled"),171:C("Room logging is now disabled"),172:C("This room is now non-anonymous"),173:C("This room is now semi-anonymous"),174:C("This room is now fully-anonymous"),201:C("A new room has been created")},disconnectMessages:{301:C("You have been banned from this room"),307:C("You have been kicked from this room"),321:C("You have been removed from this room because of an affiliation change"),322:C("You have been removed from this room because the room has changed to members-only and you're not a member"),332:C("You have been removed from this room because the MUC (Multi-user chat) service is being shut down.")},actionInfoMessages:{301:T("<strong>%1$s</strong> has been banned"),303:T("<strong>%1$s</strong>'s nickname has changed"),307:T("<strong>%1$s</strong> has been kicked out"),321:T("<strong>%1$s</strong> has been removed because of an affiliation change"),322:T("<strong>%1$s</strong> has been removed for not being a member")},newNicknameMessages:{210:T("Your nickname has been automatically set to: <strong>%1$s</strong>"),303:T("Your nickname has been changed to: <strong>%1$s</strong>")},showStatusMessages:function(e,n){var i,s=x(e),r=[],o=[],a=[];if(s.find('x[xmlns="'+m.NS.MUC_USER+'"]').each(function(e,i){var c=x(i).find("item");m.getBareJidFromJid(c.attr("jid"))===t.bare_jid&&"owner"===c.attr("affiliation")&&this.$el.find("a.configure-chatroom-button").show(),x(i).find("item reason").each(function(t,e){x(e).text()&&a.push(x(e).text())}),x(i).find("status").each(function(t,e){var i=e.getAttribute("code"),a=m.unescapeNode(m.getResourceFromJid(s.attr("from")));n&&"210"===i?o.push(C(this.newNicknameMessages[i],a)):n&&"303"===i?o.push(C(this.newNicknameMessages[i],c.attr("nick"))):n&&M.contains(M.keys(this.disconnectMessages),i)?r.push(this.disconnectMessages[i]):!n&&M.contains(M.keys(this.actionInfoMessages),i)?o.push(C(this.actionInfoMessages[i],a)):M.contains(M.keys(this.infoMessages),i)?o.push(this.infoMessages[i]):"110"!==i&&x(e).text()&&o.push(x(e).text())}.bind(this))}.bind(this)),r.length>0){for(i=0;i<r.length;i++)this.showDisconnectMessage(r[i]);for(i=0;i<a.length;i++)this.showDisconnectMessage(C('The reason given is: "'+a[i]+'"'),!0);return void this.model.set("connection_status",m.Status.DISCONNECTED)}for(i=0;i<o.length;i++)this.$content.append(t.templates.info({message:o[i]}));for(i=0;i<a.length;i++)this.showStatusNotification(C('The reason given is: "'+a[i]+'"'),!0);return(r.length||o.length||a.length)&&this.scrollDown(),e},showErrorMessage:function(t){var e=x(t).find("error");"auth"===e.attr("type")?e.find("not-authorized").length?this.renderPasswordForm():e.find("registration-required").length?this.showDisconnectMessage(C("You are not on the member list of this room")):e.find("forbidden").length&&this.showDisconnectMessage(C("You have been banned from this room")):"modify"===e.attr("type")?e.find("jid-malformed").length&&this.showDisconnectMessage(C("No nickname was specified")):"cancel"===e.attr("type")&&(e.find("not-allowed").length?this.showDisconnectMessage(C("You are not allowed to create new rooms")):e.find("not-acceptable").length?this.showDisconnectMessage(C("Your nickname doesn't conform to this room's policies")):e.find("conflict").length?this.onNicknameClash(t):e.find("item-not-found").length?this.showDisconnectMessage(C("This room does not (yet) exist")):e.find("service-unavailable").length&&this.showDisconnectMessage(C("This room has reached its maximum number of occupants")))},showSpinner:function(){this.$(".chatroom-body").children().addClass("hidden"),this.$el.find(".chatroom-body").prepend('<span class="spinner centered"/>')},hideSpinner:function(){var t=this,e=this.$el.find(".spinner");return e.length&&e.hide(function(){x(this).remove(),t.$el.find(".chat-area").removeClass("hidden"),t.$el.find(".occupants").removeClass("hidden"),t.scrollDown()}),this},onChatRoomPresence:function(e){var n,i,s=x(e),r=this.model.get("nick");return"error"===s.attr("type")?(this.model.set("connection_status",m.Status.DISCONNECTED),this.showErrorMessage(e)):(n=s.find("status[code='110']").length||s.attr("from")===this.model.get("id")+"/"+m.escapeNode(r),i=s.find("status[code='201']").length,n&&(this.model.set("connection_status",m.Status.CONNECTED),!t.muc_instant_rooms&&i?this.configureChatRoom():this.hideSpinner().showStatusMessages(e,n))),this.occupantsview.updateOccupantsOnPresence(e),!0},setChatRoomSubject:function(e,n){this.$el.find(".chatroom-topic").text(n).attr("title",n),this.$content.append(t.templates.info({message:C("Topic set by %1$s to: %2$s",e,n)})),this.scrollDown()},onChatRoomMessage:function(e){var n,i=x(e),s=i.find("forwarded");s.length&&(i=s.children("message"),n=s.children("delay"));var r=i.attr("from"),o=i.attr("id"),a=m.getResourceFromJid(r),c=a&&m.unescapeNode(a)||"",l=i.children("subject").text(),u=o&&this.model.messages.filter(function(t){return t.get("msgid")===o&&t.get("fullname")===c});return!(!u||!u.length)||(l&&this.setChatRoomSubject(c,l),""===c||(this.model.createMessage(i,n,e),c!==this.model.get("nick")&&t.emit("message",e),!0))},fetchArchivedMessages:function(n){return t.features.findWhere({var:m.NS.MAM})?(this.addSpinner(),void e.archive.query(M.extend(n,{groupchat:!0}),function(t){this.clearSpinner(),t.length&&M.map(t,this.onChatRoomMessage.bind(this))}.bind(this),function(){this.clearSpinner(),t.log("Error while trying to fetch archived messages","error")}.bind(this))):void t.log("Attempted to fetch archived messages but this user's server doesn't support XEP-0313")}}),t.ChatRoomOccupant=Backbone.Model.extend({initialize:function(e){this.set(M.extend({id:t.connection.getUniqueId()},e))}}),t.ChatRoomOccupantView=Backbone.View.extend({tagName:"li",initialize:function(){this.model.on("change",this.render,this),this.model.on("destroy",this.destroy,this)},render:function(){var e=t.templates.occupant(M.extend(this.model.toJSON(),{hint_occupant:C("Click to mention this user in your message."),desc_moderator:C("This user is a moderator."),desc_occupant:C("This user can send messages in this room."),desc_visitor:C("This user can NOT send messages in this room.")})),n=this.$el.parents();return n.length?(this.$el.replaceWith(e),this.setElement(n.first().children("#"+this.model.get("id")),!0),this.delegateEvents()):(this.$el.replaceWith(e),this.setElement(e,!0)),this},destroy:function(){this.$el.remove()}}),t.ChatRoomOccupants=Backbone.Collection.extend({model:t.ChatRoomOccupant}),t.ChatRoomOccupantsView=Backbone.Overview.extend({tagName:"div",className:"occupants",initialize:function(){this.model.on("add",this.onOccupantAdded,this)},render:function(){return this.$el.html(t.templates.chatroom_sidebar({allow_muc_invitations:t.allow_muc_invitations,label_invitation:C("Invite"),label_occupants:C("Occupants")})),t.allow_muc_invitations?this.initInviteWidget():this},onOccupantAdded:function(e){var n=this.get(e.get("id"));n?(delete n.model,n.model=e,n.initialize()):n=this.add(e.get("id"),new t.ChatRoomOccupantView({model:e})),this.$(".occupant-list").append(n.render().$el)},parsePresence:function(t){var e=m.getResourceFromJid(t.getAttribute("from")),n={nick:e,type:t.getAttribute("type"),states:[]};return M.each(t.childNodes,function(t){switch(t.nodeName){case"status":n.status=t.textContent||null;break;case"show":n.show=t.textContent||null;break;case"x":t.getAttribute("xmlns")===m.NS.MUC_USER&&M.each(t.childNodes,function(t){switch(t.nodeName){case"item":n.affiliation=t.getAttribute("affiliation"),n.role=t.getAttribute("role"),n.jid=t.getAttribute("jid"),n.nick=t.getAttribute("nick")||n.nick;break;case"status":t.getAttribute("code")&&n.states.push(t.getAttribute("code"))}})}}),n},findOccupant:function(t){var e=m.getBareJidFromJid(t.jid);return null!==e?this.model.where({jid:e}).pop():this.model.where({nick:t.nick}).pop()},updateOccupantsOnPresence:function(t){var e=this.parsePresence(t);if("error"===e.type)return!0;var n=this.findOccupant(e);switch(e.type){case"unavailable":n&&n.destroy();break;default:var i=m.getBareJidFromJid(e.jid),s=M.extend(e,{jid:i?i:void 0,resource:e.jid?m.getResourceFromJid(e.jid):void 0});n?n.save(s):this.model.create(s)}},initInviteWidget:function(){var e=this.$("input.invited-contact");return e.typeahead({minLength:1,highlight:!0},{name:"contacts-dataset",source:function(e,n){var i=[];M.each(t.roster.filter(S.contains(["fullname","jid"],e)),function(t){i.push({value:t.get("fullname"),jid:t.get("jid")})}),n(i)},templates:{suggestion:M.template('<p data-jid="{{jid}}">{{value}}</p>')}}),e.on("typeahead:selected",function(t,e,n){var i=prompt(C(T('You are about to invite %1$s to the chat room "%2$s". '),e.value,this.model.get("id"))+C("You may optionally include a message, explaining the reason for the invitation."));null!==i&&this.chatroomview.directInvite(e.jid,i),x(t.target).typeahead("val","")}.bind(this)),this}}),t.RoomsPanel=Backbone.View.extend({tagName:"div",className:"controlbox-pane",id:"chatrooms",events:{"submit form.add-chatroom":"createChatRoom","click input#show-rooms":"showRooms","click a.open-room":"createChatRoom","click a.room-info":"toggleRoomInfo","change input[name=server]":"setDomain","change input[name=nick]":"setNick"},initialize:function(t){this.$parent=t.$parent,this.model.on("change:muc_domain",this.onDomainChange,this),this.model.on("change:nick",this.onNickChange,this)},render:function(){this.$parent.append(this.$el.html(t.templates.room_panel({server_input_type:t.hide_muc_server&&"hidden"||"text",server_label_global_attr:t.hide_muc_server&&" hidden"||"",label_room_name:C("Room name"),label_nickname:C("Nickname"),label_server:C("Server"),label_join:C("Join Room"),label_show_rooms:C("Show rooms")}))),this.$tabs=this.$parent.parent().find("#controlbox-tabs");var e=t.chatboxes.get("controlbox");return this.$tabs.append(t.templates.chatrooms_tab({label_rooms:C("Rooms"),is_current:e.get("active-panel")===_})),e.get("active-panel")!==_&&this.$el.addClass("hidden"),this},onDomainChange:function(e){var n=this.$el.find("input.new-chatroom-server");n.val(e.get("muc_domain")),t.auto_list_rooms&&this.updateRoomsList()},onNickChange:function(t){var e=this.$el.find("input.new-chatroom-nick");e.val(t.get("nick"))},informNoRoomsFound:function(){var t=this.$el.find("#available-chatrooms");t.html("<dt>"+C("No rooms on %1$s",this.model.get("muc_domain"))+"</dt>"),x("input#show-rooms").show().siblings("span.spinner").remove()},onRoomsFound:function(e){var n,i,s,r,o=this.$el.find("#available-chatrooms");if(this.rooms=x(e).find("query").find("item"),this.rooms.length){for(o.html("<dt>"+C("Rooms on %1$s",this.model.get("muc_domain"))+"</dt>"),r=document.createDocumentFragment(),s=0;s<this.rooms.length;s++)n=m.unescapeNode(x(this.rooms[s]).attr("name")||x(this.rooms[s]).attr("jid")),i=x(this.rooms[s]).attr("jid"),r.appendChild(x(t.templates.room_item({name:n,jid:i,open_title:C("Click to open this room"),info_title:C("Show more information on this room")}))[0]);o.append(r),x("input#show-rooms").show().siblings("span.spinner").remove()}else this.informNoRoomsFound();return!0},updateRoomsList:function(){t.connection.sendIQ(g({to:this.model.get("muc_domain"),from:t.connection.jid,type:"get"}).c("query",{xmlns:m.NS.DISCO_ITEMS}),this.onRoomsFound.bind(this),this.informNoRoomsFound.bind(this))},showRooms:function(){var t=this.$el.find("#available-chatrooms"),e=this.$el.find("input.new-chatroom-server"),n=e.val();return n?(this.$el.find("input.new-chatroom-name").removeClass("error"),e.removeClass("error"),t.empty(),x("input#show-rooms").hide().after('<span class="spinner"/>'),this.model.save({muc_domain:n}),void this.updateRoomsList()):void e.addClass("error")},insertRoomInfo:function(e,n){var i=x(n);e.find("span.spinner").replaceWith(t.templates.room_description({desc:i.find('field[var="muc#roominfo_description"] value').text(),occ:i.find('field[var="muc#roominfo_occupants"] value').text(),hidden:i.find('feature[var="muc_hidden"]').length,membersonly:i.find('feature[var="muc_membersonly"]').length,moderated:i.find('feature[var="muc_moderated"]').length,nonanonymous:i.find('feature[var="muc_nonanonymous"]').length,open:i.find('feature[var="muc_open"]').length,passwordprotected:i.find('feature[var="muc_passwordprotected"]').length,persistent:i.find('feature[var="muc_persistent"]').length,publicroom:i.find('feature[var="muc_public"]').length,semianonymous:i.find('feature[var="muc_semianonymous"]').length,temporary:i.find('feature[var="muc_temporary"]').length,unmoderated:i.find('feature[var="muc_unmoderated"]').length,label_desc:C("Description:"),label_occ:C("Occupants:"),label_features:C("Features:"),label_requires_auth:C("Requires authentication"),label_hidden:C("Hidden"),label_requires_invite:C("Requires an invitation"),label_moderated:C("Moderated"),label_non_anon:C("Non-anonymous"),label_open_room:C("Open room"),label_permanent_room:C("Permanent room"),label_public:C("Public"),label_semi_anon:C("Semi-anonymous"),label_temp_room:C("Temporary room"),label_unmoderated:C("Unmoderated")}))},toggleRoomInfo:function(e){var n=e.target,i=x(n).parent("dd"),s=i.find("div.room-info");s.length?s.remove():(i.find("span.spinner").remove(),i.append('<span class="spinner hor_centered"/>'),t.connection.disco.info(x(n).attr("data-room-jid"),null,M.partial(this.insertRoomInfo,i)))},createChatRoom:function(e){e.preventDefault();var n,i,s,r,o;if("click"===e.type)n=x(e.target).text(),o=x(e.target).attr("data-room-jid");else{if(i=this.$el.find("input.new-chatroom-name"),r=this.$el.find("input.new-chatroom-server"),s=r.val(),n=i.val().trim(),i.val(""),!n||!s)return n||i.addClass("error"),void(s||r.addClass("error"));o=m.escapeNode(n.toLowerCase())+"@"+s.toLowerCase(),i.removeClass("error"),r.removeClass("error"),this.model.save({muc_domain:s})}t.chatboxviews.showChat({id:o,jid:o,name:n||m.unescapeNode(m.getNodeFromJid(o)),type:"chatroom",box_id:w(o)})},setDomain:function(t){this.model.save({muc_domain:t.target.value})},setNick:function(t){this.model.save({nick:t.target.value})}}),t.onDirectMUCInvitation=function(e){var n,i=x(e),s=i.children('x[xmlns="jabber:x:conference"]'),r=m.getBareJidFromJid(i.attr("from")),o=s.attr("jid"),a=s.attr("reason"),c=t.roster.get(r);if(t.auto_join_on_invite?n=!0:(c=c?c.get("fullname"):m.getNodeFromJid(r),n=a?confirm(C(T('%1$s has invited you to join a chat room: %2$s, and left the following reason: "%3$s"'),c,o,a)):confirm(C(T("%1$s has invited you to join a chat room: %2$s"),c,o))),n===!0){var l=t.chatboxviews.showChat({id:o,jid:o,name:m.unescapeNode(m.getNodeFromJid(o)),nick:m.unescapeNode(m.getNodeFromJid(t.connection.jid)),type:"chatroom",box_id:w(o),password:s.attr("password")});M.contains([m.Status.CONNECTING,m.Status.CONNECTED],l.get("connection_status"))||t.chatboxviews.get(o).join()}};var n=function(){M.each(t.auto_join_rooms,function(n){"string"==typeof n?e.rooms.open(n):"object"==typeof n?e.rooms.open(n.jid,n.nick):t.log('Invalid room criteria specified for "auto_join_rooms"',"error")})};if(t.on("chatBoxesFetched",n),t.allow_muc_invitations){var i=function(){t.connection.addHandler(function(e){return t.onDirectMUCInvitation(e),!0},"jabber:x:conference","message")};t.on("connected",i),t.on("reconnected",i)}var s=function(e,n,i){return e=e.toLowerCase(),t.wrappedChatBox(i(M.extend({id:e,jid:e,name:m.unescapeNode(m.getNodeFromJid(e)),type:"chatroom",box_id:w(e)},n)))};M.extend(e,{rooms:{close:function(e){if("undefined"==typeof e)t.chatboxviews.each(function(t){t.is_chatroom&&t.model&&t.close()});else if("string"==typeof e){var n=t.chatboxviews.get(e);n&&n.close()}else M.map(e,function(e){var n=t.chatboxviews.get(e);n&&n.close()})},open:function(e,n){"string"==typeof n?n={nick:n}:"undefined"==typeof n&&(n={});var i=t.chatboxviews.showChat.bind(t.chatboxviews);if(n.nick||(n.nick=m.getNodeFromJid(t.bare_jid)),"undefined"==typeof e)throw new TypeError("rooms.open: You need to provide at least one JID");return"string"==typeof e?s(e,n,i):M.map(e,M.partial(s,M,n,i))},get:function(e,n,i){if("string"==typeof n?n={nick:n}:"undefined"==typeof n&&(n={}),"undefined"==typeof e){var r=[];return t.chatboxes.each(function(e){"chatroom"===e.get("type")&&r.push(t.wrappedChatBox(e))}),r}var o=M.partial(t.chatboxviews.getChatBox.bind(t.chatboxviews),M,i);return n.nick||(n.nick=m.getNodeFromJid(t.bare_jid)),"string"==typeof e?s(e,n,o):M.map(e,M.partial(s,M,n,o))}}})}})}),function(t,e){define("converse-minimize",["converse-core","converse-api","tpl!chatbox_minimize","tpl!toggle_chats","tpl!trimmed_chat","converse-controlbox","converse-chatview","converse-muc"],e)}(this,function(t,e,n,i,s){"use strict";t.templates.chatbox_minimize=n,t.templates.toggle_chats=i,t.templates.trimmed_chat=s;var r=e.env.jQuery,o=e.env._,a=e.env.b64_sha1,c=e.env.moment,l=e.env.utils,u=l.__.bind(t);e.plugins.add("converse-minimize",{overrides:{_initialize:function(){return this.__super__._initialize.apply(this,arguments),t.minimized_chats=new t.MinimizedChats({model:t.chatboxes}),this},registerGlobalEventHandlers:function(){return r(window).on("resize",o.debounce(function(e){t.connection.connected&&t.chatboxviews.trimChats()},200)),this.__super__.registerGlobalEventHandlers.apply(this,arguments)},wrappedChatBox:function(t){if(t){var e=this.__super__.wrappedChatBox.apply(this,arguments);return e.maximize=t.maximize.bind(t),e.minimize=t.minimize.bind(t),e}},ChatBox:{initialize:function(){this.__super__.initialize.apply(this,arguments),"controlbox"!==this.get("id")&&this.save({minimized:this.get("minimized")||!1,time_minimized:this.get("time_minimized")||c()})},maximize:function(){this.save({minimized:!1,time_opened:c().valueOf()})},minimize:function(){this.save({minimized:!0,time_minimized:c().format()})}},ChatBoxView:{events:{"click .toggle-chatbox-button":"minimize"},initialize:function(){return this.model.on("change:minimized",this.onMinimizedChanged,this),this.__super__.initialize.apply(this,arguments)},afterShown:function(){this.__super__.afterShown.apply(this,arguments),this.model.get("minimized")||t.chatboxviews.trimChats(this)},shouldShowOnTextMessage:function(){return!this.model.get("minimized")&&this.__super__.shouldShowOnTextMessage.apply(this,arguments)},setChatBoxHeight:function(t){if(!this.model.get("minimized"))return this.__super__.setChatBoxHeight.apply(this,arguments)},setChatBoxWidth:function(t){if(!this.model.get("minimized"))return this.__super__.setChatBoxWidth.apply(this,arguments)},onMinimizedChanged:function(t){t.get("minimized")?this.minimize():this.maximize()},onMaximized:function(){t.chatboxviews.trimChats(this),l.refreshWebkit(),this.$content.scrollTop(this.model.get("scroll")),this.setChatState(t.ACTIVE).focus(),this.scrollDown(),t.emit("chatBoxMaximized",this)},onMinimized:function(){l.refreshWebkit(),t.emit("chatBoxMinimized",this)},maximize:function(){var e=t.chatboxviews;return this.$el.insertAfter(e.get("controlbox").$el).show("fast",this.onMaximized.bind(this)),this},minimize:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.save({scroll:this.$content.scrollTop()}),this.setChatState(t.INACTIVE).model.minimize(),this.$el.hide("fast",this.onMinimized.bind(this))}},ChatRoomView:{events:{"click .toggle-chatbox-button":"minimize"},initialize:function(){this.model.on("change:minimized",function(t){t.get("minimized")?this.hide():this.maximize()},this);var t=this.__super__.initialize.apply(this,arguments);return this.model.get("minimized")&&this.hide(),t}},ChatBoxes:{chatBoxMayBeShown:function(t){return this.__super__.chatBoxMayBeShown.apply(this,arguments)&&!t.get("minimized")}},ChatBoxViews:{showChat:function(t){var e=this.__super__.showChat.apply(this,arguments);return e.get("minimized")&&e.maximize(),e},getChatBoxWidth:function(t){return!t.model.get("minimized")&&t.$el.is(":visible")?t.$el.outerWidth(!0):0},getShownChats:function(){return this.filter(function(t){return!t.model.get("minimized")&&!t.model.get("closed")&&t.$el.is(":visible")})},trimChats:function(e){var n=this.getShownChats();if(!(t.no_trimming||n.length<=1)&&this.getChatBoxWidth(n[0])!==r("body").outerWidth(!0)){var i,s,a,c=t.minimized_chats.$el,l=o.contains(this.model.pluck("minimized"),!0)?c.outerWidth(!0):0,u=e?e.model.get("id"):null;s=o.reduce(this.xget(u),function(t,e){return t+this.getChatBoxWidth(e)}.bind(this),e?e.$el.outerWidth(!0):0),l+s>r("body").outerWidth(!0)&&(i=this.getOldestMaximizedChat([u]),i&&(a=this.get(i.get("id")),a&&a.$el.hide(),i.minimize()))}},getOldestMaximizedChat:function(t){t.push("controlbox");for(var e=0,n=this.model.sort().at(e);o.contains(t,n.get("id"))||n.get("minimized")===!0;)if(e++,n=this.model.at(e),!n)return null;return n}}},initialize:function(){this.updateSettings({no_trimming:!1}),t.MinimizedChatBoxView=Backbone.View.extend({tagName:"div",className:"chat-head",events:{"click .close-chatbox-button":"close","click .restore-chat":"restore"},initialize:function(){this.model.messages.on("add",function(t){t.get("message")&&this.updateUnreadMessagesCounter()},this),this.model.on("change:minimized",this.clearUnreadMessagesCounter,this),this.model.on("showReceivedOTRMessage",this.updateUnreadMessagesCounter,this),this.model.on("showSentOTRMessage",this.updateUnreadMessagesCounter,this)},render:function(){var e=o.extend(this.model.toJSON(),{tooltip:u("Click to restore this chat")});return"chatroom"===this.model.get("type")?(e.title=this.model.get("name"),this.$el.addClass("chat-head-chatroom")):(e.title=this.model.get("fullname"),this.$el.addClass("chat-head-chatbox")),this.$el.html(t.templates.trimmed_chat(e))},clearUnreadMessagesCounter:function(){this.model.set({num_unread:0}),this.render()},updateUnreadMessagesCounter:function(){this.model.set({num_unread:this.model.get("num_unread")+1}),this.render()},close:function(e){e&&e.preventDefault&&e.preventDefault(),this.remove();var n=t.chatboxviews.get(this.model.get("id"));return n?n.close():(this.model.destroy(),t.emit("chatBoxClosed",this)),this},restore:o.debounce(function(t){t&&t.preventDefault&&t.preventDefault(),this.model.messages.off("add",null,this),this.remove(),this.model.maximize()},200,!0)}),t.MinimizedChats=Backbone.Overview.extend({el:"#minimized-chats",events:{"click #toggle-minimized-chats":"toggle"},initialize:function(){this.initToggle(),this.model.on("add",this.onChanged,this),this.model.on("destroy",this.removeChat,this),this.model.on("change:minimized",this.onChanged,this),this.model.on("change:num_unread",this.updateUnreadMessagesCounter,this)},tearDown:function(){return this.model.off("add",this.onChanged),this.model.off("destroy",this.removeChat),this.model.off("change:minimized",this.onChanged),this.model.off("change:num_unread",this.updateUnreadMessagesCounter),this},initToggle:function(){this.toggleview=new t.MinimizedChatsToggleView({model:new t.MinimizedChatsToggle});var e=a("converse.minchatstoggle"+t.bare_jid);this.toggleview.model.id=e,this.toggleview.model.browserStorage=new Backbone.BrowserStorage[t.storage](e),this.toggleview.model.fetch()},render:function(){return 0===this.keys().length?(this.$el.hide(),t.chatboxviews.trimChats.bind(t.chatboxviews)):1!==this.keys().length||this.$el.is(":visible")||this.$el.show("fast",t.chatboxviews.trimChats.bind(t.chatboxviews)),this.$el},toggle:function(t){t&&t.preventDefault&&t.preventDefault(),this.toggleview.model.save({collapsed:!this.toggleview.model.get("collapsed")}),this.$(".minimized-chats-flyout").toggle()},onChanged:function(t){"controlbox"!==t.get("id")&&(t.get("minimized")?this.addChat(t):this.get(t.get("id"))&&this.removeChat(t))},addChat:function(e){var n=this.get(e.get("id"));if(!n||0===n.$el.parent().length){var i=new t.MinimizedChatBoxView({model:e});this.$(".minimized-chats-flyout").append(i.render()),this.add(e.get("id"),i),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()}},removeChat:function(t){this.remove(t.get("id")),this.toggleview.model.set({num_minimized:this.keys().length}),this.render()},updateUnreadMessagesCounter:function(){var t,e=this.model.pluck("num_unread"),n=0;for(t=0;t<e.length;t++)n+=e[t];this.toggleview.model.set({num_unread:n}),this.render()}}),t.MinimizedChatsToggle=Backbone.Model.extend({initialize:function(){this.set({collapsed:this.get("collapsed")||!1,num_minimized:this.get("num_minimized")||0,num_unread:this.get("num_unread")||0})}}),t.MinimizedChatsToggleView=Backbone.View.extend({el:"#toggle-minimized-chats",initialize:function(){this.model.on("change:num_minimized",this.render,this),this.model.on("change:num_unread",this.render,this),this.$flyout=this.$el.siblings(".minimized-chats-flyout")},render:function(){return this.$el.html(t.templates.toggle_chats(o.extend(this.model.toJSON(),{Minimized:u("Minimized")}))),this.model.get("collapsed")?this.$flyout.hide():this.$flyout.show(),
this.$el}});var e=function(e,n){var i=n.$el.find(".toggle-chatbox-button"),s=t.templates.chatbox_minimize(o.extend({info_minimize:u("Minimize this chat box")}));i.length?i.replaceWith(s):n.$el.find(".close-chatbox-button").after(s)};t.on("chatBoxOpened",e),t.on("chatRoomOpened",e),t.on("controlBoxOpened",function(e,n){t.connection.connected&&t.chatboxviews.trimChats(n)})}})}),function(t,e){define("converse-dragresize",["converse-core","converse-api","converse-chatview","converse-muc","converse-controlbox"],e)}(this,function(t,e){"use strict";var n=e.env.jQuery,i=e.env._;e.plugins.add("converse-dragresize",{overrides:{registerGlobalEventHandlers:function(){return n(document).on("mousemove",function(t){return!this.resizing||!this.allow_dragresize||(t.preventDefault(),void this.resizing.chatbox.resizeChatBox(t))}.bind(this)),n(document).on("mouseup",function(t){if(!this.resizing||!this.allow_dragresize)return!0;t.preventDefault();var e=this.applyDragResistance(this.resizing.chatbox.height,this.resizing.chatbox.model.get("default_height")),n=this.applyDragResistance(this.resizing.chatbox.width,this.resizing.chatbox.model.get("default_width"));this.connection.connected?(this.resizing.chatbox.model.save({height:e}),this.resizing.chatbox.model.save({width:n})):(this.resizing.chatbox.model.set({height:e}),this.resizing.chatbox.model.set({width:n})),this.resizing=null}.bind(this)),this.__super__.registerGlobalEventHandlers.apply(this,arguments)},ChatBox:{initialize:function(){var e=this.__super__.initialize.apply(this,arguments),n=this.get("height"),i=this.get("width"),s="controlbox"===this.get("id")?this.set.bind(this):this.save.bind(this);return s({height:t.applyDragResistance(n,this.get("default_height")),width:t.applyDragResistance(i,this.get("default_width"))}),e}},ChatBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},render:function(){var t=this.__super__.render.apply(this,arguments);return this.setWidth(),t},setWidth:function(){this.model.get("width")&&this.$el.css("width",this.model.get("width"))},_show:function(){this.initDragResize().setDimensions(),this.__super__._show.apply(this,arguments)},initDragResize:function(){var e=this.$el.find(".box-flyout");if("undefined"==typeof this.model.get("height")){var n=e.height(),i=e.width();this.model.set("height",n),this.model.set("default_height",n),this.model.set("width",i),this.model.set("default_width",i)}var s=e.css("min-width"),r=e.css("min-height");return this.model.set("min_width",s.endsWith("px")?Number(s.replace(/px$/,"")):0),this.model.set("min_height",r.endsWith("px")?Number(r.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,t.connection.connected&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},setDimensions:function(){this.adjustToViewport(),this.setChatBoxHeight(this.model.get("height")),this.setChatBoxWidth(this.model.get("width"))},setChatBoxHeight:function(e){e=e?t.applyDragResistance(e,this.model.get("default_height"))+"px":"",this.$el.children(".box-flyout")[0].style.height=e},setChatBoxWidth:function(e){e=e?t.applyDragResistance(e,this.model.get("default_width"))+"px":"",this.$el[0].style.width=e,this.$el.children(".box-flyout")[0].style.width=e},adjustToViewport:function(){var t=Math.max(document.documentElement.clientWidth,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight,window.innerHeight||0);t<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):t<=this.model.get("width")?this.model.set("width",void 0):e<=this.model.get("height")&&this.model.set("height",void 0)},onStartVerticalResize:function(e){return!t.allow_dragresize||(this.height=this.$el.children(".box-flyout").height(),t.resizing={chatbox:this,direction:"top"},void(this.prev_pageY=e.pageY))},onStartHorizontalResize:function(e){return!t.allow_dragresize||(this.width=this.$el.children(".box-flyout").width(),t.resizing={chatbox:this,direction:"left"},void(this.prev_pageX=e.pageX))},onStartDiagonalResize:function(e){this.onStartHorizontalResize(e),this.onStartVerticalResize(e),t.resizing.direction="topleft"},resizeChatBox:function(e){var n;0===t.resizing.direction.indexOf("top")&&(n=e.pageY-this.prev_pageY,n&&(this.height=this.height-n>(this.model.get("min_height")||0)?this.height-n:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height))),t.resizing.direction.indexOf("left")!==-1&&(n=this.prev_pageX-e.pageX,n&&(this.width=this.width+n>(this.model.get("min_width")||0)?this.width+n:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))}},ControlBoxView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},renderLoginPanel:function(){var t=this.__super__.renderLoginPanel.apply(this,arguments);return this.initDragResize().setDimensions(),t},renderContactsPanel:function(){var t=this.__super__.renderContactsPanel.apply(this,arguments);return this.initDragResize().setDimensions(),t}},ChatRoomView:{events:{"mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.__super__.initialize.apply(this,arguments)},render:function(){var t=this.__super__.render.apply(this,arguments);return this.setWidth(),t}}},initialize:function(){var t=this.converse;this.updateSettings({allow_dragresize:!0}),t.applyDragResistance=function(t,e){if("undefined"!=typeof t){if("undefined"==typeof e)return t;var n=10;return t!==e&&Math.abs(t-e)<n?e:t}}}})}),function(t,e){define("converse-headline",["converse-core","converse-api","converse-chatview"],e)}(this,function(t,e){"use strict";var n=e.env.jQuery,i=e.env._,s=e.env.utils,r=s.__.bind(t),o=function(e){var i=n(e),r=i.attr("from");return s.isHeadlineMessage(e)&&(t.chatboxes.create({id:r,jid:r,fullname:r,type:"headline"}).createMessage(i,void 0,e),t.emit("message",e)),!0};e.plugins.add("converse-headline",{overrides:{ChatBoxViews:{onChatBoxAdded:function(e){var n=this.get(e.get("id"));return n||"headline"!==e.get("type")?this.__super__.onChatBoxAdded.apply(this,arguments):(n=new t.HeadlinesBoxView({model:e}),this.add(e.get("id"),n),n)}}},initialize:function(){t.HeadlinesBoxView=t.ChatBoxView.extend({className:"chatbox headlines",events:{"click .close-chatbox-button":"close","click .toggle-chatbox-button":"minimize","keypress textarea.chat-textarea":"keyPressed","mousedown .dragresize-top":"onStartVerticalResize","mousedown .dragresize-left":"onStartHorizontalResize","mousedown .dragresize-topleft":"onStartDiagonalResize"},initialize:function(){"undefined"!=typeof this.setDimensions&&n(window).on("resize",i.debounce(this.setDimensions.bind(this),100)),this.disable_mam=!0,this.model.messages.on("add",this.onMessageAdded,this),this.model.on("show",this.show,this),this.model.on("destroy",this.hide,this),this.model.on("change:minimized",this.onMinimizedChanged,this),this.render().fetchMessages().insertIntoDOM().hide(),t.emit("chatBoxInitialized",this)},render:function(){return this.$el.attr("id",this.model.get("box_id")).html(t.templates.chatbox(i.extend(this.model.toJSON(),{show_toolbar:t.show_toolbar,show_textarea:!1,title:this.model.get("fullname"),unread_msgs:r("You have unread messages"),info_close:r("Close this box"),info_minimize:r("Minimize this box"),label_personal_message:""}))),"undefined"!=typeof this.setWidth&&n(window).on("resize",i.debounce(this.setWidth.bind(this),100)),this.$content=this.$el.find(".chat-content"),t.emit("chatBoxOpened",this),s.refreshWebkit(),this}});var e=function(){t.connection.addHandler(o,null,"message")};t.on("connected",e),t.on("reconnected",e)}})}),"undefined"!=typeof define&&define("converse",["converse-api","locales","converse-chatview","converse-controlbox","converse-otr","converse-ping","converse-notification","converse-minimize","converse-dragresize","converse-headline"],function(t){return t.env.jQuery(window).trigger("converse-loaded",t),window.converse=t,t}),require(["converse"]),define("jquery",[],function(){return jQuery}),define("jquery-private",[],function(){return jQuery});